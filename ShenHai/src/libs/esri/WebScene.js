// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});c.updateOrigins=function(f){f&&f.writtenProperties&&f.writtenProperties.forEach(function(f){var c=f.target;f.newOrigin&&f.oldOrigin!==f.newOrigin&&n.isMultiOriginJSONMixin(c)&&c.updateOrigin(f.propName,f.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(q,
c,n){Object.defineProperty(c,"__esModule",{value:!0});c.createCopyError=function(){return new n("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};c.isCopyError=function(f){return f&&"webscene:failed-to-copy-embedded-resources"===f.name};c.createSchemaValidationError=function(f){return new n("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:f})};c.isSchemaValidationError=
function(f){return f&&"webscene:schema-validation"===f.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(q,c,n,f,m,k,g,l,p,a,b,d,e,h){function N(a,b,e,d){2===a.length?(t[0]=a[0],t[1]=a[1],t[2]=0,a=t):a===e&&(g.vec3.copy(t,a),a=t);return v(a,b,0,e,d,0,1)}function v(a,b,e,d,h,u,v){void 0===v&&(v=1);b=G(b,h,I).projector;if(f.isNone(b))return!1;if(b===x){if(a===d&&e===u)return!0;for(b=e+3*v;e<b;e++,u++)d[u]=a[e];return!0}for(v=e+3*v;e<v;e+=3,u+=3)b(a,e,d,u);return!0}function R(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=m.getMetersPerUnitForSR(a,
1));return a.wkt===c.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===c.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function x(a,b,e,d){e[d++]=a[b++];e[d++]=a[b++];e[d]=a[b]}function U(a,b,d,h){d[h++]=T*(a[b++]/e.earthRadius);d[h++]=T*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/e.earthRadius)));d[h]=a[b]}function W(a,b,d,h){var M=.4999999*Math.PI,
M=n.clamp(Q*a[b+1],-M,M),M=Math.sin(M);d[h++]=Q*a[b]*e.earthRadius;d[h++]=e.halfEarthRadius*Math.log((1+M)/(1-M));d[h]=a[b+2]}function Z(a,b,e){b=R(b,O);b=L[b][6];if(f.isNone(b))return!1;b(a,0,t,0);e!==t&&(e[0]=t[0],e[1]=t[1],2<e.length&&(e[2]=t[2]));return!0}function E(a,b){t[0]=a.x;t[1]=a.y;t[2]=a.hasZ?a.z:0;return Z(t,a.spatialReference,b)}function C(a,b,d,h){var M=e.earthRadius+a[b+2],u=Q*a[b+1];a=Q*a[b];b=Math.cos(u);d[h++]=Math.cos(a)*b*M;d[h++]=Math.sin(a)*b*M;d[h]=Math.sin(u)*M}function r(a,
b,d,u){var M=h.Vec3Compact.length(a,b),f=n.asinClamped(a[b+2]/(0===M?1:M)),v=Math.cos(f)*M;a=(0<a[b+1]?1:-1)*n.acosClamped(a[b]/(0===v?1:v));d[u++]=T*a;d[u++]=T*f;d[u]=M-e.earthRadius}function D(a,b,e,d){var h=Y,M=Q*a[b],u=Q*a[b+1];a=a[b+2];b=Math.sin(u);var u=Math.cos(u),f=h.a/Math.sqrt(1-h.e2*b*b);e[d++]=(f+a)*u*Math.cos(M);e[d++]=(f+a)*u*Math.sin(M);e[d++]=(f*(1-h.e2)+a)*b}function w(a,b,e,d){var h=Y,M=a[b],u=a[b+1];a=a[b+2];var f,v,c,N,S,ca;b=Math.abs(a);f=M*M+u*u;v=Math.sqrt(f);c=f+a*a;N=Math.sqrt(c);
M=Math.atan2(u,M);S=a*a/c;c=f/c;u=h.a2/N;f=h.a3-h.a4/N;.3<c?(S=b/N*(1+c*(h.a1+u+S*f)/N),N=Math.asin(S),u=S*S,c=Math.sqrt(1-u)):(c=v/N*(1-S*(h.a5-u-c*f)/N),N=Math.acos(c),u=1-c*c,S=Math.sqrt(u));ca=1-h.e2*u;u=h.a/Math.sqrt(ca);h=h.a6*u;u=v-u*c;f=b-h*S;b=c*u+S*f;v=c*f-S*u;h=v/(h/ca+b);N+=h;0>a&&(N=-N);e[d++]=T*M;e[d++]=T*N;e[d]=b+v*h/2}function G(a,b,e){if(e.source.spatialReference===a&&e.dest.spatialReference===b)return e;var d=R(a,e.source),h=R(b,e.dest);0===d&&0===h?a.equals(b)?e.projector=x:e.projector=
null:e.projector=L[d][h];return e}Object.defineProperty(c,"__esModule",{value:!0});var z,y,A,B,F,J,K,H;c.SphericalECEFSpatialReference=new a({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});c.WGS84ECEFSpatialReference=new a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
c.canProject=function(a,b){return!!G(a,b,I).projector};c.vectorToVector=N;c.pointToPoint=function(a,b,e,d){void 0===e&&(e=b.spatialReference);void 0===d&&(d=0);t[0]=a.x;t[1]=a.y;var h=a.z;t[2]=void 0!==h?h:d;if(!v(t,a.spatialReference,0,t,e,0,1))return!1;b.x=t[0];b.y=t[1];b.spatialReference=e;void 0!==h?(b.z=t[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};c.pointToVector=function(a,b,e,d){void 0===d&&(d=0);t[0]=a.x;t[1]=a.y;var h=a.z;t[2]=void 0!==h?h:d;return v(t,a.spatialReference,0,b,e,0,1)};
c.vectorToPoint=function(a,b,e,h){e instanceof p?h=h||e.spatialReference:d.isPoint(e)?(e.hasZ=!0,h=h||e.spatialReference):(h=e,e=new p({spatialReference:h}));return v(a,b,0,t,h,0,1)?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=h,e):null};c.xyzToVector=function(a,b,e,d,h,u){t[0]=a;t[1]=b;t[2]=e;return v(t,d,0,h,u,0,1)};c.bufferToBuffer=v;c.computeLinearTransformation=function(a,b,e,d){var h=R(a,O),u=R(d,P);if(h===u&&1!==u&&(0!==h||a.equals(d)))return k.mat4.identity(e),k.mat4.translate(e,e,b),!0;
if(1===u){a=L[h][6];u=L[6][u];if(f.isNone(a)||f.isNone(u))return!1;a(b,0,V,0);u(V,0,aa,0);a=Q*V[0];u=Q*V[1];b=Math.sin(a);a=Math.cos(a);d=Math.sin(u);u=Math.cos(u);e[0]=-b;e[4]=-d*a;e[8]=u*a;e[12]=aa[0];e[1]=a;e[5]=-d*b;e[9]=u*b;e[13]=aa[1];e[2]=0;e[6]=u;e[10]=d;e[14]=aa[2];e[3]=0;e[7]=0;e[11]=0;e[15]=1;return!0}if(3===u&&(2===h||1===h)){a=L[h][6];if(f.isNone(a))return!1;a(b,0,V,0);b=Q*V[1];W(V,0,aa,0);k.mat4.identity(e);k.mat4.translate(e,e,aa);b=1/Math.cos(b);k.mat4.scale(e,e,[b,b,1]);return!0}return!1};
c.transformDirection=function(a,b,e,d,h){g.vec3.copy(u,a);g.vec3.add(ba,a,b);N(u,e,u,h);N(ba,e,ba,h);g.vec3.subtract(d,ba,u);g.vec3.normalize(d,d)};c.mbsToMbs=function(a,b,d,h){b=G(b,h,X);if(b.projector===x)return d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],!0;if(f.isNone(b.projector))return!1;h=b.source;var u=b.dest;if(3===u.spatialReferenceId){b=L[h.spatialReferenceId][2];if(f.isNone(b))return!1;b(a,0,V,0);b=Math.abs(Q*V[1])+Math.asin(a[3]/(e.earthRadius+a[2]));W(V,0,d,0);d[3]=b>.9999*Math.PI?Number.MAX_VALUE:
1/Math.cos(b)*a[3];return!0}b.projector(a,0,d,0);d[3]=a[3]*h.metersPerUnit/u.metersPerUnit;return!0};c.extentToBoundingBox=function(a,b,e){if(null==a)return!1;var d;t[0]=null!=a.xmin?a.xmin:0;t[1]=null!=a.ymin?a.ymin:0;t[2]=null!=a.zmin?a.zmin:0;d=v(t,a.spatialReference,0,b,e,0,1);t[0]=null!=a.xmax?a.xmax:0;t[1]=null!=a.ymax?a.ymax:0;t[2]=null!=a.zmax?a.zmax:0;d=d&&v(t,a.spatialReference,0,b,e,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==
a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return d};c.extentToBoundingRect=function(a,b,e){if(null==a)return!1;var d;t[0]=null!=a.xmin?a.xmin:0;t[1]=null!=a.ymin?a.ymin:0;t[2]=null!=a.zmin?a.zmin:0;d=v(t,a.spatialReference,0,t,e,0,1);b[0]=t[0];b[1]=t[1];t[0]=null!=a.xmax?a.xmax:0;t[1]=null!=a.ymax?a.ymax:0;t[2]=null!=a.zmax?a.zmax:0;d=d&&v(t,a.spatialReference,0,t,e,0,1);b[2]=t[0];b[3]=t[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==
a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return d};c.boundingRectToBoundingRect=function(a,e,d,h){if(null==a)return!1;if(e.equals(h))return b.set(d,a),!0;var u;t[0]=a[0];t[1]=a[1];t[2]=0;u=v(t,e,0,t,h,0,1);d[0]=t[0];d[1]=t[1];t[0]=a[2];t[1]=a[3];t[2]=0;u=u&&v(t,e,0,t,h,0,1);d[2]=t[0];d[3]=t[1];return u};(function(a){a.x2lon=function(a){return a/e.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/e.earthRadius))};a.lon2x=function(a){return a*e.earthRadius};a.lat2y=
function(a){a=Math.sin(a);return e.earthRadius/2*Math.log((1+a)/(1-a))}})(c.webMercator||(c.webMercator={}));c.canProjectToWGS84ComparableLonLat=function(a){a=R(a,O);return!!L[a][6]};c.vectorToWGS84ComparableLonLat=Z;c.pointToWGS84ComparableLonLat=E;c.pointToWGS84ComparableLonLatPoint=function(a,b){var e=R(b.spatialReference,P);return f.isNone(L[6][e])?!1:E(a,t)?(b.x=t[0],b.y=t[1],b.z=t[2],!0):!1};c.wgs84ComparableLonLatToECEF=function(a,b,d,h){void 0===h&&(h=0);h=e.earthRadius+h;var u=Math.cos(d);
a[0]=Math.cos(b)*u*h;a[1]=Math.sin(b)*u*h;a[2]=Math.sin(d)*h};var L=(z={},z[2]=(y={},y[5]=null,y[6]=x,y[1]=C,y[0]=null,y[3]=W,y[2]=x,y[4]=D,y),z[5]=(A={},A[5]=x,A[6]=x,A[1]=C,A[0]=null,A[3]=null,A[2]=null,A[4]=D,A),z[3]=(B={},B[5]=null,B[6]=U,B[1]=function(a,b,e,d){U(a,b,e,d);C(e,d,e,d)},B[0]=null,B[3]=x,B[2]=U,B[4]=function(a,b,e,d){U(a,b,e,d);D(e,d,e,d)},B),z[4]=(F={},F[5]=w,F[6]=w,F[1]=function(a,b,e,d){w(a,b,e,d);C(e,d,e,d)},F[0]=null,F[3]=function(a,b,e,d){w(a,b,e,d);W(e,d,e,d)},F[2]=w,F[4]=
x,F),z[1]=(J={},J[5]=r,J[6]=r,J[1]=x,J[0]=null,J[3]=function(a,b,e,d){r(a,b,e,d);W(e,d,e,d)},J[2]=r,J[4]=function(a,b,e,d){r(a,b,e,d);D(e,d,e,d)},J),z[0]=(K={},K[5]=null,K[6]=null,K[1]=null,K[0]=x,K[3]=null,K[2]=null,K[4]=null,K),z[6]=(H={},H[5]=null,H[6]=x,H[1]=C,H[0]=null,H[3]=null,H[2]=x,H[4]=D,H),z),O={spatialReference:null,spatialReferenceId:0},P={spatialReference:null,spatialReferenceId:0},I={source:{spatialReference:null,spatialReferenceId:0},dest:{spatialReference:null,spatialReferenceId:0},
projector:x},X={source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:x},Q=n.deg2rad(1),T=n.rad2deg(1),Y={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},t=l.vec3f64.create(),V=l.vec3f64.create(),aa=l.vec3f64.create(),u=l.vec3f64.create(),ba=l.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require",
"exports","./math/mat4"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});c.mat4=n})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(q,c,n,f){function m(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function k(a,b,d){var e=b[0],h=b[1],f=b[2],v=b[3],c=b[4],x=b[5],k=b[6],g=b[7],l=b[8],m=b[9],p=b[10],r=b[11],n=b[12],w=b[13],q=b[14];
b=b[15];var z=d[0],y=d[1],A=d[2],B=d[3];a[0]=z*e+y*c+A*l+B*n;a[1]=z*h+y*x+A*m+B*w;a[2]=z*f+y*k+A*p+B*q;a[3]=z*v+y*g+A*r+B*b;z=d[4];y=d[5];A=d[6];B=d[7];a[4]=z*e+y*c+A*l+B*n;a[5]=z*h+y*x+A*m+B*w;a[6]=z*f+y*k+A*p+B*q;a[7]=z*v+y*g+A*r+B*b;z=d[8];y=d[9];A=d[10];B=d[11];a[8]=z*e+y*c+A*l+B*n;a[9]=z*h+y*x+A*m+B*w;a[10]=z*f+y*k+A*p+B*q;a[11]=z*v+y*g+A*r+B*b;z=d[12];y=d[13];A=d[14];B=d[15];a[12]=z*e+y*c+A*l+B*n;a[13]=z*h+y*x+A*m+B*w;a[14]=z*f+y*k+A*p+B*q;a[15]=z*v+y*g+A*r+B*b;return a}function g(a,b,d){var e=
b[0],h=b[1],f=b[2],v=b[3],c=e+e,x=h+h,k=f+f;b=e*c;var g=e*x,e=e*k,l=h*x,h=h*k,f=f*k,c=v*c,x=v*x,v=v*k;a[0]=1-(l+f);a[1]=g+v;a[2]=e-x;a[3]=0;a[4]=g-v;a[5]=1-(b+f);a[6]=h+c;a[7]=0;a[8]=e+x;a[9]=h-c;a[10]=1-(b+l);a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a}function l(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];a[3]=b[3]-d[3];a[4]=b[4]-d[4];a[5]=b[5]-d[5];a[6]=b[6]-d[6];a[7]=b[7]-d[7];a[8]=b[8]-d[8];a[9]=b[9]-d[9];a[10]=b[10]-d[10];a[11]=b[11]-d[11];a[12]=b[12]-d[12];a[13]=b[13]-
d[13];a[14]=b[14]-d[14];a[15]=b[15]-d[15];return a}Object.defineProperty(c,"__esModule",{value:!0});c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.set=function(a,b,d,e,h,f,v,c,x,k,g,l,m,p,r,n,w){a[0]=b;a[1]=d;a[2]=e;a[3]=h;a[4]=f;a[5]=v;a[6]=c;a[7]=x;a[8]=k;a[9]=g;a[10]=l;a[11]=m;a[12]=p;a[13]=r;a[14]=n;a[15]=w;return a};c.identity=m;c.transpose=
function(a,b){if(a===b){var d=b[1],e=b[2],h=b[3],f=b[6],c=b[7],k=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=d;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=f;a[11]=b[14];a[12]=h;a[13]=c;a[14]=k}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};c.invert=function(a,b){var d=b[0],e=b[1],h=b[2],f=b[3],c=b[4],k=b[5],x=b[6],g=b[7],l=b[8],m=b[9],p=b[10],n=b[11],r=b[12],q=b[13],w=b[14];
b=b[15];var G=d*k-e*c,z=d*x-h*c,y=d*g-f*c,A=e*x-h*k,B=e*g-f*k,F=h*g-f*x,J=l*q-m*r,K=l*w-p*r,H=l*b-n*r,L=m*w-p*q,O=m*b-n*q,P=p*b-n*w,I=G*P-z*O+y*L+A*H-B*K+F*J;if(!I)return null;I=1/I;a[0]=(k*P-x*O+g*L)*I;a[1]=(h*O-e*P-f*L)*I;a[2]=(q*F-w*B+b*A)*I;a[3]=(p*B-m*F-n*A)*I;a[4]=(x*H-c*P-g*K)*I;a[5]=(d*P-h*H+f*K)*I;a[6]=(w*y-r*F-b*z)*I;a[7]=(l*F-p*y+n*z)*I;a[8]=(c*O-k*H+g*J)*I;a[9]=(e*H-d*O-f*J)*I;a[10]=(r*B-q*y+b*G)*I;a[11]=(m*y-l*B-n*G)*I;a[12]=(k*K-c*L-x*J)*I;a[13]=(d*L-e*K+h*J)*I;a[14]=(q*z-r*A-w*G)*I;
a[15]=(l*A-m*z+p*G)*I;return a};c.adjoint=function(a,b){var d=b[0],e=b[1],h=b[2],f=b[3],c=b[4],k=b[5],x=b[6],g=b[7],l=b[8],m=b[9],p=b[10],n=b[11],r=b[12],q=b[13],w=b[14];b=b[15];a[0]=k*(p*b-n*w)-m*(x*b-g*w)+q*(x*n-g*p);a[1]=-(e*(p*b-n*w)-m*(h*b-f*w)+q*(h*n-f*p));a[2]=e*(x*b-g*w)-k*(h*b-f*w)+q*(h*g-f*x);a[3]=-(e*(x*n-g*p)-k*(h*n-f*p)+m*(h*g-f*x));a[4]=-(c*(p*b-n*w)-l*(x*b-g*w)+r*(x*n-g*p));a[5]=d*(p*b-n*w)-l*(h*b-f*w)+r*(h*n-f*p);a[6]=-(d*(x*b-g*w)-c*(h*b-f*w)+r*(h*g-f*x));a[7]=d*(x*n-g*p)-c*(h*n-
f*p)+l*(h*g-f*x);a[8]=c*(m*b-n*q)-l*(k*b-g*q)+r*(k*n-g*m);a[9]=-(d*(m*b-n*q)-l*(e*b-f*q)+r*(e*n-f*m));a[10]=d*(k*b-g*q)-c*(e*b-f*q)+r*(e*g-f*k);a[11]=-(d*(k*n-g*m)-c*(e*n-f*m)+l*(e*g-f*k));a[12]=-(c*(m*w-p*q)-l*(k*w-x*q)+r*(k*p-x*m));a[13]=d*(m*w-p*q)-l*(e*w-h*q)+r*(e*p-h*m);a[14]=-(d*(k*w-x*q)-c*(e*w-h*q)+r*(e*x-h*k));a[15]=d*(k*p-x*m)-c*(e*p-h*m)+l*(e*x-h*k);return a};c.determinant=function(a){var b=a[0],d=a[1],e=a[2],h=a[3],f=a[4],c=a[5],k=a[6],g=a[7],m=a[8],l=a[9],p=a[10],n=a[11],q=a[12],r=a[13],
D=a[14];a=a[15];return(b*c-d*f)*(p*a-n*D)-(b*k-e*f)*(l*a-n*r)+(b*g-h*f)*(l*D-p*r)+(d*k-e*c)*(m*a-n*q)-(d*g-h*c)*(m*D-p*q)+(e*g-h*k)*(m*r-l*q)};c.multiply=k;c.translate=function(a,b,d){var e=d[0],h=d[1];d=d[2];var f=void 0,c=void 0,k=void 0,g=void 0,m=void 0,l=void 0,p=void 0,n=void 0,q=void 0,r=void 0,D=void 0,w=void 0;b===a?(a[12]=b[0]*e+b[4]*h+b[8]*d+b[12],a[13]=b[1]*e+b[5]*h+b[9]*d+b[13],a[14]=b[2]*e+b[6]*h+b[10]*d+b[14],a[15]=b[3]*e+b[7]*h+b[11]*d+b[15]):(f=b[0],c=b[1],k=b[2],g=b[3],m=b[4],l=
b[5],p=b[6],n=b[7],q=b[8],r=b[9],D=b[10],w=b[11],a[0]=f,a[1]=c,a[2]=k,a[3]=g,a[4]=m,a[5]=l,a[6]=p,a[7]=n,a[8]=q,a[9]=r,a[10]=D,a[11]=w,a[12]=f*e+m*h+q*d+b[12],a[13]=c*e+l*h+r*d+b[13],a[14]=k*e+p*h+D*d+b[14],a[15]=g*e+n*h+w*d+b[15]);return a};c.scale=function(a,b,d){var e=d[0],h=d[1];d=d[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*h;a[5]=b[5]*h;a[6]=b[6]*h;a[7]=b[7]*h;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.rotate=
function(a,b,d,e){var h=e[0],c=e[1];e=e[2];var k=Math.sqrt(h*h+c*c+e*e),g=void 0,m=void 0,l=void 0,p=void 0,n=void 0,q=void 0,C=void 0,r=void 0,D=void 0,w=void 0,G=void 0,z=void 0,y=void 0,A=void 0,B=void 0,F=void 0,J=void 0,K=void 0,H=void 0,L=void 0,O=void 0,P=void 0,m=g=void 0;if(k<f.EPSILON)return null;k=1/k;h*=k;c*=k;e*=k;g=Math.sin(d);m=Math.cos(d);l=1-m;p=b[0];n=b[1];q=b[2];C=b[3];r=b[4];D=b[5];w=b[6];G=b[7];z=b[8];y=b[9];A=b[10];B=b[11];F=h*h*l+m;J=c*h*l+e*g;K=e*h*l-c*g;H=h*c*l-e*g;L=c*c*
l+m;O=e*c*l+h*g;P=h*e*l+c*g;g=c*e*l-h*g;m=e*e*l+m;a[0]=p*F+r*J+z*K;a[1]=n*F+D*J+y*K;a[2]=q*F+w*J+A*K;a[3]=C*F+G*J+B*K;a[4]=p*H+r*L+z*O;a[5]=n*H+D*L+y*O;a[6]=q*H+w*L+A*O;a[7]=C*H+G*L+B*O;a[8]=p*P+r*g+z*m;a[9]=n*P+D*g+y*m;a[10]=q*P+w*g+A*m;a[11]=C*P+G*g+B*m;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};c.rotateX=function(a,b,d){var e=Math.sin(d);d=Math.cos(d);var h=b[4],f=b[5],c=b[6],g=b[7],k=b[8],m=b[9],l=b[10],p=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],
a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=h*d+k*e;a[5]=f*d+m*e;a[6]=c*d+l*e;a[7]=g*d+p*e;a[8]=k*d-h*e;a[9]=m*d-f*e;a[10]=l*d-c*e;a[11]=p*d-g*e;return a};c.rotateY=function(a,b,d){var e=Math.sin(d);d=Math.cos(d);var h=b[0],f=b[1],c=b[2],g=b[3],k=b[8],m=b[9],l=b[10],p=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=h*d-k*e;a[1]=f*d-m*e;a[2]=c*d-l*e;a[3]=g*d-p*e;a[8]=h*e+k*d;a[9]=f*e+m*d;a[10]=c*e+l*d;a[11]=g*e+p*d;return a};c.rotateZ=function(a,
b,d){var e=Math.sin(d);d=Math.cos(d);var h=b[0],f=b[1],c=b[2],g=b[3],k=b[4],m=b[5],l=b[6],p=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=h*d+k*e;a[1]=f*d+m*e;a[2]=c*d+l*e;a[3]=g*d+p*e;a[4]=k*d-h*e;a[5]=m*d-f*e;a[6]=l*d-c*e;a[7]=p*d-g*e;return a};c.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};c.fromScaling=function(a,
b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotation=function(a,b,d){var e=d[0],h=d[1];d=d[2];var c=Math.sqrt(e*e+h*h+d*d),g=void 0,k=void 0,m=void 0;if(c<f.EPSILON)return null;c=1/c;e*=c;h*=c;d*=c;g=Math.sin(b);k=Math.cos(b);m=1-k;a[0]=e*e*m+k;a[1]=h*e*m+d*g;a[2]=d*e*m-h*g;a[3]=0;a[4]=e*h*m-d*g;a[5]=h*h*m+k;a[6]=d*h*m+e*g;a[7]=0;a[8]=e*d*m+h*g;a[9]=h*d*m-e*g;a[10]=d*d*m+k;a[11]=0;a[12]=0;a[13]=0;
a[14]=0;a[15]=1;return a};c.fromXRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=d;a[7]=0;a[8]=0;a[9]=-d;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromYRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-d;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=d;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromZRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=d;a[2]=0;a[3]=0;a[4]=
-d;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotationTranslation=g;c.fromQuat2=function(a,b){var d=p,e=-b[0],h=-b[1],f=-b[2],c=b[3],k=b[4],m=b[5],l=b[6],n=b[7],q=e*e+h*h+f*f+c*c;0<q?(d[0]=2*(k*c+n*e+m*f-l*h)/q,d[1]=2*(m*c+n*h+l*e-k*f)/q,d[2]=2*(l*c+n*f+k*h-m*e)/q):(d[0]=2*(k*c+n*e+m*f-l*h),d[1]=2*(m*c+n*h+l*e-k*f),d[2]=2*(l*c+n*f+k*h-m*e));g(a,b,d);return a};var p=n.create();c.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};
c.getScaling=function(a,b){var d=b[0],e=b[1],h=b[2],f=b[4],c=b[5],k=b[6],g=b[8],m=b[9];b=b[10];a[0]=Math.sqrt(d*d+e*e+h*h);a[1]=Math.sqrt(f*f+c*c+k*k);a[2]=Math.sqrt(g*g+m*m+b*b);return a};c.getRotation=function(a,b){var d=b[0]+b[5]+b[10],e=0;0<d?(e=2*Math.sqrt(d+1),a[3]=.25*e,a[0]=(b[6]-b[9])/e,a[1]=(b[8]-b[2])/e,a[2]=(b[1]-b[4])/e):b[0]>b[5]&&b[0]>b[10]?(e=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/e,a[0]=.25*e,a[1]=(b[1]+b[4])/e,a[2]=(b[8]+b[2])/e):b[5]>b[10]?(e=2*Math.sqrt(1+b[5]-b[0]-b[10]),
a[3]=(b[8]-b[2])/e,a[0]=(b[1]+b[4])/e,a[1]=.25*e,a[2]=(b[6]+b[9])/e):(e=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/e,a[0]=(b[8]+b[2])/e,a[1]=(b[6]+b[9])/e,a[2]=.25*e);return a};c.fromRotationTranslationScale=function(a,b,d,e){var h=b[0],f=b[1],c=b[2],k=b[3],g=h+h,m=f+f,l=c+c;b=h*g;var p=h*m,h=h*l,n=f*m,f=f*l,c=c*l,g=k*g,m=k*m,k=k*l,l=e[0],q=e[1];e=e[2];a[0]=(1-(n+c))*l;a[1]=(p+k)*l;a[2]=(h-m)*l;a[3]=0;a[4]=(p-k)*q;a[5]=(1-(b+c))*q;a[6]=(f+g)*q;a[7]=0;a[8]=(h+m)*e;a[9]=(f-g)*e;a[10]=(1-(b+n))*
e;a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};c.fromRotationTranslationScaleOrigin=function(a,b,d,e,h){var f=b[0],c=b[1],k=b[2],g=b[3],m=f+f,l=c+c,p=k+k;b=f*m;var n=f*l,q=f*p,f=c*l,c=c*p,r=k*p,k=g*m,l=g*l,D=g*p,w=e[0],G=e[1],p=e[2];e=h[0];g=h[1];h=h[2];var m=(1-(f+r))*w,z=(n+D)*w,w=(q-l)*w,n=(n-D)*G,r=(1-(b+r))*G,G=(c+k)*G,q=(q+l)*p,c=(c-k)*p;b=(1-(b+f))*p;a[0]=m;a[1]=z;a[2]=w;a[3]=0;a[4]=n;a[5]=r;a[6]=G;a[7]=0;a[8]=q;a[9]=c;a[10]=b;a[11]=0;a[12]=d[0]+e-(m*e+n*g+q*h);a[13]=d[1]+g-(z*
e+r*g+c*h);a[14]=d[2]+h-(w*e+G*g+b*h);a[15]=1;return a};c.fromQuat=function(a,b){var d=b[0],e=b[1],h=b[2];b=b[3];var f=d+d,c=e+e,k=h+h,d=d*f,g=e*f,e=e*c,m=h*f,l=h*c,h=h*k,f=b*f,c=b*c;b*=k;a[0]=1-e-h;a[1]=g+b;a[2]=m-c;a[3]=0;a[4]=g-b;a[5]=1-d-h;a[6]=l+f;a[7]=0;a[8]=m+c;a[9]=l-f;a[10]=1-d-e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.frustum=function(a,b,d,e,h,f,c){var k=1/(d-b),g=1/(h-e),m=1/(f-c);a[0]=2*f*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*f*g;a[6]=0;a[7]=0;a[8]=(d+b)*k;a[9]=(h+e)*g;a[10]=
(c+f)*m;a[11]=-1;a[12]=0;a[13]=0;a[14]=c*f*2*m;a[15]=0;return a};c.perspective=function(a,b,d,e,h){b=1/Math.tan(b/2);var f=void 0;a[0]=b/d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=h&&Infinity!==h?(f=1/(e-h),a[10]=(h+e)*f,a[14]=2*h*e*f):(a[10]=-1,a[14]=-2*e);return a};c.perspectiveFromFieldOfView=function(a,b,d,e){var h=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),c=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*
Math.PI/180);var k=2/(c+b),g=2/(h+f);a[0]=k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=0;a[7]=0;a[8]=-((c-b)*k*.5);a[9]=(h-f)*g*.5;a[10]=e/(d-e);a[11]=-1;a[12]=0;a[13]=0;a[14]=e*d/(d-e);a[15]=0;return a};c.ortho=function(a,b,d,e,h,f,c){var k=1/(b-d),g=1/(e-h),m=1/(f-c);a[0]=-2*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*m;a[11]=0;a[12]=(b+d)*k;a[13]=(h+e)*g;a[14]=(c+f)*m;a[15]=1;return a};c.lookAt=function(a,b,d,e){var h=void 0,c=void 0,k=void 0,g=void 0,l=void 0,p=void 0,
n=void 0,q=void 0,E=void 0,C=void 0,r=b[0],D=b[1];b=b[2];k=e[0];g=e[1];e=e[2];n=d[0];q=d[1];d=d[2];if(Math.abs(r-n)<f.EPSILON&&Math.abs(D-q)<f.EPSILON&&Math.abs(b-d)<f.EPSILON)return m(a);n=r-n;q=D-q;E=b-d;C=1/Math.sqrt(n*n+q*q+E*E);n*=C;q*=C;E*=C;h=g*E-e*q;c=e*n-k*E;k=k*q-g*n;(C=Math.sqrt(h*h+c*c+k*k))?(C=1/C,h*=C,c*=C,k*=C):k=c=h=0;g=q*k-E*c;l=E*h-n*k;p=n*c-q*h;(C=Math.sqrt(g*g+l*l+p*p))?(C=1/C,g*=C,l*=C,p*=C):p=l=g=0;a[0]=h;a[1]=g;a[2]=n;a[3]=0;a[4]=c;a[5]=l;a[6]=q;a[7]=0;a[8]=k;a[9]=p;a[10]=E;
a[11]=0;a[12]=-(h*r+c*D+k*b);a[13]=-(g*r+l*D+p*b);a[14]=-(n*r+q*D+E*b);a[15]=1;return a};c.targetTo=function(a,b,d,e){var h=b[0],f=b[1];b=b[2];var c=e[0],k=e[1],g=e[2];e=h-d[0];var m=f-d[1];d=b-d[2];var l=e*e+m*m+d*d;0<l&&(l=1/Math.sqrt(l),e*=l,m*=l,d*=l);var p=k*d-g*m,g=g*e-c*d,c=c*m-k*e,l=p*p+g*g+c*c;0<l&&(l=1/Math.sqrt(l),p*=l,g*=l,c*=l);a[0]=p;a[1]=g;a[2]=c;a[3]=0;a[4]=m*c-d*g;a[5]=d*p-e*c;a[6]=e*g-m*p;a[7]=0;a[8]=e;a[9]=m;a[10]=d;a[11]=0;a[12]=h;a[13]=f;a[14]=b;a[15]=1;return a};c.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};c.add=function(a,b,
d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];a[4]=b[4]+d[4];a[5]=b[5]+d[5];a[6]=b[6]+d[6];a[7]=b[7]+d[7];a[8]=b[8]+d[8];a[9]=b[9]+d[9];a[10]=b[10]+d[10];a[11]=b[11]+d[11];a[12]=b[12]+d[12];a[13]=b[13]+d[13];a[14]=b[14]+d[14];a[15]=b[15]+d[15];return a};c.subtract=l;c.multiplyScalar=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*d;a[5]=b[5]*d;a[6]=b[6]*d;a[7]=b[7]*d;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12]*d;a[13]=b[13]*d;a[14]=b[14]*
d;a[15]=b[15]*d;return a};c.multiplyScalarAndAdd=function(a,b,d,e){a[0]=b[0]+d[0]*e;a[1]=b[1]+d[1]*e;a[2]=b[2]+d[2]*e;a[3]=b[3]+d[3]*e;a[4]=b[4]+d[4]*e;a[5]=b[5]+d[5]*e;a[6]=b[6]+d[6]*e;a[7]=b[7]+d[7]*e;a[8]=b[8]+d[8]*e;a[9]=b[9]+d[9]*e;a[10]=b[10]+d[10]*e;a[11]=b[11]+d[11]*e;a[12]=b[12]+d[12]*e;a[13]=b[13]+d[13]*e;a[14]=b[14]+d[14]*e;a[15]=b[15]+d[15]*e;return a};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&
a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};c.equals=function(a,b){var d=a[0],e=a[1],h=a[2],c=a[3],g=a[4],k=a[5],m=a[6],l=a[7],p=a[8],n=a[9],q=a[10],C=a[11],r=a[12],D=a[13],w=a[14];a=a[15];var G=b[0],z=b[1],y=b[2],A=b[3],B=b[4],F=b[5],J=b[6],K=b[7],H=b[8],L=b[9],O=b[10],P=b[11],I=b[12],X=b[13],Q=b[14];b=b[15];return Math.abs(d-G)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(G))&&Math.abs(e-z)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(z))&&
Math.abs(h-y)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-A)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(g-B)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(k-F)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(F))&&Math.abs(m-J)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(J))&&Math.abs(l-K)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(K))&&Math.abs(p-H)<=f.EPSILON*Math.max(1,Math.abs(p),Math.abs(H))&&Math.abs(n-L)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(L))&&Math.abs(q-
O)<=f.EPSILON*Math.max(1,Math.abs(q),Math.abs(O))&&Math.abs(C-P)<=f.EPSILON*Math.max(1,Math.abs(C),Math.abs(P))&&Math.abs(r-I)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(I))&&Math.abs(D-X)<=f.EPSILON*Math.max(1,Math.abs(D),Math.abs(X))&&Math.abs(w-Q)<=f.EPSILON*Math.max(1,Math.abs(w),Math.abs(Q))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.mul=k;c.sub=l})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),
function(q,c,n,f,m,k,g,l){function p(a,b,d,f){var e,h;a instanceof g&&b instanceof g&&(d=b.longitude,f=b.latitude,h=a.latitude,e=a.longitude);a=n.deg2rad(h);f=n.deg2rad(f);e=n.deg2rad(e);b=n.deg2rad(d);d=Math.sin((a-f)/2);e=Math.sin((e-b)/2);d=2*n.asinClamped(Math.sqrt(d*d+Math.cos(a)*Math.cos(f)*e*e))*c.earthRadius;return Math.round(1E4*d)/1E4}function a(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(c,"__esModule",{value:!0});c.earthRadius=f.wgs84Radius;c.halfEarthRadius=c.earthRadius/
2;c.halfEarthCircumference=Math.PI*c.earthRadius;c.earthCircumference=2*c.halfEarthCircumference;c.metersPerDegree=c.halfEarthCircumference/180;c.getGreatCircleDistance=p;c.getGreatCircleSpanAt=function(a,b,d){var e=b.spatialReference,f=new g(b.x,a.y,e),h=new g(d.x,a.y,e);b=new g(a.x,b.y,e);a=new g(a.x,d.y,e);return{lon:p(f,h),lat:p(b,a)}};c.getLonDeltaForDistance=function(a,b){b/=c.earthRadius;a=n.deg2rad(a);b=Math.sin(b/2);a=Math.cos(a);a=2*n.asinClamped(Math.sqrt(b*b/(a*a)));return n.rad2deg(a)};
c.getLatDeltaForDistance=function(a){return n.rad2deg(a/c.earthRadius)};c.getMaxCameraAltitude=function(a){a=n.deg2rad(a/2);return(1-Math.sin(a))*c.earthRadius/Math.sin(a)};c.getViewExtentDistance=function(a,b){b=n.deg2rad(b/2);return 2*n.acosClamped((Math.pow(a+c.earthRadius,2)+Math.pow(c.earthRadius,2)-Math.pow((a+c.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+c.earthRadius),2)-a*a-2*a*c.earthRadius),2))/(2*(a+c.earthRadius)*c.earthRadius))*c.earthRadius};c.computeCartesianDistance=
function(a,f){a=l.wgs84ComparableLonLatToECEF(b,a.longitude,a.latitude,a.z||0);f=l.wgs84ComparableLonLatToECEF(d,f.longitude,f.latitude,f.z||0);f=[f[0]-a[0],f[1]-a[1],f[2]-a[2]];return Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])};c.longitudeToTimezone=a;c.positionToTimezone=function(b,d){d||(d={hours:0,minutes:0,seconds:0});d.hours=a(b[0],!0);b=d.hours%1;d.hours-=b;d.minutes=60*b;b=d.minutes%1;d.minutes-=b;d.seconds=Math.round(60*b);return d};c.distanceToIdealHorizon=function(a,b){b=b||c.earthRadius;
a=m.vec3.dot(a,a);return Math.sqrt(Math.abs(a-b*b))};var b=k.vec3f64.create(),d=k.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});(function(c){c.length=function(f,c){var k=f[c],g=f[c+1];f=f[c+2];return Math.sqrt(k*k+g*g+f*f)};c.normalize=function(f,c){var k=f[c],g=f[c+1],l=f[c+2],k=1/Math.sqrt(k*k+g*g+l*l);f[c]*=k;f[c+1]*=k;f[c+2]*=k};c.scale=function(f,c,k){f[c]*=k;f[c+1]*=
k;f[c+2]*=k};c.add=function(f,c,k,g,l,p){void 0===p&&(p=c);l=l||f;l[p]=f[c]+k[g];l[p+1]=f[c+1]+k[g+1];l[p+2]=f[c+2]+k[g+2]};c.subtract=function(f,c,k,g,l,p){void 0===p&&(p=c);l=l||f;l[p]=f[c]-k[g];l[p+1]=f[c+1]-k[g+1];l[p+2]=f[c+2]-k[g+2]}})(c.Vec3Compact||(c.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});c.isSpatialReferenceSupported=function(c,f){return null==c?!1:"2d"===f?!0:
"local"===f?!c.isGeographic:c.isWebMercator||c.isWGS84||4490===c.wkid}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});var n={width:600,height:400};c.getOptimalThumbnailSize=function(f,c){c=c||n;var k=c.width;c=c.height;var g=k/c;1.5>g?c=k/1.5:1.5<g&&(k=1.5*c);k>f.width&&(c*=f.width/k,k=f.width);c>f.height&&(k*=f.height/c,c=f.height);return{width:Math.round(k),height:Math.round(c)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),
function(q,c,n,f,m,k,g){return function(c){function l(a){a=c.call(this,a)||this;a.viewing=null;return a}n(l,c);a=l;l.prototype.clone=function(){return new a({viewing:this.viewing?this.viewing.clone():null})};var a;f([k.property({type:g,json:{write:!0}})],l.prototype,"viewing",void 0);return l=a=f([k.subclass("esri.webscene.ApplicationProperties")],l)}(k.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),
function(q,c,n,f,m,k,g,l){return function(c){function a(a){a=c.call(this,a)||this;a.search=null;return a}n(a,c);b=a;a.prototype.clone=function(){return new b(k.clone({search:this.search}))};var b;f([g.property({type:l,json:{write:!0}})],a.prototype,"search",void 0);return a=b=f([g.subclass("esri.webdoc.applicationProperties.Viewing")],a)}(g.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(q,c,n,f,m,k,g,l,p){var a=m.ofType(p);return function(b){function d(e){e=b.call(this,e)||this;e.addressSearchEnabled=!0;e.enabled=!0;e.hintText=null;e.layers=new a;return e}n(d,b);e=d;d.prototype.readAddressSearchEnabled=function(a){return!a};d.prototype.writeAddressSearchEnabled=function(a,b,e){b[e]=!a};d.prototype.clone=function(){return new e(g.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var e;f([l.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],d.prototype,"addressSearchEnabled",void 0);f([l.reader("addressSearchEnabled")],d.prototype,"readAddressSearchEnabled",null);f([l.writer("addressSearchEnabled")],d.prototype,"writeAddressSearchEnabled",null);f([l.property({type:Boolean,json:{write:!0,default:!0}})],d.prototype,"enabled",void 0);f([l.property({type:String,json:{write:!0}})],d.prototype,"hintText",void 0);
f([l.property({type:a,json:{write:{enabled:!0,isRequired:!0}}})],d.prototype,"layers",void 0);return d=e=f([l.subclass("esri.webdoc.applicationProperties.Search")],d)}(l.declared(k.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(q,c,n,f,m,k,g,l,p){return function(a){function b(b){b=a.call(this,b)||this;b.field=null;b.id=null;b.subLayer=null;return b}n(b,a);d=b;b.prototype.clone=function(){return new d(k.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var d;f([g.property({type:p,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);f([g.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);f([g.property({type:l.Integer,json:{write:!0}})],b.prototype,
"subLayer",void 0);return b=d=f([g.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(g.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(q,c,n,f,m,k,g){return function(c){function l(a){a=c.call(this,a)||this;a.exactMatch=!1;a.name=
null;a.type=null;return a}n(l,c);a=l;l.prototype.clone=function(){return new a({exactMatch:this.exactMatch,type:this.type,name:this.name})};var a;f([k.property({type:Boolean,json:{write:!0}})],l.prototype,"exactMatch",void 0);f([k.property({type:String,json:{write:!0}})],l.prototype,"name",void 0);f([k.enumeration.serializable()(g.kebabDict)],l.prototype,"type",void 0);return l=a=f([k.subclass("esri.webdoc.applicationProperties.SearchLayerField")],l)}(k.declared(m.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,c,n,f,m,k,g,l,p){var a=function(a,d,e){return{enabled:!e||!e.isPresentation}};return function(b){function d(a){a=b.call(this,a)||this;a.lighting=new l;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}n(d,b);e=d;d.prototype.clone=function(){return new e(this.cloneConstructProperties())};d.prototype.cloneConstructProperties=function(){return{lighting:l.prototype.clone.call(this.lighting),background:k.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var e;f([g.property({type:l,json:{write:!0}})],d.prototype,"lighting",void 0);f([g.property(p.backgroundProperty)],d.prototype,"background",void 0);f([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],d.prototype,"atmosphereEnabled",void 0);f([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],d.prototype,"starsEnabled",void 0);return d=e=f([g.subclass("esri.webscene.Environment")],d)}(g.declared(m.JSONSupport))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(q,c,n,f,m,k){return function(c){function g(a){a=c.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}n(g,c);m=g;g.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};g.prototype.writeDate=function(a,b,d){b[d]=a.getTime()};g.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};g.prototype.writedirectShadowsEnabled=function(a,b,d){a&&(b[d]=a)};g.prototype.writeDisplayUTCOffset=function(a,b){null!=
a&&(b.displayUTCOffset=a)};g.prototype.clone=function(){return new m(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var m;f([k.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],g.prototype,"date",void 0);f([k.reader("date",["datetime"])],g.prototype,"readDate",
null);f([k.writer("date")],g.prototype,"writeDate",null);f([k.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],g.prototype,"directShadowsEnabled",void 0);f([k.reader("directShadowsEnabled",["directShadows"])],g.prototype,"readDirectShadowsEnabled",null);f([k.writer("directShadowsEnabled")],g.prototype,"writedirectShadowsEnabled",null);f([k.property({type:Number,json:{write:!0}})],g.prototype,"displayUTCOffset",void 0);f([k.writer("displayUTCOffset")],g.prototype,"writeDisplayUTCOffset",
null);return g=m=f([k.subclass("esri.webscene.Lighting")],g)}(k.declared(m.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(q,c,n,f){Object.defineProperty(c,"__esModule",{value:!0});q={base:n,key:"type",typeMap:{color:f}};c.backgroundProperty={types:q,json:{read:function(c){return function(f,g,l){if(!f)return f;for(var k in c.typeMap)if(f.type===k)return g=new c.typeMap[k],g.read(f,l),g}}(q),write:{overridePolicy:function(c,
f,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,k,g,l){var p=k.strict()({color:"color"});return function(a){function b(b){return a.call(this,b)||this}n(b,a);b.prototype.normalizeCtorArgs=function(a){a&&a.type&&
(a=m({},a),delete a.type);return a};b.prototype.clone=function(){};f([l.property({type:p.apiValues,readOnly:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],b.prototype,"type",void 0);return b=f([l.subclass("esri.webscene.background.Background")],b)}(l.declared(g.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,c,n,f,m,k,g,l,p){var a=m({},l.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function d(a){a=b.call(this,a)||this;a.type="color";a.color=new k([0,0,0,1]);return a}n(d,b);e=d;d.prototype.clone=function(){return new e(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var e;f([g.enumeration.serializable()({color:"color"})],d.prototype,"type",void 0);f([g.property(a)],d.prototype,"color",void 0);return d=e=f([g.subclass("esri.webscene.background.ColorBackground")],
d)}(g.declared(p))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(q,c,n,f,m,k,g,l,p){return function(a){function b(b){b=a.call(this,b)||this;b.environment=new p;b.spatialReference=null;b.viewpoint=null;return b}n(b,a);d=b;Object.defineProperty(b.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new d({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var d;f([g.property({type:p,json:{write:{isRequired:!0}}})],b.prototype,"environment",void 0);f([g.property({type:l})],b.prototype,"spatialReference",void 0);f([g.property({type:["local","global"]})],b.prototype,"viewingMode",
null);f([g.property({type:m,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);return b=d=f([g.subclass("esri.webscene.InitialViewProperties")],b)}(g.declared(k))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(q,c,n,f,m,k,g,l,p){var a=m.ofType(p);return function(b){function d(e){e=
b.call(this,e)||this;e.slides=new a;return e}n(d,b);Object.defineProperty(d.prototype,"slides",{set:function(b){b&&(b=b.filter(function(a){return!!a.viewpoint}));this._set("slides",k.referenceSetter(b,this._get("slides"),a))},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};f([l.property({type:a,nonNullable:!0,json:{write:!0}}),l.cast(k.castForReferenceSetter)],d.prototype,"slides",null);return d=f([l.subclass("esri.webscene.Presentation")],
d)}(l.declared(g.JSONSupport))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/environment/SceneViewLighting ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(q,c,n,f,m,k,g,l,p,a,b,d,e,h,N,v,R,x,U,W,Z,E,C,r,D,w,G,z,y,A){function B(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function F(a){if(a=B(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function J(a,b){a=b-a;a>P&&(a-=O);a<-P&&(a+=O);return a}var K=0,H=b.ofType(y.default),L=h.getLogger("esri.webscene.Slide"),O=86400,P=43200;return function(e){function c(a){a=e.call(this,a)||this;a._applyToController=null;a.id=Date.now().toString(16)+
"-slide-"+K++;a.title=new A.default;a.description=new G.default;a.thumbnail=new r.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new D;a.visibleLayers=new H;return a}f(c,e);c.prototype.castTitle=function(a){return"string"===typeof a?new A.default({text:a}):R.ensureType(A.default,a)};c.prototype.castDescription=function(a){return"string"===typeof a?new G.default({text:a}):R.ensureType(G.default,a)};c.prototype.castThumbnail=function(a){return"string"===typeof a?new r.default({url:a}):
R.ensureType(r.default,a)};c.prototype.castBasemap=function(a){return Z.ensureType(a)};Object.defineProperty(c.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",d.referenceSetter(a,this._get("visibleLayers"),H))},enumerable:!0,configurable:!0});c.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof W){var b=F(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};
L.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};c.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};c.prototype._updateVisibleLayersFrom=function(a){var b=this,e=[];return N.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var d=F(b);e.push(new y.default({id:a.layer.id,sublayerIds:d}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(e)})};c.prototype.updateFrom=function(a,b){var e=this;b={screenshot:n({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){e.viewpoint=
a.viewpoint.clone();e.environment.lighting=w.prototype.clone.apply(a.environment.lighting);e.basemap=a.map.basemap&&a.map.basemap.clone()||null;e.ground=a.map.ground?z.default.fromGround(a.map.ground):null;return e._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){e.thumbnail=new r.default({url:a.dataUrl});return e})};c.prototype.applyTo=function(a,b){return g(this,void 0,void 0,function(){var e,d,c;return k(this,function(f){this._applyToController&&
this._applyToController.abort();this._applyToController=e=N.createAbortController();N.onAbortOrThrow(b,function(){return e.abort()});d=n({animate:!0},b,{signal:this._applyToController.signal});c=N.createDeferred(function(){e.abort()});this._applyTo(a,d,e).then(c.resolve,c.reject);return[2,c.promise]})})};c.prototype._applyTo=function(b,e,d){return g(this,void 0,void 0,function(){var c,f=this;return k(this,function(h){switch(h.label){case 0:return[4,a.result(function(){return g(f,void 0,void 0,function(){return k(this,
function(a){switch(a.label){case 0:return[4,this._applyBasemap(b,e)];case 1:return a.sent(),this._applyLayerVisibility(b),this._applyGround(b),[4,this._applyViewpoint(b,e)];case 2:return a.sent(),[2]}})})}())];case 1:c=h.sent();this._applyToController===d&&(this._applyToController=null);if(!1===c.ok)throw c.error;return[2,this]}})})};c.prototype._applyBasemap=function(a,b){return g(this,void 0,void 0,function(){var e;return k(this,function(d){switch(d.label){case 0:if(!this.basemap)return[3,5];d.label=
1;case 1:return d.trys.push([1,3,,4]),[4,this.basemap.load(b)];case 2:return d.sent(),[3,4];case 3:e=d.sent();if(N.isAbortError(e))throw e;return[3,4];case 4:a.map.basemap=Z.clonePreservingTiledLayers(this.basemap,a.map.basemap),d.label=5;case 5:return[2]}})})};c.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};c.prototype._allLayers=function(a){var e=new b;this._collectLayers(a,e);this._collectLayers(a.ground,e);return e};c.prototype._collectLayers=
function(a,b){var e=this;a.layers.forEach(function(a){b.add(a);a.layers&&e._collectLayers(a,b)})};c.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var e=b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=e;var d=e&&e.sublayerIds,e=B(a);d&&e&&e.forEach(function(a){return a.visible=0<=d.indexOf(a.id)})})};c.prototype._applyViewpoint=function(a,b){return g(this,void 0,void 0,function(){return k(this,function(e){switch(e.label){case 0:if(!this.viewpoint||
b.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return b.animate?this.get("environment.lighting.date")?[4,this._animateToLighting(a,b)]:[3,2]:[3,4];case 1:return e.sent(),[2];case 2:return a.environment.lighting=this.environment.lighting.clone(),[4,a.goTo(this.viewpoint,b)];case 3:e.sent(),e.label=4;case 4:return a.viewpoint=this.viewpoint,a.environment.lighting=this.environment.lighting.clone(),[3,6];case 5:a.environment.lighting=this.environment.lighting.clone(),e.label=6;case 6:return[2]}})})};
c.prototype._animateToLighting=function(a,b){return g(this,void 0,void 0,function(){var e,d,c,f=this;return k(this,function(h){e=null;"global"===a.viewingMode&&(e=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);d=a.goTo(this.viewpoint,b);d.then(function(){a.environment.lighting=
f.environment.lighting.clone()});c=function(){e&&e.remove();a.environment.lighting.cameraTrackingEnabled=!0};return[2,d.then(function(){a.environment.lighting=E.default.fromWebsceneLighting(f.environment.lighting);c()},function(a){c();throw a;})]})})};c.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};c.prototype._setTime=function(a,b,e){a.setTime(b);a.setUTCHours(e/3600);a.setUTCMinutes(e%3600/60);a.setUTCSeconds(e%3600%60);
return a};c.prototype._animateLightingWithCamera=function(a){var b=this,e=this._getTime(new Date(a.environment.lighting.date.toString())),d=e[0],c=e[1],e=this._getTime(this.environment.lighting.date),f=e[0],h=J(c,e[1]),g=a.renderCoordsHelper,k=U.vec3f64.create();g.toRenderCoords(a.camera.position,k);var l=U.vec3f64.create();g.toRenderCoords(this.viewpoint.camera.position,l);var m=U.vec3f64.create(),n=new Date;return a.watch("camera",function(e){g.toRenderCoords(e.position,m);var u=x.vec3.squaredDistance(k,
m),p=x.vec3.squaredDistance(l,m);e=0;0!==u+p&&(e=u/(u+p));u=d+(f-d)*e;e=C.moduloPositive(c+h*e,O);a.environment.lighting.date=b._setTime(n,u,e)})};c.createFrom=function(a,b){return(new this).updateFrom(a,b)};m([v.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);m([v.property({type:A.default,json:{default:function(){return new A.default({text:""})},write:{isRequired:!0}}})],c.prototype,"title",void 0);m([v.cast("title")],c.prototype,"castTitle",null);m([v.property({type:G.default,
json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],c.prototype,"description",void 0);m([v.cast("description")],c.prototype,"castDescription",null);m([v.property({type:r.default,json:{default:function(){return new r.default({url:""})},write:{isRequired:!0}}})],c.prototype,"thumbnail",void 0);m([v.cast("thumbnail")],c.prototype,"castThumbnail",null);m([v.property({type:p,nonNullable:!0,json:{write:{isRequired:!0}}})],c.prototype,"viewpoint",void 0);m([v.property({type:l,json:{read:{source:"baseMap"},
write:{target:"baseMap"}}})],c.prototype,"basemap",void 0);m([v.cast("basemap")],c.prototype,"castBasemap",null);m([v.property({type:z.default,json:{write:!0}})],c.prototype,"ground",void 0);m([v.property({type:H,json:{write:{isRequired:!0}}})],c.prototype,"visibleLayers",null);m([v.cast("visibleLayers")],c.prototype,"castVisibleLayers",null);m([v.property({type:D,json:{write:!0}})],c.prototype,"environment",void 0);return c=m([v.subclass("esri.webscene.Slide")],c)}(v.declared(e.JSONSupport))})},
"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),function(q,c,n,f,m,k,g,l){Object.defineProperty(c,"__esModule",{value:!0});q=function(a){function b(b){b=a.call(this,b)||this;b.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};b.cameraTrackingEnabled=
!0;b.ambientOcclusionEnabled=!1;var e=(new Date).getFullYear(),e=new Date("March 15, "+e+" 12:00:00 UTC");b._set("defaultDate",e);b._set("date",e);return b}n(b,a);d=b;b.fromWebsceneLighting=function(a){return new d(m({},a.cloneConstructProperties()))};Object.defineProperty(b.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});b.prototype.autoUpdate=function(a,b){var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=b.hours;this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=
!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);e!==d&&(p.target=this,p.timezoneOffset=d,this.emit("timezone-will-change",p));if(null!=a)return b!==a.getTime()};b.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),b=new d(m({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));
a&&b._set("date",b._get("defaultDate"));b.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;b.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;b.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;b.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return b};b.prototype.cloneWithWebsceneLighting=function(a){var b=this.clone();null!=a.date&&(b.date=a.date);b.directShadowsEnabled=a.directShadowsEnabled;b.displayUTCOffset=a.displayUTCOffset;return b};
b.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var d;f([g.property({type:Boolean})],b.prototype,"cameraTrackingEnabled",void 0);f([g.property({type:Boolean})],b.prototype,"ambientOcclusionEnabled",void 0);f([g.property({type:Date})],b.prototype,"defaultDate",null);f([g.property({type:Date})],b.prototype,"date",null);return b=d=f([g.subclass("esri.views.3d.environment.SceneViewLighting")],b)}(g.declared(k.EventedMixin(l)));c.SceneViewLighting=
q;var p={target:null,timezoneOffset:0};c.default=q})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,k){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a.url="";return a}n(g,c);m=g;g.prototype.clone=function(){return new m({url:this.url})};
var m;f([k.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"url",void 0);return g=m=f([k.subclass("esri.webdoc.support.Thumbnail")],g)}(k.declared(m.JSONSupport));c.default=q})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,k){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function g(){var a=
null!==c&&c.apply(this,arguments)||this;a.text="";return a}n(g,c);m=g;g.prototype.clone=function(){return new m({text:this.text})};var m;f([k.property({type:String,json:{write:!0}})],g.prototype,"text",void 0);return g=m=f([k.subclass("esri.webscene.support.Description")],g)}(k.declared(m.JSONSupport));c.default=q})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(q,c,n,f,m,k,g,l,p){Object.defineProperty(c,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.opacity=null;return b}n(b,a);d=b;b.prototype.clone=function(){return new d({opacity:this.opacity})};b.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new m;a.opacity=this.opacity;return a};b.fromGround=function(a){return new d({opacity:a.opacity})};var d;f([g.property({type:Number,json:{type:l.Integer,read:{reader:p.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,b){b.transparency=p.opacityToTransparency(a)},target:"transparency"}}})],b.prototype,"opacity",void 0);return b=d=f([g.subclass("esri.webscene.support.SlideGround")],b)}(g.declared(k.JSONSupport));c.default=q})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(q,c,n,f,m,k,g,l){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function a(a){a=c.call(this,a)||this;a.id="";a.sublayerIds=null;return a}n(a,c);b=a;a.prototype.clone=function(){return new b({id:this.id,sublayerIds:k.clone(this.sublayerIds)})};var b;f([g.property({type:String,json:{write:!0}})],a.prototype,"id",void 0);f([g.property({type:[l.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.prototype,"sublayerIds",void 0);return a=b=f([g.subclass("esri.webscene.support.SlideVisibleLayer")],
a)}(g.declared(m.JSONSupport));c.SlideVisibleLayer=q;c.default=q})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,k){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a.text="";return a}n(g,c);m=g;g.prototype.clone=function(){return new m({text:this.text})};
var m;f([k.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"text",void 0);return g=m=f([k.subclass("esri.webscene.support.Title")],g)}(k.declared(m.JSONSupport));c.default=q})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(q,c,n,f){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function f(f,k){return c.call(this,f,k,"webscene")||this}n(f,c);Object.defineProperty(f.prototype,"supportsGround",
{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return f}(f.Version);c.Version=q;c.default=q})},"esri/core/Version":function(){define(["require","exports","./Error"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});q=function(){function c(c,f,g){void 0===g&&(g="");this.major=c;this.minor=f;this._context=g}c.prototype.lessThan=
function(c,f){return this.major<c||c===this.major&&this.minor<f};c.prototype.since=function(c,f){return!this.lessThan(c,f)};c.prototype.validate=function(c){if(this.major!==c.major)throw new n((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:c});};c.prototype.clone=function(){return new c(this.major,this.minor,this._context)};c.parse=function(f,k){void 0===
k&&(k="");var g=f.split("."),l=g[0],g=g[1],m=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(m))throw new n((k&&k+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:f});if(!g||!g.match||!g.match(m))throw new n((k&&k+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:f});f=parseInt(l,10);l=parseInt(g,10);return new c(f,l,k)};return c}();c.Version=q})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),function(q,
c,n,f,m,k,g,l,p,a,b,d,e,h,N,v,R,x,U,W,Z,E,C,r,D,w,G,z,y,A,B,F,J,K,H,L,O,P,I,X,Q,T){var Y=W.getLogger("esri.WebScene"),t=new T.default(1,18);return function(a){function c(b){b=a.call(this,b)||this;b._handles=new h;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.presentation=new Q;b.initialViewProperties=new X;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=null;b._isAuthoringAppSetByUser=
!1;b._isAuthoringAppVersionSetByUser=!1;return b}n(c,a);c.prototype.initialize=function(){var a=this;this.when().catch(function(a){Y.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(M){this.addResolvingPromise(E.reject(M));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",function(){return a._scheduleLayersIdGC()}))};
c.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};c.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};c.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};c.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};c.prototype.writeLayers=function(a,b,c,e){var d=this,f=k({},e,{layerContainerType:"operational-layers"});
a=a.map(function(a){return d.verifyWriteLayer(a,e)?a.write(null,f):null}).filter(function(a){return!!a});b[c]=a.toArray()};c.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new e("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};c.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return new T.default(parseInt(a[0],10),parseInt(b,10))};c.prototype.writeSourceVersion=
function(a,b,c){b[c]=t.major+"."+t.minor};Object.defineProperty(c.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0});c.prototype.writeAuthoringApp=function(a,b){b.authoringApp=
a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(c.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});c.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:p.version};c.prototype.writeGround=function(a,b,c,e){b[c]=a?a.write(null,e):{transparency:0,layers:[]}};c.prototype.readInitialViewProperties=
function(a,c){a={};c.initialState&&c.initialState.environment&&(a.environment=I.fromJSON(c.initialState.environment));a.spatialReference=c.spatialReference?y.fromJSON(c.spatialReference):y.WebMercator;a.viewingMode=c.viewingMode||"global";c.initialState&&c.initialState.viewpoint&&(a.viewpoint=b.fromJSON(c.initialState.viewpoint));return new X(a)};c.prototype.writeInitialViewProperties=function(a,b,c,e){a&&(c={},a.environment&&(c.environment=a.environment.write({},e)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},
e)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},e):y.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};c.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return this.when()};c.prototype.loadAll=function(){var a=this;return U.default(this,function(b){var c=a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))})};c.prototype.read=
function(a,b){var c=this;b=k({},b,{origin:"web-scene"});var e=this._isAuthoringAppVersionSetByUser,d=this._isAuthoringAppSetByUser,f=arguments;w.readLoadable(this,a,function(b){return c.inherited(f,[a,b])},b);d||(this._isAuthoringAppSetByUser=!1);e||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var e=a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),g=this.presentation.slides,h=
function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},l=e.filter(function(a){return!g.some(function(b){return h(b,a.id)})});g.forEach(function(a){a.visibleLayers.addMany(l)})}};c.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=R.clone(b))};c.prototype.write=function(a,b){if("loaded"!==this.loadStatus){var c=new e("webscene:not-loaded",
"Web scene must be loaded before it can be serialized");Y.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=k({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);return c};c.prototype.save=function(a){return l(this,void 0,void 0,function(){var b,c,d;return g(this,function(f){switch(f.label){case 0:if(this.portalItem)return[3,2];Y.error("save(): requires the .portalItem property to be set");
return[4,E.reject(new e("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:f.sent(),f.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,E.reject(new e("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:f.sent(),f.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return f.sent(),[4,this._loadObjectsWithLayers()];case 6:return f.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",
url:this.portalItem.itemUrl&&C.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||F.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,c),[4,this._verifySave(d,c,a)];case 7:return f.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:d})];case 8:return f.sent(),D.updateOrigins(c),b?[4,b]:[3,10];case 9:f.sent(),f.label=10;case 10:return[4,this._saveThumbnail()];case 11:return f.sent(),[2,this.portalItem]}})})};c.prototype.saveAs=
function(a,b){return l(this,void 0,void 0,function(){var c,d,f,h,k,l;return g(this,function(g){switch(g.label){case 0:if(c=J.from(a))return[3,2];Y.error("saveAs(portalItem): requires a portal item parameter");return[4,E.reject(new e("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:g.sent(),g.label=2;case 2:return c.id&&(c=c.clone(),c.id=null),d=c.portal||F.getDefault(),[4,this.load()];case 3:return g.sent(),[4,this._loadObjectsWithLayers()];case 4:return g.sent(),
f=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:d,writtenProperties:[],blockedRelativeUrls:[]}),h=this.write(null,f),[4,this._verifySaveAs(h,f,b)];case 5:return g.sent(),[4,d._signIn()];case 6:return g.sent(),k=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl"),c.type="Web Scene",c.portal=d,this._updateTypeKeywords(c),[4,d.user.addItem({item:c,folder:b&&b.folder,data:h})];case 7:return g.sent(),this.portalItem=c,v.JSONSupport.prototype.read.call(this,{version:h.version,
authoringApp:h.authoringApp,authoringAppVersion:h.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:c.itemUrl&&C.urlToObject(c.itemUrl)}),D.updateOrigins(f),k&&(this.thumbnailUrl=l?C.addQueryParameter(k,"w","8192"):k),[4,this._saveThumbnail()];case 8:return g.sent(),[2,c]}})})};c.prototype._saveThumbnail=function(){return l(this,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:
[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};c.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var f=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new e(a.name,a.message,a.details)});b.blockedRelativeUrls&&(f=f.concat(b.blockedRelativeUrls.map(function(a){return new e("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));c&&c.ignoreUnsupported&&(f=f.filter(function(a){return"layer:unsupported"!==
a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(f=f.filter(function(a){return"web-document-write:property-required"!==a.name}));var g=c&&c.strictSchemaValidationEnabled;return(g?E.create(function(a){return q(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");Y.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new e("webscene:schema-validation",
a)})}).then(function(a){if(g&&0<a.length)throw K.createSchemaValidationError(a.concat(f));return f}):E.resolve(f)).then(function(a){if(0<a.length)return E.reject(new e("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};c.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?E.reject(K.createCopyError()):this._verifySave(a,b,c,!0)};c.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",
messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};c.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};c.prototype.updateFrom=function(a,b){void 0===b&&(b={});return l(this,void 0,void 0,function(){var c,e;return g(this,function(d){switch(d.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:d.sent();
if(e=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};c.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return l(this,void 0,void 0,function(){return g(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=I.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=
a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,
3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._updateFromThumbnail=function(a,b){return l(this,void 0,void 0,function(){var c,e;return g(this,function(d){switch(d.label){case 0:return c=O.getOptimalThumbnailSize(a,b),[4,a.takeScreenshot({format:"jpg",width:c.width,height:c.height,disableSlice:!0})];case 1:return e=d.sent(),this.thumbnailUrl=e.dataUrl,[2]}})})};c.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):
this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};c.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};c.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var e=0,d=a.baseMap.elevationLayers;e<d.length;e++)c.push(d[e]);var f=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));
return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:c}};c.prototype._loadFromJSON=function(a,b){var c=this,e=new d;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return E.create(function(a){return q(["./portal/support/layersCreator"],a)})}).then(function(d){var f=
c._extractOperationalLayers(a),g=f.operationalLayers,h=f.operationalElevationLayers,f=f.basemapElevationLayers,l=[],m={context:k({},b,{layerContainerType:"operational-layers"})};c.portalItem&&(m.context.portal=c.portalItem.portal||F.getDefault());if(0<f.length){var n=k({},m,{context:k({},m.context,{layerContainerType:"ground"})});n.defaultLayerType="ArcGISTiledElevationServiceLayer";l.push(d.populateOperationalLayers(c.ground.layers,f,n))}0<h.length&&(n=k({},m,{context:k({},m.context,{layerContainerType:"ground"})}),
n.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(d.populateOperationalLayers(e,h,n)));g&&0<g.length&&l.push(d.populateOperationalLayers(c.layers,g,m));return E.eachAlways(l).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(e)})};c.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())});
return E.eachAlways(a).then(function(){})};c.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new e("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new e("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=c;return b._readAndLoadFromJSON(c,{origin:"web-scene",url:C.urlToObject(a.itemUrl),
portal:a.portal||F.getDefault()})})};c.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!L.isSpatialReferenceSupported(b,"global"))return E.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||H.canProject(a,
b)}}else{if(!L.isSpatialReferenceSupported(b,"local"))return E.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},f=d(a.viewpoint);return f&&!c(f)?
E.reject(new e("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:f,sceneSpatialReference:b,viewingMode:a.viewingMode})):(f=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(f=d(f.viewpoint),E.reject(new e("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:f,sceneSpatialReference:b,viewingMode:a.viewingMode}))):E.resolve()};c.prototype._validateHeightModelInfo=function(){var a=A.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?E.reject(a):E.resolve()};c.prototype._validateJSON=function(a){var b=T.default.parse(a.version||"","webscene");t.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=y.WebMercator.toJSON());return a};c.prototype._updateTypeKeywords=function(a){"local"===
this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(c.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||
y.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?C.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});c.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};c.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};c.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};c.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));
(b=this.presentation&&this.presentation.slides)&&b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};c.fromJSON=function(a){if(!a)throw new e("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};c.VERSION=t;f([r.property({type:P,json:{write:!0}})],c.prototype,"applicationProperties",void 0);f([r.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],c.prototype,"basemap",void 0);
f([r.property({type:G,json:{read:{source:"clippingArea.geometry",reader:B.fromJSON},write:{target:"clippingArea.geometry"}}})],c.prototype,"clippingArea",void 0);f([r.writer("clippingArea")],c.prototype,"writeClippingArea",null);f([r.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],c.prototype,"clippingEnabled",void 0);f([r.reader("clippingEnabled",["clippingArea"])],c.prototype,"readClippingEnabled",null);f([r.writer("clippingEnabled")],c.prototype,"writeClippingEnabled",null);
f([r.property({type:z,json:{write:!0}})],c.prototype,"heightModelInfo",void 0);f([r.property({json:{write:{target:"operationalLayers"}}})],c.prototype,"layers",void 0);f([r.writer("layers")],c.prototype,"writeLayers",null);f([r.property({readOnly:!0,type:T.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],c.prototype,"sourceVersion",void 0);f([r.reader("sourceVersion",["version"])],c.prototype,"readSourceVersion",null);f([r.writer("sourceVersion")],c.prototype,"writeSourceVersion",
null);f([r.property({dependsOn:["portalItem.thumbnailUrl"]})],c.prototype,"thumbnailUrl",null);f([r.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringApp",null);f([r.writer("authoringApp")],c.prototype,"writeAuthoringApp",null);f([r.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringAppVersion",null);f([r.writer("authoringAppVersion")],c.prototype,"writeAuthoringAppVersion",null);f([r.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],
c.prototype,"ground",void 0);f([r.writer("ground")],c.prototype,"writeGround",null);f([r.property({type:Q,nonNullable:!0,json:{write:function(a,b,c,d){a.slides&&0<a.slides.length&&(c=k({},d,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],c.prototype,"presentation",void 0);f([r.property({type:X,nonNullable:!0,json:{default:function(){return new X({viewingMode:"global",spatialReference:y.WebMercator})}}})],c.prototype,"initialViewProperties",void 0);f([r.reader("initialViewProperties",["initialState.environment",
"spatialReference","viewingMode","initialState.viewpoint"])],c.prototype,"readInitialViewProperties",null);f([r.writer("initialViewProperties",{"initialState.environment":{type:I},spatialReference:{type:y},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],c.prototype,"writeInitialViewProperties",null);f([r.property({type:J})],c.prototype,"portalItem",void 0);f([r.property()],c.prototype,"resourceInfo",void 0);f([r.property()],c.prototype,"_sceneSpatialReference",null);f([r.property()],
c.prototype,"_verifyItemRelativeRootPath",null);return c=f([r.subclass("esri.WebScene")],c)}(r.declared(x.LoadableMixin(Z.EsriPromiseMixin(v.JSONSupportMixin(a)))))});