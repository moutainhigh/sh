// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Graphic ../../intl ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/string ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../intl/date ../../intl/number ../../layers/support/fieldUtils ../../popup/content/TextContent ../../popup/content/support/ChartMediaInfoValueSeries ../../popup/support/FieldInfoFormat ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(z,q,f,d,x,A,v,m,r,y,E,n,F,w,C,D,I,c,k,t,B,e,a,b,h,u,P,M){function Q(){return v(this,void 0,void 0,function(){return A(this,function(a){return[2,w.create(function(a){z(["../../support/arcadeUtils"],function(g){a(g)})})]})})}function G(a){var b=/(\n)/gi;return"string"===typeof a?a.replace(b,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):a}function J(a,b){return a&&"function"===typeof a.getField?a.getField(b):null}function K(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"\x26#"+
a.charCodeAt(0)+";"})}var R=["$datastore","$map","$layer"],H=F.getLogger("esri.widgets.FeatureViewModel"),N=/^\s*expression\//i,L=k.convertDateFormatToIntlOptions("short-date-short-time");return function(k){function l(a){var g=k.call(this,a)||this;g._handles=new E;g._featureAbortController=null;g._graphicChangedThrottled=D.throttle(g._graphicChanged,1,g);g._effectivePopupTemplate=null;g._contentResponse=null;g._graphic=null;g._fieldInfoMap=null;g.content=null;g.defaultPopupTemplateEnabled=!1;g.formattedAttributes=
null;g.graphic=null;g.lastEditInfo=null;g.title="";g.view=null;g._handles.add(I.init(g,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled".split(" "),function(){return g._graphicChangedThrottled()}));return g}f(l,k);l.prototype.destroy=
function(){this._clear();this._cancelFeatureQuery();this._handles.destroy();this._graphic=this.graphic=this._handles=null};Object.defineProperty(l.prototype,"spatialReference",{get:function(){return this.get("view.spatialReference")||null},set:function(a){void 0===a?this._clearOverride("spatialReference"):this._override("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"map",{get:function(){return this.get("view.map")||null},set:function(a){void 0===a?this._clearOverride("map"):
this._override("map",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"waitingForContent",{get:function(){return!!this._featureAbortController},enumerable:!0,configurable:!0});l.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};l.prototype._graphicChanged=function(){return v(this,void 0,void 0,function(){var a,p,b,O;return A(this,function(g){switch(g.label){case 0:this._cancelFeatureQuery();this._clear();this._graphic=
p=(a=this.graphic)?a.clone():null;if(!p)return[2];this._featureAbortController=b=w.createAbortController();g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._queryFeature({signal:b.signal})];case 2:return g.sent(),[3,4];case 3:return O=g.sent(),H.error("error","error loading template",O),[3,4];case 4:return this._featureAbortController=null,[2]}})})};l.prototype._cancelFeatureQuery=function(){var a=this._featureAbortController;a&&a.abort();this._featureAbortController=null};l.prototype._compileContent=
function(a,p){var g=this;if(a&&(a.nodeName||a&&M.isWidgetBase(a)||M.isWidget(a)))return a;if(this._graphic){if("string"===typeof a)return this._compileText(new e({text:a})).text;if(Array.isArray(a))return a.map(function(a,b){b=(b=p&&p[b])&&b.value;if("attachments"===a.type)return g._compileAttachments(a,b);if("fields"===a.type)return g._compileFields(a);if("media"===a.type)return g._compileMedia(a);if("text"===a.type)return g._compileText(a)});a&&H.warn("invalid content type.")}};l.prototype._compileFields=
function(a){var g=this,b=this._effectivePopupTemplate;a=n.clone(a);var h=b&&b.expressionInfos,b=a.fieldInfos?void 0:b&&b.fieldInfos,b=a.fieldInfos||n.clone(b),e=[];b&&b.forEach(function(a){var p=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||a.visible)p=g._isExpressionField(p)?g._getExpressionInfo(h,p):null,a.label=p?p.title:a.label,e.push(a)});a.fieldInfos=e;return a};l.prototype._setImageValue=function(a){var g=a.value,b=a.formattedAttributes;a=a.layer;var h=g.linkURL,e=g.sourceURL;
e&&(e=this._fixTokens(e,a),g.sourceURL=this._substituteAttributes(b,e));h&&(a=this._fixTokens(h,a),g.linkURL=this._substituteAttributes(b,a))};l.prototype._compileMedia=function(a){var g=this,b=this._graphic;a=n.clone(a);var h=a.mediaInfos,e=b.attributes,k=u.getSourceLayer(b),c=this.formattedAttributes.global,d=x({},c,e);a.mediaInfos=h&&h.map(function(a){if(a=n.clone(a)){var p=a.title?g._processFieldsInLinks(a.title,d):"",b=a.caption?g._processFieldsInLinks(a.caption,d):"";a.title=p?g._substituteAttributes(c,
p):"";a.caption=b?g._substituteAttributes(c,b):"";if("image"===a.type)return p=a.value,g._setImageValue({value:p,formattedAttributes:c,layer:k}),a.value.sourceURL?a:void 0;if("pie-chart"===a.type||"line-chart"===a.type||"column-chart"===a.type||"bar-chart"===a.type)return p=a.value,g._setChartValue({value:p,chartType:a.type,attributes:e,formattedAttributes:c,layer:k}),a}}).filter(Boolean);return a};l.prototype._normalizeTemplateFields=function(a){var g=this._fieldInfoMap.get(a.toLowerCase());return"{"+
(g&&g.fieldName||a)+"}"};l.prototype._substituteAttributes=function(a,p){var g=this;return(""+this._removeEmptyHref(r.substitute(C.replace(p,function(a){return g._normalizeTemplateFields(a)}),a))).trim()};l.prototype._compileText=function(a){if((a=n.clone(a))&&a.text){var g=this.formattedAttributes.global,b=this._processFieldsInLinks(a.text,x({},g,this._graphic.attributes));a.text=this._substituteAttributes(g,b)}return a};l.prototype._formatEditInfo=function(a,b){var g=a.creatorField,p=a.creationDateField,
h=a.editorField;if(b){a=b[a.editDateField];if("number"===typeof a)return b=b[h],g=r.formatDate(a,L),{type:"edit",date:g,user:b};p=b[p];if("number"===typeof p)return b=b[g],g=r.formatDate(p,L),{type:"create",date:g,user:b}}};l.prototype._compileLastEditInfo=function(){var a=this._effectivePopupTemplate,b=this._graphic;if(a){var a=a.lastEditInfoEnabled,h=b.get("sourceLayer.editFieldsInfo");if(a&&h)return this._formatEditInfo(h,b.attributes)}};l.prototype._compileTitle=function(){var a=this._effectivePopupTemplate,
b=this._graphic,h=a&&a.title,e=b.attributes,a=this.formattedAttributes.global,b="function"===typeof h?h.call(null,{graphic:b}):h;return"string"===typeof b&&b?(b=this._processFieldsInLinks(b,x({},a,e)),this._substituteAttributes(a,b)):""};l.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var g=b.replace(N,"").toLowerCase(),p;a.some(function(a){return a.name.toLowerCase()===g?(p=a,!0):!1});return p}};l.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,
function(a,g,p){return(a=J(b,p))?"{"+a.name+"}":g})};l.prototype._encodeAttributes=function(a){var g=a?n.clone(a):{};Object.keys(g).forEach(function(a){var b=g[a];"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),g[a]=b)});return g};l.prototype._createfieldInfoMap=function(a,b){var g=this,p=new Map;a&&a.forEach(function(a){var h=g._getFixedFieldName(a.fieldName,b);a.fieldName=h;p.set(h.toLowerCase(),a)});return p};l.prototype._formatAttributeValue=function(a){var b=a.value,
g=a.fieldName,h=a.fieldInfos,e=a.fieldInfoMap;a=a.layer;if(null==b)return b;var c=this._getDomainName(g,b);return c||(c=this._getTypeName(g))?c:e.get(g.toLowerCase())?this._formatValueToFieldInfo(b,{fieldInfos:h,fieldName:g,layer:a}):(h=a&&a.fieldsIndex)&&h.isDateField(g)?r.formatDate(b,L):G(b)};l.prototype._formatAttributes=function(a){var b=this,g=this._graphic,h=u.getSourceLayer(g),e=n.clone(g.attributes);this.addRelatedFeatureAttributes(e);var c=this._createfieldInfoMap(a,h);this._fieldInfoMap=
c;Object.keys(e).forEach(function(g){e[g]=b._formatAttributeValue({fieldName:g,fieldInfos:a,fieldInfoMap:c,layer:h,value:e[g]})});return e};l.prototype._formatValueToFieldInfo=function(a,p){var g=p.fieldName,h=this._getFieldInfo(p.fieldInfos,g),e=n.clone(h),h=p.preventPlacesFormatting;(p=J(p.layer,g))&&"date"===p.type&&(p=e.format||new b,p.dateFormat=p.dateFormat||"short-date-short-time",e.format=p);e=e&&e.format;return"string"===typeof a||null==a||null==e?a:h?t.formatNumber(a,x({},t.convertNumberFormatToIntlOptions(e),
{minimumFractionDigits:0,maximumFractionDigits:20})):e.format(a)};l.prototype._getDomainName=function(a,b){if(this.isRelatedField(a))return null;var g=this._graphic,h=u.getSourceLayer(g);return h&&"function"===typeof h.getFieldDomain?(a=h.getFieldDomain(a,{feature:g}))&&"coded-value"===a.type?a.getName(b):null:null};l.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var g=b.toLowerCase(),h=void 0;a.some(function(a){return a.fieldName&&a.fieldName.toLowerCase()===g?(h=a,!0):!1});return h}};
l.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var b=this._graphic,g=u.getSourceLayer(b);if(!g||"function"!==typeof g.getFeatureType)return null;var h=g.typeIdField;return h&&a===h?(a=g.getFeatureType(b))?a.name:null:null};l.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};l.prototype._processFieldsInLinks=function(a,b){var g=this.get("_graphic.layer");a=this._fixTokens(a,g);var h=this._encodeAttributes(b),g=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;
return a?a.replace(g,function(a,g,p){g=(""+(g||p)).trim();return r.substitute(a,g&&"{"===g[0]?b:h)}):a};l.prototype._compileAttachments=function(a,b){a=n.clone(a);if(!b||b&&0===b.length)return a;a.attachmentInfos=b;return a};l.prototype._queryAttachments=function(){var a=this._graphic,b=u.getSourceLayer(a);if(!b)return w.resolve([]);if((b="scene"===b.type&&b.associatedLayer?b.associatedLayer:b)&&"function"===typeof b.queryAttachments){var e=b.objectIdField,c=(a=a.attributes)&&a[e],a=new h({objectIds:[c],
returnMetadata:!0});return b.queryAttachments(a).then(function(a){return a[c]||[]})}return w.resolve([])};l.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return w.resolve();var g={};a.forEach(function(a,h){"attachments"===a.type&&(a=b._queryAttachments())&&(g[h]=a)});return Object.keys(g).length?w.eachAlways(g):w.resolve()};l.prototype._getContent=function(){var a=this._effectivePopupTemplate,b=this._graphic,a=a&&a.content,b="function"===typeof a?a.call(null,{graphic:b}):
a;return w.isPromiseLike(b)?b:w.resolve(b)};l.prototype._querySourceLayer=function(a,b){var g=a.layer,h=a.outFields;a=a.objectIds;if("function"!==typeof g.queryFeatures||!a)return b=new y("query-required-fields","Could not query required fields for the specified layer. Some fields will not be available.",{outFields:h,objectIds:a}),H.warn("query-required-fields","Could not query required fields for the specified layer. Some fields will not be available."),w.reject(b);var e=g.createQuery();e.objectIds=
a;e.outFields=h;e.returnGeometry=!0;return g.queryFeatures(e,b).then(function(a){return a.features[0]})};l.prototype._queryRequiredFieldsFeature=function(a){var b=this,g=this._graphic,h=this._effectivePopupTemplate,e=g.sourceLayer;return e&&h?("function"===typeof e.load?e.load(a):w.resolve()).then(function(){var c=g.attributes[e.objectIdField],p="number"===typeof c?[c]:void 0;return h.getRequiredFields(e.fields).then(function(h){return B.featureHasFields(h,g)?null:b._querySourceLayer({layer:e,outFields:h,
objectIds:p},a)})}):w.resolve(null)};l.prototype._queryFeature=function(a){var b=this,g=this._featureAbortController,h=this._graphic;this._effectivePopupTemplate=h&&h.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled);return this._getContent().then(function(e){if(g===b._featureAbortController&&h){var c=b._checkForRelatedFeatures(e,a),k=b._createFormattedExpressions().then(function(a){h.attributes=x({},h.attributes,a)}),p=b._queryContentElements(e).then(function(a){return b._contentResponse=
a}),d=b._queryRequiredFieldsFeature(a).then(function(a){a&&(h.geometry=a.geometry,h.attributes=x({},h.attributes,a.attributes))});return w.eachAlways([c,k,p,d]).then(function(){if(g===b._featureAbortController&&h){b._set("formattedAttributes",b._createFormattedAttributes(e));b._set("title",b._compileTitle());var a=b._compileLastEditInfo();b._set("lastEditInfo",a||null);a=b._compileContent(e,b._contentResponse);b._set("content",a||null);return a}})}})};l.prototype._isExpressionField=function(a){return N.test(a)};
l.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+("string"===typeof a?G(K(a)):a)+"\x3c/li\x3e"}).join("")+"\x3c/ul\x3e"};l.prototype._formatArcadeDictionary=function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+a.keys().map(function(b){var g=a.field(b),g="string"===typeof g?G(K(g)):g;return"\x3ctr\x3e\x3cth\x3e"+b+"\x3c/th\x3e\x3ctd\x3e"+g+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};l.prototype._createFormattedExpressions=
function(){return v(this,void 0,void 0,function(){var a,b,h,e,c,k,d,u,t,l,B,f=this;return A(this,function(g){switch(g.label){case 0:return a=this,b=a._effectivePopupTemplate,h=a._graphic,e=b&&b.expressionInfos,c=[],k={},e&&e.length?[4,Q()]:[2,k];case 1:d=g.sent();u=function(a){var b="expression/"+a.name,g=d.createSyntaxTree(a.expression),e=R.filter(function(a){return d.hasVariable(g,a)});a=d.loadScriptDependencies(g,!0,e).then(function(){return v(f,void 0,void 0,function(){var a,c,u,p,t=this;return A(this,
function(l){a=this.spatialReference;c=d.getViewInfo({spatialReference:a});u=d.createExecContext(h,c);u.useAsync=!0;this._addVarsToContext(d,e,u,c);p=d.createFunction(g,u);return[2,d.executeAsyncFunction(p,u).then(function(a){k[b]="string"===typeof a?G(K(a)):Array.isArray(a)?t._formatArcadeArray(a):a&&"esri.arcade.Dictionary"===a.declaredClass?t._formatArcadeDictionary(a):a},function(a){return H.error("arcade-execution-error",a)})]})})});c.push(a)};t=0;for(l=e;t<l.length;t++)B=l[t],u(B);return[2,w.eachAlways(c).then(function(){return k})]}})})};
l.prototype._addVarsToContext=function(a,b,h,e){var g=this.graphic,c=this.map;b.forEach(function(b){b=b.toLowerCase();var k={map:c,spatialReference:e.sr};"$map"===b&&(h.vars[b]=a.convertMapToFeatureSetCollection(k));"$layer"===b&&(h.vars[b]=a.convertFeatureLayerToFeatureSet(g.sourceLayer,e.sr));"$datastore"===b&&(h.vars[b]=a.convertServiceUrlToWorkspace(g.sourceLayer.url,e.sr))})};l.prototype._createFormattedAttributes=function(a){var b=this,g=this._effectivePopupTemplate,h={global:this._formatAttributes(g&&
g.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,g){"fields"===a.type&&a.fieldInfos&&(h.content[g]=b._formatAttributes(a.fieldInfos))});return h};l.prototype._getAllFieldInfos=function(a){var b=this._effectivePopupTemplate,h=[];(b=b&&b.fieldInfos)&&h.push.apply(h,b);if(!a||!Array.isArray(a))return h;a.forEach(function(a){"fields"===a.type&&h.push.apply(h,a&&a.fieldInfos)});return h};l.prototype._checkForRelatedFeatures=function(a,b){var h=this._graphic;a=this._getAllFieldInfos(a);
return this.queryRelatedInfos(h,a,b)};l.prototype._getTooltip=function(a){var b=a.label;return"pie-chart"===a.chartType?b:b+":\n"+a.value};l.prototype._getChartOption=function(b){var h=b.value,g=b.attributes,e=b.formattedAttributes,c=b.fieldName,k=b.relatedFieldName,d=b.fieldInfos,t=b.chartType,l=b.index;b=u.getSourceLayer(this._graphic);var B=h.normalizeField,h=h.tooltipField,B=B?this.isRelatedField(B)?g[this.getRelatedFieldInfo(B).fieldName]:g[B]:null,f=k&&void 0!==g[k]?g[k]:void 0!==g[c]?g[c]:
e[c],f=void 0===f?null:f&&B?f/B:f,l=new a({x:l,y:f});if(this.isRelatedField(c))return e=this.getRelatedFieldInfo(c),c=(c=this.getRelatedFieldInfo(h))?c.fieldName:null,d=this._formatValueToFieldInfo(f,{fieldInfos:d,fieldName:k,layer:b,preventPlacesFormatting:!!B}),k=e?e.label||e.fieldName:k,l.tooltip=this._getTooltip({label:c&&void 0!==g[c]?g[c]:k,chartType:t,value:d}),l;g=this._getFieldInfo(d,c);k=this._getFixedFieldName(c,b);g=g?g.label||g.fieldName:c;l.tooltip=this._getTooltip({label:h&&void 0!==
e[h]?e[h]:g,chartType:t,value:e[k]});return l};l.prototype._getFixedFieldName=function(a,b){return(b=J(b,a))?b.name:a};l.prototype._getFixedFieldNames=function(a,b){var h=this;return a&&a.map(function(a){return h._getFixedFieldName(a,b)})};l.prototype._setChartValue=function(a){var b=this,h=a.value,g=a.attributes,e=a.formattedAttributes,c=a.chartType;a=a.layer;var k=this._effectivePopupTemplate,d=this.relatedInfoCount,u=h.fields,t=h.normalizeField;h.fields=this._getFixedFieldNames(u,a);t&&(h.normalizeField=
this._getFixedFieldName(t,a));if(u.some(function(a){return!!(null!=e[a]||b.isRelatedField(a)&&d)})){var l=k&&k.fieldInfos;u.forEach(function(a,k){b.isRelatedField(a)?h.series=h.series.concat(b._getRelatedChartInfos({fieldInfos:l,fieldName:a,formattedAttributes:e,chartType:c,value:h})):(a=b._getChartOption({value:h,index:k,attributes:g,chartType:c,formattedAttributes:e,fieldName:a,fieldInfos:l}),h.series.push(a))})}};l.prototype._getRelatedChartInfos=function(a){var b=this,h=a.fieldInfos,e=a.fieldName,
g=a.formattedAttributes,c=a.chartType,k=a.value,d=[];a=this.getRelatedFieldInfo(e);var u=a.fieldName,t=this.getRelatedInfo(a.layerId);if(!t)return d;a=t.relatedFeatures;t=t.relation;if(!t||!a)return d;t=t.cardinality;a.forEach(function(a,t){var l=a.attributes;l&&Object.keys(l).forEach(function(a){a===u&&d.push(b._getChartOption({value:k,index:t,attributes:l,formattedAttributes:g,fieldName:e,chartType:c,relatedFieldName:a,fieldInfos:h}))})});return"one-to-many"===t||"many-to-many"===t?d:[d[0]]};d([c.property()],
l.prototype,"_featureAbortController",void 0);d([c.property({readOnly:!0})],l.prototype,"content",void 0);d([c.property({type:Boolean})],l.prototype,"defaultPopupTemplateEnabled",void 0);d([c.property({readOnly:!0})],l.prototype,"formattedAttributes",void 0);d([c.property({type:m})],l.prototype,"graphic",void 0);d([c.property({readOnly:!0})],l.prototype,"lastEditInfo",void 0);d([c.property({dependsOn:["view"]})],l.prototype,"spatialReference",null);d([c.property({readOnly:!0})],l.prototype,"title",
void 0);d([c.property({dependsOn:["view"]})],l.prototype,"map",null);d([c.property({readOnly:!0,dependsOn:["_featureAbortController"]})],l.prototype,"waitingForContent",null);d([c.property()],l.prototype,"view",void 0);return l=d([c.subclass("esri.widgets.FeatureViewModel")],l)}(c.declared(P))})},"esri/core/throttle":function(){define(["require","exports"],function(z,q){function f(d,f,q,v){var m=null,r=1E3;"number"===typeof f?(r=f,v=q):(m=f,r=q);var y=0,x,n=function(){y=0;d.apply(v,x)};f=function(){for(var d=
[],f=0;f<arguments.length;f++)d[f]=arguments[f];m&&m.apply(v,d);x=d;r?y||(y=setTimeout(n,r)):n()};f.remove=function(){y&&(clearTimeout(y),y=0)};f.forceUpdate=function(){y&&(clearTimeout(y),n())};f.hasPendingUpdates=function(){return!!y};return f}Object.defineProperty(q,"__esModule",{value:!0});q.throttle=f;q.default=f})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(z,q){Object.defineProperty(q,"__esModule",{value:!0});q.getSourceLayer=function(f){if(f)return f.get("sourceLayer")||
f.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),function(z,q,f,d,x,A,v,m,r,y,E,n,F,w){var C=
new Map,D=m.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(m){function c(c){c=m.call(this,c)||this;c.relatedInfoCount=null;c.relatedInfos=new Map;return c}f(c,m);c.prototype.destroy=function(){this.relatedInfos.clear()};c.prototype.addRelatedFeatureAttributes=function(c){var d=this;this.relatedInfos.forEach(function(k){return d._addRelatedFeatureAttribute(c,k)})};c.prototype.getRelatedFieldInfo=function(c){if(-1===c.indexOf("relationships/"))return null;c=c.split("/").slice(1);
return{layerId:c[0],fieldName:c[1]}};c.prototype.getRelatedInfo=function(c){return this.relatedInfos.get(c.toString())};c.prototype.isRelatedField=function(c){void 0===c&&(c="");return c?-1!==c.indexOf("relationships/"):!1};c.prototype.queryRelatedInfos=function(c,d,f){var e=this;this.relatedInfos.clear();var a=w.getSourceLayer(c);if(!a)return r.resolve();var b=d.filter(function(a){return a&&e.isRelatedField(a.fieldName)});if(!b||!b.length)return r.resolve();this._createRelatedInfos(d,a);return this._queryLayerInfos(a,
f).then(function(a){e._updateRelatedInfoLayerInfos(a);return e._queryRelatedFeatureMap(c,f).then(function(a){Object.keys(a).forEach(function(b){e._setRelatedFeatures(a[b],b.toString())});return a})})};c.prototype._addRelatedFeatureAttribute=function(c,d){var k=this;c&&d&&(d.relatedFeatures&&d.relatedFeatures&&d.relatedFeatures.forEach(function(e){return k._addAttributesFromFeature(c,e,d)}),d.relatedStatsFeatures&&d.relatedStatsFeatures&&d.relatedStatsFeatures.forEach(function(e){return k._addAttributesFromFeature(c,
e,d)}))};c.prototype._updateRelatedInfoLayerInfo=function(c,d){if(c=c.value)this.getRelatedInfo(d).layerInfo=c.data};c.prototype._updateRelatedInfoLayerInfos=function(c){var d=this;Object.keys(c).forEach(function(k){return d._updateRelatedInfoLayerInfo(c[k],k.toString())})};c.prototype._addAttributesFromFeature=function(c,d,f){var e=this;c&&d&&f&&Object.keys(d.attributes).forEach(function(a){var b=e._relatedFieldInfoToString({layerId:f.relation.id.toString(),fieldName:a});c[b]=d.attributes[a]})};
c.prototype._relatedFieldInfoToString=function(c){return c?"relationships/"+c.layerId+"/"+c.fieldName:""};c.prototype._createRelatedInfoForFieldInfo=function(c,d){var k=this.getRelatedFieldInfo(c.fieldName);if(k){var e=k.layerId,k=k.fieldName;e&&(d=this.getRelatedInfo(e)||this._createRelatedInfo(e,d))&&(d.relatedFields.push(k),c.statisticType&&(c=new F({statisticType:c.statisticType,onStatisticField:k,outStatisticFieldName:k}),d.outStatistics.push(c)))}};c.prototype._createRelatedInfos=function(c,
d){var k=this;c.forEach(function(c){return k._createRelatedInfoForFieldInfo(c,d)})};c.prototype._queryRelatedFeatureMap=function(c,d){var k=this,e={};this.relatedInfos.forEach(function(a,b){a.layerInfo&&(e[b]=k._queryRelatedLayerFeatures(c,a,d))});return r.eachAlways(e)};c.prototype._queryLayerInfos=function(c,d){var k=this,e={};this.relatedInfos.forEach(function(a,b){a=a.relation;if(!a)throw b=new v("relation-required","A relation is required on a layer to retrieve related records."),D.error(b),
b;a=a.relatedTableId;if(!a)throw b=new v("A related table ID is required on a layer to retrieve related records."),D.error(b),b;a=c.url+"/"+a;var h=C.get(a),u=h?h:k._queryLayerInfo(a,d);h||C.set(a,u);e[b]=u});return r.eachAlways(e)};c.prototype._queryLayerInfo=function(c,d){return x(c,{query:{f:"json"},signal:d&&d.signal})};c.prototype._queryRelatedLayerFeatures=function(c,d,f){var e=w.getSourceLayer(c).layerId.toString(),a=d.layerInfo,b=d.queryTask,h=d.relation;if(e=this._getDestinationRelation(a,
e)){var h=h.keyField,u=e.keyField,e="string"===this._getDestinationFieldType(a,e)?u+"\x3d'"+c.attributes[h]+"'":u+"\x3d"+c.attributes[h];c=b.execute(new n({where:e,outFields:d.relatedFields}),f);d=d.outStatistics&&0<d.outStatistics.length&&a.supportsStatistics?b.execute(new n({where:e,outFields:d.relatedFields,outStatistics:d.outStatistics}),f):null;return r.eachAlways({features:c,statsFeatures:d?d:r.resolve()})}return r.resolve()};c.prototype._setRelatedFeatures=function(c,d){if(d=this.getRelatedInfo(d)){var f=
c.value;f&&(c=f.features,f=f.statsFeatures,c=c&&c.value,d.relatedFeatures=c?c.features:[],c=f&&f.value,d.relatedStatsFeatures=c?c.features:[])}};c.prototype._getRelation=function(c,d){if(!d.relationships)return null;var f=null;d.relationships.some(function(e){return e.id===parseInt(c,10)?(f=e,!0):!1});return f};c.prototype._createRelatedInfo=function(c,d){var f=this._getRelation(c,d);if(f){d=d.url+"/"+f.relatedTableId;var e=new E({url:d}),f={url:d,queryTask:e,relation:f,relatedFields:[],outStatistics:[]};
this.relatedInfos.set(c,f);return f}};c.prototype._getDestinationRelation=function(c,d){var f;c&&c.relationships&&c.relationships.some(function(c){return""+c.relatedTableId===d?(f=c,!0):!1});return f};c.prototype._getDestinationFieldType=function(c,d){var f=void 0;c.fields.some(function(c){return c.name===d.keyField?(f=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(c.type)?"number":"string",!0):!1});return f};d([y.aliasOf("relatedInfos.size")],
c.prototype,"relatedInfoCount",void 0);d([y.property()],c.prototype,"relatedInfos",void 0);return c=d([y.subclass("esri.widgets.Popup.support.RelatedFeatures")],c)}(y.declared(A))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(z,q){Object.defineProperty(q,"__esModule",{value:!0});var f=z.toUrl("../../../themes/base/images/files/");q.isSupportedImage=function(d){d=d.toLowerCase();return"image/bmp"===d||"image/emf"===d||"image/exif"===d||"image/gif"===
d||"image/x-icon"===d||"image/jpeg"===d||"image/png"===d||"image/tiff"===d||"image/x-wmf"===d};q.getIconPath=function(d){return d?"text/plain"===d?f+"text-32.svg":"application/pdf"===d?f+"pdf-32.svg":"text/csv"===d?f+"csv-32.svg":"application/gpx+xml"===d?f+"gpx-32.svg":"application/x-dwf"===d?f+"cad-32.svg":"application/postscript"===d||"application/json"===d||"text/xml"===d||"model/vrml"===d?f+"code-32.svg":"application/x-zip-compressed"===d||"application/x-7z-compressed"===d||"application/x-gzip"===
d||"application/x-tar"===d||"application/x-gtar"===d||"application/x-bzip2"===d||"application/gzip"===d||"application/x-compress"===d||"application/x-apple-diskimage"===d||"application/x-rar-compressed"===d||"application/zip"===d?f+"zip-32.svg":-1!==d.indexOf("image/")?f+"image-32.svg":-1!==d.indexOf("audio/")?f+"sound-32.svg":-1!==d.indexOf("video/")?f+"video-32.svg":-1!==d.indexOf("msexcel")||-1!==d.indexOf("ms-excel")||-1!==d.indexOf("spreadsheetml")?f+"excel-32.svg":-1!==d.indexOf("msword")||
-1!==d.indexOf("ms-word")||-1!==d.indexOf("wordprocessingml")?f+"word-32.svg":-1!==d.indexOf("powerpoint")||-1!==d.indexOf("presentationml")?f+"report-32.svg":f+"generic-32.svg":f+"generic-32.svg"}})},"esri/widgets/support/chartUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/_base/kernel @dojo/framework/shim/Promise".split(" "),function(z,q,f,d,x){function A(){var d=x.locale;if(!d)return"en_US";var f;if(!(f=q.locales[d])){d=d.split("-")[0].toLowerCase();
f=null;for(var m=0,n=Object.keys(q.locales);m<n.length;m++){var v=n[m];if(-1<v.indexOf(d)){f=q.locales[v];break}}}return f||"en_US"}Object.defineProperty(q,"__esModule",{value:!0});q.locales={ar:"ar","bs-ba":"bs_BA","ca-es":"ca_ES","cs-cz":"cs_CZ","da-dk":"da_DK","de-ch":"de_CH","de-de":"de_DE","el-gr":"el_GR","en-ca":"en_CA","en-us":"en_US","es-es":"es_ES","et-ee":"et_EE","fi-fi":"fi_FI","fr-fr":"fr_FR","he-il":"he_IL","hr-hr":"hr_HR","hu-hu":"hu_HU","id-id":"id_ID","it-it":"it_IT","ja-jp":"ja_JP",
"ko-kr":"ko_KR","lt-lt":"lt_LT","lv-lv":"lv_LV","nb-no":"nb_NO","nl-nl":"nl_NL","pl-pl":"pl_PL","pt-br":"pt_BR","pt-pt":"pt_PT","ro-ro":"ro_RO","ru-ru":"ru_RU","sl-sl":"sl_SL","sr-rs":"sr_RS","sv-se":"sv_SE","th-th":"th_TH","tr-tr":"tr_TR","uk-ua":"uk_UA","vi-vn":"vi_VN","zh-cn":"zh_Hans","zh-hk":"zh_Hant","zh-tw":"zh_Hant"};q.getChartLocale=A;var v,m;q.loadChartsModule=function(r){void 0===r&&(r=A());return d(this,void 0,void 0,function(){var q=this;return f(this,function(x){if(v&&r===m)return[2,
v];m=r;v=Promise.all([new Promise(function(d,f){z(["../../libs/amcharts4/index"],d,f)}),new Promise(function(d,f){z(["../../libs/amcharts4/lang/"+r],d,f)})]).then(function(n){var v=n[0],w=n[1];return d(q,void 0,void 0,function(){var d,n;return f(this,function(f){switch(f.label){case 0:return d=v.am4core,m===r&&(d.options.defaultLocale=w.default),"function"===typeof Object.assign?[3,2]:[4,new Promise(function(c,d){z(["@dojo/framework/shim/object"],c,d)})];case 1:n=f.sent(),Object.defineProperty(Object,
"assign",{value:n.assign,writable:!0,configurable:!0}),f.label=2;case 2:return[2,v]}})})},function(){return m=v=null});return[2,v]})})}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/string"],function(z,q,f,d){function x(d){var f=null;A.some(function(m){m.pattern.test(d)&&(f=m);return!!f});return f}Object.defineProperty(q,"__esModule",{value:!0});var A=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:f.view},
{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Explorer"},{id:"arcgis-navigator",
pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:f.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:f.openInApp,
appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Microsoft Power Bi"}];q.autoLink=function(f){if("string"!==typeof f||!f)return f;var m=x(f);if(!m)return f;var r=f.match(m.pattern),r=d.replace(m.label,{appName:m.appName,hierPart:r&&r[2]});return f.replace(m.pattern,
"\x3ca "+(m.target?'target\x3d"'+m.target+'"':"")+' href\x3d"$1" '+("_blank"===m.target?'rel\x3d"noreferrer"':"")+"\x3e"+r+"\x3c/a\x3e")}})},"*now":function(z){z(['dojo/i18n!*preload*esri/widgets/nls/Feature*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/i18n!./Feature/nls/Feature ../intl ../core/events ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/chartUtils ./support/uriUtils ./support/widget ./support/widgetUtils".split(" "),function(z,q,f,d,x,A,v,m,r,y,E,n,F,w,C,
D,I,c,k){var t={title:!0,content:!0,lastEditedInfo:!0};return function(q){function e(a){a=q.call(this,a)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._refreshTimers=new Map;a._mediaInfo=new Map;a._loadingChartsModule=null;a.graphic=null;a.defaultPopupTemplateEnabled=!1;a.label=m.widgetLabel;a.spatialReference=null;a.title=null;a.visibleElements=x({},t);a.map=null;a.view=null;a.viewModel=new w;return a}f(e,q);e.prototype.postInitialize=function(){var a=this;this.own(E.init(this,"viewModel.content",
function(){return a._setupMediaRefreshTimers()}))};e.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._destroyCharts()};e.prototype.destroyCharts=function(){return this._destroyCharts()};e.prototype.castVisibleElements=function(a){return x({},t,a)};e.prototype.render=function(){var a=c.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},c.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating",
"esri-feature__loading-spinner")})),b=this.visibleElements,h=this.viewModel,d=h.waitingForContent,h=h.title,h=b.title?c.tsx("h4",{class:"esri-feature__title",innerHTML:h}):null,b=b.content?c.tsx("div",{class:"esri-feature__main-container"},[this._renderContent(),this._renderLastEditInfo()]):null;return c.tsx("div",{class:this.classes("esri-feature","esri-widget")},c.tsx("div",{class:"esri-feature__size-container"},h,d?a:b))};e.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};e.prototype.nextMedia=
function(a){this._pageContentElementMedia(a,"next")};e.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};e.prototype._buildKey=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];c=this.get("viewModel.graphic.uid")||"0";b=b.join("-");return a+"__"+c+"-"+b};e.prototype._destroyCharts=function(){return v(this,void 0,void 0,function(){var a;return A(this,function(b){switch(b.label){case 0:return(a=this._loadingChartsModule)?[4,a]:[3,2];case 1:b.sent(),
b.label=2;case 2:return this._chartMap.forEach(function(a){return a.dispose()}),this._chartMap.clear(),[2]}})})};e.prototype._renderContent=function(){var a=this.viewModel.content;return a?"string"===typeof a?c.tsx("div",{key:"content-string",innerHTML:a}):c.isWidget(a)?c.tsx("div",{key:"content-widget"},a.render()):a instanceof HTMLElement?c.tsx("div",{key:"content-html-element",bind:a,afterCreate:this._attachToNode}):c.isWidgetBase(a)?c.tsx("div",{key:"content-dijit",bind:a.domNode,afterCreate:this._attachToNode}):
Array.isArray(a)?a.length?c.tsx("div",{key:"content-content-elements"},a.map(this._renderContentElement,this)):null:null:null};e.prototype._renderContentElement=function(a,b){var c=this.visibleElements;if("boolean"!==typeof c.content&&!c.content[a.type])return null;switch(a.type){case "attachments":return this._renderAttachments(a);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,b);default:return null}};e.prototype._renderAttachmentInfo=
function(a){var b,h,d=a.attachmentInfo,e=a.supportsResizeAttachments,f=d.contentType,k=d.orientationInfo,n=d.name,q=d.url;a="list"===a.contentElement.displayType?48:400;var k=(k=k?[k.rotation?"rotate("+k.rotation+"deg)":"",k.mirrored?"scaleX(-1)":""].join(" "):"")?{transform:k}:{},r=e&&C.isSupportedImage(f),t=-1===q.indexOf("?")?"?":"\x26",f=r?""+q+t+"w\x3d"+a:C.getIconPath(f);a=(b={},b["esri-feature__attachment-item-mask--icon"]=!r,b);b=(h={},h["esri-feature__attachments-image--resizable"]=e,h);
return c.tsx("li",{class:"esri-feature__attachments-item",key:d},c.tsx("a",{class:"esri-feature__attachments-item-link",href:q,rel:"noreferrer",target:"_blank"},c.tsx("div",{class:this.classes(a,"esri-feature__attachment-item-mask")},c.tsx("img",{styles:k,alt:"",class:this.classes(b,"esri-feature__attachments-image"),src:f}),c.tsx("span",{class:"esri-feature__attachments-image-overlay"},c.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),c.tsx("span",
{class:"esri-feature__attachments-filename"},n||m.noTitle)))};e.prototype._renderAttachments=function(a){var b=this,d,e=a.displayType,f=a.attachmentInfos,k=f&&f.length,n=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),e=(d={},d["esri-feature__attachments--list"]="preview"!==e,d["esri-feature__attachments--preview"]="preview"===e,d);return k?c.tsx("div",{key:"attachments-element",class:this.classes("esri-feature__attachments","esri-feature__content-element",e)},c.tsx("div",
{class:"esri-feature__attachments-title"},m.attach),c.tsx("ul",{class:"esri-feature__attachments-items"},f.map(function(c,d){return b._renderAttachmentInfo({attachmentInfo:c,attachmentInfoIndex:d,supportsResizeAttachments:n,contentElement:a})}))):null};e.prototype._forceLTR=function(a){return"\x26lrm;"+a};e.prototype._renderFieldInfo=function(a,b){var d,e=this.viewModel.formattedAttributes,f=e?e.content[b]||e.global:null,k=a.fieldName,e=a.label||k,f=f?null==f[k]?"":f[k]:"";a=!(!a.format||!a.format.dateFormat);
f="number"!==typeof f||a?I.autoLink(f):this._forceLTR(f);a=(d={},d["esri-feature__field-data--date"]=a,d);return c.tsx("tr",{key:this._buildKey("fields-element-info-row",b)},c.tsx("th",{key:this._buildKey("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:e}),c.tsx("td",{key:this._buildKey("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",a),innerHTML:f}))};e.prototype._renderFields=function(a,b){var d=this;return(a=a.fieldInfos)?c.tsx("div",
{key:this._buildKey("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},c.tsx("table",{class:"esri-widget__table",summary:m.fieldsSummary,key:this._buildKey("fields-element-table",b)},c.tsx("tbody",{key:this._buildKey("fields-element-table-body",b)},a.map(function(a){return d._renderFieldInfo(a,b)})))):null};e.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};e.prototype._clearMediaRefreshTimers=
function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};e.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};e.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+b+(d?"#":"")+d};e.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&
(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};e.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,c){return a._setupMediaRefreshTimer(c)})};e.prototype._updateMediaInfoTimestamp=function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,
c)});this.scheduleRender()};e.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,e=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(e.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(e.sourceURL,a)},b),this._refreshTimers.set(a,b))};e.prototype._renderMediaInfoType=function(a){var b=a.mediaInfo,d=a.contentElementIndex;a=a.activeMediaIndex;var e=b.title,e=void 0===e?"":e;if("image"===b.type){var f=b.value,k=b.refreshInterval,m=f.sourceURL,b=f.linkURL,f=this._shouldOpenInNewTab(b)?
"_blank":"_self",n="_blank"===f?"noreferrer":"",m=(k=k?this._mediaInfo.get(d):null)?k.sourceURL:m,d=c.tsx("img",{alt:e,key:this._buildKey("media-image",d,a,k?k.timestamp:0),src:m});return(a=b?c.tsx("a",{title:e,href:b,rel:n,target:f},d):null)?a:d}if(-1!==b.type.indexOf("chart"))return c.tsx("div",{key:this._buildKey("media-chart",d,a),bind:this,"data-media-info":b,"data-content-element-index":d,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies})};e.prototype._getChartDependencies=
function(a){var b=this,c=a["data-media-info"],d=a["data-content-element-index"],e=this._chartMap.get(d);e&&e.dispose();var f=c.value,k=c.type;this._loadingChartsModule=D.loadChartsModule().then(function(c){return b._renderChart({chartDiv:a,contentElementIndex:d,type:k,value:f,chartsModule:c})})};e.prototype._createPieChart=function(a){var b=a.chartsModule,c=b.am4charts;a=b.am4core.create(a.chartDiv,c.PieChart);a.rtl=k.isRTL();c=a.series.push(new c.PieSeries);c.labels.template.disabled=!0;c.ticks.template.disabled=
!0;c.dataFields.value="y";c.dataFields.category="x";c.tooltip.label.wrap=!0;c.tooltip.label.maxWidth=200;c.tooltip.label.rtl=a.rtl;return a};e.prototype._createXYChart=function(a){var b=a.type,c=a.value,d=a.chartsModule,e=d.am4core,d=d.am4charts;a=e.create(a.chartDiv,d.XYChart);a.rtl=k.isRTL();c=15<c.series.length;if("column-chart"===b){var f=a.xAxes.push(new d.CategoryAxis);f.dataFields.category="x";f.renderer.labels.template.disabled=!0;f.tooltip.label.wrap=!0;f.tooltip.label.maxWidth=200;f.tooltip.label.rtl=
a.rtl;f.tooltip.events.on("sizechanged",function(){f.tooltip.dy=-f.tooltip.contentHeight});var m=a.yAxes.push(new d.ValueAxis),n=m.renderer.labels.template;m.renderer.minLabelPosition=.05;m.renderer.maxLabelPosition=.95;n.wrap=!0;m=a.series.push(new d.ColumnSeries);m.dataFields.valueY="y";m.dataFields.categoryX="x";a.cursor=new d.XYCursor;c&&(a.scrollbarX=new e.Scrollbar)}if("bar-chart"===b){var q=a.yAxes.push(new d.CategoryAxis);q.dataFields.category="x";q.renderer.inversed=!0;q.renderer.labels.template.disabled=
!0;q.tooltip.label.wrap=!0;q.tooltip.label.maxWidth=200;q.tooltip.label.rtl=a.rtl;q.tooltip.events.on("sizechanged",function(){q.tooltip.dx=q.tooltip.contentWidth});m=a.xAxes.push(new d.ValueAxis);n=m.renderer.labels.template;m.renderer.minLabelPosition=.05;m.renderer.maxLabelPosition=.95;n.wrap=!0;m=a.series.push(new d.ColumnSeries);m.dataFields.valueX="y";m.dataFields.categoryY="x";a.cursor=new d.XYCursor;c&&(a.scrollbarY=new e.Scrollbar)}if("line-chart"===b){var r=a.xAxes.push(new d.CategoryAxis);
r.dataFields.category="x";r.renderer.labels.template.disabled=!0;r.tooltip.label.wrap=!0;r.tooltip.label.maxWidth=200;r.tooltip.label.rtl=a.rtl;r.tooltip.events.on("sizechanged",function(){r.tooltip.dy=-r.tooltip.contentHeight});m=a.yAxes.push(new d.ValueAxis);n=m.renderer.labels.template;m.renderer.minLabelPosition=.05;m.renderer.maxLabelPosition=.95;n.wrap=!0;m=a.series.push(new d.LineSeries);m.dataFields.categoryX="x";m.dataFields.valueY="y";a.cursor=new d.XYCursor;c&&(a.scrollbarX=new e.Scrollbar)}return a};
e.prototype._renderChart=function(a){var b=a.contentElementIndex,c=a.type,d=a.value,e=a.chartsModule;e.am4core.useTheme(e.am4themes_animated);a="pie-chart"===c?this._createPieChart(a):this._createXYChart(a);a.data=d.series.map(function(a){return{x:a.tooltip,y:a.y}});this._chartMap.set(b,a)};e.prototype._renderMediaInfo=function(a){var b=a.mediaInfo,d=a.contentElementIndex;a=this._renderMediaInfoType({mediaInfo:b,contentElementIndex:d,activeMediaIndex:a.activeMediaIndex});var e=b.title?c.tsx("div",
{key:this._buildKey("media-title",d),class:"esri-feature__media-item-title",innerHTML:b.title}):null,b=b.caption?c.tsx("div",{key:this._buildKey("media-caption",d),class:"esri-feature__media-item-caption",innerHTML:b.caption}):null;return c.tsx("div",{key:this._buildKey("media-container",d),class:"esri-feature__media-item-container"},c.tsx("div",{key:this._buildKey("media-item-container",d),class:"esri-feature__media-item"},a),e,b)};e.prototype._renderMediaPageButton=function(a,b){var d=(a="previous"===
a)?m.previous:m.next,e=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),f=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),k=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon",
"esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),n=a?this._previousClick:this._nextClick;return c.tsx("div",{key:this._buildKey(a?"media-previous":"media-next",b),title:d,tabIndex:0,role:"button",class:e,"data-content-element-index":b,bind:this,onkeydown:n,onclick:n},c.tsx("span",{"aria-hidden":"true",class:f}),c.tsx("span",{"aria-hidden":"true",class:k}),c.tsx("span",{class:"esri-icon-font-fallback-text"},d))};e.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],
c=y.eventKey(a);"ArrowLeft"===c&&(a.stopPropagation(),this.previousMedia(b));"ArrowRight"===c&&(a.stopPropagation(),this.nextMedia(b))};e.prototype._renderMedia=function(a,b){var d,e=(a=a.mediaInfos)&&a.length||0,f=(d={},d["esri-feature--media-pagination-visible"]=1<e,d);d=this._renderMediaPageButton("previous",b);var k=this._renderMediaPageButton("next",b),m=this._activeMediaMap.get(b);isNaN(m)&&(this._activeMediaMap.set(b,0),m=0);return e?c.tsx("div",{key:this._buildKey("media-element",b),"data-content-element-index":b,
bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",f)},c.tsx("div",{key:this._buildKey("media-element-container",b),class:"esri-feature__media-container"},d,this._renderMediaInfo({mediaInfo:a[m],contentElementIndex:b,activeMediaIndex:m}),k)):null};e.prototype._renderLastEditInfo=function(){var a=this.visibleElements,b=this.viewModel.lastEditInfo;if(!b||!a.lastEditedInfo)return null;a=b.user;b=r.substitute("edit"===b.type?a?m.lastEditedByUser:
m.lastEdited:a?m.lastCreatedByUser:m.lastCreated,{date:b.date,user:a});return c.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},b)};e.prototype._renderText=function(a,b){return a.text?c.tsx("div",{key:this._buildKey("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};e.prototype._attachToNode=function(a){a.appendChild(this)};e.prototype._setContentElementMedia=function(a,
b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};e.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};e.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};e.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};
d([n.aliasOf("viewModel.graphic")],e.prototype,"graphic",void 0);d([n.aliasOf("viewModel.defaultPopupTemplateEnabled")],e.prototype,"defaultPopupTemplateEnabled",void 0);d([n.property()],e.prototype,"label",void 0);d([n.aliasOf("viewModel.spatialReference")],e.prototype,"spatialReference",void 0);d([n.aliasOf("viewModel.title")],e.prototype,"title",void 0);d([n.property(),c.renderable()],e.prototype,"visibleElements",void 0);d([n.cast("visibleElements")],e.prototype,"castVisibleElements",null);d([n.aliasOf("viewModel.map")],
e.prototype,"map",void 0);d([n.aliasOf("viewModel.view")],e.prototype,"view",void 0);d([n.property({type:w}),c.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo"])],e.prototype,"viewModel",void 0);d([c.accessibleHandler()],e.prototype,"_previousClick",null);d([c.accessibleHandler()],e.prototype,"_nextClick",null);return e=d([n.subclass("esri.widgets.Feature")],e)}(n.declared(F))});