// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(G,z,v){function h(a,c){a=Math.min(Math.max(a,-100),100);c=Math.min(Math.max(c,-100),100);var f,m,d=new Uint8Array(256);for(f=0;256>f;f++)0<a&&100>a?m=(200*f-25500+510*c)/(2*(100-a))+128:0>=a&&-100<a?m=(200*f-25500+510*c)*(100+a)/2E4+128:100===a?(m=200*f-25500+256*(100-a)+510*c,m=0<m?255:0):-100===a&&(m=128),d[f]=255<m?255:0>m?0:m;return d}function q(a,c,f,m,d,w,g,b){return{xmin:d<=
f*a?0:d<f*a+a?d-f*a:a,ymin:w<=m*c?0:w<m*c+c?w-m*c:c,xmax:d+g<=f*a?0:d+g<f*a+a?d+g-f*a:a,ymax:w+b<=m*c?0:w+b<m*c+c?w+b-m*c:c}}var t=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length},n={createColormapLUT:function(a){if(a){var c=a.colormap;if(c&&0!==c.length){var c=c.sort(function(a,b){return a[0]-b[0]}),f=0;0>c[0][0]&&(f=c[0][0]);var m=Math.max(256,c[c.length-1][0]-f+1),d=new Uint8Array(4*m),w=[],g=0,b=0,k=5===c[0].length;if(65536<m)return c.forEach(function(a){w[a[0]-
f]=k?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:w,offset:f,alphaSpecified:k};if(a.fillUnspecified)for(a=c[b],g=a[0]-f;g<m;g++)d[4*g]=a[1],d[4*g+1]=a[2],d[4*g+2]=a[3],d[4*g+3]=k?a[4]:255,g===a[0]-f&&(a=b===c.length-1?a:c[++b]);else for(g=0;g<c.length;g++)a=c[g],b=4*(a[0]-f),d[b]=a[1],d[b+1]=a[2],d[b+2]=a[3],d[b+3]=k?a[4]:255;return{indexedColormap:d,offset:f,alphaSpecified:k}}}},createContrastBrightnessLUT:h,createStretchLUT:function(a){var c=a.minCutOff,f=a.maxCutOff,m=a.gamma,d=a.pixelType,
w=a.outMin||0,g=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(d))return null;var b=c.length,k,l=0;"s8"===d?l=-127:"s16"===d&&(l=-32767);var e=256;-1<["u16","s16"].indexOf(d)&&(e=65536);for(var p=[],r=g-w,d=0;d<b;d++)p[d]=f[d]-c[d];k=m&&m.length>=b;var u=[];if(k)for(d=0;d<b;d++)u[d]=1<m[d]?2<m[d]?6.5+Math.pow(m[d]-2,2.5):6.5+100*Math.pow(2-m[d],4):1;var n,x=[],y,A,q;if(k)for(d=0;d<b;d++){q=[];for(k=0;k<e;k++)y=k+l,n=(y-c[d])/p[d],A=1,1<m[d]&&(A-=Math.pow(1/r,n*u[d])),q[k]=y<f[d]&&y>c[d]?Math.floor(A*
r*Math.pow(n,1/m[d]))+w:y>=f[d]?g:w;x[d]=q}else for(d=0;d<b;d++){q=[];for(k=0;k<e;k++)y=k+l,q[k]=y<=c[d]?w:y>=f[d]?g:Math.floor((y-c[d])/p[d]*r)+w;x[d]=q}if(null!=a.contrastOffset)for(a=h(a.contrastOffset,a.brightnessOffset),d=0;d<b;d++)for(q=x[d],k=0;k<e;k++)q[k]=a[q[k]];return{lut:x,offset:l}},colorize:function(a,c){if(!t(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;var f=a.clone(),m=f.pixels,d=f.mask,w=f.width*f.height;if(1!==m.length)return a;var g=c.indexedColormap;a=c.indexed2DColormap;
var b=c.offset;c=c.alphaSpecified;var k=g.length-1,l=0,m=m[0],e=new Uint8Array(m.length),p=new Uint8Array(m.length),r=new Uint8Array(m.length),u=0;if(g)if(d)for(l=0;l<w;l++)d[l]&&(u=4*(m[l]-b),u<b||u>k?d[l]=0:(e[l]=g[u],p[l]=g[u+1],r[l]=g[u+2],d[l]=g[u+3]));else{d=new Uint8Array(w);for(l=0;l<w;l++)u=4*(m[l]-b),u<b||u>k?d[l]=0:(e[l]=g[u],p[l]=g[u+1],r[l]=g[u+2],d[l]=g[u+3]);f.mask=d}else if(d)for(l=0;l<w;l++)d[l]&&(g=a[m[l]],e[l]=g[0],p[l]=g[1],r[l]=g[2],d[l]=g[3]);else{d=new Uint8Array(w);for(l=0;l<
w;l++)g=a[m[l]],e[l]=g[0],p[l]=g[1],r[l]=g[2],d[l]=g[3];f.mask=d}f.pixels=[e,p,r];f.statistics=null;f.pixelType="u8";f.maskIsAlpha=c;return f},estimateStatisticsHistograms:function(a){if(!t(a))return null;var c=a.pixels,f=a.mask,m=a.pixelType,d=a.statistics;a=a.width*a.height;var w=c.length,g,b,k,l,e,p=[],r=[],u,h,x;for(l=0;l<w;l++){u=new Uint32Array(256);x=c[l];if("u8"===m)if(g=-.5,b=255.5,f)for(e=0;e<a;e++)f[e]&&u[x[e]]++;else for(e=0;e<a;e++)u[x[e]]++;else{g=d[l].minValue;b=d[l].maxValue;k=(b-
g)/256;h=new Uint32Array(257);if(f)for(e=0;e<a;e++)f[e]&&h[Math.floor((x[e]-g)/k)]++;else for(e=0;e<a;e++)h[Math.floor((x[e]-g)/k)]++;for(e=0;255>e;e++)u[e]=h[e];u[255]=h[255]+h[256]}p.push({min:g,max:b,size:256,counts:u});for(e=x=h=k=0;256>e;e++)k+=u[e],h+=e*u[e];h/=k;for(e=0;256>e;e++)x+=u[e]*Math.pow(e-h,2);u=Math.sqrt(x/(k-1));k=(b-g)/256;e=(h+.5)*k+g;u*=k;r.push({min:g,max:b,avg:e,stddev:u})}return{statistics:r,histograms:p}},extractBands:function(a,c){return!c||!t(a)||c&&c.some(function(c){return c>
a.pixels.length})?a:new v({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:c.map(function(c){return a.pixels[c]}),statistics:a.statistics&&c.map(function(c){return a.statistics[c]})})},stretch:function(a,c){if(!t(a))return null;a=a.clone();var f=a.pixels,m=a.mask,d=c.minCutOff,h=c.maxCutOff,g=c.gamma,b=c.outMin||0;c=c.outMax||255;var k=a.width*a.height,l=f.length,e,p,r,u,n,x=c-b,y=[];for(e=0;e<l;e++)y[e]=h[e]-d[e];
p=g&&g.length>=l;var A=[];if(p)for(e=0;e<l;e++)A[e]=1<g[e]?2<g[e]?6.5+Math.pow(g[e]-2,2.5):6.5+100*Math.pow(2-g[e],4):1;if(p)if(null!=m)for(p=0;p<k;p++){if(m[p])for(e=0;e<l;e++)r=f[e][p],n=(r-d[e])/y[e],u=1,1<g[e]&&(u-=Math.pow(1/x,n*A[e])),f[e][p]=r<h[e]&&r>d[e]?Math.floor(u*x*Math.pow(n,1/g[e]))+b:r>=h[e]?c:b}else for(p=0;p<k;p++)for(e=0;e<l;e++)r=f[e][p],n=(r-d[e])/y[e],u=1,1<g[e]&&(u-=Math.pow(1/x,n*A[e])),f[e][p]=r<h[e]&&r>d[e]?Math.floor(u*x*Math.pow(n,1/g[e]))+b:r>=h[e]?c:b;else if(null!=m)for(p=
0;p<k;p++){if(m[p])for(e=0;e<l;e++)r=f[e][p],f[e][p]=r<h[e]&&r>d[e]?Math.floor((r-d[e])/y[e]*x)+b:r>=h[e]?c:b}else for(p=0;p<k;p++)for(e=0;e<l;e++)r=f[e][p],f[e][p]=r<h[e]&&r>d[e]?Math.floor((r-d[e])/y[e]*x)+b:r>=h[e]?c:b;a.pixelType="u8";a.updateStatistics();return a},lookupPixels:function(a,c){if(!t(a))return null;var f=a.pixels,m=a.mask,d=a.width*a.height,h=f.length,g=c.lut;c=c.offset;var b,k;g&&1===g[0].length&&(g=f.map(function(){return g}));var l=[],e,p,r;if(c)if(null==m)for(b=0;b<h;b++){e=
f[b];p=g[b];r=new Uint8Array(d);for(k=0;k<d;k++)r[k]=p[e[k]-c];l.push(r)}else for(b=0;b<h;b++){e=f[b];p=g[b];r=new Uint8Array(d);for(k=0;k<d;k++)m[k]&&(r[k]=p[e[k]-c]);l.push(r)}else if(null==m)for(b=0;b<h;b++){e=f[b];p=g[b];r=new Uint8Array(d);for(k=0;k<d;k++)r[k]=p[e[k]];l.push(r)}else for(b=0;b<h;b++){e=f[b];p=g[b];r=new Uint8Array(d);for(k=0;k<d;k++)m[k]&&(r[k]=p[e[k]]);l.push(r)}a=new v({width:a.width,height:a.height,pixels:l,mask:m,pixelType:"u8"});a.updateStatistics();return a},remapColor:function(a,
c){if(!t(a))return null;a=a.clone();var f=a.width*a.height,m=c.length,d=Math.floor(m/2),h=c[Math.floor(d)],g=a.pixels[0],b,k,l,e,p,r,u=!1,n=new Uint8Array(f),x=new Uint8Array(f),y=new Uint8Array(f),A=a.mask,q=4===c[0].mappedColor.length;A||(A=new Uint8Array(f),A.fill(q?255:1),a.mask=A);for(p=0;p<f;p++)if(A[p]){b=g[p];u=!1;r=d;k=h;l=0;for(e=m-1;1<e-l;){if(b===k.value){u=!0;break}b>k.value?l=r:e=r;r=Math.floor((l+e)/2);k=c[Math.floor(r)]}u||(b===c[l].value?(k=c[l],u=!0):b===c[e].value?(k=c[e],u=!0):
b<c[l].value?(u=!1,k=null):b>c[l].value&&(b<c[e].value?(k=c[l],u=!0):e===m-1?(u=!1,k=null):(k=c[e],u=!0)));u?(n[p]=k.mappedColor[0],x[p]=k.mappedColor[1],y[p]=k.mappedColor[2],A[p]=k.mappedColor[3]):n[p]=x[p]=y[p]=A[p]=0}a.pixels=[n,x,y];a.mask=A;a.pixelType="u8";a.maskIsAlpha=q;return a},mosaic:function(a,c,f,m){var d=a.filter(function(a){return t(a)})[0];if(null==d)return null;var h=m?m.width:c.width;m=m?m.height:c.height;var g=d.width,b=d.height,k=c.width/g;c=c.height/b;var l=f?f.x:0;f=f?f.y:0;
var e=d.pixelType,p=d.getPixelArrayConstructor(e),r=d.pixels.length,d=[],u,n,x,y,A,E,F,D,B,C;for(A=0;A<r;A++){n=new p(h*m);for(E=0;E<c;E++)for(F=0;F<k;F++)if(x=a[E*k+F])for(u=x.pixels[A],C=q(g,b,F,E,l,f,h,m),D=C.ymin;D<C.ymax;D++)for(x=(E*b+D-f)*h+(F*g-l),y=D*g,B=C.xmin;B<C.xmax;B++)n[x+B]=u[y+B];d.push(n)}var z;if(a.some(function(a){return a&&a.mask&&0<a.mask.length}))for(z=new Uint8Array(h*m),E=0;E<c;E++)for(F=0;F<k;F++)if(p=(x=a[E*k+F])?x.mask:null,C=q(g,b,F,E,l,f,h,m),p)for(D=C.ymin;D<C.ymax;D++)for(x=
(E*b+D-f)*h+(F*g-l),y=D*g,B=C.xmin;B<C.xmax;B++)z[x+B]=p[y+B];else if(x)for(D=C.ymin;D<C.ymax;D++)for(x=(E*b+D-f)*h+(F*g-l),y=D*g,B=C.xmin;B<C.xmax;B++)z[x+B]=1;else for(D=C.ymin;D<C.ymax;D++)for(x=(E*b+D-f)*h+(F*g-l),y=D*g,B=C.xmin;B<C.xmax;B++)z[x+B]=0;a=new v({width:h,height:m,pixels:d,pixelType:e,mask:z});a.updateStatistics();return a},mosaicPixelData:function(a,c){if(!a||0===a.length)return null;var f=a.filter(function(a){return a.pixelBlock})[0];if(!f)return null;var h=(f.extent.xmax-f.extent.xmin)/
f.pixelBlock.width,d=(f.extent.ymax-f.extent.ymin)/f.pixelBlock.height,q=.01*Math.min(h,d),g=a.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>q?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>q?a.extent.xmin-b.extent.xmin:0}),b=Math.min.apply(null,g.map(function(a){return a.extent.xmin})),k=Math.min.apply(null,g.map(function(a){return a.extent.ymin})),l=Math.max.apply(null,g.map(function(a){return a.extent.xmax})),e=Math.max.apply(null,g.map(function(a){return a.extent.ymax}));
a={x:Math.round((c.xmin-b)/h),y:Math.round((e-c.ymax)/d)};b={width:Math.round((l-b)/h),height:Math.round((e-k)/d)};h={width:Math.round((c.xmax-c.xmin)/h),height:Math.round((c.ymax-c.ymin)/d)};if(Math.round(b.width/f.pixelBlock.width)*Math.round(b.height/f.pixelBlock.height)!==g.length||0>a.x||0>a.y||b.width<h.width||b.height<h.height)return null;f=g.map(function(a){return a.pixelBlock});f=n.mosaic(f,b,a,h);return{extent:c,pixelBlock:f}}};return n})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(G,z,v,h,q,t,n,a,c){var f=a.getLogger("esri.layers.support.PixelBlock");return function(a){function d(g){g=a.call(this,g)||this;g.width=null;g.height=null;g.pixelType="f32";g.validPixelCount=null;g.mask=null;g.maskIsAlpha=!1;g.pixels=null;g.statistics=null;return g}v(d,a);m=d;d.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");return a};d.prototype.getPlaneCount=
function(){return this.pixels&&this.pixels.length};d.prototype.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new q("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};d.prototype.getAsRGBA=function(){var a=new ArrayBuffer(this.width*
this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};d.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};d.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(b){return a._calculateBandStatistics(b,a.mask)});var b=this.mask,k=0;if(b)for(var l=
0;l<b.length;l++)b[l]&&k++;else k=this.width*this.height;this.validPixelCount=k};d.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){var b;switch(a){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var k=b[0];b=b[1];for(var l=this.pixels,e=this.width*this.height,g=l.length,d,c,f,h=[],y=0;y<g;y++){f=this._createEmptyBand(a,
e);d=l[y];for(var m=0;m<e;m++)c=d[m],f[m]=c>b?b:c<k?k:c;h.push(f)}this.pixels=h;this.pixelType=a}};d.prototype.clone=function(){var a=new m({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(a.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var b,k=this.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){a.pixels=[];var l=this.pixels[0].slice;for(b=
0;b<this.pixels.length;b++)a.pixels[b]=l?this.pixels[b].slice(0,this.pixels[b].length):new k(this.pixels[b])}if(this.statistics)for(a.statistics=[],b=0;b<this.statistics.length;b++)a.statistics[b]=n.clone(this.statistics[b]);return a};d.prototype.getPixelArrayConstructor=function(a){switch(a){case "u8":a=Uint8Array;break;case "u16":a=Uint16Array;break;case "u32":a=Uint32Array;break;case "s8":a=Int8Array;break;case "s16":a=Int16Array;break;case "s32":a=Int32Array;break;case "u32":a=Uint32Array;break;
case "f32":a=Float32Array;break;case "f64":a=Float64Array;break;default:a=Float32Array}return a};d.prototype._createEmptyBand=function(a,b){return new (this.getPixelArrayConstructor(a))(b)};d.prototype._fillFrom8Bit=function(a){var b=this.mask,k=this.maskIsAlpha,l=this.pixels;if(a&&l&&l.length){var e,d,c;e=d=c=l[0];3<=l.length?(d=l[1],c=l[2]):2===l.length&&(d=l[1]);a=new Uint32Array(a);l=this.width*this.height;if(e.length!==l)f.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
else if(b&&b.length===l)if(k)for(k=0;k<l;k++)b[k]&&(a[k]=b[k]<<24|c[k]<<16|d[k]<<8|e[k]);else for(k=0;k<l;k++)b[k]&&(a[k]=-16777216|c[k]<<16|d[k]<<8|e[k]);else for(k=0;k<l;k++)a[k]=-16777216|c[k]<<16|d[k]<<8|e[k]}else f.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFromNon8Bit=function(a){var b=this.pixels,d=this.mask,l=this.statistics;if(a&&b&&b.length){var e=this.pixelType,c=1,g=0,c=1;l&&0<l.length?(g=l.map(function(a){return a.minValue}).reduce(function(a,
b){return Math.min(a,b)}),c=l.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),c=255/c):(c=255,"s8"===e?(g=-128,c=127):"u16"===e?c=65535:"s16"===e?(g=-32768,c=32767):"u32"===e?c=4294967295:"s32"===e?(g=-2147483648,c=2147483647):"f32"===e?(g=-3.4*1E39,c=3.4*1E39):"f64"===e&&(g=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-g));a=new Uint32Array(a);var e=this.width*this.height,h,m,l=h=m=b[0];if(l.length!==e)return f.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
if(2<=b.length)if(h=b[1],3<=b.length&&(m=b[2]),d&&d.length===e)for(b=0;b<e;b++)d[b]&&(a[b]=-16777216|(m[b]-g)*c<<16|(h[b]-g)*c<<8|(l[b]-g)*c);else for(b=0;b<e;b++)a[b]=-16777216|(m[b]-g)*c<<16|(h[b]-g)*c<<8|(l[b]-g)*c;else if(d&&d.length===e)for(b=0;b<e;b++)h=(l[b]-g)*c,d[b]&&(a[b]=-16777216|h<<16|h<<8|h);else for(b=0;b<e;b++)h=(l[b]-g)*c,a[b]=-16777216|h<<16|h<<8|h}else f.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFrom32Bit=function(a){var b=
this.pixels,c=this.mask;if(!a||!b||!b.length)return f.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var d,e,g;d=e=g=b[0];3<=b.length?(e=b[1],g=b[2]):2===b.length&&(e=b[1]);var h=this.width*this.height;if(d.length!==h)return f.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var m=0;if(c&&c.length===h)for(b=0;b<h;b++)a[m++]=d[b],a[m++]=e[b],a[m++]=g[b],a[m++]=c[b]&1;else for(b=0;b<h;b++)a[m++]=d[b],a[m++]=e[b],a[m++]=g[b],a[m++]=
1};d.prototype._calculateBandStatistics=function(a,b){var c=Infinity,d=-Infinity,e=a.length,f,g=0;if(b)for(f=0;f<e;f++)b[f]&&(g=a[f],c=g<c?g:c,d=g>d?g:d);else for(f=0;f<e;f++)g=a[f],c=g<c?g:c,d=g>d?g:d;return{minValue:c,maxValue:d}};var m;h([c.property({json:{write:!0}})],d.prototype,"width",void 0);h([c.property({json:{write:!0}})],d.prototype,"height",void 0);h([c.property({json:{write:!0}})],d.prototype,"pixelType",void 0);h([c.cast("pixelType")],d.prototype,"castPixelType",null);h([c.property({json:{write:!0}})],
d.prototype,"validPixelCount",void 0);h([c.property({json:{write:!0}})],d.prototype,"mask",void 0);h([c.property({json:{write:!0}})],d.prototype,"maskIsAlpha",void 0);h([c.property({json:{write:!0}})],d.prototype,"pixels",void 0);h([c.property({json:{write:!0}})],d.prototype,"statistics",void 0);return d=m=h([c.subclass("esri.layers.support.PixelBlock")],d)}(c.declared(t.JSONSupport))})},"esri/views/2d/layers/BitmapLayerView2D":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ../engine/BitmapContainer".split(" "),
function(G,z,v,h,q,t){Object.defineProperty(z,"__esModule",{value:!0});z.BitmapLayerView2D=function(n){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.container=new t.BitmapContainer(c.clips);return c}h(c,a);c.prototype.initialize=function(){var a=this;this.handles.add(this.clips.on("change",function(){return a.container.setClips(a.clips)}))};return c=v([q.subclass("esri.views.2d.layers.BitmapLayerView2D")],c)}(q.declared(n))}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(G,z,v,h,q,t,n,a,c,f,m,d){Object.defineProperty(z,"__esModule",{value:!0});var w=q.ofType({key:"type",base:c,typeMap:{rect:f,path:d,geometry:m}});z.LayerView2D=function(c){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.clips=new w;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}v(b,c);b.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()},function(){});var b=function(){return a.notifyChange("rendering")};
this.handles.add([n.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),n.init(this,["fullOpacity","container"],function(){a.container&&(a.container.opacity=a.fullOpacity)},!0),n.on(this,"container","post-render",b),n.on(this,"container","will-render",b)])};b.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=
null};Object.defineProperty(b.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});b.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,d=c.minScale,c=c.maxScale;if(null!=d&&null!=c){var b=!d,f=
!c;!b&&a<=d&&(b=!0);!f&&a>=c&&(f=!0);b=b&&f}return b};b.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};b.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};b.prototype.isUpdating=function(){return!1};b.prototype.isRendering=function(){return!1};b.prototype.canResume=
function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};h([a.property({type:w,set:function(a){a=t.referenceSetter(a,this._get("clips"),w);this._set("clips",a)}})],b.prototype,"clips",void 0);h([a.property()],b.prototype,"moving",void 0);h([a.property({dependsOn:["attached","suspended","moving"]})],b.prototype,"rendering",null);h([a.property()],b.prototype,"attached",void 0);h([a.property()],b.prototype,"container",void 0);h([a.property({dependsOn:["view.scale",
"layer.minScale","layer.maxScale"]})],b.prototype,"suspended",void 0);h([a.property({readOnly:!0})],b.prototype,"updateParameters",void 0);h([a.property()],b.prototype,"updateRequested",void 0);h([a.property({dependsOn:["updateRequested","attached","suspended"]})],b.prototype,"updating",null);h([a.property()],b.prototype,"view",void 0);return b=h([a.subclass("esri.views.2d.layers.LayerView2D")],b)}(a.declared(c))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(G,z,v,h,q,t){return function(n){function a(){return null!==n&&n.apply(this,arguments)||this}h(a,n);return a=v([t.subclass("esri.views.layers.support.ClipArea")],a)}(t.declared(q.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(G,z,v,h,q,t){return function(n){function a(){var a=null!==n&&n.apply(this,
arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}h(a,n);c=a;a.prototype.clone=function(){return new c({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var c;v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"left",void 0);v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",
void 0);v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"bottom",void 0);v([q.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=c=v([q.subclass("esri.views.layers.support.ClipRect")],a)}(q.declared(t))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(G,z,v,h,q,t,n,a,c){var f={base:n,key:"type",typeMap:{extent:q.Extent,polygon:q.Polygon}};return function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}h(d,c);m=d;Object.defineProperty(d.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new m({geometry:this.geometry.clone()})};var m;v([t.property({types:f,json:{read:a.fromJSON,write:!0}})],d.prototype,
"geometry",void 0);v([t.property({readOnly:!0,dependsOn:["geometry"]})],d.prototype,"version",null);return d=m=v([t.subclass("esri.views.layers.support.Geometry")],d)}(t.declared(c))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(G,z,v,h,q,t){return function(n){function a(){var a=null!==n&&n.apply(this,arguments)||this;
a.type="path";a.path=[];return a}h(a,n);Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});v([q.property({type:[[[Number]]],json:{write:!0}})],a.prototype,"path",void 0);v([q.property({readOnly:!0,dependsOn:["path"]})],a.prototype,"version",null);return a=v([q.subclass("esri.views.layers.support.Path")],a)}(q.declared(t))})},"esri/views/2d/layers/support/ExportStrategy":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../engine ../../viewStateUtils ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(G,z,v,h,q,t,n,a,c,f,m,d,w,g,b,k,l,e){var p=d.create(),r=[0,0],u=new e(0,0,0,0);return function(a){function d(b){var d=a.call(this,b)||this;d._imagePromise=null;d.hidpi=!1;d.imageMaxWidth=2048;d.imageMaxHeight=2048;d.imageRotationSupported=!1;d.imageNormalizationSupported=!1;d.update=c.debounce(function(a,b){return q(d,void 0,void 0,function(){var d,c,e,f,g,l,m,y,p,n=this;return h(this,function(h){d=a.state;c=w.getInfo(d.spatialReference);e=this.hidpi?a.pixelRatio:1;if(!a.stationary||this.destroyed)return[2];
this.imageRotationSupported?(r[0]=d.size[0],r[1]=d.size[1]):k.getOuterSize(r,d);f=Math.floor(r[0]*e)>this.imageMaxWidth||Math.floor(r[1]*e)>this.imageMaxHeight;g=c&&(d.extent.xmin<c.valid[0]||d.extent.xmax>c.valid[1]);l=!this.imageNormalizationSupported&&g;m=!f&&!l;y=this.imageRotationSupported?d.rotation:0;m?this._imagePromise=this._singleExport(d,r,y,e,b):(p=Math.min(this.imageMaxWidth,this.imageMaxHeight),l&&(p=Math.min(d.worldScreenWidth,p)),this._imagePromise=this._tiledExport(d,p,y,e,b));return[2,
this._imagePromise.then(function(a){n._imagePromise=null;var b=n.container.children.slice();n.container.removeAllChildren();a.forEach(n.container.addChild,n.container);n.disposeSource&&b.forEach(function(a){n.disposeSource(a.source)},n)}).catch(function(a){n._imagePromise=null;throw a;})]})})},5E3);return d}t(d,a);d.prototype.destroy=function(){};Object.defineProperty(d.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});d.prototype.updateExports=
function(a){for(var b=0,d=this.container.children;b<d.length;b++){var c=d[b];if(!c.visible||!c.attached)break;a(c)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(c.invalidateTexture(),c.requestRender())}};d.prototype._export=function(a,d,e,f,g,h){var l=this;return c.resolve().then(function(){return l.fetchSource(a,Math.floor(d*g),Math.floor(e*g),{rotation:f,pixelRatio:g,signal:h})}).then(function(c){c=new b.Bitmap(c);c.x=a.xmin;c.y=a.ymax;c.resolution=a.width/d;c.rotation=
f;c.pixelRatio=g;return c})};d.prototype._singleExport=function(a,b,d,c,e){k.getBBox(p,a.center,a.resolution,b);a=new m(p[0],p[1],p[2],p[3],a.spatialReference);return this._export(a,b[0],b[1],d,c,e).then(function(a){return[a]})};d.prototype._tiledExport=function(a,b,d,e,f){var h=this,k=g.create({size:b,spatialReference:a.spatialReference,scales:[a.scale]}),n=new l(k),k=n.getTileCoverage(a);if(!k)return null;var y=[];k.forEach(function(c,g,k,l){u.set(c,g,k,l);n.getTileBounds(p,u);c=new m(p[0],p[1],
p[2],p[3],a.spatialReference);y.push(h._export(c,b,b,d,e,f))});return c.all(y)};n([f.property()],d.prototype,"_imagePromise",void 0);n([f.property()],d.prototype,"container",void 0);n([f.property()],d.prototype,"disposeSource",void 0);n([f.property()],d.prototype,"fetchSource",void 0);n([f.property()],d.prototype,"hidpi",void 0);n([f.property()],d.prototype,"imageMaxWidth",void 0);n([f.property()],d.prototype,"imageMaxHeight",void 0);n([f.property()],d.prototype,"imageRotationSupported",void 0);n([f.property()],
d.prototype,"imageNormalizationSupported",void 0);n([f.property()],d.prototype,"requestUpdate",void 0);n([f.property({dependsOn:["_imagePromise"]})],d.prototype,"updating",null);return d=n([f.subclass("esri.views.2d.layers.support.ExportStrategy")],d)}(f.declared(a))})},"esri/views/2d/viewStateUtils":function(){define(["require","exports"],function(G,z){Object.defineProperty(z,"__esModule",{value:!0});var v=Math.PI/180;z.snapToPixel=function(h,q,t){var n=t.resolution;t=t.size;h[0]=n*(Math.round(q[0]/
n)+t[0]%2*.5);h[1]=n*(Math.round(q[1]/n)+t[1]%2*.5);return h};z.getOuterSize=function(h,q){var t=q.rotation*v,n=Math.abs(Math.cos(t)),t=Math.abs(Math.sin(t)),a=q.size;q=a[0];a=a[1];h[0]=Math.round(a*t+q*n);h[1]=Math.round(a*n+q*t);return h};z.getBBox=function(h,q,t,n){var a=q[0];q=q[1];var c=n[0];n=n[1];t*=.5;h[0]=a-t*c;h[1]=q-t*n;h[2]=a+t*c;h[3]=q+t*n;return h};z.bboxIntersects=function(h,q){var t=h[1],n=h[2],a=h[3],c=q[0],f=q[1],m=q[3];return!(h[0]>q[2]||n<c||t>m||a<f)}})},"esri/views/layers/ImageryLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/timeUtils ../../tasks/support/Query ./support/popupUtils".split(" "),
function(G,z,v,h,q,t,n,a,c,f,m,d,w,g){Object.defineProperty(z,"__esModule",{value:!0});z.ImageryLayerView=function(b){return function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a.view=null;return a}v(l,b);l.prototype.fetchPopupFeatures=function(b,d){return t(this,void 0,void 0,function(){var e,f,h,l,k,p,t,v,z,B,C;return q(this,function(q){switch(q.label){case 0:e=this.layer;if(!b)return[2,c.reject(new n("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:e}))];
f=e.popupEnabled;h=g.getFetchPopupTemplate(e,d);if(!f||!a.isSome(h))throw new n("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:f,popupTemplate:h});return[4,h.getRequiredFields()];case 1:return l=q.sent(),k=new w,k.geometry=b,k.outFields=l,k.outSpatialReference=b.spatialReference,p=this.view.resolution,t="2d"===this.view.type?new m(p,p,this.view.spatialReference):new m(.5*p,.5*p,this.view.spatialReference),v=h.layerOptions||{returnTopmostRaster:!0,
showNoDataRecords:!1},z=v.returnTopmostRaster,B=v.showNoDataRecords,C={returnDomainValues:!0,returnTopmostRaster:z,pixelSize:t,showNoDataRecords:B},[2,e.queryVisibleRasters(k,C).then(function(a){return a})]}})})};h([f.property()],l.prototype,"layer",void 0);h([f.property()],l.prototype,"view",void 0);h([f.property(d.combinedViewLayerTimeExtentProperty)],l.prototype,"timeExtent",void 0);return l=h([f.subclass("esri.views.layers.ImageryLayerView")],l)}(f.declared(b))}})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),
function(G,z,v,h,q,t,n){Object.defineProperty(z,"__esModule",{value:!0});z.getRequiredFields=function(a,c){void 0===c&&(c=a.popupTemplate);return h(this,void 0,void 0,function(){var f,h,d,w,g,b,k,l,e,p,r;return v(this,function(m){switch(m.label){case 0:return t.isSome(c)?[4,c.getRequiredFields(a.fields)]:[2,[]];case 1:f=m.sent();h=c.lastEditInfoEnabled;d=a.objectIdField;w=a.typeIdField;g=a.globalIdField;if(q.includes(f,"*"))return[2,["*"]];k=n.fixFields;l=[a.fields];p=(e=f).concat;return(r=h)?[4,
n.getFeatureEditFields(a)]:[3,3];case 2:r=m.sent(),m.label=3;case 3:return b=k.apply(void 0,l.concat([p.apply(e,[r||null])])),w&&b.push(w),b&&d&&n.hasField(a.fields,d)&&-1===b.indexOf(d)&&b.push(d),b&&g&&n.hasField(a.fields,g)&&-1===b.indexOf(g)&&b.push(g),[2,b]}})})};z.getFetchPopupTemplate=function(a,c){return a.popupTemplate?a.popupTemplate:t.isSome(c)&&c.defaultPopupTemplateEnabled&&t.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/rasterFunctions/pixelUtils ../engine/ImageryBitmapSource ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(G,
z,v,h,q,t,n,a,c,f,m,d,w,g,b,k,l,e,p,r){var u=a.getLogger("esri.views.2d.layers.ImageryLayerView2D");return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._exportImageVersion=-1;return b}v(b,a);Object.defineProperty(b.prototype,"pixelData",{get:function(){if(this.updating)return null;var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){var b=this.view.extent,a=a.map(function(a){return a.source}).filter(function(a){return a.extent&&
a.extent.intersects(b)}).map(function(a){return{extent:a.extent,pixelBlock:a.originalPixelBlock}});return(a=w.mosaicPixelData(a,b))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null},enumerable:!0,configurable:!0});b.prototype.hitTest=function(a,b){if(this.suspended)return c.resolve(null);a=this.view.toMap(f.createScreenPoint(a,b));return c.resolve(new n({attributes:{},geometry:a}))};b.prototype.update=function(a){this.strategy.update(a).catch(function(a){c.isAbortError(a)||u.error(a)})};
b.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();this.strategy=new l({container:this.container,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this.fetchImage.bind(this),requestUpdate:function(){return a.requestUpdate()}});this.handles.add([m.init(this,"layer.exportImageServiceParameters.version",function(b){a._exportImageVersion!==
b&&(a._exportImageVersion=b,a.requestUpdate())}),this.watch("timeExtent",function(){return a.requestUpdate()}),this.layer.on("redraw",function(){a.strategy.updateExports(function(b){b.source instanceof HTMLImageElement?b.requestRender():a.layer.applyRenderer({pixelBlock:b.source.pixelBlock}).then(function(d){var c=b.source;c.pixelBlock=d.pixelBlock;c.filter=function(b){return a.layer.applyFilter(b)};a.container.requestRender()})})})],"imagerylayerview-update")};b.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();
this.strategy.destroy();this.container.removeAllChildren();this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};b.prototype.moveStart=function(){};b.prototype.viewChange=function(){};b.prototype.moveEnd=function(){this.requestUpdate()};b.prototype.doRefresh=function(){return t(this,void 0,void 0,function(){return q(this,function(a){this.requestUpdate();return[2]})})};b.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};b.prototype.fetchImage=
function(a,b,d,c){var e=this;this._exportImageVersion=this.get("layer.exportImageServiceParameters.version");c=c||{};c.timeExtent=this.timeExtent;c.requestAsImageElement=!0;return this.layer.fetchImage(a,b,d,c).then(function(a){return a.imageElement?a.imageElement:e.layer.applyRenderer(a.pixelData,{signal:c.signal}).then(function(b){b=new g.default(b.pixelBlock,b.extent.clone(),a.pixelData.pixelBlock);b.filter=function(a){return e.layer.applyFilter(a)};return b})})};h([d.property({dependsOn:["updating"]})],
b.prototype,"pixelData",null);h([d.property()],b.prototype,"strategy",void 0);h([d.property({dependsOn:["strategy.updating"]})],b.prototype,"updating",void 0);return b=h([d.subclass("esri.views.2d.layers.ImageryLayerView2D")],b)}(d.declared(e.ImageryLayerView(r.RefreshableLayerView(b.BitmapLayerView2D(k.LayerView2D(p))))))});