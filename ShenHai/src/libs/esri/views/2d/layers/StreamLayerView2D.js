// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/accessorSupport/decorators ../../../tasks/support/FeatureSet ./FeatureLayerView2D ./support/util".split(" "),function(x,y,m,e,n,p,q,r,d,t,u,v){function w(c){if(!c)return null;var a={};c.geometry&&(a.geometry=c.geometry.toJSON());c.where&&(a.where=
c.where);return a}return function(c){function a(){var b=null!==c&&c.apply(this,arguments)||this;b._enabledDataRecieved=!1;b.errorString=null;b.connectionStatus="disconnected";return b}m(a,c);a.prototype.destroy=function(){this.connectionStatus="disconnected"};Object.defineProperty(a.prototype,"connectionError",{get:function(){if(this.errorString)return new r("stream-controller",this.errorString)},enumerable:!0,configurable:!0});a.prototype.on=function(b,g){"data-received"===b&&(this._enabledDataRecieved=
!0,this._proxy.enableEvent("data-received",!0));var a=this.inherited(arguments,[b,g]),f=this;return{remove:function(){a.remove();f.hasEventListener("data-received")||f._proxy.enableEvent("data-received",!1)}}};a.prototype.queryLatestObservations=function(b,a){var g=this;return this._proxy.queryLatestObservations(this._cleanUpQuery(b),a).then(function(b){b=t.fromJSON(b);b.features.forEach(function(b){b.layer=g.layer;b.sourceLayer=g.layer});return b})};a.prototype._createClientOptions=function(){var b=
this,a=this.inherited(arguments);return n({},a,{setProperty:function(a){b.set(a.propertyName,a.value)}})};a.prototype._createTileRendererHash=function(){var b=this.inherited(arguments),a=this.layer,c=a.filter&&JSON.stringify(a.filter.geometry)+"."+a.filter.where;return b+"."+c+"."+(a.purgeOptions&&a.purgeOptions.age+"."+a.purgeOptions.displayCount)+"."+a.maximumTrackPoints};a.prototype._createServiceOptions=function(){return q(this,void 0,void 0,function(){var a,c,d,f,e,h,k,l;return p(this,function(b){a=
this.layer;c=a.capabilities;d=a.objectIdField;f=a.fields.map(function(a){return a.toJSON()});e=a.fullExtent&&a.fullExtent.toJSON();h=v.toJSONGeometryType(a.geometryType);k=a.timeInfo&&a.timeInfo.toJSON()||null;l=this.layer.source;return[2,{type:"stream",maxRecordCount:c.query.maxRecordCount,tileMaxRecordCount:c.query.tileMaxRecordCount,capabilities:c,fields:f,fullExtent:e,geometryType:h,objectIdField:d,timeInfo:k,source:this.layer.parsedUrl.path,streamUrls:l.sourceJSON.streamUrls,content:this.layer.parsedUrl.query,
serviceFilter:w(this.layer.filter),purgeOptions:this.layer.purgeOptions,maximumTrackPoints:this.layer.maximumTrackPoints,enableDataRecieved:this._enabledDataRecieved}]})})};e([d.property()],a.prototype,"errorString",void 0);e([d.property({dependsOn:["errorString"],readOnly:!0})],a.prototype,"connectionError",null);e([d.property()],a.prototype,"connectionStatus",void 0);return a=e([d.subclass("esri.views.2d.layers.StreamLayerView2D")],a)}(d.declared(u))});