// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/3d/interactive/editingTools/graphicMove3D/GraphicMove3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Collection ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../Manipulator3D ../../manipulatorUtils ../manipulatorUtils ./isSupportedGraphic ../../../../interactive/InteractiveToolBase ../../../../interactive/dragUtils/dragActions ../../../../interactive/dragUtils/dragHandlers".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t){Object.defineProperty(c,"__esModule",{value:!0});var v=function(){return function(a){this.allGraphics=a;this.type="graphic-move-start"}}();c.GraphicMoveStartEvent=v;var A=function(){return function(a,b,l,f){this.dx=a;this.dy=b;this.dz=l;this.allGraphics=f;this.type="graphic-move"}}();c.GraphicMoveEvent=A;var l=function(){return function(a){this.allGraphics=a;this.type="graphic-move-stop"}}();c.GraphicMoveStopEvent=l;u=function(b){function n(a){a=b.call(this,
a)||this;a.graphics=new r;a.type="move-3d";a._handles=new g;return a}w(n,b);n.prototype.initialize=function(){var a=this;this._handles.add(this.graphics.on("change",function(){a._refreshManipulators()}));this._refreshManipulators()};n.prototype.destroy=function(){this._handles.destroy();this._handles=null;this.graphics.removeAll();this._set("view",null)};n.prototype.reset=function(){};n.prototype._createDragAction=function(a){var b=this,n=C.createGraphicDragActionMany(a);return function(f){switch(f.action){case "start":b.emit("graphic-move-start",
new v(a))}n(f);switch(f.action){case "start":case "update":("update"===f.action||f.deltaX||f.deltaY||f.deltaZ)&&b.emit("graphic-move",new A(f.deltaX,f.deltaY,f.deltaZ,a));break;case "end":b.emit("graphic-move-stop",new l(a))}}};n.prototype._refreshManipulators=function(){var b=this;this._handles.remove("graphics");this.manipulators.removeAll();for(var l=this.graphics.toArray(),n=[],q=function(m){if(0!==z.isSupportedGraphic(m))return"continue";var l=d.createGraphicMoveXYManipulator(g.view,m);g._handles.add(l.events.on("immediate-click",
function(a){b.emit("immediate-click",p({},a,{graphic:m}));a.stopPropagation()}),"graphics");g.manipulators.add(l);n.push(l);var q=d.createGraphicMoveZManipulator({view:g.view,graphic:m});if(a.isNone(q))return"continue";g._handles.add([f.init(m,"geometry",function(){return x.placeManipulatorAtGraphic(q,m)}),f.init(m,["visible","layer.visible"],function(){return q.visible=m.visible&&m.layer.visible})],"graphics");g.manipulators.add(q);n.push(q)},g=this,m=0;m<l.length;m++)q(l[m]);t.createManipulatorDragHandlerOneOf(n,
function(a,m){return a instanceof k.Manipulator3D?d.createGraphicMoveZScreenDragToMap(b.view,a):d.createGraphicMoveXYScreenDragToMap(b.view,a,m)},this._createDragAction(l))};h([e.property({constructOnly:!0,nonNullable:!0})],n.prototype,"view",void 0);h([e.property({readOnly:!0})],n.prototype,"graphics",void 0);h([e.property({readOnly:!0})],n.prototype,"type",void 0);return n=h([e.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMove3DTool")],n)}(e.declared(b.EventedMixin(n.InteractiveToolBase)));
c.GraphicMove3DTool=u})},"esri/views/3d/interactive/Manipulator3D":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../core/compilerUtils ../../../core/Evented ../../../core/maybe ../../../core/screenUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ../../3d/support/geometryUtils ../../3d/support/projectionUtils ../../3d/support/stack ../../3d/webgl-engine/lib/Camera ../../3d/webgl-engine/lib/Layer ../../3d/webgl-engine/lib/Object3D".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v,A,l,q,y,H){function G(a){return 0!==a[12]||0!==a[13]||0!==a[14]}Object.defineProperty(c,"__esModule",{value:!0});u=function(){function e(m){this.camera=new q.default;this._elevation={offset:0,override:0};this._hideOnGrab=!1;this.collisionType={type:"point"};this.collisionPriority=0;this.renderObjects=[];this._visible=this.autoScaleRenderObjects=!0;this._radius=10;this._worldSized=!1;this.focusMultiplier=2;this.touchMultiplier=2.5;this.worldOriented=!1;
this._modelTransform=x.mat4f64.create();this._worldFrame=null;this._renderLocation=n.vec3f64.create();this._renderLocationDirty=!0;this._elevationAlignedLocation=new p.Point;this.interactive=this._elevationAlignedLocationDirty=!0;this.selectable=!1;this.cursor=null;this._selected=this._hovering=this.dragging=this._grabbing=!1;this._state=0;this._focused=!1;this.events=new b({target:this});this._screenLocation={screenPointArray:a.createScreenPointArray(),renderScreenPointArray:a.createRenderScreenPointArray3(),
pixelSize:0};this._screenLocationDirty=!0;this._engineResourcesAddedToStage=!1;this._engineResources=null;this._attached=!1;this._materialIdReferences=this._engineLayerId=null;this._location=new p.Point({x:0,y:0,z:0,spatialReference:m.view.spatialReference});for(var l in m)this[l]=m[l];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}e.prototype.destroy=function(){this._removeResourcesFromStage();this.camera=this.view=this._engineResources=null};Object.defineProperty(e.prototype,
"elevationInfo",{get:function(){return this._elevationInfo},set:function(a){this._elevationInfo=a;this._elevationAlignedLocationDirty=!0;this._updateEngineObject()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hideOnGrab",{get:function(){return this._hideOnGrab},set:function(a){this._hideOnGrab!==a&&(this._hideOnGrab=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==
this._visible&&(this._visible=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"worldSized",{get:function(){return this._worldSized},set:function(a){a!==this._worldSized&&(this._worldSized=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"modelTransform",{get:function(){return this._modelTransform},set:function(a){G(a)&&(this._screenLocationDirty=!0);k.mat4.copy(this._modelTransform,a);this._updateEngineObject()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"renderLocation",{get:function(){this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=x.mat4f64.create()),
A.computeLinearTransformation(this.view.renderSpatialReference,this._renderLocation,this._worldFrame,this.view.renderSpatialReference),this._worldFrame[12]=0,this._worldFrame[13]=0,this._worldFrame[14]=0):this._worldFrame&&(this._worldFrame=null));return this._renderLocation},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"location",{get:function(){return this._location},set:function(a){t.clonePoint(a,this._location);this._elevationAlignedLocationDirty=this._screenLocationDirty=
this._renderLocationDirty=!0;this._updateEngineObject()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"elevationAlignedLocation",{get:function(){if(!this._elevationAlignedLocationDirty)return this.elevationAlignedLocation;this._evaluateElevationAlignment();this._updateElevationAlignedLocation();return this._elevationAlignedLocation},set:function(a){t.clonePoint(a,this._location);this._evaluateElevationAlignment();this._location.z-=this._elevation.offset;this._updateElevationAlignedLocation();
this._updateEngineObject()},enumerable:!0,configurable:!0});e.prototype._updateElevationAlignedLocation=function(){this._elevationAlignedLocation.x=this.location.x;this._elevationAlignedLocation.y=this.location.y;var a=g.isSome(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=a+this._elevation.offset;this._elevationAlignedLocation.spatialReference=this.location.spatialReference;this._screenLocationDirty=this._renderLocationDirty=!0};Object.defineProperty(e.prototype,
"grabbing",{get:function(){return this._grabbing},set:function(a){a!==this._grabbing&&(this._grabbing=a,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hovering",{get:function(){return this._hovering},set:function(a){a!==this._hovering&&(this._hovering=a,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"selected",
{get:function(){return this._selected},set:function(a){a!==this._selected&&(this._selected=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(a){a!==this._state&&(this._state=a,this._updateEngineObject())},enumerable:!0,configurable:!0});e.prototype._setFocused=function(a){a!==this._focused&&(this._focused=a,this.events.emit("focus",{action:!0===a?"focus":"unfocus"}))};Object.defineProperty(e.prototype,
"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"screenLocation",{get:function(){this.ensureScreenLocation();return this._screenLocation},enumerable:!0,configurable:!0});e.prototype.ensureScreenLocation=function(){if(this._screenLocationDirty){this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation);this._screenLocationDirty=!1;var a;G(this._modelTransform)?(a=this._calculateModelTransformOffset(L),a=
z.vec3.add(a,a,this.renderLocation)):a=this.renderLocation;this.camera.projectPoint(a,this._screenLocation.renderScreenPointArray);this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}};e.prototype.intersectionDistance=function(b,e){if(!this.visible)return null;var n=a.screenPointObjectToArray(b,F),q=this._getCollisionRadius(e);e=-1*this.collisionPriority;switch(this.collisionType.type){case "point":if(d.vec2.squaredDistance(this.screenLocation.screenPointArray,
n)<q*q)return this.screenLocation.renderScreenPointArray[2]+e;break;case "line":var g=this.collisionType.paths;b=this._getWorldToScreenObjectScale();b=this._calculateObjectTransform(b,J);for(var q=q*this.screenLocation.pixelSize,n=v.ray.fromScreen(this.camera,n,E),k=0,B=g;k<B.length;k++)if(g=B[k],0!==g.length)for(var c=z.vec3.transformMat4(N,g[0],b),t=1;t<g.length;t++){var Q=z.vec3.transformMat4(P,g[t],b),y=v.lineSegment.closestRayDistance2(v.lineSegment.fromPoints(c,Q,I),n);if(null!=y&&y<q*q)return b=
z.vec3.add(l.sv3d.get(),c,Q),z.vec3.scale(b,b,.5),q=a.castRenderScreenPointArray(l.sv3d.get()),this.camera.projectPoint(b,q),q[2]+e;z.vec3.copy(c,Q)}break;case "disc":c=this.collisionType.direction;b=this._getWorldToScreenObjectScale();b=this._calculateObjectTransform(b,J);q*=this.screenLocation.pixelSize;n=v.ray.fromScreen(this.camera,n,E);t=f.mat3.fromMat4(m,b);t=z.vec3.transformMat3(R,c,t);c=this._calculateModelTransformPosition(S);v.plane.fromPositionAndNormal(c,t,K);k=D;if(v.plane.intersectRay(K,
n,k)&&z.vec3.squaredDistance(k,c)<q*q)return this.screenLocation.renderScreenPointArray[2]+e;break;case "ribbon":b=this.collisionType;g=b.paths;c=b.direction;b=this._getWorldToScreenObjectScale();b=this._calculateObjectTransform(b,J);q*=this.camera.computeScreenPixelSizeAt(this.renderLocation);n=v.ray.fromScreen(this.camera,n,E);t=f.mat3.fromMat4(m,b);t=z.vec3.transformMat3(R,c,t);c=this._calculateModelTransformPosition(S);v.plane.fromPositionAndNormal(c,t,K);k=D;if(!v.plane.intersectRay(K,n,k))break;
n=0;for(B=g;n<B.length;n++)if(g=B[n],0!==g.length)for(c=z.vec3.transformMat4(N,g[0],b),t=1;t<g.length;t++){Q=z.vec3.transformMat4(P,g[t],b);y=v.lineSegment.distance2(v.lineSegment.fromPoints(c,Q,I),k);if(null!=y&&y<q*q)return b=z.vec3.add(l.sv3d.get(),c,Q),z.vec3.scale(b,b,.5),q=a.castRenderScreenPointArray(l.sv3d.get()),this.camera.projectPoint(b,q),q[2]+e;z.vec3.copy(c,Q)}break;default:r.neverReached(this.collisionType)}return null};e.prototype.attach=function(a){void 0===a&&(a={manipulator3D:{}});
if(this.view._stage){a=a.manipulator3D;this._engineLayerId=a.engineLayerId;if(g.isNone(this._engineLayerId)){var b=new y("manipulator-3d",{isPickable:!1});this.view._stage.add(0,b);this.view._stage.addToViewContent([b.id]);this._engineLayerId=b.id;a.engineLayerId=b.id}a.engineLayerReferences=(a.engineLayerReferences||0)+1;this._materialIdReferences=a.materialIdReferences;g.isNone(this._materialIdReferences)&&(this._materialIdReferences=new Map,a.materialIdReferences=this._materialIdReferences);this.camera.copyFrom(this.view.state.camera);
this._attached=!0;this._updateEngineObject();A.canProject(this._location.spatialReference,this.view.spatialReference)||(this.location=new p.Point({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}};e.prototype.detach=function(a){void 0===a&&(a={manipulator3D:{}});a=a.manipulator3D;a.engineLayerReferences--;var b=0===a.engineLayerReferences;b&&(a.engineLayerId=null);this._removeResourcesFromStage(b);this._materialIdReferences=this._engineLayerId=this._engineResources=null;this._attached=
!1};e.prototype.onViewChange=function(){this.camera.copyFrom(this.view.state.camera);this._screenLocationDirty=!0;this._updateEngineObject()};e.prototype.onElevationChange=function(a){C.containsPointObject(a.extent,this.location)&&(this._elevationAlignedLocationDirty=!0,this._updateEngineObject())};e.prototype._evaluateElevationAlignment=function(a){void 0===a&&(a=this.location);if(g.isNone(this.elevationInfo))return!1;var b=null,m=0;switch(this.elevationInfo.mode){case "on-the-ground":b=this.view.elevationProvider.getElevation(a,
"ground")||0;break;case "relative-to-ground":m=(this.view.elevationProvider.getElevation(a,"ground")||0)+(this.elevationInfo.offset||0);break;case "relative-to-scene":m=(this.view.elevationProvider.getElevation(a,"scene")||0)+(this.elevationInfo.offset||0);break;case "absolute-height":m=this.elevationInfo.offset||0}return m!==this._elevation.offset||b!==this._elevation.override?(this._elevation.offset=m,this._elevation.override=b,!0):!1};e.prototype._updateEngineObject=function(){if(this._attached)if(!1===
this.visible)this._removeResourcesFromStage();else{var a=this._getWorldToScreenObjectScale(),b=J;!0===this.autoScaleRenderObjects&&(a*=this._getFocusedSize(this._radius,this.focused));this._calculateObjectTransform(a,b);for(var a=this._ensureEngineResources().objectsByState,m=(this.focused?2:1)|(this.selected?8:4),n=this.hideOnGrab&&this.grabbing,e=0;e<a.length;e++){var l=a[e],f=l.stateMask,l=l.objects;if(n)for(var f=0,q=l;f<q.length;f++)l=q[f],l.hideAllComponents();else if(q=0===(f&65520)||(this.state&
f)===(f&65520),0!==(f&15)&&(m&f)!==(f&15)||!q)for(f=0,q=l;f<q.length;f++)l=q[f],l.hideAllComponents();else for(f=0,q=l;f<q.length;f++)l=q[f],l.unhideAllComponents(),l.objectTransformation=b}}};e.prototype._ensureEngineResources=function(){if(g.isNone(this._engineResources)){var a=this.view._stage.getContent(0,g.expect(this._engineLayerId)),b=[],m=new Set;this.renderObjects.forEach(function(a){a=a.material;m.has(a)||(b.push(a),m.add(a))});var l=function(a,b){var m=b.geometry,l=b.material,f=b.transform;
Array.isArray(m)?m.forEach(function(b){return a.addGeometry(b,l,f)}):a.addGeometry(m,l,f)},f=new Map;this.renderObjects.forEach(function(a){var b=new H({idHint:"manipulator"});l(b,a);a=a.stateMask||0;var m=f.get(a)||[];m.push(b);f.set(a,m)});var e=[];f.forEach(function(a,b){e.push({stateMask:b,objects:a})});this._engineResources={objectsByState:e,layer:a,materials:b}}this._addResourcesToStage();return this._engineResources};e.prototype._addResourcesToStage=function(){var a=this;if(!this._engineResourcesAddedToStage&&
!g.isNone(this._engineResources)){var b=this._engineResources,m=b.objectsByState,l=b.layer;b.materials.forEach(function(b){var m=g.expect(a._materialIdReferences),l=m.get(b.id)||0;0===l&&a.view._stage.add(3,b);m.set(b.id,l+1)});m.forEach(function(b){b.objects.forEach(function(b){l.addObject(b);a.view._stage.add(1,b)})});this._engineResourcesAddedToStage=!0}};e.prototype._removeResourcesFromStage=function(a){var b=this;void 0===a&&(a=!1);if(this._engineResourcesAddedToStage&&!g.isNone(this._engineResources)){var m=
this._engineResources,l=m.layer,f=m.materials;m.objectsByState.forEach(function(a){a.objects.forEach(function(a){l.removeObject(a);b.view._stage.remove(1,a.id)})});f.forEach(function(a){var m=g.expect(b._materialIdReferences),l=m.get(a.id);1===l?(b.view._stage.remove(3,a.id),m.delete(a.id)):m.set(a.id,l-1)});a&&this.view._stage.remove(0,l.id);this._engineResourcesAddedToStage=!1}};e.prototype._getCollisionRadius=function(a){return this._getFocusedSize(this.radius,!0)*("touch"===a?this.touchMultiplier:
1)};e.prototype._getFocusedSize=function(a,b){return a*(b?this.focusMultiplier:1)};e.prototype._getWorldToScreenObjectScale=function(){return this._worldSized?1:this.screenLocation.pixelSize};e.prototype._calculateModelTransformPosition=function(a){var b=this._getWorldToScreenObjectScale(),b=this._calculateObjectTransform(b,B);return z.vec3.set(a,b[12],b[13],b[14])};e.prototype._calculateModelTransformOffset=function(a){var b=this._calculateModelTransformPosition(a);return z.vec3.subtract(a,b,this.renderLocation)};
e.prototype._calculateObjectTransform=function(a,b){k.mat4.set(b,a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);k.mat4.multiply(b,b,this._modelTransform);this._worldFrame&&k.mat4.multiply(b,b,this._worldFrame);b[12]+=this.renderLocation[0];b[13]+=this.renderLocation[1];b[14]+=this.renderLocation[2];b[15]=1;return b};return e}();c.Manipulator3D=u;var F=a.createScreenPointArray(),I=v.lineSegment.create(),E=v.ray.create(),m=e.mat3f64.create(),B=x.mat4f64.create(),J=x.mat4f64.create(),K=v.plane.create(),N=n.vec3f64.create(),
P=n.vec3f64.create(),D=n.vec3f64.create(),R=n.vec3f64.create(),S=n.vec3f64.create(),L=n.vec3f64.create()})},"esri/views/3d/interactive/manipulatorUtils":function(){define("require exports ../../../core/maybe ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../layers/graphics/dehydratedFeatures ../layers/graphics/graphicUtils ../support/stack ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryUtil ../webgl-engine/materials/DefaultMaterial ../../interactive/Manipulator3D".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k){function x(a,b){var f=1!==b;a=new e({diffuse:a,transparent:f,writeDepth:!f,cullFace:2,opacity:b,castShadows:!1,softwareInstanced:!0},"manipulator");a.renderOccluded=4;return a}function d(a,b,f,e){a=p.vec3.normalize(g.sv3d.get(),a);b=p.vec3.normalize(g.sv3d.get(),b);var n=p.vec3.cross(g.sv3d.get(),a,b);e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=0;e[4]=b[0];e[5]=b[1];e[6]=b[2];e[7]=0;e[8]=n[0];e[9]=n[1];e[10]=n[2];e[11]=0;e[12]=f[0];e[13]=f[1];e[14]=f[2];e[15]=1;return e}Object.defineProperty(c,
"__esModule",{value:!0});c.createManipulatorMaterial=x;c.createSphereManipulator=function(b,e,g){return new k.Manipulator3D({view:b,renderObjects:[{geometry:new a(f.createSphereGeometry(1,32,32),"manipulator"),material:x(e,g)}]})};c.calculateInputRotationTransform=function(a,b,e,f){a=p.vec3.subtract(g.sv3d.get(),a,e);f=p.vec3.cross(g.sv3d.get(),f,a);e=d(a,f,e,g.sm4d.get());w.mat4.invert(e,e);b=p.vec3.transformMat4(g.sv3d.get(),b,e);return Math.atan2(b[1],b[0])};c.calculateTranslateRotateFromBases=
d;c.placeManipulatorAtGraphic=function(a,e){var f=a.view.getViewForGraphic(e),f=h.isSome(f)&&"computeAttachmentOrigin"in f?f.computeAttachmentOrigin(e,a.view.spatialReference):null;h.isSome(f)?a.elevationAlignedLocation=f:(e=e.geometry,h.isNone(e)||(e=b.computeCentroid(e),h.isNone(e)||(a.location=r.hydrateGeometry(e))))}})},"esri/views/interactive/Manipulator3D":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/assignHelper ../../core/Accessor ../../core/compilerUtils ../../core/Evented ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f64 ../../core/libs/gl-matrix-2/mat4 ../../core/libs/gl-matrix-2/mat4f64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/aaBoundingRect ../../layers/graphics/dehydratedFeatures ../3d/support/geometryUtils ../3d/support/projectionUtils ../3d/support/stack ../3d/webgl-engine/lib/Intersector ../3d/webgl-engine/lib/intersectorUtils ../3d/webgl-engine/lib/Layer ../3d/webgl-engine/lib/Object3D".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v,A,l,q,y,H,G,F,I,E,m){function B(a){return 0!==a[12]||0!==a[13]||0!==a[14]}Object.defineProperty(c,"__esModule",{value:!0});u=function(c){function d(a){a=c.call(this,a)||this;a.hideOnGrab=!1;a.moveOnDrag=!0;a.snapToPointer=!0;a.collisionType={type:"point"};a.collisionPriority=0;a.renderObjects=[];a.autoScaleRenderObjects=!0;a._radius=10;a._worldSized=!1;a._focusMultiplier=2;a._touchMultiplier=2.5;a.interactive=!0;a.selectable=!1;a.cursor=null;a.dragging=
!1;a._areAnyEngineObjectsVisible=!1;a.events=new g({target:a});a._position=A.vec3f64.create();a._modelTransform=n.mat4f64.create();a._dragOffset=null;a._dirtyScreenPoint=f.createScreenPoint();a._dirtyScreenPointArray=f.createScreenPointArray();a._dirtyRenderScreenPointArray=f.createRenderScreenPointArray3();a._dirtyOriginScreenPointArray=f.createScreenPointArray();a._dirtyScreenPixelSize=1;a._screenPositionDirty=!0;a._engineResourcesAddedToStage=!1;a._engineResources=null;a._attached=!1;a._engineLayerId=
null;a._materialIdReferences=null;a._hitResult={onSurface:!1,surfaceType:"ground"};return a}w(d,c);d.prototype.initialize=function(){var a=this;this._intersector=new F(this.view.viewingMode);this._mapPoint=q.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.events.on("drag",function(b){return a.drag(b)})};d.prototype.destroy=function(){this._removeResourcesFromStage();this._engineResources=null;this._set("view",null);this._camera=null};Object.defineProperty(d.prototype,"alignment",{get:function(){return this._get("alignment")},
set:function(a){this._set("alignment",a);this.constructed&&this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visible",{set:function(a){a!==this._get("visible")&&(this._set("visible",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"radius",{get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"worldSized",{get:function(){return this._worldSized},set:function(a){a!==this._worldSized&&(this._worldSized=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"focusMultiplier",{get:function(){return this._focusMultiplier},set:function(a){this._focusMultiplier=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"touchMultiplier",{get:function(){return this._touchMultiplier},set:function(a){this._touchMultiplier=a},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"modelTransform",{get:function(){return this._modelTransform},set:function(a){B(a)&&(this._screenPositionDirty=!0);z.mat4.copy(this._modelTransform,a);this._updateEngineObject()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"position",{get:function(){return this._position},set:function(a){this.view.renderCoordsHelper.fromRenderCoords(a,this._mapPoint,this._mapPoint.spatialReference);this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"mapPoint",{get:function(){return this._mapPoint},set:function(a){q.clonePoint(a,this._mapPoint);this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"grabbing",{set:function(a){a!==this._get("grabbing")&&(this._set("grabbing",a),this._updateEngineObject());a||(this._dragOffset=null)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hovering",{set:function(a){a!==this._get("hovering")&&(this._set("hovering",a),this._updateEngineObject())},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"selected",{set:function(a){a!==this._get("selected")&&(this._set("selected",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{set:function(a){a!==this._get("state")&&(this._set("state",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"areAnyEngineObjectsVisible",{get:function(){return this._areAnyEngineObjectsVisible},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"surfaceType",{get:function(){return this._hitResult.onSurface?this._hitResult.surfaceType:null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"screenPoint",{get:function(){this._updateScreenSpaceProperties();
return this._dirtyScreenPoint},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_screenPointArray",{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_renderScreenPointArray",{get:function(){this._updateScreenSpaceProperties();return this._dirtyRenderScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_originScreenPointArray",{get:function(){this._updateScreenSpaceProperties();
return this._dirtyOriginScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_screenPixelSize",{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPixelSize},enumerable:!0,configurable:!0});d.prototype._updateScreenSpaceProperties=function(){if(this._screenPositionDirty){this._screenPositionDirty=!1;this._dirtyScreenPixelSize=this._camera.computeScreenPixelSizeAt(this._position);var a=B(this._modelTransform),b;a?(b=this._calculateModelTransformOffset(Y),
b=v.vec3.add(b,b,this._position)):b=this._position;this._camera.projectPoint(b,this._dirtyRenderScreenPointArray);this._camera.renderToScreen(this._dirtyRenderScreenPointArray,this._dirtyScreenPointArray);f.screenPointArrayToObject(this._dirtyScreenPointArray,this._dirtyScreenPoint);a?(this._camera.projectPoint(this._position,N),this._camera.renderToScreen(N,this._dirtyOriginScreenPointArray)):C.vec2.copy(this._dirtyOriginScreenPointArray,this._dirtyScreenPointArray)}};d.prototype.intersectionDistance=
function(a,e){if(!this._get("visible"))return null;var m=f.screenPointObjectToArray(a,K),l=this._getCollisionRadius(e);e=-1*this._get("collisionPriority");switch(this.collisionType.type){case "point":if(C.vec2.squaredDistance(this._screenPointArray,m)<l*l)return this._renderScreenPointArray[2]+e;break;case "line":var d=this.collisionType.paths;a=this._getWorldToScreenObjectScale();a=this._calculateObjectTransform(a,L);for(var l=l*this._screenPixelSize,m=y.ray.fromScreen(this._camera,m,D),q=0,n=d;q<
n.length;q++)if(d=n[q],0!==d.length)for(var g=v.vec3.transformMat4(O,d[0],a),c=1;c<d.length;c++){var k=v.vec3.transformMat4(U,d[c],a),B=y.lineSegment.closestRayDistance2(y.lineSegment.fromPoints(g,k,P),m);if(null!=B&&B<l*l)return a=v.vec3.add(G.sv3d.get(),g,k),v.vec3.scale(a,a,.5),l=f.castRenderScreenPointArray(G.sv3d.get()),this._camera.projectPoint(a,l),l[2]+e;v.vec3.copy(g,k)}break;case "disc":g=this.collisionType.direction;a=this._getWorldToScreenObjectScale();a=this._calculateObjectTransform(a,
L);l*=this._screenPixelSize;m=y.ray.fromScreen(this._camera,m,D);c=x.mat3.fromMat4(R,a);c=v.vec3.transformMat3(V,g,c);g=this._calculateModelTransformPosition(W);y.plane.fromPositionAndNormal(g,c,M);q=T;if(y.plane.intersectRay(M,m,q)&&v.vec3.squaredDistance(q,g)<l*l)return this._renderScreenPointArray[2]+e;break;case "ribbon":a=this.collisionType;d=a.paths;g=a.direction;a=this._getWorldToScreenObjectScale();a=this._calculateObjectTransform(a,L);l*=this._camera.computeScreenPixelSizeAt(this._position);
m=y.ray.fromScreen(this._camera,m,D);c=x.mat3.fromMat4(R,a);c=v.vec3.transformMat3(V,g,c);g=this._calculateModelTransformPosition(W);y.plane.fromPositionAndNormal(g,c,M);q=T;if(!y.plane.intersectRay(M,m,q))break;m=0;for(n=d;m<n.length;m++)if(d=n[m],0!==d.length)for(g=v.vec3.transformMat4(O,d[0],a),c=1;c<d.length;c++){k=v.vec3.transformMat4(U,d[c],a);B=y.lineSegment.distance2(y.lineSegment.fromPoints(g,k,P),q);if(null!=B&&B<l*l)return a=v.vec3.add(G.sv3d.get(),g,k),v.vec3.scale(a,a,.5),l=f.castRenderScreenPointArray(G.sv3d.get()),
this._camera.projectPoint(a,l),l[2]+e;v.vec3.copy(g,k)}break;default:b.neverReached(this.collisionType)}return null};d.prototype.drag=function(b){if(this.moveOnDrag){b=f.screenPointObjectToArray(b.screenPoint,K);a.isNone(this._dragOffset)&&this.grabbing&&!this.snapToPointer&&(this._dragOffset=C.vec2.subtract(t.vec2f32.create(),b,this._originScreenPointArray));a.isSome(this._dragOffset)&&C.vec2.subtract(b,b,this._dragOffset);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(b,this._intersector,
"on-the-ground"===this.alignment?J:null);b=this._intersector.results.min;var m=T;b.getIntersectionPoint(m)?(this.position=m,this._hitResult.onSurface=!0,this._hitResult.surfaceType="TerrainRenderer"===b.intersector?"ground":"feature"):this._hitResult.onSurface=!1}};d.prototype.attach=function(b){void 0===b&&(b={manipulator3D:{}});if(this.view._stage){b=b.manipulator3D;this._engineLayerId=b.engineLayerId;if(a.isNone(this._engineLayerId)){var m=new E("manipulator-3d",{isPickable:!1});this.view._stage.add(0,
m);this.view._stage.addToViewContent([m.id]);this._engineLayerId=m.id;b.engineLayerId=m.id}b.engineLayerReferences=(b.engineLayerReferences||0)+1;this._materialIdReferences=b.materialIdReferences;a.isNone(this._materialIdReferences)&&(this._materialIdReferences=new Map,b.materialIdReferences=this._materialIdReferences);this._camera=this.view.state.camera;this._attached=!0;this._updateEngineObject();H.canProject(this._mapPoint.spatialReference,this.view.spatialReference)||(this.mapPoint=q.makeDehydratedPoint(0,
0,0,this.view.spatialReference))}};d.prototype.detach=function(a){void 0===a&&(a={manipulator3D:{}});a=a.manipulator3D;a.engineLayerReferences--;var b=0===a.engineLayerReferences;b&&(a.engineLayerId=null);this._removeResourcesFromStage(b);this._camera=this._materialIdReferences=this._engineLayerId=this._engineResources=null;this._attached=!1};d.prototype.onViewChange=function(){this._camera=this.view.state.camera;this._screenPositionDirty=!0;this._updateEngineObject()};d.prototype.onElevationChange=
function(a){this.view.renderCoordsHelper.fromRenderCoords(this.position,X,a.spatialReference)&&l.containsPoint(a.extent,X)&&this._refreshMapPoint(!0)};d.prototype._refreshMapPoint=function(a){void 0===a&&(a=!1);switch(this.alignment){case "none":break;case "on-the-ground":var m=this.view.elevationProvider.getElevation(this.mapPoint,"ground");if(m===this._mapPoint.z&&a)return;this._mapPoint.z=m;break;default:b.neverReached(this.alignment)}this._screenPositionDirty=!0;this._hitResult.onSurface=!1;this.view.renderCoordsHelper.toRenderCoords(this._mapPoint,
this._position);this._updateEngineObject()};d.prototype._updateEngineObject=function(){this._areAnyEngineObjectsVisible=!1;if(this._attached)if(!1===this._get("visible"))this._removeResourcesFromStage();else{var a=this._getWorldToScreenObjectScale(),b=L;!0===this._get("autoScaleRenderObjects")&&(a*=this._getFocusedSize(this._radius,this._focused));this._calculateObjectTransform(a,b);for(var a=this._ensureEngineResources().objectsByState,m=(this._focused?2:1)|(this._get("selected")?8:4),e=this._get("hideOnGrab")&&
this._get("grabbing"),l=0;l<a.length;l++){var d=a[l],f=d.stateMask,d=d.objects;if(e)for(var f=0,q=d;f<q.length;f++)d=q[f],d.hideAllComponents();else if(q=0===(f&15)||(m&f)===(f&15),f=0===(f&65520)||(this._get("state")&f)===(f&65520),q&&f)for(f=0,q=d;f<q.length;f++)d=q[f],d.unhideAllComponents(),d.objectTransformation=b,this._areAnyEngineObjectsVisible=!0;else for(f=0,q=d;f<q.length;f++)d=q[f],d.hideAllComponents()}}};d.prototype._ensureEngineResources=function(){if(a.isNone(this._engineResources)){var b=
this.view._stage.getContent(0,a.expect(this._engineLayerId)),d=[],e=new Set;this.renderObjects.forEach(function(a){a=a.material;e.has(a)||(d.push(a),e.add(a))});var f=function(a,b){var m=b.geometry,d=b.material,e=b.transform;Array.isArray(m)?m.forEach(function(b){return a.addGeometry(b,d,e)}):a.addGeometry(m,d,e)},l=new Map;this.renderObjects.forEach(function(a){var b=new m({idHint:"manipulator"});f(b,a);a=a.stateMask||0;var d=l.get(a)||[];d.push(b);l.set(a,d)});var q=[];l.forEach(function(a,b){q.push({stateMask:b,
objects:a})});this._engineResources={objectsByState:q,layer:b,materials:d}}this._addResourcesToStage();return this._engineResources};d.prototype._addResourcesToStage=function(){var b=this;if(!this._engineResourcesAddedToStage&&!a.isNone(this._engineResources)){var m=this._engineResources,d=m.objectsByState,e=m.layer;m.materials.forEach(function(m){var d=a.expect(b._materialIdReferences),e=d.get(m.id)||0;0===e&&b.view._stage.add(3,m);d.set(m.id,e+1)});d.forEach(function(a){a.objects.forEach(function(a){e.addObject(a);
b.view._stage.add(1,a)})});this._engineResourcesAddedToStage=!0}};d.prototype._removeResourcesFromStage=function(b){var m=this;void 0===b&&(b=!1);if(this._engineResourcesAddedToStage&&!a.isNone(this._engineResources)){var d=this._engineResources,e=d.layer,l=d.materials;d.objectsByState.forEach(function(a){a.objects.forEach(function(a){e.removeObject(a);m.view._stage.remove(1,a.id)})});l.forEach(function(b){var d=a.expect(m._materialIdReferences),e=d.get(b.id);1===e?(m.view._stage.remove(3,b.id),d.delete(b.id)):
d.set(b.id,e-1)});b&&this.view._stage.remove(0,e.id);this._engineResourcesAddedToStage=!1}};d.prototype._getCollisionRadius=function(a){return this._getFocusedSize(this._radius,!0)*("touch"===a?this._touchMultiplier:1)};d.prototype._getFocusedSize=function(a,b){return a*(b?this._focusMultiplier:1)};d.prototype._getWorldToScreenObjectScale=function(){return this._worldSized?1:this._screenPixelSize};d.prototype._calculateModelTransformPosition=function(a){var b=this._getWorldToScreenObjectScale(),b=
this._calculateObjectTransform(b,S);return v.vec3.set(a,b[12],b[13],b[14])};d.prototype._calculateModelTransformOffset=function(a){var b=this._calculateModelTransformPosition(a);return v.vec3.subtract(a,b,this._position)};d.prototype._calculateObjectTransform=function(a,b){z.mat4.set(b,a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);z.mat4.multiply(b,b,this._modelTransform);b[12]+=this._position[0];b[13]+=this._position[1];b[14]+=this._position[2];b[15]=1;return b};h([e.property({constructOnly:!0,nonNullable:!0})],
d.prototype,"view",void 0);h([e.property({value:"none",nonNullable:!0})],d.prototype,"alignment",null);h([e.property()],d.prototype,"hideOnGrab",void 0);h([e.property()],d.prototype,"moveOnDrag",void 0);h([e.property()],d.prototype,"snapToPointer",void 0);h([e.property()],d.prototype,"collisionType",void 0);h([e.property({type:k.Integer})],d.prototype,"collisionPriority",void 0);h([e.property({constructOnly:!0})],d.prototype,"renderObjects",void 0);h([e.property()],d.prototype,"autoScaleRenderObjects",
void 0);h([e.property({value:!0})],d.prototype,"visible",null);h([e.property()],d.prototype,"radius",null);h([e.property()],d.prototype,"worldSized",null);h([e.property()],d.prototype,"focusMultiplier",null);h([e.property()],d.prototype,"touchMultiplier",null);h([e.property()],d.prototype,"interactive",void 0);h([e.property()],d.prototype,"selectable",void 0);h([e.property()],d.prototype,"cursor",void 0);h([e.property({value:!1})],d.prototype,"grabbing",null);h([e.property()],d.prototype,"dragging",
void 0);h([e.property({value:!1})],d.prototype,"hovering",null);h([e.property({value:!1})],d.prototype,"selected",null);h([e.property({value:0})],d.prototype,"state",null);h([e.property({dependsOn:["hovering","grabbing"]})],d.prototype,"focused",null);return d=h([e.subclass("esri.views.interactive.Manipulator3D")],d)}(e.declared(r));c.Manipulator3D=u;var J={include:new Set};J.include.add(I.TERRAIN_ID);var K=f.createScreenPointArray(),N=f.createRenderScreenPointArray3(),P=y.lineSegment.create(),D=
y.ray.create(),R=d.mat3f64.create(),S=n.mat4f64.create(),L=n.mat4f64.create(),M=y.plane.create(),O=A.vec3f64.create(),U=A.vec3f64.create(),T=A.vec3f64.create(),V=A.vec3f64.create(),W=A.vec3f64.create(),Y=A.vec3f64.create(),X=A.vec3f64.create()})},"esri/views/3d/interactive/editingTools/manipulatorUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../support/elevationInfoUtils ../../../../support/featureFlags ../Manipulator3D ../manipulatorUtils ../dragUtils/dragAtLocation ../dragUtils/projectScreenToMap ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial ../../../interactive/GraphicManipulator ../../../interactive/dragUtils/screenDragToMap".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v){function A(a,b){return"on-the-ground"===b.mode||h.isNone(a.geometry)||!a.geometry.hasZ?!1:!0}Object.defineProperty(c,"__esModule",{value:!0});c.createGraphicMoveXYManipulator=function(a,b){return new t.GraphicManipulator({graphic:b,view:a,selectable:!0,cursor:"move"})};c.createGraphicMoveXYScreenDragToMap=function(a,b,d){return v.createXYConstrainedFromProject(x.createForGraphic(a,b.graphic,d.start),h.expect(b.graphic.geometry).spatialReference)};c.canMoveZ=
A;c.createGraphicMoveZManipulator=function(l){var q=l.graphic,c=l.view;if(!a.enableEditing3D())return null;var k=g.getGraphicEffectiveElevationInfo(q);if(!A(q,k))return null;var t=[r.vec3f64.fromValues(0,0,0),r.vec3f64.fromValues(0,0,90)],t=new d(z.createPolylineGeometry(t),"move-z"),v=z.createConeGeometry(20,5,16,!1),v=new d(v),x=[r.vec3f64.fromValues(0,0,0),r.vec3f64.fromValues(0,0,110)],E=p.mat4f64.create();w.mat4.translate(E,E,[0,0,90]);w.mat4.rotateX(E,E,Math.PI/2);var m=p.mat4f64.create();w.mat4.translate(m,
m,[0,0,90]);w.mat4.rotateX(m,m,Math.PI/2);w.mat4.scale(m,m,[1.2,1.2,1]);var B=r.vec3f64.fromValues(0,.5,.9),h=b.vec4f64.fromValues(B[0],B[1],B[2],1);return new f.Manipulator3D({view:c,renderObjects:[{geometry:t,material:function(){var a=new n({color:h},"move-z");a.renderOccluded=4;return a}(),stateMask:1},{geometry:v,transform:E,material:e.createManipulatorMaterial(B,1),stateMask:1},{geometry:t,material:function(a){a=new C({color:h,width:a},"move-z");a.renderOccluded=4;return a}(2),stateMask:2},{geometry:v,
transform:m,material:e.createManipulatorMaterial(B,1),stateMask:2}],collisionType:{type:"line",paths:[x]},autoScaleRenderObjects:!1,worldSized:!1,radius:4,selectable:!1,cursor:"ns-resize",elevationInfo:k,worldOriented:null!=l.worldOriented?l.worldOriented:!0,visible:!!q.visible})};c.createGraphicMoveZScreenDragToMap=function(a,b){var d=v.createZConstrainedFromProject(x.createCameraAlignedWorldUp(a,b.elevationAlignedLocation),b.location.spatialReference);return k.dragAtLocation(a,d,b.elevationAlignedLocation)}})},
"esri/support/elevationInfoUtils":function(){define(["require","exports","../core/maybe"],function(u,c,h){function w(b,g){var a=h.isSome(b)?b.hasZ:!1;return h.isNone(g)?a?"absolute-height":"on-the-ground":"relative-to-ground"!==g.mode||!h.isNone(g.offset)&&0!==g.offset||!h.isSome(b)||"point"!==b.type||a&&0!==b.z?g.mode:"on-the-ground"}function p(b){var g=r(b);return w(b.geometry,g)}function r(b){return b.layer&&"elevationInfo"in b.layer?b.layer.elevationInfo:null}Object.defineProperty(c,"__esModule",
{value:!0});c.getGeometryEffectiveElevationMode=w;c.getGraphicEffectiveElevationMode=p;c.getGraphicEffectiveElevationInfo=function(b){var g=r(b);b=w(b.geometry,g);var a=h.isSome(g)&&"on-the-ground"!==b?g.offset:0,g=h.isSome(g)&&"on-the-ground"!==b?g.featureExpressionInfo:null;return{mode:b,offset:a,featureExpressionInfo:g}};c.hasGraphicFeatureExpressionInfo=function(b){if("on-the-ground"===p(b))return!1;b=r(b);b=h.isSome(b)&&b.featureExpressionInfo?b.featureExpressionInfo.expression:null;return!(!b||
"0"===b)}})},"esri/views/3d/interactive/dragUtils/dragAtLocation":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils".split(" "),function(u,c,h,w,p,r){Object.defineProperty(c,"__esModule",{value:!0});c.dragAtLocation=function(b,g,a){if(p.isNone(g))return null;var f=null,e=0,c=0;return function(k){"start"===k.action&&(f=b.toScreen(a),0>f.x||f.x>b.width||0>f.y||f.y>b.height?f=null:(e=k.start.x-f.x,
c=k.start.y-f.y));if(null==f)return null;var d=w.clamp(k.screenPoint.x-e,0,b.width),z=w.clamp(k.screenPoint.y-c,0,b.height),d=r.createScreenPoint(d,z);return g(h({},k,{start:f,screenPoint:d}))}}})},"esri/views/3d/interactive/dragUtils/projectScreenToMap":function(){define("require exports ../../../../geometry ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../support/elevationInfoUtils ../../support/geometryUtils ../../support/projectionUtils ../../support/geometryUtils/plane ../../support/geometryUtils/ray".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k){function x(a){return function(b,d){return(b=a.toMap(b))&&f.pointToPoint(b,b,d)?b:null}}function d(a,d){var e=p.createScreenPointArray(),f=k.create(),g=b.vec3f64.create();return function(b,l){p.screenPointObjectToArray(b,e);k.fromScreenAtEye(a.state.camera,e,f);b=a.renderCoordsHelper.intersectManifoldClosestSilhouette(f,d,g);return a.renderCoordsHelper.fromRenderCoords(b,l)}}Object.defineProperty(c,"__esModule",{value:!0});c.createForGraphic=function(a,b,e){switch(g.getGraphicEffectiveElevationMode(b)){case "on-the-ground":return x(a);
case "absolute-height":return b=a.toMap(e,{include:[b]}),d(a,b.z);default:return null}};c.createForGraphicAtLocation=function(a,b,e){switch(g.getGraphicEffectiveElevationMode(b)){case "on-the-ground":return x(a);case "absolute-height":return d(a,e.z);default:return null}};c.createOnTheGround=x;c.createAbsoluteHeight=d;c.createCameraAlignedWorldUp=function(d,f){var g=b.vec3f64.create();if(!d.renderCoordsHelper.toRenderCoords(f,g))return null;var c=r.vec3.length(g),n=b.vec3f64.create();d.renderCoordsHelper.worldUpAtPosition(g,
n);var A=e.create(),l=p.createScreenPointArray(),q=b.vec3f64.create(),y=k.create();return function(b,f){var t=d.state.camera,v=r.vec3.cross(A,n,r.vec3.subtract(q,g,t.eye));r.vec3.cross(v,v,n);e.fromPositionAndNormal(g,v,A);k.fromScreenAtEye(t,p.screenPointObjectToArray(b,l),y);if(!e.intersectRay(A,y,q))return null;r.vec3.subtract(q,q,g);a.vector.projectPoint(n,q,q);"global"===d.viewingMode&&r.vec3.length(q)*w.sign(r.vec3.dot(n,q))<-c+.001&&r.vec3.subtract(q,r.vec3.scale(q,n,.001),g);r.vec3.add(q,
q,g);return d.renderCoordsHelper.fromRenderCoords(q,new h.Point,f)}}})},"esri/views/interactive/GraphicManipulator":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/assignHelper ../../core/Accessor ../../core/Evented ../../core/Logger ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/webMercatorUtils ../../support/elevationInfoUtils ../../symbols/support/defaults ../../symbols/support/ElevationInfo ../../views/support/drapedUtils".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v){Object.defineProperty(c,"__esModule",{value:!0});var A=g.getLogger("esri.views.interactive.GraphicManipulator");u=function(d){function g(a){a=d.call(this,a)||this;a.layer=null;a.interactive=!0;a.selectable=!1;a.dragging=!1;a.cursor=null;a.events=new b({target:a});a._circleCollisionCache=null;a._originalSymbol=null;return a}w(g,d);Object.defineProperty(g.prototype,"graphic",{set:function(b){"mesh"===a.get(b.geometry,"type")?A.error("Mesh geometries are not supported"):
(this._circleCollisionCache=null,this._originalSymbol=b.symbol,this._set("graphic",b))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"elevationInfo",{get:function(){var a="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,b=n.getGraphicEffectiveElevationMode(this.graphic);return new t({mode:b,offset:a?a.offset:0})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"focusedSymbol",{set:function(a){a!==this._get("focusedSymbol")&&(this._set("focusedSymbol",
a),this._updateGraphicSymbol(),this._circleCollisionCache=null)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"grabbing",{set:function(a){if(a!==this._get("grabbing")){var b=this._focused;this._set("grabbing",a);this._updateGraphicSymbol(b)}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hovering",{set:function(a){if(a!==this._get("hovering")){var b=this._focused;this._set("hovering",a);this._updateGraphicSymbol(b)}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"selected",{set:function(a){a!==this._get("selected")&&(this._set("selected",a),this._updateGraphicSymbol())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0});g.prototype.destroy=function(){this._resetGraphicSymbol();this._set("view",null)};g.prototype.intersectionDistance=function(b){var d=this._get("graphic");if(!1===d.visible)return null;var e=this._get("focusedSymbol"),
e=a.isSome(e)?e:d.symbol,m=d.geometry;if(a.isNone(m))return null;var f=this._get("view");return"2d"===f.type?this._intersectDistance2D(b,f,m,e):this._intersectDistance3D(b,f,d)};g.prototype.attach=function(){a.isNone(this.layer)||this.layer.add(this.graphic)};g.prototype.detach=function(){this._resetGraphicSymbol();a.isNone(this.layer)||this.layer.remove(this.graphic)};g.prototype._updateGraphicSymbol=function(b){void 0===b&&(b=this._focused);b!==this._focused&&(b=this.graphic.symbol,b!==this._originalSymbol&&
b!==this.focusedSymbol&&(this._originalSymbol=b));this.graphic.symbol=this._focused&&a.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol};g.prototype._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol};g.prototype._intersectDistance2D=function(b,d,e,m){m=m||C.getDefaultSymbol2D(e);if(a.isNone(m))return null;var l=this._circleCollisionCache;if("point"!==e.type||"simple-marker"!==m.type)return l=v.intersectsDrapedGeometry(b,e,d),a.isSome(l)?1:null;if(a.isNone(l)||
!l.originalPoint.equals(e)){var g=d.spatialReference;z.canProject(e,g)&&(l=z.project(e,g),this._circleCollisionCache=l={originalPoint:e.clone(),mapPoint:l,radiusPx:f.pt2px(m.size)})}return a.isSome(l)?(b=f.screenPointObjectToArray(b,q),d=d.state.toScreen(y,l.mapPoint.x,l.mapPoint.y),l=l.radiusPx,k.vec2.squaredDistance(b,d)<l*l?1:null):null};g.prototype._intersectDistance3D=function(a,b,d){a=b.toMap(a,{include:[d]});if(!a)return null;d=l;return b.renderCoordsHelper.toRenderCoords(a,d)?x.vec3.distance(d,
b.state.camera.eye):null};h([e.property({constructOnly:!0,nonNullable:!0})],g.prototype,"graphic",null);h([e.property({readOnly:!0,dependsOn:["graphic"]})],g.prototype,"elevationInfo",null);h([e.property({constructOnly:!0,nonNullable:!0})],g.prototype,"view",void 0);h([e.property({value:null})],g.prototype,"focusedSymbol",null);h([e.property({constructOnly:!0})],g.prototype,"layer",void 0);h([e.property()],g.prototype,"interactive",void 0);h([e.property()],g.prototype,"selectable",void 0);h([e.property({value:!1})],
g.prototype,"grabbing",null);h([e.property()],g.prototype,"dragging",void 0);h([e.property()],g.prototype,"hovering",null);h([e.property({value:!1})],g.prototype,"selected",null);h([e.property()],g.prototype,"cursor",void 0);return g=h([e.subclass("esri.views.interactive.GraphicManipulator")],g)}(e.declared(r));c.GraphicManipulator=u;var l=d.vec3f64.create(),q=f.createScreenPointArray(),y=f.createScreenPointArray()})},"esri/views/support/drapedUtils":function(){define("require exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),
function(u,c,h,w,p,r){function b(a,b,e,g){void 0===g&&(g=new h.Extent);var f;if("2d"===e.type)f=b*e.resolution;else if("3d"===e.type){var d=e.basemapTerrain,c=d.overlayManager,c=c?c.overlayPixelSizeInMapUnits(a):1;f=d&&!d.spatialReference.equals(e.spatialReference)?p.getMetersPerUnitForSR(d.spatialReference)/p.getMetersPerUnitForSR(e.spatialReference):b*c}b=a.x-f;d=a.y-f;c=a.x+f;a=a.y+f;e=e.spatialReference;g.xmin=Math.min(b,c);g.ymin=Math.min(d,a);g.xmax=Math.max(b,c);g.ymax=Math.max(d,a);g.spatialReference=
e;return g}Object.defineProperty(c,"__esModule",{value:!0});c.createQueryGeometry=b;c.intersectsDrapedGeometry=function(a,f,e){a=e.toMap(a);if(w.isNone(a))return null;var c=r.calculateTolerance();return b(a,c,e,g).intersects(f)?a:null};var g=new h.Extent})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(u,c){function h(c,b){return b&&b.xoffset?Math.max(c,Math.abs(b.xoffset)):b&&b.yoffset?Math.max(c,Math.abs(b.yoffset)):c}function w(c,b){if("number"===
typeof c)return c;if(c&&c.stops&&c.stops.length){c=c.stops;for(var g=b=0,a=0;a<c.length;a++){var f=c[a].size;"number"===typeof f&&(b+=f,g++)}return b/g}return b}function p(c,b){if(!b)return c;b=b.filter(function(a){return"size"===a.type}).map(function(a){var b=a.minSize;return(w(a.maxSize,c)+w(b,c))/2});var g=0,a=b.length;if(0===a)return c;for(var f=0;f<a;f++)g+=b[f];return Math.max(Math.floor(g/a),c)}Object.defineProperty(c,"__esModule",{value:!0});c.calculateTolerance=function(c){if(!c)return 6;
var b="visualVariables"in c?p(6,c.visualVariables):6;if("simple"===c.type)return h(b,c.symbol);if("unique-value"===c.type){var g=b;c.uniqueValueInfos.forEach(function(a){g=h(g,a.symbol)});return g}if("class-breaks"===c.type){var a=b;c.classBreakInfos.forEach(function(b){a=h(a,b.symbol)});return a}return b}})},"esri/views/interactive/dragUtils/screenDragToMap":function(){define(["require","exports","../../../core/tsSupport/assignHelper","../../../core/maybe"],function(u,c,h,w){function p(c,b,g){if(w.isNone(c))return null;
var a=null,f=0,e=0,k=0;return function(x){"start"===x.action&&(a=c(x.start,g),k=e=f=0);var d=f,z=e,n=k,r=c(x.screenPoint,g);w.isSome(a)&&w.isSome(r)&&(d=b&1?r.x-a.x:0,z=b&2?r.y-a.y:0,n=b&4?r.z-a.z:0);x={action:x.action,deltaX:d,deltaY:z,deltaZ:n,spatialReference:g};f=d;e=z;k=n;return x}}Object.defineProperty(c,"__esModule",{value:!0});c.createFromProject=p;c.createMapAxisConstrainedScreenToMapDrag=function(c,b,g){if(w.isNone(c))return null;var a=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);if(0===a)return null;
var f=b[0]/a,e=b[1]/a,k=b[2]/a,x=null,d=0,z=0,n=0;return function(a){"start"===a.action&&(x=c(a.start,g),n=z=d=0);var b=d,v=z,A=n,l=c(a.screenPoint,g);w.isSome(x)&&w.isSome(l)&&(b=l.x-x.x,v=l.y-x.y,A=l.z-x.z,A=b*f+v*e+A*k,b=A*f,v=A*e,A*=k);a={action:a.action,deltaX:b,deltaY:v,deltaZ:A,previousDeltaX:d,previousDeltaY:z,previousDeltaZ:n,spatialReference:g};d=b;z=v;n=A;return a}};c.createXYConstrainedFromProject=function(r,b){return p(r,c.horizontalDegreesOfFreedom,b)};c.createZConstrainedFromProject=
function(r,b){return p(r,c.verticalDegreesOfFreedom,b)};c.withHistoryInfo=function(c){if(w.isNone(c))return c;var b=0,g=0,a=0;return function(f){var e=c(f);if(w.isNone(e))return null;"start"===f.action&&(a=g=b=0);f=h({},e,{deltaDeltaX:e.deltaX-b,deltaDeltaY:e.deltaY-g,deltaDeltaZ:e.deltaZ-a});b=e.deltaX;g=e.deltaY;a=e.deltaZ;return f}};c.withScreenHistoryInfo=function(c){if(w.isNone(c))return c;var b=0,g=0;return function(a){var f=c(a);if(w.isNone(f))return null;"start"===a.action&&(b=a.start.x,g=
a.start.y);f=h({},f,{screenDeltaDeltaX:a.screenPoint.x-b,screenDeltaDeltaY:a.screenPoint.y-g});b=a.screenPoint.x;g=a.screenPoint.y;return f}};c.horizontalDegreesOfFreedom=3;c.verticalDegreesOfFreedom=4})},"esri/views/3d/interactive/editingTools/graphicMove3D/isSupportedGraphic":function(){define("require exports ../../../../../core/compilerUtils ../../../../../core/maybe ../../../../../support/elevationInfoUtils ../../../../../support/featureFlags".split(" "),function(u,c,h,w,p,r){Object.defineProperty(c,
"__esModule",{value:!0});c.isSupportedGraphic=function(b){if("graphics"!==b.layer.type)return 1;if(w.isNone(b.geometry))return 2;var g=b.geometry.type;switch(g){case "polygon":case "point":case "polyline":break;case "multipoint":case "extent":case "mesh":return 3;default:return h.neverReached(g),3}g=p.getGraphicEffectiveElevationMode(b);return"on-the-ground"===g||r.enableEditing3D()&&"absolute-height"===g&&!p.hasGraphicFeatureExpressionInfo(b)?0:4}})},"esri/views/interactive/InteractiveToolBase":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/has ../../core/promiseUtils ../../core/scheduling ../../core/accessorSupport/decorators ./interactiveToolUtils ./ManipulatorCollection".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k){Object.defineProperty(c,"__esModule",{value:!0});u=function(c){function d(a){a=c.call(this,a)||this;a.attached=!1;a.created=!1;a.completed=!1;a.manipulators=new k.ManipulatorCollection;a.deferCreation=!1;a._editableFlags=[];a._manipulatorHandles=new r;a._creationResolver=g.createResolver();return a}h(d,c);Object.defineProperty(d.prototype,"active",{get:function(){return null!=this.view&&this.view.activeTool===this},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"isSupported",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visible",{set:function(a){this._set("visible",a);a||e.setActive(this,!1);this.attached&&(a?this._show():this._hide())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"editable",{get:function(){return this.hasEditableFlag(0)},set:function(a){this.setEditableFlag(0,a)},enumerable:!0,configurable:!0});d.prototype.attach=function(){if(!this.attached&&this.isSupported){this.manipulators.attach();
this.onAttach();if(this.visible)this.onShow();this._set("attached",!0)}};d.prototype.detach=function(){this.attached&&(this.onHide(),this.onDetach(),this.manipulators.detach(),this._manipulatorHandles.removeAll(),this._set("attached",!1))};d.prototype.handleInputEvent=function(a){if(this.attached)this.onInputEvent(a)};d.prototype.destroy=function(){this.manipulators.destroy();this._manipulatorHandles&&(this._manipulatorHandles.destroy(),this._manipulatorHandles=null);this._set("view",null)};d.prototype.setEditableFlag=
function(a,b){this._editableFlags[a]=b;this.manipulators.isToolEditable=this._editableFlags.every(function(a){return null==a||a});this._updateManipulatorAttachment();0===a&&this.notifyChange("editable");this.onEditableChange()};d.prototype.hasEditableFlag=function(a){a=this._editableFlags[a];return null==a?!0:a};d.prototype.when=function(){return this._creationResolver.promise};d.prototype.rejectCreation=function(a){this._creationResolver.reject(a)};d.prototype.initialize=function(){this.deferCreation||
this.complete()};d.prototype.onAttach=function(){};d.prototype.onDetach=function(){};d.prototype.onShow=function(){};d.prototype.onHide=function(){};d.prototype.onEditableChange=function(){};d.prototype.onInputEvent=function(a){};Object.defineProperty(d.prototype,"internallyEditable",{get:function(){return this.hasEditableFlag(0)&&this.hasEditableFlag(1)},enumerable:!0,configurable:!0});d.prototype.create=function(){var d=this;this.created||(this._set("created",!0),b("esri-native-promise")?this._creationResolver(this):
a.schedule(function(){return d._creationResolver(d)}))};d.prototype.complete=function(){this.create();this._set("completed",!0)};d.prototype._show=function(){this._updateManipulatorAttachment();this.onShow()};d.prototype._hide=function(){this._updateManipulatorAttachment();this.onHide()};d.prototype._updateManipulatorAttachment=function(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()};w([f.property({constructOnly:!0})],d.prototype,"view",void 0);w([f.property({dependsOn:["view.activeTool"],
readOnly:!0})],d.prototype,"active",null);w([f.property({value:!0})],d.prototype,"visible",null);w([f.property({value:!0})],d.prototype,"editable",null);w([f.property({readOnly:!0})],d.prototype,"attached",void 0);w([f.property({readOnly:!0})],d.prototype,"created",void 0);w([f.property({readOnly:!0})],d.prototype,"completed",void 0);w([f.property({readOnly:!0})],d.prototype,"manipulators",void 0);w([f.property({constructOnly:!0})],d.prototype,"deferCreation",void 0);return d=w([f.subclass("esri.views.interactive.InteractiveToolBase")],
d)}(f.declared(p));c.InteractiveToolBase=u})},"esri/views/interactive/ManipulatorCollection":function(){define(["require","exports","../../core/tsSupport/decorateHelper","../../core/Collection","../../core/maybe"],function(u,c,h,w,p){Object.defineProperty(c,"__esModule",{value:!0});u=function(){function c(){this._isToolEditable=!0;this._manipulators=new w;this._nextManipulatorId=0;this._resourceContexts={manipulator3D:{}};this._attached=!1}Object.defineProperty(c.prototype,"isToolEditable",{set:function(b){this._isToolEditable=
b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"length",{get:function(){return this._manipulators.length},enumerable:!0,configurable:!0});c.prototype.add=function(b,c){void 0===c&&(c=0);return this.addMany([b],c)[0]};c.prototype.addMany=function(b,c){var a=this;void 0===c&&(c=0);return b.map(function(b){var e=a._nextManipulatorId++;b={id:e,manipulator:b,visibilityPredicate:c,attached:!1};a._manipulators.add(b);a._attached&&a._updateManipulatorAttachment(b);return e})};c.prototype.remove=
function(b){if("number"===typeof b){for(var c=0;c<this._manipulators.length;c++)if(this._manipulators.getItemAt(c).id===b)return b=this._manipulators.splice(c,1)[0],this._detachManipulator(b),b.id;return null}for(c=0;c<this._manipulators.length;c++)if(this._manipulators.getItemAt(c).manipulator===b)return b=this._manipulators.splice(c,1)[0],this._detachManipulator(b),b.id;return null};c.prototype.removeAll=function(){var b=this;this._manipulators.forEach(function(c){b._detachManipulator(c)});this._manipulators.removeAll()};
c.prototype.attach=function(){var b=this;this._manipulators.forEach(function(c){b._updateManipulatorAttachment(c)});this._attached=!0};c.prototype.detach=function(){var b=this;this._manipulators.forEach(function(c){b._detachManipulator(c)});this._attached=!1};c.prototype.destroy=function(){this._manipulators.forEach(function(b){b=b.manipulator;b.destroy&&b.destroy()});this._manipulators.destroy();this._resourceContexts=null};c.prototype.on=function(b,c){return this._manipulators.on(b,function(a){c(a)})};
c.prototype.forEach=function(b){for(var c=0,a=this._manipulators.items;c<a.length;c++)b(a[c])};c.prototype.intersect=function(b,c){var a=null,f=Number.MAX_VALUE;this._manipulators.forEach(function(e){var g=e.id,x=e.manipulator;e.attached&&x.interactive&&(e=x.intersectionDistance(b,c),p.isSome(e)&&e<f&&(f=e,a=g))});return a};c.prototype.findById=function(b){if(p.isNone(b))return null;for(var c=0,a=this._manipulators.items;c<a.length;c++){var f=a[c];if(b===f.id)return f.manipulator}return null};c.prototype._updateManipulatorAttachment=
function(b){this._isManipulatorItemVisible(b)?this._attachManipulator(b):this._detachManipulator(b)};c.prototype._attachManipulator=function(b){b.attached||(b.manipulator.attach(this._resourceContexts),b.attached=!0)};c.prototype._detachManipulator=function(b){if(b.attached){var c=b.manipulator;c.grabbing=!1;c.dragging=!1;c.hovering=!1;c.selected=!1;c.detach(this._resourceContexts);b.attached=!1}};c.prototype._isManipulatorItemVisible=function(b){return 2===b.visibilityPredicate?!0:this._isToolEditable?
0===b.visibilityPredicate:1===b.visibilityPredicate};return c}();c.ManipulatorCollection=u})},"esri/views/interactive/dragUtils/dragActions":function(){define(["require","exports","../../../core/maybe","../../../geometry/support/webMercatorUtils","../../draw/support/drawUtils"],function(u,c,h,w,p){function r(b,a){var c=null,e=h.isSome(b[a])?b[a].spatialReference:null;return function(f){if("start"===f.action&&h.isSome(b[a])){var g=b[a],d=f.spatialReference;c=h.isNone(g)||"mesh"===g.type?null:g.spatialReference.equals(d)?
g.clone():w.canProject(g,d)?w.project(g,d):null}h.isNone(c)||(f=p.move(c.clone(),f.deltaX,f.deltaY,f.deltaZ),f.spatialReference.equals(e)?b[a]=f:b[a]=w.project(f,e))}}function b(b){return r(b,"geometry")}Object.defineProperty(c,"__esModule",{value:!0});c.createGeometryDragAction=r;c.createGraphicDragAction=b;c.createGraphicDragActionMany=function(c){var a=c.map(b);return function(b){return a.forEach(function(a){return a(b)})}}})},"esri/views/draw/support/drawUtils":function(){define(["require","exports",
"../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/coordsUtils"],function(u,c,h,w,p){function r(a,c,e,g){null==g||a.hasZ||(g=void 0);if("point"===a.type)return a.x+=c,a.y+=e,a.hasZ&&null!=g&&(a.z+=g),a;if("multipoint"===a.type){for(var f=a.points,d=0;d<f.length;d++)f[d]=b(f[d],c,e,g);return a}if("extent"===a.type)return a.xmin+=c,a.xmax+=c,a.ymin+=e,a.ymax+=e,null!=g&&(a.zmin+=g,a.zmax+=g),a;for(var f=p.geometryToCoordinates(a),k="polyline"===
a.type?a.paths:a.rings,n=0;n<f.length;n++)for(var h=f[n],d=0;d<h.length;d++)h[d]=b(h[d],c,e,g);"paths"in a?a.paths=k:a.rings=k;return a}function b(a,b,c,k){return g(a,a[0]+b,a[1]+c,null!=a[2]&&null!=k?a[2]+k:void 0)}function g(a,b,c,g){b=[b,c];2<a.length&&b.push(null!=g?g:a[2]);3<a.length&&b.push(a[3]);return b}Object.defineProperty(c,"__esModule",{value:!0});c.move=r;c.cloneMove=function(a,b,c,k,h){a=a.clone();var d=k.resolution;if("point"===a.type){if(h)r(a,b*d,-c*d);else{h=k.state.transform;k=
k.state.inverseTransform;var e=h[0]*a.x+h[2]*a.y+h[4],f=h[1]*a.x+h[3]*a.y+h[5];a.x=k[0]*(e+b)+k[2]*(f+c)+k[4];a.y=k[1]*(e+b)+k[3]*(f+c)+k[5]}return a}if("multipoint"===a.type){if(h)r(a,b*d,-c*d);else{d=a.points;h=k.state.transform;k=k.state.inverseTransform;for(var C=0;C<d.length;C++){var t=d[C],f=h[0]*t[0]+h[2]*t[1]+h[4],v=h[1]*t[0]+h[3]*t[1]+h[5],e=k[0]*(f+b)+k[2]*(v+c)+k[4],f=k[1]*(f+b)+k[3]*(v+c)+k[5];d[C]=g(t,e,f,void 0)}}return a}if("extent"===a.type){if(h)r(a,b*d,-c*d);else{h=k.state.transform;
k=k.state.inverseTransform;var d=h[0]*a.xmin+h[2]*a.ymin+h[4],A=h[1]*a.xmin+h[3]*a.ymin+h[5],e=h[0]*a.xmax+h[2]*a.ymax+h[4];h=h[1]*a.xmax+h[3]*a.ymax+h[5];a.xmin=k[0]*(d+b)+k[2]*(A+c)+k[4];a.ymin=k[1]*(d+b)+k[3]*(A+c)+k[5];a.xmax=k[0]*(e+b)+k[2]*(h+c)+k[4];a.ymax=k[1]*(e+b)+k[3]*(h+c)+k[5]}return a}if(h)r(a,b*d,-c*d);else{A=p.geometryToCoordinates(a);d="polyline"===a.type?a.paths:a.rings;h=k.state.transform;k=k.state.inverseTransform;for(var l=0;l<A.length;l++)for(var q=A[l],C=0;C<q.length;C++)t=
q[C],f=h[0]*t[0]+h[2]*t[1]+h[4],v=h[1]*t[0]+h[3]*t[1]+h[5],e=k[0]*(f+b)+k[2]*(v+c)+k[4],f=k[1]*(f+b)+k[3]*(v+c)+k[5],q[C]=g(t,e,f,void 0);"paths"in a?a.paths=d:a.rings=d}return a};c.scale=function(a,b,c,k){if("point"===a.type){var e=a.x,d=a.y,f=k?k[0]:e;k=k?k[1]:d;a=a.clone();a.x=(e-f)*b+f;a.y=(d-k)*c+k;return a}if("multipoint"===a.type){var d=p.geometryToCoordinates(a),f=h.create(),n=w.getRingsOrPathsBounds(f,[d]),f=n[0],d=n[1],e=n[2],n=n[3],f=k?k[0]:(f+e)/2,n=k?k[1]:(n+d)/2,r=a.clone(),t=r.points;
for(a=0;a<t.length;a++)k=t[a],e=k[0],d=k[1],e=(e-f)*b+f,d=(d-n)*c+n,t[a]=g(k,e,d,void 0);return r}if("extent"===a.type)return d=a.xmin,f=a.xmax,e=a.ymin,n=a.ymax,r=k?k[0]:(d+f)/2,k=k?k[1]:(n+e)/2,a=a.clone(),a.xmin=(d-r)*b+r,a.ymax=(n-k)*c+k,a.xmax=(f-r)*b+r,a.ymin=(e-k)*c+k,a.xmin>a.xmax&&(b=a.xmin,a.xmin=a.xmax,a.xmax=b),a.ymin>a.ymax&&(b=a.ymin,a.ymin=a.ymax,a.ymax=b),a;for(var f=p.geometryToCoordinates(a),d=h.create(),r=w.getRingsOrPathsBounds(d,f),e=r[0],d=r[1],n=r[2],r=r[3],n=k?k[0]:(e+n)/2,
r=k?k[1]:(r+d)/2,t=a.clone(),v="polyline"===t.type?t.paths:t.rings,A=0;A<f.length;A++){var l=f[A];for(a=0;a<l.length;a++)k=l[a],e=k[0],d=k[1],e=(e-n)*b+n,d=(d-r)*c+r,v[A][a]=g(k,e,d,void 0)}"paths"in t?t.paths=v:t.rings=v;return t};c.getScaleRatio=function(a,b,c,g,h,d){return Math.sqrt((h-a)*(h-a)+(d-b)*(d-b))/Math.sqrt((c-a)*(c-a)+(g-b)*(g-b))};c.getRotationAngle=function(a,b,c,g,h,d){return 180*Math.atan2(b-d,a-h)/Math.PI-180*Math.atan2(b-g,a-c)/Math.PI}})},"esri/views/interactive/dragUtils/dragHandlers":function(){define(["require",
"exports","../../../core/maybe","../../../core/accessorSupport/utils"],function(u,c,h,w){function p(b,c,a){var f=null;return b.events.on("drag",function(e){"start"===e.action&&(f=c(b,e));if(!h.isNone(f)){var g=f(e);h.isSome(g)&&a(g);"end"===e.action&&(f=null)}})}function r(b,c,a){for(var f=[],e=0;e<b.length;e++)f.push(p(b[e],c,a));return w.handlesGroup(f)}Object.defineProperty(c,"__esModule",{value:!0});c.createManipulatorDragHandler=p;c.createManipulatorDragHandlerOneOf=function(b,c,a){var f=null;
return r(b,function(a,b){return h.isSome(f)?null:f=c(a,b)},function(b){"end"===b.action&&(f=null);return a(b)})};c.createManipulatorDragHandlerMany=r})},"esri/views/3d/interactive/editingTools/graphicReshape3D/GraphicReshape3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ./isSupportedGraphic ./ReshapeOperation ./reshapeUtils ../../../../interactive/InteractiveToolBase".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x){Object.defineProperty(c,"__esModule",{value:!0});u=function(c){function d(a){a=c.call(this,a)||this;a._handles=new r;a._reshapeOperation=null;a._internalGeometryUpdate=!1;a.type="reshape-3d";a._emitter.target=null;return a}w(d,c);d.prototype.destroy=function(){this._handles.removeAll();this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null);this._set("view",null);this._set("graphic",null)};d.prototype._updateGeometry=function(){0===
f.isSupportedGraphic(this.graphic)&&k.isReshapeGeometry(this.graphic.geometry)?this._reshapeOperation.inputGeometry=this.graphic.geometry.clone():this._reshapeOperation.inputGeometry=null};d.prototype._updateGraphic=function(){var a=this;this._handles.remove("onGraphicGeometryChange");this._updateGeometry();if(0===f.isSupportedGraphic(this.graphic)){var b=this.watch("graphic.geometry",function(){!1===a._internalGeometryUpdate&&a._updateGeometry()},!0);this._handles.add(b,"onGraphicGeometryChange")}};
d.prototype.manipulatorSelectionChanged=function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()};d.prototype._onReshapeGeometryChanged=function(){b.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)};d.prototype.initialize=function(){var a=this;this._reshapeOperation=new e.ReshapeOperation({view:this.view,graphic:this.graphic,manipulators:this.manipulators});this._handles.add([this._reshapeOperation.on("reshape",
function(b){"reshape"===b.type&&a._onReshapeGeometryChanged();a.emit("reshape",b)}),this._reshapeOperation.on("move",function(b){"move"===b.type&&a._onReshapeGeometryChanged();a.emit("move",b)}),this._reshapeOperation.on("vertex-add",function(b){a._onReshapeGeometryChanged();a.emit("vertex-add",b)}),this._reshapeOperation.on("vertex-remove",function(b){a._onReshapeGeometryChanged();a.emit("vertex-remove",b)}),this._reshapeOperation.on("immediate-click",function(){return a.emit("immediate-click")}),
g.init(this,"graphic",function(){a._updateGraphic()},!0)])};d.prototype.handleInputEvent=function(a){"key-down"!==a.type||"Delete"!==a.key&&"Backspace"!==a.key||this._reshapeOperation.removeSelectedVertices()};d.prototype.reset=function(){};h([a.property({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0);h([a.property({constructOnly:!0})],d.prototype,"graphic",void 0);h([a.property({readOnly:!0})],d.prototype,"type",void 0);return d=h([a.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool")],
d)}(a.declared(p.EventedMixin(x.InteractiveToolBase)));c.GraphicReshape3DTool=u})},"esri/views/3d/interactive/editingTools/graphicReshape3D/isSupportedGraphic":function(){define("require exports ../../../../../core/compilerUtils ../../../../../core/maybe ../../../../../geometry/Circle ../../../../../support/elevationInfoUtils ../../../../../support/featureFlags".split(" "),function(u,c,h,w,p,r,b){Object.defineProperty(c,"__esModule",{value:!0});c.isSupportedGraphic=function(c){if("graphics"!==c.layer.type)return 1;
var a=c.geometry;if(w.isNone(a))return 2;var f=a.type;switch(f){case "polygon":if(a instanceof p)return 3;break;case "polyline":break;case "point":case "multipoint":case "extent":case "mesh":return 3;default:return h.neverReached(f),3}a=r.getGraphicEffectiveElevationMode(c);return"on-the-ground"===a||b.enableEditing3D()&&"absolute-height"===a&&!r.hasGraphicFeatureExpressionInfo(c)?0:4}})},"esri/geometry/Circle":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/unitUtils ../core/accessorSupport/decorators ./Point ./Polygon ./support/geodesicUtils ./support/webMercatorUtils ./support/WKIDUnitConversion".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k){return function(c){function d(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=c.apply(this,a)||this;a.center=null;a.geodesic=!1;a.numberOfPoints=60;a.radius=1E3;a.radiusUnit="meters";return a}w(d,c);u=d;d.prototype.normalizeCtorArgs=function(a,b){var c;if(a&&a.center)c=a;else{if(a&&a.rings)return this.inherited(arguments);c={center:a}}return h({},this.inherited(arguments,[]),c,b)};d.prototype.initialize=function(){var a=this.center,b=this.numberOfPoints;
this.hasZ=a&&a.hasZ;if(0===this.rings.length&&a){var c=r.convertUnit(this.radius,this.radiusUnit,"meters"),d=a.spatialReference,f="geographic";if(d.isWebMercator)f="webMercator";else if(null!=k[d.wkid]||d.wkt&&0===d.wkt.indexOf("PROJCS"))f="projected";if(this.geodesic){d=void 0;switch(f){case "webMercator":d=e.webMercatorToGeographic(a);break;case "projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case "geographic":d=
a}a=this._createGeodesicCircle(d,c,b);"webMercator"===f&&(a=e.geographicToWebMercator(a))}else d=void 0,"webMercator"===f||"projected"===f?d=c/this._convert2Meters(1,a.spatialReference):"geographic"===f&&(d=r.lengthToDegrees(c,"meters")),a=this._createPlanarCircle(a,d,b);this.spatialReference=a.spatialReference;this.addRing(a.rings[0])}};d.prototype.clone=function(){var a=this.numberOfPoints,b=this.radius,c=this.radiusUnit,d=this.geodesic;return new u({center:this.center.clone(),numberOfPoints:a,
radius:b,radiusUnit:c,geodesic:d})};d.prototype._createGeodesicCircle=function(b,c,d){for(var e=0,g=[];360>e;){var l=[0,0];f.directGeodeticSolver(l,[b.x,b.y],e,c);this.hasZ&&l.push(b.z);g.push(l);e+=360/d}g.push(g[0]);return new a(g)};d.prototype._createPlanarCircle=function(b,c,d){for(var e=0,f=[];e<2*Math.PI;){var l=[b.x+Math.cos(-e)*c,b.y+Math.sin(-e)*c];this.hasZ&&l.push(b.z);f.push(l);e+=Math.PI/(d/2)}f.push(f[0]);return new a({spatialReference:b.spatialReference,rings:[f]})};d.prototype._convert2Meters=
function(a,b){if(null!=k[b.wkid])b=k.values[k[b.wkid]];else{b=b.wkt;var c=b.lastIndexOf(",")+1,d=b.lastIndexOf("]]");b=parseFloat(b.substring(c,d))}return a*b};var u;p([b.property({type:g})],d.prototype,"center",void 0);p([b.property()],d.prototype,"geodesic",void 0);p([b.property()],d.prototype,"numberOfPoints",void 0);p([b.property()],d.prototype,"radius",void 0);p([b.property()],d.prototype,"radiusUnit",void 0);return d=u=p([b.subclass("esri.geometry.Circle")],d)}(b.declared(a))})},"esri/geometry/support/geodesicUtils":function(){define("require exports @dojo/framework/shim/object ../. ../../core/Error ../../core/unitUtils".split(" "),
function(u,c,h,w,p,r){function b(a){if(!a||!a.isGeographic)return null;if(a.wkid){var b=C[a.wkid];if(b)return b}if(a.wkt){a=n.exec(a.wkt);if(!a||2!==a.length)return null;b=a[1].split(",");if(!b||3!==b.length)return null;a=parseFloat(b[1]);b=parseFloat(b[2]);return isNaN(a)||isNaN(b)?null:{a:a,f:0===b?0:1/b}}return null}function g(a){a=b(a||z);if("b"in a&&"eSq"in a&&"radius"in a)return a;var c=a.a*(1-a.f);return h.assign(a,{b:c,eSq:1-Math.pow(c/a.a,2),radius:(2*a.a+c)/3})}function a(a,b,c){var e=g(c);
c=e.a;var e=e.eSq,f=Math.sqrt(e),k=Math.sin(b[1]*d);b=c*b[0]*d;c=0<e?c*(1-e)*(k/(1-e*k*k)-1/(2*f)*Math.log((1-f*k)/(1+f*k)))*.5:c*k;a[0]=b;a[1]=c;return a}function f(a){return null!==b(a)}function e(a,b){if("polyline"!==a.type&&"polygon"!==a.type)throw new p("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");var c=a.spatialReference;if(!f(c))throw new p("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");var d=
g(c).radius/1E4;b<d&&(b=d);for(var d=[],e=[0,0],h={distance:null},n=0,r="polyline"===a.type?a.paths:a.rings;n<r.length;n++){var v=r[n],t=[];d.push(t);t.push([v[0][0],v[0][1]]);for(var E=v[0][0],m=v[0][1],B=void 0,J=void 0,K=0;K<v.length-1;K++)if(B=v[K+1][0],J=v[K+1][1],E!==B||m!==J){var u=[E,m];x(h,[E,m],[B,J],c);E=h.azimuth;m=h.distance;B=m/b;if(1<B){for(J=1;J<=B-1;J++)k(e,u,E,J*b,c),t.push(e.slice(0));k(e,u,E,(m+Math.floor(B-1)*b)/2,c);t.push(e.slice(0))}k(e,u,E,m,c);t.push(e.slice(0));E=e[0];m=
e[1]}}return"polyline"===a.type?new w.Polyline({paths:d,spatialReference:c}):new w.Polygon({rings:d,spatialReference:c})}function k(a,b,c,e,f){var l=b[0]*d,q=b[1]*d;b=c*d;f=g(f);var k=f.a,h=f.b;f=f.f;c=Math.sin(b);b=Math.cos(b);for(var n=(1-f)*Math.tan(q),q=1/Math.sqrt(1+n*n),A=n*q,m=Math.atan2(n,b),n=q*c,B=n*n,r=1-B,k=r*(k*k-h*h)/(h*h),t=1+k/16384*(4096+k*(-768+k*(320-175*k))),v=k/1024*(256+k*(-128+k*(74-47*k))),k=e/(h*t),w=2*Math.PI,p,u,z,x;1E-12<Math.abs(k-w);)z=Math.cos(2*m+k),p=Math.sin(k),u=
Math.cos(k),x=v*p*(z+v/4*(u*(-1+2*z*z)-v/6*z*(-3+4*p*p)*(-3+4*z*z))),w=k,k=e/(h*t)+x;e=A*p-q*u*b;h=f/16*r*(4+f*(4-3*r));e=Math.atan2(A*u+q*p*b,(1-f)*Math.sqrt(B+e*e))/d;l=(l+(Math.atan2(p*c,q*u-A*p*b)-(1-h)*f*n*(k+h*p*(z+h*u*(-1+2*z*z)))))/d;a.splice(0,a.length);a.push(l,e);return a}function x(a,b,c,e){var f=b[0]*d;b=b[1]*d;var l=c[0]*d;c=c[1]*d;var k=g(e),h=k.a;e=k.b;var n=k.f,r=k.radius,A=l-f,m=Math.atan((1-n)*Math.tan(b)),B=Math.atan((1-n)*Math.tan(c)),k=Math.sin(m),m=Math.cos(m),t=Math.sin(B),
B=Math.cos(B),v=1E3,p=A,w,u,z,x,L,M,O,C;do{x=Math.sin(p);L=Math.cos(p);z=Math.sqrt(B*x*B*x+(m*t-k*B*L)*(m*t-k*B*L));if(0===z)return{distance:0};L=k*t+m*B*L;M=Math.atan2(z,L);O=m*B*x/z;u=1-O*O;x=L-2*k*t/u;isNaN(x)&&(x=0);C=n/16*u*(4+n*(4-3*u));w=p;p=A+(1-C)*n*O*(M+C*z*(x+C*L*(-1+2*x*x)))}while(1E-12<Math.abs(p-w)&&0<--v);if(0===v)return a=l-f,{azimuth:Math.atan2(Math.sin(a)*Math.cos(c),Math.cos(b)*Math.sin(c)-Math.sin(b)*Math.cos(c)*Math.cos(a))/d,distance:Math.acos(Math.sin(b)*Math.sin(c)+Math.cos(b)*
Math.cos(c)*Math.cos(l-f))*r};f=u*(h*h-e*e)/(e*e);b=f/1024*(256+f*(-128+f*(74-47*f)));l=Math.atan2(m*Math.sin(p),m*t*Math.cos(p)-k*B);a.azimuth=Math.atan2(B*Math.sin(p),m*t-k*B*Math.cos(p))/d;a.distance=e*(1+f/16384*(4096+f*(-768+f*(320-175*f))))*(M-b*z*(x+b/4*(L*(-1+2*x*x)-b/6*x*(-3+4*z*z)*(-3+4*x*x))));a.reverseAzimuth=l/d;return a}Object.defineProperty(c,"__esModule",{value:!0});var d=Math.PI/180,z=w.SpatialReference.WGS84,n=/SPHEROID\[([^\]]+)]/i,C={4326:{a:6378137,f:1/298.257223563},104900:{a:2439700,
f:0},104901:{a:6051E3,f:0},104902:{a:6051800,f:0},104903:{a:1737400,f:0},104904:{a:3393400,f:.005207166853303471},104905:{a:3396190,f:.005886007555525457},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492E3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1E4,f:0},104912:{a:2409300,f:0},104913:{a:15E3,f:0},104914:{a:4E4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85E3,f:0},104918:{a:1821460,f:0},104919:{a:5E3,f:0},104920:{a:12E3,f:0},104921:{a:3E4,f:3},
104922:{a:18E3,f:0},104923:{a:14E3,f:0},104924:{a:49300,f:0},104925:{a:60268E3,f:.09796243445941462},104926:{a:16E3,f:0},104927:{a:9500,f:0},104928:{a:56E4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16E3,f:0},104932:{a:133E3,f:0},104933:{a:718E3,f:0},104934:{a:888E3,f:0},104935:{a:1986300,f:0},104936:{a:1E4,f:0},104937:{a:41900,f:0},104938:{a:11E4,f:0},104939:{a:50100,f:0},104940:{a:764E3,f:0},104941:{a:11E3,f:0},104942:{a:529800,f:0},104943:{a:2575E3,f:0},104944:{a:25559E3,f:.022927344575296365},
104945:{a:578900,f:0},104946:{a:33E3,f:0},104947:{a:21E3,f:0},104948:{a:13E3,f:0},104949:{a:31E3,f:0},104950:{a:27E3,f:0},104951:{a:42E3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15E3,f:0},104955:{a:54E3,f:0},104956:{a:77E3,f:0},104957:{a:27E3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764E3,f:.01708124697141011},104961:{a:74E3,f:0},104962:{a:79E3,f:0},104963:{a:104E3,f:.14423076923076922},104964:{a:29E3,f:0},104965:{a:17E4,f:0},104966:{a:208E3,f:0},104967:{a:4E4,
f:0},104968:{a:1352600,f:0},104969:{a:1195E3,f:0},104970:{a:593E3,f:0},104971:{a:3396190,f:0},104972:{a:47E4,f:0},104973:{a:255E3,f:0},104974:{a:2439400,f:0}};c.isSupported=f;c.geodesicAreas=function(b,c){void 0===c&&(c="square-meters");if(b.some(function(a){return!f(a.spatialReference)}))throw new p("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var d=[],l=0;l<b.length;l++){var q=b[l],k=q.spatialReference,k=.0015696101447650193*g(k).radius;
d.push(e(q,k))}b=[];for(var l=[0,0],q=[0,0],h=0;h<d.length;h++){for(var k=d[h],n=k.rings,k=k.spatialReference,t=0,v=0;v<n.length;v++){var E=n[v];a(l,E[0],k);a(q,E[E.length-1],k);for(var m=q[0]*l[1]-l[0]*q[1],B=0;B<E.length-1;B++)a(l,E[B+1],k),a(q,E[B],k),m+=q[0]*l[1]-l[0]*q[1];t+=m}t=r.convertUnit(t,"square-meters",c);b.push(t/-2)}return b};c.geodesicLengths=function(a,b){void 0===b&&(b="meters");if(!a&&!a)throw new p("geodesic-lengths:invalid-geometries","the input geometries type is not supported");
if(a.some(function(a){return!f(a.spatialReference)}))throw new p("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var c=[],d=0;d<a.length;d++){for(var e=a[d],g=e.spatialReference,e="polyline"===e.type?e.paths:e.rings,k=0,h=0;h<e.length;h++){for(var n=e[h],t=0,v=1;v<n.length;v++){var m=n[v-1][0],B=n[v][0],w=n[v-1][1],u=n[v][1];if(w!==u||m!==B){var z={distance:null};x(z,[m,w],[B,u],g);t+=z.distance}}k+=t}k=r.convertUnit(k,"meters",b);c.push(k)}return c};
c.geodesicDensify=e;c.directGeodeticSolver=k;c.inverseGeodeticSolver=x;c.geodesicDistance=function(a,b,c){void 0===c&&(c="meters");if(!a||!b)throw new p("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!a.spatialReference||!b.spatialReference)throw new p("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!a.spatialReference.equals(b.spatialReference))throw new p("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");
var d=a.spatialReference;if(!f(d))throw new p("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(a.equals(b))return{distance:0,azimuth:0,reverseAzimuth:0};var e={distance:null};x(e,[a.x,a.y],[b.x,b.y],d);e.distance=r.convertUnit(e.distance,"meters",c);return e};c.pointFromDistance=function(a,b,c){if(!a||null==b||null==c)throw new p("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(0>c||360<c)throw new p("point-from-distance:-of-bounds",
"azimuth is restricted to angles between, and including, 0\u00b0 to 360\u00b0 degrees");if(!a.spatialReference)throw new p("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");var d=a.spatialReference;if(!f(d))throw new p("geodesic-distance:not-supported","input geometry spatial reference is not supported");var e=[0,0];k(e,[a.x,a.y],c,b,d);return new w.Point({x:e[0],y:e[1],spatialReference:d})}})},"@dojo/framework/shim/object":function(){(function(u){"object"===
typeof module&&"object"===typeof module.exports?(u=u(require,exports),void 0!==u&&(module.exports=u)):"function"===typeof define&&define.amd&&define(["require","exports","./global","../has/has","./Symbol"],u)})(function(u,c){Object.defineProperty(c,"__esModule",{value:!0});var h=u("./global"),w=u("../has/has"),p=u("./Symbol");w.default("es6-object")?(u=h.default.Object,c.assign=u.assign,c.getOwnPropertyDescriptor=u.getOwnPropertyDescriptor,c.getOwnPropertyNames=u.getOwnPropertyNames,c.getOwnPropertySymbols=
u.getOwnPropertySymbols,c.is=u.is,c.keys=u.keys):(c.keys=function(c){return Object.keys(c).filter(function(b){return!b.match(/^@@.+/)})},c.assign=function(h){for(var b=[],g=1;g<arguments.length;g++)b[g-1]=arguments[g];if(null==h)throw new TypeError("Cannot convert undefined or null to object");var a=Object(h);b.forEach(function(b){b&&c.keys(b).forEach(function(c){a[c]=b[c]})});return a},c.getOwnPropertyDescriptor=function(c,b){p.isSymbol(b);return Object.getOwnPropertyDescriptor(c,b)},c.getOwnPropertyNames=
function(c){return Object.getOwnPropertyNames(c).filter(function(b){return!b.match(/^@@.+/)})},c.getOwnPropertySymbols=function(c){return Object.getOwnPropertyNames(c).filter(function(b){return!!b.match(/^@@.+/)}).map(function(b){return Symbol.for(b.substring(2))})},c.is=function(c,b){return c===b?0!==c||1/c===1/b:c!==c&&b!==b});w.default("es2017-object")?(u=h.default.Object,c.getOwnPropertyDescriptors=u.getOwnPropertyDescriptors,c.entries=u.entries,c.values=u.values):(c.getOwnPropertyDescriptors=
function(h){return c.getOwnPropertyNames(h).reduce(function(b,g){b[g]=c.getOwnPropertyDescriptor(h,g);return b},{})},c.entries=function(h){return c.keys(h).map(function(b){return[b,h[b]]})},c.values=function(h){return c.keys(h).map(function(b){return h[b]})})})},"esri/views/3d/interactive/editingTools/graphicReshape3D/ReshapeOperation":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/compilerUtils ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../layers/graphics/dehydratedFeatures ../../../../../support/elevationInfoUtils ../../Manipulator3D ../../manipulatorUtils ../../dragUtils/projectScreenToMap ../manipulatorUtils ./reshapeUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../../interactive/dragUtils/dragHandlers ../../../../interactive/dragUtils/screenDragToMap".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v,A,l,q,y,H){Object.defineProperty(c,"__esModule",{value:!0});u=function(b){function c(a){a=b.call(this,a)||this;a._vertexManipulatorMaterial=n.createManipulatorMaterial([1,.5,0],1);a._edgeManipulatorMaterial=n.createManipulatorMaterial([.5,.5,.5],1);a._selectedManipulatorMaterial=n.createManipulatorMaterial([1,1,1],1);a._manipulatorGeometry=new l(q.createSphereGeometry(1,16,16),"reshape-manipulator");a._handles=new g;a._manipulatorHandles=new g;a._manipulatorInfos=
[];a._reshapeHelper=null;a._moveManipulator=null;a._moveZManipulator=null;a._numGrabbing=0;a._reshapeEventState=0;a.view=null;a.graphic=null;a.outputGeometry=null;a.manipulators=null;a._emitter.target=null;return a}w(c,b);c.prototype.initialize=function(){var b=this;this._handles.add(this.watch(["graphic.visible","graphic.layer.visible"],function(){for(var c=b.graphic.visible&&b.graphic.layer.visible,d=0,e=b._manipulatorInfos;d<e.length;d++)e[d].manipulator.visible=!!c;a.isSome(b._moveZManipulator)&&
(b._moveZManipulator.visible=!!c)}))};c.prototype.destroy=function(){this._clear();this._handles.destroy()};Object.defineProperty(c.prototype,"inputGeometry",{get:function(){return a.isSome(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(a){this._recreateManipulators(a)},enumerable:!0,configurable:!0});c.prototype.removeSelectedVertices=function(){var a=this._manipulatorInfos.filter(function(a){return a.manipulator.selected&&"vertex"===a.handle.type});this._removeVertices(a)};
c.prototype.manipulatorSelectionChanged=function(){this._updateMoveZManipulatorPosition()};c.prototype._clear=function(){this._manipulatorHandles.removeAll();this.manipulators.removeAll();this._manipulatorInfos=[];this._reshapeHelper=this._moveManipulator=null;this._numGrabbing=0};c.prototype._recreateManipulators=function(b){this._clear();this._reshapeHelper=v.createReshapeHelper(b,"global"===this.view.viewingMode);if(!a.isNone(this._reshapeHelper)){b=d.getGraphicEffectiveElevationInfo(this.graphic);
for(var c=0,e=this._reshapeHelper.components;c<e.length;c++){for(var f=e[c],m=0,l=f.vertices;m<l.length;m++)this._createPerVertexManipulator(l[m],b);m=0;for(f=f.edges;m<f.length;m++)this._createPerVertexManipulator(f[m],b)}this._createGraphicMoveManipulators()}};c.prototype._perGraphicManipulatorDragAction=function(b,c){if("end"!==c.action){var d=[],e=this._manipulatorInfos.some(function(a){return"vertex"===a.handle.type&&a.manipulator.selected}),f=1===b&&e;b=a.expect(this._reshapeHelper);for(var m=
0,l=this._manipulatorInfos;m<l.length;m++)e=l[m],"vertex"!==e.handle.type||e.manipulator.grabbing||f&&!e.manipulator.selected||(a.expect(b).addDelta(e.handle,c.deltaDeltaX,c.deltaDeltaY,c.deltaDeltaZ),d.push(e.handle.pos),this._updateManipulatorPosition(e));if(0!==d.length){f=0;for(m=this._manipulatorInfos;f<m.length;f++)e=m[f],"vertex"!==e.handle.type&&this._updateManipulatorPosition(e);this.outputGeometry=b.commit();d.length===this._manipulatorInfos.length?(this._updateEventState(1),this.emit("move",
{type:"move",dx:c.screenDeltaDeltaX,dy:c.screenDeltaDeltaY,mover:this.graphic})):(this._updateEventState(2),this.emit("reshape",{type:"reshape",mover:this.graphic}))}}};c.prototype._perVertexManipulatorDragAction=function(b,c){var d="edge"===b.handle.type?this._splitEdgeManipulator(b):b;this._updateEventState(2);!1===b.manipulator.selected&&(this._clearManipulatorSelection(),this._updateMoveZManipulatorPosition());b=c.deltaDeltaX;var e=c.deltaDeltaY,f=c.deltaDeltaZ;if(b||e||f){c=[];for(var m=0,l=
this._manipulatorInfos;m<l.length;m++){var g=l[m];"vertex"===g.handle.type&&(g.manipulator.selected&&!g.manipulator.grabbing||g===d)&&c.push(g)}l=a.expect(this._reshapeHelper);for(g=0;g<c.length;g++)d=c[g],m=d.handle,l.addDelta(m,b,e,f),this._updateManipulatorPosition(d);this.outputGeometry=l.commit();for(b=0;b<c.length;b++)d=c[b],m=d.handle,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(m.left)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(m.right));this.emit("reshape",
{type:"reshape",mover:this.graphic})}};c.prototype._updateEventState=function(a){if(a===this._reshapeEventState)return!1;switch(a){case 0:if(0!==this._numGrabbing)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",
{type:"reshape-stop",mover:this.graphic}),this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}var b=this._reshapeEventState!==a;this._reshapeEventState=a;return b};c.prototype._createGraphicMoveManipulators=function(){var b=this;
this._moveManipulator=t.createGraphicMoveXYManipulator(this.view,this.graphic);this._manipulatorHandles.add(y.createManipulatorDragHandler(this._moveManipulator,function(a,c){return H.withScreenHistoryInfo(H.withHistoryInfo(t.createGraphicMoveXYScreenDragToMap(b.view,a,c)))},function(a){return b._perGraphicManipulatorDragAction(0,a)}));this._manipulatorHandles.add(this._watchAndUpdateGrabState(this._moveManipulator));this._moveManipulator.events.on("immediate-click",function(a){b.emit("immediate-click");
a.stopPropagation()});this.manipulators.add(this._moveManipulator);this._moveZManipulator=t.createGraphicMoveZManipulator({view:this.view,graphic:this.graphic});a.isSome(this._moveZManipulator)&&(this._manipulatorHandles.add(y.createManipulatorDragHandler(this._moveZManipulator,function(a){return H.withScreenHistoryInfo(H.withHistoryInfo(t.createGraphicMoveZScreenDragToMap(b.view,a)))},function(a){return b._perGraphicManipulatorDragAction(1,a)})),this._manipulatorHandles.add(this._watchAndUpdateGrabState(this._moveZManipulator)),
this.manipulators.add(this._moveZManipulator),this._manipulatorHandles.add(f.init(this.graphic,"geometry",function(){return b._updateMoveZManipulatorPosition()})))};c.prototype._clearManipulatorSelection=function(){for(var a=0,b=this._manipulatorInfos;a<b.length;a++)b[a].manipulator.selected=!1;this._updateMoveZManipulatorPosition()};c.prototype._createPerVertexManipulator=function(a,b){var c=this;void 0===b&&(b=d.getGraphicEffectiveElevationInfo(this.graphic));b=new z.Manipulator3D({view:this.view,
renderObjects:[{geometry:this._manipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:F.Vertex|4},{geometry:this._manipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:F.Edge|4},{geometry:this._manipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8}],radius:5,elevationInfo:b,visible:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(b,a);var e={manipulator:b,handle:a};this._manipulatorInfos.push(e);this.manipulators.add(b);
this._updateManipulatorPosition(e);this._manipulatorHandles.add(this._watchAndUpdateGrabState(b),b);this._manipulatorHandles.add(y.createManipulatorDragHandler(b,function(a){return H.withHistoryInfo(H.createXYConstrainedFromProject(C.createForGraphicAtLocation(c.view,c.graphic,a.elevationAlignedLocation),a.location.spatialReference))},function(a){return c._perVertexManipulatorDragAction(e,a)}));b.events.on("immediate-click",function(a){return c._manipulatorClickCallback(a,e)});return b};c.prototype._setTypeSpecificManipulatorSettings=
function(a,b){switch(b.type){case "vertex":a.state=F.Vertex;a.selectable=!0;a.cursor="move";a.collisionPriority=2;a.hideOnGrab=!0;break;case "edge":a.state=F.Edge;a.selectable=!1;a.cursor="copy";a.collisionPriority=1;a.hideOnGrab=!1;break;default:r.neverReached(b)}};c.prototype._watchAndUpdateGrabState=function(a){var b=this;return a.events.on("grab",function(a){"start"===a.action?b._numGrabbing++:(b._numGrabbing--,b._updateEventState(0))})};c.prototype._removeManipulator=function(a){a&&(this._manipulatorHandles.remove(a.manipulator),
this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(a),1),this.manipulators.remove(a.manipulator))};c.prototype._getManipulatorInfoFromHandle=function(a){if(a)for(var b=0,c=this._manipulatorInfos;b<c.length;b++){var d=c[b];if(a===d.handle)return d}return null};c.prototype._updateManipulatorPosition=function(b){if(b){var c=a.expect(this._reshapeHelper);"vertex"===b.handle.type?b.manipulator.location=c.getVertexPositionAsPoint(b.handle,G):"edge"===b.handle.type&&(b.manipulator.location=c.getEdgePositionAsPoint(b.handle,
.5,G))}};c.prototype._splitEdgeManipulator=function(b){var c=a.expect(this._reshapeHelper).splitEdge(b.handle,.5);b.handle=c;this._setTypeSpecificManipulatorSettings(b.manipulator,b.handle);c.left&&this._createPerVertexManipulator(c.left);c.right&&this._createPerVertexManipulator(c.right);return b};c.prototype._updateMoveZManipulatorPosition=function(){if(!a.isNone(this._moveZManipulator)){var b=A.sv3d.get();k.vec3.set(b,0,0,0);for(var c=0,d=0,e=this._manipulatorInfos;d<e.length;d++){var f=e[d];"vertex"===
f.handle.type&&f.manipulator.selected&&(c++,k.vec3.add(b,b,f.manipulator.renderLocation))}if(0!==c&&(k.vec3.scale(b,b,1/c),G.spatialReference=a.expect(this._reshapeHelper).geometry.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(b,G))){this._moveZManipulator.elevationAlignedLocation=G;return}n.placeManipulatorAtGraphic(this._moveZManipulator,this.graphic)}};c.prototype._removeVertices=function(b){for(var c=[],d=a.expect(this._reshapeHelper),e=0;e<b.length;e++){var f=b[e];"vertex"===
f.handle.type&&d.canRemoveVertex(f.handle)&&(c.push(f.handle.unnormalizedPos),this._removeManipulator(f),this._removeManipulator(this._getManipulatorInfoFromHandle(f.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(f.handle.right)),(f=d.removeVertex(f.handle))&&this._createPerVertexManipulator(f))}0<c.length&&(this.outputGeometry=d.commit(),b=this._updateEventState(2),this.emit("vertex-remove",{type:"vertex-remove",removed:c}),b&&this._updateEventState(0),this._updateMoveZManipulatorPosition())};
c.prototype._manipulatorClickCallback=function(b,c){"vertex"===c.handle.type&&2===b.button&&this._removeVertices([c]);if("edge"===c.handle.type&&0===b.button){c=this._splitEdgeManipulator(c);this.outputGeometry=a.expect(this._reshapeHelper).commit();var d=this._updateEventState(2);this.emit("vertex-add",{type:"vertex-add",added:[c.handle.unnormalizedPos]});d&&this._updateEventState(0)}b.stopPropagation()};h([e.property({constructOnly:!0})],c.prototype,"view",void 0);h([e.property({constructOnly:!0})],
c.prototype,"graphic",void 0);h([e.property()],c.prototype,"inputGeometry",null);h([e.property()],c.prototype,"outputGeometry",void 0);h([e.property({constructOnly:!0})],c.prototype,"manipulators",void 0);return c=h([e.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],c)}(e.declared(b.EventedAccessor));c.ReshapeOperation=u;var G=x.makeDehydratedPoint(0,0,null,null),F;(function(a){a.Vertex=16;a.Edge=32})(F||(F={}))})},"esri/views/3d/interactive/editingTools/graphicReshape3D/reshapeUtils":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/coordsUtils ../../../../../geometry/support/spatialReferenceUtils".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x){Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(){this.vertices=[];this.edges=[]}a.prototype.makeVertex=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);a={pos:a,unnormalizedPos:a,left:b,right:c,type:"vertex",component:this};this.vertices.push(a);return a};a.prototype.makeEdge=function(a,b){var c={v0:a,v1:b,type:"edge",component:this};a.right=c;b.left=c;this.edges.push(c);return c};a.prototype.removeVertex=function(a){this.vertices.splice(this.vertices.indexOf(a),
1);a.left&&this.removeEdge(a.left);a.right&&this.removeEdge(a.right)};a.prototype.removeEdge=function(a){this.edges.splice(this.edges.indexOf(a),1);a.v0.right=null;a.v1.left=null};return a}();c.Component=d;var z=function(){function a(){}a.prototype.createNew=function(){return b.vec2f64.create()};a.prototype.fromArray=function(a){return b.vec2f64.fromValues(a[0],a[1])};a.prototype.toArray=function(a){return[a[0],a[1]]};a.prototype.toPoint=function(a,b){b.x=a[0];b.y=a[1];b.hasZ=!1;b.hasM=!1;return b};
a.prototype.lerp=function(a,b,c,d){return r.vec2.lerp(d,a,b,c)};a.prototype.addDelta=function(a,b,c){a[0]+=b;a[1]+=c};return a}();c.CoordinateHelper2D=z;var n=function(){function b(a){this.ztype=a}b.prototype.createNew=function(){return a.vec3f64.create()};b.prototype.fromArray=function(b){return a.vec3f64.fromValues(b[0],b[1],b[2]||0)};b.prototype.toArray=function(a){return[a[0],a[1],a[2]]};b.prototype.toPoint=function(a,b){b.x=a[0];b.y=a[1];0===this.ztype?(b.z=a[2],b.hasZ=!0,b.hasM=!1):(b.m=a[2],
b.hasZ=!1,b.hasM=!0);return b};b.prototype.lerp=function(a,b,c,d){return g.vec3.lerp(d,a,b,c)};b.prototype.addDelta=function(a,b,c,d){a[0]+=b;a[1]+=c;0===this.ztype&&(a[2]+=d)};return b}();c.CoordinateHelper3D=n;var C=function(){function a(){}a.prototype.createNew=function(){return e.vec4f64.create()};a.prototype.fromArray=function(a){return e.vec4f64.fromValues(a[0],a[1],a[2]||0,a[3]||0)};a.prototype.toArray=function(a){return[a[0],a[1],a[2],a[3]]};a.prototype.toPoint=function(a,b){b.x=a[0];b.y=
a[1];b.z=a[2];b.m=a[3];b.hasZ=!0;b.hasM=!0;return b};a.prototype.lerp=function(a,b,c,d){return f.vec4.lerp(d,a,b,c)};a.prototype.addDelta=function(a,b,c,d){a[0]+=b;a[1]+=c;a[2]+=d};return a}();c.CoordinateHelper4D=C;u=function(){function a(a,b,c){this.geometry=a;this.doUnnormalization=b;this.coordinateHelper=c;this.components=[];a=x.getInfo(this.geometry.spatialReference);this._tmpMapPoint=c.createNew();a?(this._spanMin=a.valid[0],this._spanMax=a.valid[1],this._span=this._spanMax-this._spanMin):this.doUnnormalization=
!1}a.prototype.addDelta=function(a,b,c,d){this.coordinateHelper.addDelta(a.pos,b,c,d)};a.prototype.getVertexPositionAsPoint=function(a,b){this.coordinateHelper.toPoint(a.pos,b);b.spatialReference=this.geometry.spatialReference;return b};a.prototype.getEdgePosition=function(a,b,c){void 0===c&&(c=this.coordinateHelper.createNew());return this.coordinateHelper.lerp(a.v0.unnormalizedPos,a.v1.unnormalizedPos,b,c)};a.prototype.getEdgePositionAsPoint=function(a,b,c){a=this.getEdgePosition(a,b,this._tmpMapPoint);
this.coordinateHelper.toPoint(a,c);c.spatialReference=this.geometry.spatialReference;return c};a.prototype.canRemoveVertex=function(a){return!0};a.prototype.removeVertex=function(a){var b=a.component,c=a.left,d=a.right;b.removeVertex(a);return c&&d?b.makeEdge(c.v0,d.v1):null};a.prototype.splitEdge=function(a,b){var c=a.component;b=c.makeVertex(this.getEdgePosition(a,b));var d=a.v0,e=a.v1;c.removeEdge(a);c.makeEdge(d,b);c.makeEdge(b,e);return b};return a}();c.ReshapeHelper=u;var t=function(a){function b(b,
c,e){c=a.call(this,b,c,e)||this;c.geometry=b;b=c.geometry.rings;for(var f=0;f<b.length;++f){for(var g=b[f],h=new d,l=g.length-1,m=0;m<l;++m){var n=e.fromArray(g[m]);h.makeVertex(n)}g=h.vertices.length-1;for(l=0;l<g;++l)h.makeEdge(h.vertices[l],h.vertices[l+1]);h.makeEdge(h.vertices[h.vertices.length-1],h.vertices[0]);c.doUnnormalization&&k.computeUnnormalizedVertexPositionsOnDateLineCrossing(h.vertices,c._spanMin,c._spanMax,c._span);c.components.push(h)}return c}w(b,a);b.prototype.canRemoveVertex=
function(a){return 3<a.component.vertices.length};b.prototype.commit=function(){var a=this,b=[],c=this.coordinateHelper.toArray;this.components.forEach(function(d){var e=[];a.doUnnormalization&&k.computeUnnormalizedVertexPositionsOnDateLineCrossing(d.vertices,a._spanMin,a._spanMax,a._span);var f=d.vertices[0],g=f;do e.push(c(f.unnormalizedPos)),f=f.right.v1;while(f&&f!==g);e.push(c(d.vertices[0].unnormalizedPos));b.push(e)});this.geometry.rings=b;return this.geometry};return b}(u),v=function(a){function b(b,
c,e){c=a.call(this,b,c,e)||this;c.geometry=b;b=c.geometry.paths;for(var f=0;f<b.length;++f){for(var g=b[f],h=new d,l=g.length,m=0;m<l;++m){var n=e.fromArray(g[m]);h.makeVertex(n)}g=h.vertices.length-1;for(l=0;l<g;++l)h.makeEdge(h.vertices[l],h.vertices[l+1]);c.doUnnormalization&&k.computeUnnormalizedVertexPositionsOnDateLineCrossing(h.vertices,c._spanMin,c._spanMax,c._span);c.components.push(h)}return c}w(b,a);b.prototype.canRemoveVertex=function(a){return 2<a.component.vertices.length};b.prototype.commit=
function(){var a=this,b=[],c=this.coordinateHelper.toArray;this.components.forEach(function(d){var e=[];a.doUnnormalization&&k.computeUnnormalizedVertexPositionsOnDateLineCrossing(d.vertices,a._spanMin,a._spanMax,a._span);var f=d=d.vertices[0];do e.push(c(d.unnormalizedPos)),d=d.right?d.right.v1:null;while(d&&d!==f);b.push(e)});this.geometry.paths=b;return this.geometry};return b}(u);c.isReshapeGeometry=function(a){return p.isSome(a)&&("polygon"===a.type||"polyline"===a.type)};c.createReshapeHelper=
function(a,b){if(p.isNone(a))return null;var c;c=a.hasZ&&a.hasM?new C:a.hasM?new n(1):a.hasZ?new n(0):new z;return"polygon"===a.type?new t(a,b,c):new v(a,b,c)}})},"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicTransform3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/math/common ../../../../../support/elevationInfoUtils ../../../../../support/featureFlags ../isSupportedGraphicUtils ../manipulatorUtils ./GraphicScaleRotateTransform ./GraphicXYAxisTransform ./GraphicXYTransform ./GraphicZTransform ./isSupportedGraphic ../../../support/stack ../../../../interactive/InteractiveToolBase".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v,A,l,q,y,H,G,F){Object.defineProperty(c,"__esModule",{value:!0});var I=a.getLogger("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool");u=function(a){function b(b){b=a.call(this,b)||this;b.enableRotation=!0;b.enableScaling=!0;b.type="transform-3d";b.handles=new g;b.zTransform=null;b.scaleRotate=null;return b}w(b,a);b.prototype.initialize=function(){this.xyTransform=new q.GraphicXYTransform({tool:this});this.xyAxisTransform=
new l.GraphicXYAxisTransform({tool:this});if(this.enableScaling||this.enableRotation)this.scaleRotate=new A.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"});C.enableEditing3D()&&v.canMoveZ(this.graphic,n.getGraphicEffectiveElevationInfo(this.graphic))&&(this.zTransform=new y.GraphicZTransform({tool:this}));this._recreateManipulators()};b.prototype.destroy=function(){this._clear();this.xyTransform.destroy();this.xyTransform=
null;this.xyAxisTransform.destroy();this.xyAxisTransform=null;f.isSome(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null);f.isSome(this.zTransform)&&(this.zTransform.destroy(),this.zTransform=null);this._set("view",null);this._set("graphic",null)};Object.defineProperty(b.prototype,"graphic",{set:function(a){if(null==a)I.error("invalid graphic");else{var b=H.isSupportedGraphic(a);0!==b?(I.error("Transform tool not supported for graphic ("+t.isSupportedGraphicResultMessage(b)+")."),
this._set("graphic",null)):this._set("graphic",a)}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"symbolRotationAngle",{get:function(){var a=this.graphic.symbol;return a?(a=a.symbolLayers.find(function(a){return"object"===a.type}),z.toRadian(-(a&&a.heading||0))):0},enumerable:!0,configurable:!0});b.prototype.reset=function(){};b.prototype.onDetach=function(){f.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()};b.prototype.onHide=function(){f.isSome(this.scaleRotate)&&
this.scaleRotate.cancelActiveAnimation()};b.prototype._clear=function(){this.handles.removeAll()};b.prototype._recreateManipulators=function(){var a=this;this._clear();var b=f.unwrap(this.graphic);this.xyTransform.recreateManipulators();this.xyAxisTransform.recreateManipulators();f.isSome(this.scaleRotate)&&this.scaleRotate.recreateManipulators();f.isSome(this.zTransform)&&this.zTransform.recreateManipulators();this.handles.add([e.watch(b,"geometry",function(){return a.updateManipulators()})]);this.updateManipulators()};
b.prototype.updateManipulators=function(){var a=this.view.renderCoordsHelper.basisMatrixAtPosition(this.xyTransform.renderLocation,G.sm4d.get()),b="none";this.xyTransform.focused?b="xy":this.xyAxisTransform.focused?b="xy-axis":f.isSome(this.scaleRotate)&&this.scaleRotate.getFocused()&&(b="scale-rotate");f.isSome(this.zTransform)&&this.zTransform.dragging&&(b="z");f.isSome(this.scaleRotate)&&this.scaleRotate.dragging&&(b="scale-rotate");this.xyAxisTransform.dragging&&(b="xy-axis");this.xyTransform.dragging&&
(b="xy");var c=a;f.isSome(this.scaleRotate)&&(this.scaleRotate.updateManipulators(a,"scale-rotate"===b),c=this.scaleRotate.getScale(),c=x.mat4.fromScaling(G.sm4d.get(),d.vec3.set(G.sv3d.get(),c,c,c)),c=x.mat4.multiply(G.sm4d.get(),a,c));this.xyTransform.updateManipulators(c,"none"===b||"xy"===b);this.xyAxisTransform.updateManipulators(c,"xy"===b||"xy-axis"===b,"xy-axis"===b);f.isSome(this.zTransform)&&this.zTransform.updateManipulators(c)};h([k.property({constructOnly:!0,nonNullable:!0})],b.prototype,
"view",void 0);h([k.property({value:null})],b.prototype,"graphic",null);h([k.property()],b.prototype,"enableRotation",void 0);h([k.property()],b.prototype,"enableScaling",void 0);h([k.property({readOnly:!0})],b.prototype,"type",void 0);return b=h([k.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool")],b)}(k.declared(b.EventedMixin(F.InteractiveToolBase)));c.GraphicTransform3DTool=u})},"esri/views/3d/interactive/editingTools/isSupportedGraphicUtils":function(){define(["require",
"exports","../../../../core/compilerUtils"],function(u,c,h){Object.defineProperty(c,"__esModule",{value:!0});c.isSupportedGraphicResultMessage=function(c){switch(c){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported";default:h.neverReached(c)}return""}})},"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicScaleRotateTransform":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/scheduling ../../../../../core/screenUtils ../../../../../core/watchUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/math/common ../../Manipulator3D ../../manipulatorUtils ../../manipulatorUtils ./dragUtils ./graphicTransform3DToolConfig ../../../support/geometryUtils ../../../support/mathUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/materials/ColorMaterial".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v,A,l,q,y,H,G,F,I,E,m){function B(a,b){var c=a.allLayerViews.find(function(a){return a.layer===b.layer});if(f.isNone(b.symbol))return null;var d=b.symbol;return{symbolLayers:d.symbolLayers.map(function(a){var b=null,e=null;"object"===a.type&&(b=a.heading);e=c.getSymbolLayerSize(d,a);return{heading:b,size:e}}).toArray()}}function J(a,b,c,d){a.symbolLayers.forEach(function(a,e){var g=b.symbolLayers[e];e=g.heading;g=g.size;"object"===a.type&&(a.heading=(f.isSome(e)?
e:0)-t.toDegree(c),f.isSome(g)&&"width"in g&&(a.width=g.width*d,a.depth=g.depth*d,a.height=g.height*d))})}function K(a,b,c){a=b.projectPoint(a,k.castRenderScreenPointArray(R));b=b.renderToScreen(a,S);return n.vec3.set(c,b[0],b[1],0)}function N(a){var b=null,c=1,d=function(){return c};return{start:function(){c=a.getScale();b=a.getScale;a.getScale=d},update:function(b){c+=((c+1)/2-c)*Math.min(b*y.RING_RESET_ANIMATION_SPEED_FACTOR,1);a.tool.updateManipulators();return.01>Math.abs(c-1)?1:0},destroy:function(){a.getScale=
b;a.tool.updateManipulators()}}}function P(a){var b=0,c=null,d=function(){return!1};return{start:function(){c=a.getFocused;a.getFocused=d;b=0},update:function(c){b+=c;return!a.ringManipulator.focused||b>y.RING_INDICATOR_DELAY_MS?1:0},destroy:function(){a.getFocused=c;a.tool.updateManipulators()}}}Object.defineProperty(c,"__esModule",{value:!0});var D;(function(a){a.ScaleIn=32;a.ScaleOut=64;a.RotateLeft=128;a.RotateRight=256;a.Highlighted=512;a.Unlocked=1024;a.TouchInput=32768})(D||(D={}));u=function(){function c(a){var b=
this;this.mode=null;this._handles=new g;this._activeAnimation=this._scaleRotateDragData=null;this.getFocused=function(){return b.ringManipulator.focused};this.getScale=function(){return f.isSome(b._scaleRotateDragData)&&"scale"===b._scaleRotateDragData.mode?b._scaleRotateDragData.scale:1};this.tool=a.tool;this.mode=a.mode}c.prototype.destroy=function(){this._clear()};c.prototype._clear=function(){f.isSome(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null);
this._handles.removeAll();this.tool.manipulators.remove(this.ringManipulator);this.ringManipulator=null};Object.defineProperty(c.prototype,"dragging",{get:function(){return this.ringManipulator.dragging},enumerable:!0,configurable:!0});c.prototype.startAnimation=function(a){var c=this;this.cancelActiveAnimation();a.start();var d=e.addFrameTask({update:function(b){a.update(b.deltaTime)&&c.cancelActiveAnimation()}});this._activeAnimation=b({},a,{frameTask:d})};c.prototype.cancelActiveAnimation=function(){f.isSome(this._activeAnimation)&&
(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)};c.prototype.recreateManipulators=function(){var c=this;this._clear();this.ringManipulator=this.createRingManipulator();this.tool.manipulators.add(this.ringManipulator);q.createDragHandler(this.ringManipulator,function(d){c._scaleRotateDragData=null;var e=C.vec3f64.fromValues(c.ringManipulator.modelTransform[8],c.ringManipulator.modelTransform[9],c.ringManipulator.modelTransform[10]),g=C.vec3f64.clone(c.ringManipulator.renderLocation),
h=H.plane.fromPositionAndNormal(g,e),k=q.createCartesianPlaneDrag(d,c.tool.view,h);if(f.isNone(k))return null;d=B(c.tool.view,c.tool.graphic);if(f.isNone(d))return null;var m={mode:"none",origin:g,angle:0,startAngle:c.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:d};c._scaleRotateDragData=m;return function(d){var e=k(d),g=A.calculateInputRotationTransform(e.start,e.end,m.origin,h),l=G.cyclicalPI.shortestSignedDiff(m.angle,g);m.angleDir=a.clamp(m.angleDir+l,-y.ROTATE_INDICATOR_DIRECTION_BUFFER,
y.ROTATE_INDICATOR_DIRECTION_BUFFER);m.angle=g;l=n.vec3.subtract(F.sv3d.get(),e.start,m.origin);g=n.vec3.subtract(F.sv3d.get(),e.end,m.origin);l=n.vec3.length(l);g=n.vec3.length(g);g=0===l?0:g/l;m.scaleDir=a.clamp(m.scaleDir+(g-m.scale),-y.SCALE_INDICATOR_DIRECTION_BUFFER,y.SCALE_INDICATOR_DIRECTION_BUFFER);m.scale=g;if("none"===m.mode){if(!(g=c.mode)){var q=m.origin,p=c.tool.view.state.camera,r=e.start,g=e.end,l=K(r,p,F.sv3d.get()),g=K(g,p,F.sv3d.get());if(n.vec3.squaredDistance(l,g)<y.DRAG_THRESHOLD_PX*
y.DRAG_THRESHOLD_PX)g=null;else var v=n.vec3.subtract(F.sv3d.get(),r,q),v=n.vec3.cross(F.sv3d.get(),v,h),r=n.vec3.add(F.sv3d.get(),r,v),q=K(q,p,F.sv3d.get()),p=K(r,p,F.sv3d.get()),r=n.vec3.subtract(F.sv3d.get(),p,l),p=n.vec3.subtract(F.sv3d.get(),l,q),l=H.ray.wrap(l,r),p=H.ray.wrap(q,p),g=H.ray.distance2(l,g)<H.ray.distance2(p,g)?"rotate":"scale"}if(f.isSome(g)){switch(g){case "rotate":c.tool.emit("graphic-rotate-start",{graphic:c.tool.graphic});break;case "scale":c.tool.emit("graphic-scale-start",
{graphic:c.tool.graphic})}m.mode=g}}else{if(f.isSome(c.tool.graphic.symbol)){g=c.tool.graphic.symbol.clone();l=0;p=1;switch(m.mode){case "scale":p=m.scale;break;case "rotate":l=m.angle}J(g,m.startSymbolData,l,p);c.tool.graphic.symbol=g}if("update"===d.action)switch(m.mode){case "rotate":c.tool.emit("graphic-rotate",{graphic:c.tool.graphic,angle:m.angle,type:"rotate"});break;case "scale":c.tool.emit("graphic-scale",{graphic:c.tool.graphic,scale:m.scale,type:"scale"})}}if("end"===d.action){switch(m.mode){case "rotate":c.tool.emit("graphic-rotate-stop",
{graphic:c.tool.graphic});break;case "scale":c.tool.emit("graphic-scale-stop",{graphic:c.tool.graphic})}c.startAnimation(N(c));c._scaleRotateDragData=null}c.tool.updateManipulators();return b({},e,m)}},function(a){});this._handles.add([x.init(this.tool.graphic,"geometry",function(){l.placeManipulatorAtGraphic(c.ringManipulator,c.tool.graphic)}),this.ringManipulator.events.on("focus",function(a){"focus"===a.action?c.startAnimation(P(c)):c.tool.updateManipulators()}),this.ringManipulator.events.on("immediate-click",
function(a){a.stopPropagation()}),x.init(this.tool.graphic,["visible","layer.visible"],function(){c.ringManipulator.visible=c.tool.graphic.visible&&c.tool.graphic.layer.visible})])};c.prototype.updateManipulators=function(a,b){var c=d.mat4.identity(F.sm4d.get()),e=this.tool.symbolRotationAngle;0!==e&&d.mat4.rotate(c,c,e,C.vec3f64.fromValues(0,0,1));var e=this.getScale(),e=d.mat4.fromScaling(F.sm4d.get(),n.vec3.set(F.sv3d.get(),e,e,e)),g=d.mat4.identity(F.sm4d.get());d.mat4.multiply(g,a,e);d.mat4.multiply(g,
g,c);this.ringManipulator.modelTransform=g;this.ringManipulator.state=0;this.ringManipulator.state|=!0===b?D.Highlighted:0;this.ringManipulator.state|=f.isSome(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode?0:D.Unlocked;if(f.isSome(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case "rotate":this.ringManipulator.state|=0>this._scaleRotateDragData.angleDir?D.RotateLeft:D.RotateRight;break;case "scale":this.ringManipulator.state|=0>this._scaleRotateDragData.scaleDir?
D.ScaleIn:D.ScaleOut}};c.prototype.createRingManipulator=function(){for(var a=function(a,b,c){for(var d=[],e=Math.ceil(y.GEOMETRY_SEGMENTS*(b-a)/(2*Math.PI)),f=0;f<e+1;f++){var g=a+f*(b-a)/e;d.push(C.vec3f64.fromValues(c*Math.cos(g),c*Math.sin(g),0))}return d},b=function(b){return a(0,2*Math.PI,b)},c=function(a,b){return new I(E.createPathExtrusionGeometry([[-b/2,0],[b/2,0],[b/2,y.RING_HEIGHT/2],[-b/2,y.RING_HEIGHT/2]],a,[],[],!1),"graphic-transform-ring")},e=b(y.RING_RADIUS),f=c(e,y.RING_THICKNESS),
g=[],h=[],k=[],m=0;2>m;m++){var l=m*Math.PI-Math.PI/4,n=Math.PI/2-y.ROTATE_INDICATOR_ARC_LENGTH,p=l+n,l=l+Math.PI/2-n,n=a(p,l,y.INNER_INDICATOR_RADIUS),q=c(n,y.INDICATOR_THICKNESS);k.push(n);g.push(q);h.push(q);for(q=0;2>q;q++){var r=0===q,t=z.mat4f64.create();if(r){d.mat4.scale(t,t,[1,-1,1]);d.mat4.rotate(t,t,-p,[0,0,1]);var u=Math.round(y.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(n.length-1))}else d.mat4.rotate(t,t,l,[0,0,1]),u=Math.round((1-y.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(n.length-
1));t[12]=n[u][0];t[13]=n[u][1];t[14]=n[u][2];u=E.createExtrudedTriangle(y.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,y.ROTATE_INDICATOR_ARROW_TIP_RADIUS,y.RING_HEIGHT);E.transformInPlace(u,t);t=new I(u,"graphic-transform-ring-rotate");(r?g:h).push(t)}}q=[];for(m=0;2>m;m++)l=m*Math.PI-Math.PI/4,n=Math.PI/2-y.SCALE_INDICATOR_ARC_LENGTH,p=l+n,l=l+Math.PI/2-n,n=a(p,l,y.OUTER_INDICATOR_RADIUS),q.push(c(n,y.INDICATOR_THICKNESS));m=b(y.RING_RADIUS+y.SCALE_INDICATOR_OFFSET1);p=b(y.RING_RADIUS+y.SCALE_INDICATOR_OFFSET2);
m=c(m,y.INDICATOR_THICKNESS);p=c(p,y.INDICATOR_THICKNESS);l=b(y.RING_RADIUS-y.SCALE_INDICATOR_OFFSET1);n=b(y.RING_RADIUS-y.SCALE_INDICATOR_OFFSET2);b=c(l,y.INDICATOR_THICKNESS);c=c(n,y.INDICATOR_THICKNESS);l=this.createMaterial();n=this.createMaterial(.66);t=this.createMaterial(.5);r=this.createMaterial(.33);f=[{geometry:f,material:l,stateMask:D.Highlighted},{geometry:f,material:t}];this.mode&&"scale"!==this.mode||(f=f.concat([{geometry:q,material:l,stateMask:D.Highlighted|D.Unlocked},{geometry:m,
material:n,stateMask:D.Highlighted|D.ScaleIn},{geometry:p,material:r,stateMask:D.Highlighted|D.ScaleIn},{geometry:b,material:n,stateMask:D.Highlighted|D.ScaleOut},{geometry:c,material:r,stateMask:D.Highlighted|D.ScaleOut}]));this.mode&&"rotate"!==this.mode||(f=f.concat([{geometry:h,material:l,stateMask:D.Highlighted|D.Unlocked},{geometry:g,material:l,stateMask:D.Highlighted|D.RotateLeft},{geometry:h,material:l,stateMask:D.Highlighted|D.RotateRight}]));e=[e].concat(k);return new v.Manipulator3D({view:this.tool.view,
renderObjects:f,autoScaleRenderObjects:!1,radius:y.RING_THICKNESS,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:{mode:"on-the-ground",offset:0},collisionType:{type:"ribbon",paths:e,direction:C.vec3f64.fromValues(0,0,1)}})};c.prototype.createMaterial=function(a){void 0===a&&(a=1);var b=y.HANDLE_COLOR.concat([a]);a=new m({color:b,transparent:1!==a,cullFace:2},"graphic-transform");a.renderOccluded=2;return a};return c}();c.GraphicScaleRotateTransform=u;var R=C.vec3f64.create(),S=k.createScreenPointArray()})},
"esri/views/3d/interactive/editingTools/graphicTransform3D/dragUtils":function(){define("require exports ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/geometryUtils ../../../support/stack".split(" "),function(u,c,h,w,p,r,b){Object.defineProperty(c,"__esModule",{value:!0});c.createDragHandler=function(a,b,c){var e=null;return a.events.on("drag",function(a){"start"===a.action&&(e=b(a));if(!h.isNone(e)){var d=e(a);h.isSome(d)&&
c(d);"end"===a.action&&(e=null)}})};c.createCartesianPlaneDrag=function(a,c,e){a=w.screenPointObjectToArray(a.start,w.castScreenPointArray(b.sv2d.get()));a=r.ray.fromScreen(c.state.camera,a,g);var f=p.vec3f64.create(),h=p.vec3f64.create();return r.plane.intersectRay(e,a,f)?function(a){var d=w.screenPointObjectToArray(a.screenPoint,w.castScreenPointArray(b.sv2d.get())),d=r.ray.fromScreen(c.state.camera,d,g);return r.plane.intersectRay(e,d,h)?{action:a.action,start:f,end:h}:null}:null};var g=r.ray.create()})},
"esri/views/3d/interactive/editingTools/graphicTransform3D/graphicTransform3DToolConfig":function(){define(["require","exports"],function(u,c){Object.defineProperty(c,"__esModule",{value:!0});c.HANDLE_COLOR=[1,.5,0];c.GEOMETRY_SEGMENTS=128;c.DISC_RADIUS=70;c.DISC_COLLISION_RADIUS=80;c.DISC_HEIGHT=.02;c.DISC_TRANSLATE_ARROW_SIZE=54;c.DISC_TRANSLATE_ARROW_OFFSET=100;c.RING_RADIUS=160;c.RING_HEIGHT=.5;c.RING_THICKNESS=24;c.INDICATOR_THICKNESS=9;c.INNER_INDICATOR_RADIUS=c.RING_RADIUS+30;c.OUTER_INDICATOR_RADIUS=
c.RING_RADIUS+53;c.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60;c.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23;c.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12;c.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3;c.DRAG_THRESHOLD_PX=10;c.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2;c.SCALE_INDICATOR_OFFSET1=30;c.SCALE_INDICATOR_OFFSET2=53;c.SCALE_INDICATOR_DIRECTION_BUFFER=.2;c.ROTATE_INDICATOR_DIRECTION_BUFFER=.3;c.RING_INDICATOR_DELAY_MS=200;c.RING_RESET_ANIMATION_SPEED_FACTOR=3;c.ALIGN_ARROWS_SCALE_THRESHOLD=1E6})},"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicXYAxisTransform":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Handles ../../../../../core/has ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../../dragUtils/projectScreenToMap ./graphicTransform3DToolConfig ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/dragUtils/dragActions ../../../../interactive/dragUtils/dragHandlers ../../../../interactive/dragUtils/screenDragToMap".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v,A,l,q,y,H,G){function F(a){return"local"===a.viewingMode?!0:a.scale<t.ALIGN_ARROWS_SCALE_THRESHOLD}Object.defineProperty(c,"__esModule",{value:!0});var I;(function(a){a.Highlighted=512;a.Visible=1024})(I||(I={}));u=function(){function c(a){this._handles=new b;this.arrowManipulatorInfos=[];this.tool=a.tool}c.prototype.destroy=function(){this._clear()};c.prototype._clear=function(){var a=this;this._handles.removeAll();this.arrowManipulatorInfos.forEach(function(b){a.tool.manipulators.remove(b.manipulator)});
this.arrowManipulatorInfos=[]};Object.defineProperty(c.prototype,"focused",{get:function(){return this.arrowManipulatorInfos.some(function(a){return a.manipulator.focused})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"dragging",{get:function(){return this.arrowManipulatorInfos.some(function(a){return a.manipulator.dragging})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"arrowRotationAngle",{get:function(){return"local"===this.tool.view.viewingMode||this.tool.view.scale<
t.ALIGN_ARROWS_SCALE_THRESHOLD?this.tool.symbolRotationAngle:0},enumerable:!0,configurable:!0});c.prototype.createDragAction=function(){var a=this,b=y.createGraphicDragAction(this.tool.graphic);return function(c){"start"===c.action&&a.tool.emit("graphic-translate-start",{graphic:a.tool.graphic});b(c);switch(c.action){case "update":a.tool.emit("graphic-translate",{graphic:a.tool.graphic,dx:c.deltaX,dy:c.deltaY,dz:c.deltaZ,type:"translate"});break;case "end":a.tool.emit("graphic-translate-stop",{graphic:a.tool.graphic})}}};
c.prototype.recreateManipulators=function(){var a=this;this._clear();for(var b=[],c=0;4>c;c++){var d=this.createArrowManipulator(c);b.push(d);this.tool.manipulators.add(d.manipulator);var e=this.createDragAction(),e=H.createManipulatorDragHandler(d.manipulator,this.createDragEventMappingFunction(c),e);this._handles.add(e);this._handles.add([d.manipulator.events.on("focus",function(){a.tool.updateManipulators()}),d.manipulator.events.on("immediate-click",function(a){a.stopPropagation()})])}this.arrowManipulatorInfos=
b;this.arrowManipulatorInfos.forEach(function(b){n.placeManipulatorAtGraphic(b.manipulator,a.tool.graphic)});this._handles.add([f.init(this.tool.graphic,"geometry",function(){a.arrowManipulatorInfos.forEach(function(b){n.placeManipulatorAtGraphic(b.manipulator,a.tool.graphic)})}),f.init(this.tool.graphic,["visible","layer.visible"],function(){var b=a.tool.graphic.visible&&a.tool.graphic.layer.visible;a.arrowManipulatorInfos.forEach(function(a){a.manipulator.visible=b})})])};c.prototype.updateManipulators=
function(a,b,c){var f=this.tool.symbolRotationAngle,h=e.mat4.identity(v.sm4d.get());0!==f&&e.mat4.rotate(h,h,f,d.vec3f64.fromValues(0,0,1));var f=e.mat4.multiply(v.sm4d.get(),a,h),k=F(this.tool.view)?f:a,m=this.dragging,l=b||g("esri-mobile")?I.Visible:0;this.arrowManipulatorInfos.forEach(function(a){var b=e.mat4.multiply(v.sm4d.get(),k,a.transform);a.manipulator.state=m?l|(a.manipulator.dragging?I.Highlighted:0):l|(a.manipulator.focused&&c?I.Highlighted:0);a.manipulator.modelTransform=b})};c.prototype.createArrowManipulator=
function(a){var b=Math.sqrt(t.DISC_TRANSLATE_ARROW_SIZE*t.DISC_TRANSLATE_ARROW_SIZE*3/4),c=l.createExtrudedTriangle(b,t.DISC_TRANSLATE_ARROW_SIZE/2,t.DISC_TRANSLATE_ARROW_SIZE/2,t.DISC_HEIGHT);l.transformInPlace(c,e.mat4.fromTranslation(v.sm4d.get(),x.vec3.set(v.sv3d.get(),0,-b/3,0)));var c=new A(c,"graphic-transform-disc-arrow"+a),f=this.createMaterial(),g=this.createMaterial(.5),h=this.createMaterial(0),b=new z.Manipulator3D({view:this.tool.view,renderObjects:[{geometry:c,material:f,stateMask:I.Visible|
I.Highlighted},{geometry:c,material:g,stateMask:I.Visible},{geometry:c,material:h,stateMask:0}],autoScaleRenderObjects:!1,radius:b,focusMultiplier:1,touchMultiplier:1,elevationInfo:{mode:"on-the-ground",offset:0},collisionType:{type:"disc",direction:d.vec3f64.fromValues(0,0,1)}}),c=e.mat4.identity(v.sm4d.get());e.mat4.fromZRotation(c,a*Math.PI/2);a=e.mat4.identity(v.sm4d.get());e.mat4.fromTranslation(a,x.vec3.set(v.sv3d.get(),0,t.DISC_TRANSLATE_ARROW_OFFSET,0));f=k.mat4f64.create();e.mat4.multiply(f,
c,a);return{manipulator:b,transform:f}};c.prototype.createMaterial=function(a){void 0===a&&(a=1);var b=t.HANDLE_COLOR.concat([a]);a=new q({color:b,transparent:1!==a,cullFace:2},"graphic-transform");a.renderOccluded=2;return a};c.prototype.createDragEventMappingFunction=function(b){var c=this;return function(d){var e=c.arrowRotationAngle,e=[Math.cos(e),Math.sin(e),0],f=[-e[1],e[0],0],g=G.createMapAxisConstrainedScreenToMapDrag(C.createForGraphicAtLocation(c.tool.view,c.tool.graphic,d.elevationAlignedLocation),
0===b%2?f:e,a.expect(c.tool.graphic.geometry).spatialReference);return a.isNone(g)?null:function(b){b=g(b);return a.isNone(b)?null:b}}};return c}();c.GraphicXYAxisTransform=u})},"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicXYTransform":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../../dragUtils/projectScreenToMap ./graphicTransform3DToolConfig ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/dragUtils/dragActions ../../../../interactive/dragUtils/dragHandlers ../../../../interactive/dragUtils/screenDragToMap".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x,d,z,n,C,t,v,A,l,q){Object.defineProperty(c,"__esModule",{value:!0});var y;(y||(y={})).Highlighted=512;u=function(){function c(a){this._handles=new b;this.tool=a.tool}c.prototype.destroy=function(){this._clear()};c.prototype._clear=function(){this._handles.removeAll();this.tool.manipulators.remove(this.discManipulator);this.discManipulator=null};Object.defineProperty(c.prototype,"focused",{get:function(){return this.discManipulator.focused},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"dragging",{get:function(){return this.discManipulator.dragging},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderLocation",{get:function(){return this.discManipulator.renderLocation},enumerable:!0,configurable:!0});c.prototype.recreateManipulators=function(){var b=this;this._clear();this.discManipulator=this.createDiscManipulator();this.tool.manipulators.add(this.discManipulator);var c=this.createDragAction(),c=l.createManipulatorDragHandler(this.discManipulator,
this.createDragEventMappingFunction(),c);this._handles.add(c);this._handles.add([a.init(this.tool.graphic,"geometry",function(){d.placeManipulatorAtGraphic(b.discManipulator,b.tool.graphic)}),this.discManipulator.events.on("immediate-click",function(a){a.stopPropagation()}),a.init(this.tool.graphic,["visible","layer.visible"],function(){b.discManipulator.visible=b.tool.graphic.visible&&b.tool.graphic.layer.visible})]);this._handles.add([this.discManipulator.events.on("focus",function(){b.tool.updateManipulators()})])};
c.prototype.updateManipulators=function(a,b){this.discManipulator.modelTransform=a;this.discManipulator.state=b?y.Highlighted:0};c.prototype.createDiscManipulator=function(){var a=this.tool.view,b=new C(t.createCylinderGeometry(n.DISC_HEIGHT,1,n.GEOMETRY_SEGMENTS,k.vec3f64.fromValues(0,0,1),k.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),c=f.mat4.fromScaling(e.mat4f64.create(),k.vec3f64.fromValues(n.DISC_RADIUS,n.DISC_RADIUS,n.DISC_RADIUS)),d=this.createMaterial(),g=this.createMaterial(.5);
return new x.Manipulator3D({view:a,renderObjects:[{geometry:b,material:d,transform:c,stateMask:y.Highlighted},{geometry:b,material:g,transform:c}],worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,radius:n.DISC_COLLISION_RADIUS,elevationInfo:{mode:"on-the-ground",offset:0},collisionType:{type:"disc",direction:k.vec3f64.fromValues(0,0,1)}})};c.prototype.createMaterial=function(a){void 0===a&&(a=1);var b=n.HANDLE_COLOR.concat([a]);a=new v({color:b,transparent:1!==a,cullFace:2},
"graphic-transform");a.renderOccluded=2;return a};c.prototype.createDragEventMappingFunction=function(){var a=this;return function(b){var c=q.createXYConstrainedFromProject(z.createForGraphicAtLocation(a.tool.view,a.tool.graphic,b.elevationAlignedLocation),g.expect(a.tool.graphic.geometry).spatialReference);return g.isNone(c)?null:function(a){a=c(a);return g.isNone(a)?null:a}}};c.prototype.createDragAction=function(){var a=this,b=A.createGraphicDragAction(this.tool.graphic);return function(c){"start"===
c.action&&a.tool.emit("graphic-translate-start",{graphic:a.tool.graphic});b(c);switch(c.action){case "update":a.tool.emit("graphic-translate",{graphic:a.tool.graphic,dx:c.deltaX,dy:c.deltaY,dz:c.deltaZ,type:"translate"});break;case "end":a.tool.emit("graphic-translate-stop",{graphic:a.tool.graphic})}}};return c}();c.GraphicXYTransform=u})},"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicZTransform":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/watchUtils ../../manipulatorUtils ../manipulatorUtils ../../../../interactive/dragUtils/dragActions ../../../../interactive/dragUtils/dragHandlers".split(" "),
function(u,c,h,w,p,r,b,g,a,f,e,k,x){Object.defineProperty(c,"__esModule",{value:!0});u=function(){function c(a){this._handles=new b;this.zManipulator=null;this.tool=a.tool}c.prototype.destroy=function(){this._clear()};c.prototype._clear=function(){this._handles.removeAll();g.isSome(this.zManipulator)&&this.tool.manipulators.remove(this.zManipulator);this.zManipulator=null};Object.defineProperty(c.prototype,"dragging",{get:function(){return g.isSome(this.zManipulator)&&this.zManipulator.dragging},
enumerable:!0,configurable:!0});c.prototype.recreateManipulators=function(){var b=this;this._clear();this.zManipulator=e.createGraphicMoveZManipulator({view:this.tool.view,graphic:this.tool.graphic,worldOriented:!1});if(g.isSome(this.zManipulator)){this.tool.manipulators.add(this.zManipulator);var c=this.createDragEventMappingFunction(),d=k.createGraphicDragAction(this.tool.graphic),c=x.createManipulatorDragHandler(this.zManipulator,c,d);this._handles.add(c);this._handles.add([a.init(this.tool.graphic,
"geometry",function(){g.isSome(b.zManipulator)&&f.placeManipulatorAtGraphic(b.zManipulator,b.tool.graphic)}),this.zManipulator.events.on("immediate-click",function(a){a.stopPropagation()}),a.init(this.tool.graphic,["visible","layer.visible"],function(){g.isSome(b.zManipulator)&&(b.zManipulator.visible=b.tool.graphic.visible&&b.tool.graphic.layer.visible)})])}};c.prototype.updateManipulators=function(a){g.isSome(this.zManipulator)&&(this.zManipulator.modelTransform=a)};c.prototype.createDragEventMappingFunction=
function(){var a=this;return function(b){var c=e.createGraphicMoveZScreenDragToMap(a.tool.view,b);return g.isNone(c)?null:function(b){var d=c(b);if(g.isNone(d))return null;switch(b.action){case "start":a.tool.emit("graphic-translate-start",{graphic:a.tool.graphic});break;case "update":a.tool.emit("graphic-translate",{graphic:a.tool.graphic,dx:d.deltaX,dy:d.deltaY,dz:d.deltaZ});break;case "end":a.tool.emit("graphic-translate-stop",{graphic:a.tool.graphic})}return d}}};return c}();c.GraphicZTransform=
u})},"esri/views/3d/interactive/editingTools/graphicTransform3D/isSupportedGraphic":function(){define("require exports ../../../../../core/compilerUtils ../../../../../core/maybe ../../../../../support/elevationInfoUtils ../../../../../support/featureFlags".split(" "),function(u,c,h,w,p,r){Object.defineProperty(c,"__esModule",{value:!0});c.isSupportedGraphic=function(b){if("graphics"!==b.layer.type)return 1;if(w.isNone(b.geometry))return 2;var c=b.geometry.type;switch(c){case "point":break;case "polygon":case "polyline":case "multipoint":case "extent":case "mesh":return 3;
default:return h.neverReached(c),3}c=w.isSome(b.symbol)&&"point-3d"===b.symbol.type&&b.symbol.symbolLayers;if(!(c&&0<c.length&&c.some(function(a){return"object"===a.type})))return 5;c=p.getGraphicEffectiveElevationMode(b);return"on-the-ground"===c||r.enableEditing3D()&&"absolute-height"===c&&!p.hasGraphicFeatureExpressionInfo(b)?0:4}})},"*noref":1}});
define(["require","exports","./editingTools/graphicMove3D/GraphicMove3DTool","./editingTools/graphicReshape3D/GraphicReshape3DTool","./editingTools/graphicTransform3D/GraphicTransform3DTool"],function(u,c,h,w,p){Object.defineProperty(c,"__esModule",{value:!0});c.GraphicMove3DTool=h.GraphicMove3DTool;c.GraphicReshape3DTool=w.GraphicReshape3DTool;c.GraphicTransform3DTool=p.GraphicTransform3DTool});