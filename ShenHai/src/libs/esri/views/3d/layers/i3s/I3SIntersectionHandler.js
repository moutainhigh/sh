// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils".split(" "),function(h,c,l,t,u,v){function w(b,a,f,d){void 0===d&&(d=0);d=b[3]+d;var m=a[0]-b[0],g=a[1]-b[1];b=a[2]-b[2];a=f[0];var e=f[1];f=f[2];var p=a*m+e*g+f*b;return 0<=p*p-(a*a+e*e+f*f)*(m*m+g*g+b*b-d*d)}Object.defineProperty(c,"__esModule",{value:!0});h=function(){function b(a){this.type="I3S";this.layerUid=a.layerUid;this.sublayerUid=
a.sublayerUid;this.collection=a.collection;this.forEach=a.forEach;this.slicePlaneEnabled=a.slicePlaneEnabled;this.intersectionHandlerId=this.layerUid}b.prototype.intersect=function(a,b,d,m){var g=this,e=a.results,f=2===a.options.store,h=a.ray.direction,k=a.tolerance,c=function(a){return a},r=function(a){return a},n=l.isSome(a.options.verticalOffset)?a.options.verticalOffset.i3s:null;l.isSome(n)&&(c=function(a){return n.applyToMbs(a)},r=function(a){return n.applyToObb(a)});this.forEach(function(q,
l){q.renderMbs&&!w(c(q.renderMbs),d,h,k)||q.renderObb&&!u.intersectLine(r(q.renderObb),d,h,k)||g.collection.intersect(l,d,m,k,n,function(h,c,l,n){if(0<=c&&(null==b||b(d,m,c))){var k=function(a){a.intersector=g.type;a.target={type:"external",metadata:{layerUid:g.layerUid,sublayerUid:g.sublayerUid,nodeIndex:q.index,componentIndex:h}};a.dist=c;t.vec3.copy(a.normal,l);a.triangleNr=n};(null==e.min.dist||c<e.min.dist)&&k(e.min);(null==e.max.dist||c>e.max.dist)&&k(e.max);if(f){var p=new v.IntersectorResult(a.ray);
k(p);a.results.all.push(p)}}})})};return b}();c.I3SIntersectionHandler=h});