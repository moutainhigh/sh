// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Color ../../../Graphic ../../../core/Collection ../../../core/has ../../../core/iteratorUtils ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/layerUtils ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ./support/symbolColorUtils ../support/debugFlags ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/material/RenderTexture ../webgl-engine/lib/Texture ../webgl-engine/lib/TextureBackedBuffer/BufferManager module @dojo/framework/shim/Promise".split(" "),
function(H,v,I,Y,l,Z,aa,ba,B,ca,da,J,ea,C,k,r,fa,ga,K,ha,ia,ja,g,ka,la,L,M,ma,na,z,oa,pa,N,qa,ra,sa,ta,O,P,ua,va,wa,xa,n,ya,D,Q,za,Aa,E,Ba,F,Ca,Da,A,R,Ea,Fa){function S(k){var g=k.metallicRoughness;return g&&0<=g.baseColorTextureId||g&&0<=g.metallicRoughnessTextureId||0<=k.normalTextureId||0<=k.emissiveTextureId||0<=k.occlusionTextureId}function T(g){return k.isSome(g)&&K.isArrayBuffer(g.data)}function U(g,n){for(var c=1024,a=0;a<g.length;a++)var b=g[a],c=c+(b.interleavedVertexData.byteLength+(b.indices?
b.indices.byteLength:0)),c=c+(b.positionData.data.byteLength+b.positionData.indices.byteLength);if(k.isSome(n))for(g=0;g<n.length;g++)a=n[g],k.isSome(a)&&K.isArrayBuffer(a.data)&&(c+=a.data.byteLength);return c}function V(k,g){return 104857600<g.byteSize?(y.warn("Node is too big to store in IndexedDB cache: "+k.id+" ("+g.byteSize+" bytes)"),!1):0<g.byteSize}Object.defineProperty(v,"__esModule",{value:!0});var y=ea.getLogger("esri.views.3d.layers.SceneLayerView3D"),W=[1,1,1,1],Ga=function(){return function(){this.cachedSymbolInfos=
[];this.cachedSymbolColors=null}}();v.I3SMeshView3D=function(v){return function(v){function c(){var a=null!==v&&v.apply(this,arguments)||this;a._elevationProvider=null;a._intersectionHandler=null;a._worker=new O;a._workerThread=null;a._nodeId2Meta=new Map;a._addTasks=new Map;a._rendererVersion=0;a._rendererFields=null;a._colorVariable=null;a._opacityVariable=null;a._symbolInfos=new Map;a._idbCache=new ya.IDBCache("esri-scenelayer-cache","geometries");a._labeler=null;a._hasColors=!1;a._hasTextures=
!1;a._hasData=!1;a.slicePlaneEnabled=!1;a._layerUrl="";a._cacheKeySuffix=null;a._arcade=null;a._tmpAttributeOnlyGraphic=new B(null,null,{});return a}Y(c,v);Object.defineProperty(c.prototype,"layerUid",{get:function(){return this.layer&&this.layer.uid},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"sublayerUid",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updatingMeshView3D",{get:function(){return!(!this._controller||!this._controller.updating)||
!!this._visibleGeometryChangedSchedulerHandle||k.isSome(this._labeler)&&this._labeler.updating},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"rendererTextureUsage",{get:function(){return n.rendererNeedsTextures(this._currentRenderer)?31:12},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=ha.getMetersPerVerticalUnitForSR(this.layer.spatialReference),d=sa.getMetersPerUnit(a.unit);return(a.offset||0)*d/b}return 0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view&&this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!da("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.renderView.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=this;ja.open(fa.getAbsMid("./SceneLayerWorker",H,
Fa)).then(function(b){a.destroyed?b.close():a._workerThread=b});n.checkSceneLayerValid(this.layer);n.checkSceneLayerCompatibleWithView(this.layer,this.view);this._layerUrl=this.layer.parsedUrl.path;this._controller=new oa({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new ua({collection:this._collection,forAllFeatures:function(b){return a._forAllFeatures(b,
null,1)},forAllFeaturesOfNode:function(b,e){return a._forAllFeaturesOfNode(b,e)}});if(this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());
this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid,function(b){return a._deleteComponentObject(b)});this._intersectionHandler=new xa.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,forEach:function(b){return a._nodeId2Meta.forEach(function(a){return b(a.node,a.objectHandle)})}});this._elevationProvider=new va({layerView:this,intersectionHandler:this._intersectionHandler});
this.updatingHandles.add(this,"view.clippingArea",function(){return a._clippingAreaChanged()},2);this.updatingHandles.add(this,"fullOpacity",function(b){return a._opacityChange(b)});this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)});this.updatingHandles.add(this,"elevationOffset",function(b,e){return a._reloadAll(e)});this.updatingHandles.add(this,"filter",function(){return a._filterChange()},2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",
function(){return a._updatePBR()});b=function(){a._reloadAll();a._memCache.clear()};this.updatingHandles.add(this,"rendererTextureUsage",b);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",b);this.updatingHandles.add(this,"suspended",function(b){return a._suspendedChange(b)},2);this.updatingHandles.add(this.layer,"labelsVisible",function(){return a._labelsVisibleChange()},2);this.updatingHandles.add(this.layer,"labelingInfo",function(){return a._labelsVisibleChange()},2);this.handles.add(ia.init(E,
"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var d=a._controller.crsIndex;(new Promise(function(a,b){H(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&E.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:d}))})}else b||!a._treeDebugger||E.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}));this._cacheKeySuffix=n.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(function(a){return y.warn("Failed to initialize IndexedDB cache: "+
a)});this._componentColorManager=this._hasSymbolColors?new Ea.BufferManager(this._stage.renderView.renderingContext):null};c.prototype.destroy=function(){this._clearAddTasks();this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);this._workerThread&&
(this._workerThread.close(),this._workerThread=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._stage=this._collection=this._memCache=null;k.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&
(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};c.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};c.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};c.prototype.memEstimateGeometryAdded=function(a){a=this._collection.getObjectMemoryUsageGPU(a);this.gpuMemoryEstimate+=
a;this.geoMemoryEstimate+=a;return a};c.prototype.memEstimateGeometryRemoved=function(a){a=this._collection.getObjectMemoryUsageGPU(a);this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};c.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a)};c.prototype.getUsedMemory=function(){var a=0;this._nodeId2Meta.forEach(function(b){return a+=b.node.memory});return a};c.prototype.getUnloadedMemory=function(){return this._controller?this._controller.unloadedMemoryEstimate:0};c.prototype.ignoresMemoryFactor=
function(){return!1};c.prototype._labelsVisibleChange=function(){var a=this;k.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);if(pa.areLabelsVisible(this.layer)&&this._supportsLabeling){var b=new ta.default({view:this.view,layer:this.layer,collection:this._collection});this._nodeId2Meta.forEach(function(d){a._addMetaToLabeler(b,d)});this._labeler=b}};c.prototype._addMetaToLabeler=function(a,b){var d=this;a.addNodeMeta(b,function(a,b){return d._createAttributes(a,b)})};c.prototype._suspendedChange=
function(a){a?(this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};c.prototype.getStats=function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),"Total GPU Memory Estimate":(this.gpuMemoryEstimate/
1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};this._controller&&(this._cachingEnabled()&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};c.prototype.getLoadedAttributes=function(a){if((a=this._nodeId2Meta.get(a))&&a.attributeInfo)return a.attributeInfo.loadedAttributes};c.prototype.getAttributeData=function(a){if((a=
this._nodeId2Meta.get(a))&&a.attributeInfo)return a.attributeInfo.attributeData};c.prototype.setAttributeData=function(a,b){var d=this;if(a=this._nodeId2Meta.get(a))a.attributeInfo=b,a.cachedRendererVersion=this._getInvalidRendererVersion(),a.filteredIds=null,k.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(a,function(a,b){return d._createAttributes(a,b)}),this._updateEngineObject(a)};c.prototype.getLoadedNodeIds=function(){var a=[];this._nodeId2Meta.forEach(function(b){return a.push(b.node.id)});
return a.sort()};c.prototype.getLoadedNodes=function(){var a=[];this._nodeId2Meta.forEach(function(b){return a.push(b.node)});return a};c.prototype.getLoadedNodeIndices=function(a){this._nodeId2Meta.forEach(function(b,d){return a.push(d)})};c.prototype._createTexture=function(a,b,d,e){if(k.isNone(d)||null==d.data)return null;var c=d.data,h=b.wrapTextures;b=d.usage&1?"opaque"===b.alphaMode?3:4:3;var q=!0,u;d.encoding===n.DDS_ENCODING_STRING?u=R.DDS_ENCODING:q=C.isPowerOfTwo(c.width)&&C.isPowerOfTwo(c.height);
q=(e?this._enableAtlasMipMaps:this._enableMipMaps)&&q;d=new R(c,a.id+"/"+d.id,{mipmap:q,wrap:e||!h?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:e&&q&&this._disableAtlasAnisotropy,encoding:u,noUnpackFlip:!0,components:b});this._stage.add(4,d);a.memory+=this.memEstimateTextureAdded(d);return d};c.prototype._getVertexBufferLayout=function(a,b){a={hasTexture:S(a.params.material),hasNormals:null!=b.vertexAttributes.normal,hasRegions:null!=b.vertexAttributes.uvRegion};return Ca.glLayout(Da.createVertexBufferLayout(this._getGeometryParameters(a)))};
c.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};c.prototype._findGraphicNodeAndIndex=function(a){var b=D.attributeLookup(a.attributes,this._getObjectIdField()),d=null;J.someMap(this._nodeId2Meta,function(a){var c=a.featureIds.indexOf(b);if(-1===c)return!1;d={node:a.node,index:c};return!0});return d};c.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.index);if(!a)return[];for(var d=[],c=this._getObjectIdField(),f=0;f<b.length;f++){var h=D.attributeLookup(b[f].attributes,
c),h=a.featureIds.indexOf(h);-1!==h&&d.push(h)}return d};c.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return r.reject();var b=this._nodeId2Meta.get(a.node.index).objectHandle;a=wa.boundingBoxCornerPoints(a.index,this._collection,b,new Float64Array(24));if(F.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=z.empty(),z.expandWithBuffer(b,a,0,8),r.resolve({boundingBox:b,screenSpaceObjects:[]})};c.prototype.whenGraphicAttributes=
function(a,b){var d=this;return n.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=new Map,c=[],e=0;e<a.length;e++){var u=a[e],w=d._findGraphicNodeAndIndex(u),m=b.get(w.node);m||(m={node:w.node,indices:[],graphics:[]},c.push(m));m.indices.push(w.index);m.graphics.push(u)}return c},{populateObjectId:!0})};c.prototype.getGraphicFromIntersectorMetadata=function(a){if(null==a.nodeIndex||null==a.componentIndex)return null;var b=this._nodeId2Meta.get(a.nodeIndex);return null==
b||null==b.featureIds||a.componentIndex>=b.featureIds.length?null:this._createGraphic(a.componentIndex,b)};c.prototype._getCacheKey=function(a){return this._layerUrl+"/v9/"+a.id+this._cacheKeySuffix};c.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};c.prototype._cachingEnabled=function(){return!this._controller.disableIDBCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix};c.prototype.loadCachedGPUData=function(a){return this._memCache.pop(this._getMemCacheKey(a.index))};
c.prototype.loadMissingTextures=function(a,b,d,c){var e=this,h=a.filter(function(a,d){if(0===(a.usage&e.rendererTextureUsage))return!1;if(k.isNone(b))return!0;a=n.selectEncoding(a.encodings,e.useCompressedTextures);d=b[d];return k.isNone(d)||null==d.data||a&&d.encoding!==a.encoding?!0:!1});return 0===h.length?r.resolve(!1):d(h,c).then(function(d){for(var c=0,e=0;e<a.length;e++)c<d.length&&d[c].id===a[e].id&&(b[e]=d[c],c++);return!0})};c.prototype.loadCachedNodeData=function(a,b,d){var c=this;return this._cachingEnabled()?
this._idbCache.get(this._getCacheKey(a),b).then(function(e){if(null==e)return null;if(e.nodeVersion!==a.version)return c._idbCache.remove(c._getCacheKey(a)),null;a.obb||(a.obb=Ba.clone(e.nodeObb),a.isComputedObb=!0,c._controller.updateVisibility(a.index));return c.loadMissingTextures(e.requiredTextures,e.textureData,d,b).then(function(d){d&&c._idbCache.initialized&&k.isSome(e.textureData)&&(e.byteSize=U(e.transformedGeometries,e.textureData),e.textureData.every(T)&&V(a,e)&&c._idbCache.put(c._getCacheKey(a),
e).catch(function(b){return y.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)}));r.throwIfAborted(b);return e})}):r.resolve(null)};c.prototype.addNodeData=function(a,b){var d=this;if(0===b.allGeometryData.length||0===b.allGeometryData[0].geometries.length)return r.resolve();1!==b.allGeometryData.length&&y.warn("Node with",b.allGeometryData.length,"geometries is unsupported");return this._addData(a,b.attributeDataInfo,function(){return d._transformNode(a,b).then(function(b){return d._controller.reschedule(a.index,
b)}).then(function(c){a.obb||(a.obb=c.obb,a.isComputedObb=!0,d._controller.updateVisibility(a.index));b.allGeometryData[0].componentOffsets=c.componentOffsets;c.featureIds&&(b.allGeometryData[0].featureIds=Array.prototype.slice.call(c.featureIds));c={geometryData:b.allGeometryData[0],transformedGeometries:c.transformedGeometries,requiredTextures:b.requiredTextures,textureData:b.textureData,nodeVersion:a.version,nodeObb:a.obb,byteSize:d._cachingEnabled()?U(c.transformedGeometries,b.textureData):0};
if(V(a,c)&&d._idbCache.initialized){var e=k.isSome(c.textureData)?c.textureData.map(function(a){return T(a)?a:null}):null;d._idbCache.put(d._getCacheKey(a),I({},c,{textureData:e})).catch(function(b){return y.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)})}return d._addCachedNodeData(a,c)})})};c.prototype._transformNode=function(a,b){for(var d=this,c=b.allGeometryData[0].geometries,f=Array(c.length),h=0;h<c.length;++h)f[h]=this._getVertexBufferLayout(c[h],b.geometryIndex);var q={geometryBuffer:b.geometryBuffer,
geometryData:b.allGeometryData[0],geometryIndex:b.geometryIndex,layouts:f,mbs:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",q,{transferList:[b.geometryBuffer]}):O.ensureDracoDecoder(q).then(function(){return d._controller.reschedule(a.index,
q).then(function(a){return d._worker.transform(a)})})};c.prototype.addCachedGPUData=function(a,b,d){this._controller.isGeometryVisible(a)?(k.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,b),this._addNodeMeta(a.index,b),this.updateNodeStatus(a.index,d),this._collection.setObjectVisibility(b.objectHandle,!0),this._updateMaterial(b),this._updateEngineObject(b),this._highlights.objectCreated(b),this._treeDebugger&&this._treeDebugger.update()):(d=this._controller.indexDepth-a.level,this._memCache.put(this._getMemCacheKey(a.index),
b,a.memory,d))};c.prototype.addCachedNodeData=function(a,b,d){var c=this;return this._addData(a,d,function(){return c._addCachedNodeData(a,b)})};c.prototype._addCachedNodeData=function(a,b){var d=this;if(this.suspended||!this._controller.isGeometryVisible(a))return r.resolve();var c=b.geometryData,f=b.transformedGeometries,h=k.isSome(b.textureData)?b.textureData.filter(function(a){return k.isSome(a)&&0!==(a.usage&d.rendererTextureUsage)}):null;a.memory=0;var q=c.componentOffsets,u=c.geometries,c=
c.featureIds,g=null,m=null;if(this._hasSymbolColors)for(var g=this._componentColorManager.getBuffer(c.length),m=new Uint16Array(c.length),p=0;p<c.length;p++)m[p]=g.acquireIndex();var x=this._collection,u=u[0],f=f[0],n=this._materialParameters(u,f.layout),q=q||new Uint16Array([0,f.indices?f.indices.length:f.interleavedVertexData.byteLength/f.layout[0].stride]),q={vertices:{data:f.interleavedVertexData,count:f.interleavedVertexData.byteLength/f.layout[0].stride,layoutParameters:n.geometryParams},positionData:{positions:f.positionData.data,
indices:f.positionData.indices},indices:f.indices,primitiveType:4,componentOffsets:q},m=u.transformation?M.mat4f64.clone(u.transformation):M.mat4f64.create();L.mat4.multiply(m,f.corMatrices.globalTrafo,m);var g=L.mat4.getTranslation(ma.vec3f64.create(),m),m=ka.mat3.fromMat4(la.mat3f32.create(),m),l=x.createObject({geometry:q,obb:a.renderObb,transform:{position:g,rotationScale:m},visible:!1}),q=k.isSome(h)?h.map(function(b){return d._createTexture(a,n.material,b,2===n.geometryParams.textureCoordinates)}):
[];this._configureMaterial(l,u.params.material,q,h);a.memory+=this.memEstimateGeometryAdded(l);var h=this._addTasks.get(a.index),t=new Ga;t.node=a;t.featureIds=c;t.objectHandle=l;t.cachedRendererVersion=this._getInvalidRendererVersion();t.attributeInfo=h.attributeInfo;t.material={alphaMode:u.params.material.alphaMode,isSchematic:u.params.material.isSchematic};t.textures=q;h.meta=t;!this._hasTextures&&b.requiredTextures.some(function(a){return 0!==(a.usage&19)})&&(this._hasTextures=!0);this._hasData=
!0;this._hasColors=this._hasColors||f.hasColors;this._hasTextures=this._hasTextures||!!a.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var v=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(t).then(function(b){var c=d._addTasks.get(a.index);if(c)if(k.isSome(d._labeler)&&d._addMetaToLabeler(d._labeler,t),d._addNodeMeta(a.index,t),d.suspended)d._removeNodeStageData(a.index,d.elevationOffset);else{x.setObjectVisibility(l,!0);t.attributeInfo=c.attributeInfo;var c=t.cachedRendererVersion!==
d._rendererVersion,e=v!==d.slicePlaneEnabled;d._setObjectSymbology(t);var f=d._applyFiltersToNode(t);(c||b&&(e||f))&&d._addOrUpdateEdgeRendering(t);d.visibleGeometryChanged(t);d._highlights.objectCreated(t);d._updateMaterial(t);d._markParentsAsHole(a.index);d._treeDebugger&&d._treeDebugger.update()}})};c.prototype._addNodeMeta=function(a,b){this._nodeId2Meta.has(a)&&(y.error("Removing duplicated node"),this._deleteComponentObject(this._nodeId2Meta.get(a)));this._nodeId2Meta.set(a,b)};c.prototype._materialParameters=
function(a,b){a=a.params.material;var d=b.some(function(a){return"uvRegion"===a.name});b=b.some(function(a){return"normalCompressed"===a.name});var c=S(a);return{geometryParams:this._getGeometryParameters({hasTexture:c,hasNormals:b,hasRegions:d}),material:a}};c.prototype._configureMaterial=function(a,b,d,c){var e=this,h=this.rendererTextureUsage,q=function(a){if(0!==(a&h))a:{if(!k.isNone(c))for(var b=0;b<c.length;b++){var e=c[b];if(k.isSome(e)&&0!==(e.usage&a)){a=d[b].id;break a}}a=null}else a=null;
return a};this._collection.updateMaterial(a,function(a){var d=e._isIntegratedMesh,c=b.metallicRoughness.baseColorFactor,f=C.clamp(b.metallicRoughness.baseColorFactor[3],0,1);a.baseColor=[c[0],c[1],c[2],f];a.objectOpacity=e.fullOpacity;a.roughnessFactor=b.metallicRoughness.roughnessFactor;a.metallicFactor=b.metallicRoughness.metallicFactor;a.emissiveFactor=b.emissiveFactor;a.reflectanceFactor=b.isSchematic?.2:.5;a.usePBR=e._usePBR(b.isSchematic);a.isIntegratedMesh=e._isIntegratedMesh;var c=e._stage.renderView.textureRepository,
h=q(1);h&&(a.baseColorTexture=new A.RenderTexture(c,h));if(h=q(2))a.metallicRoughnessTexture=new A.RenderTexture(c,h);if(h=q(16))a.emissionTexture=new A.RenderTexture(c,h);if(h=q(8))a.occlusionTexture=new A.RenderTexture(c,h);if(h=q(4))a.normalTexture=new A.RenderTexture(c,h);a.commonMaterialParameters.slicePlaneEnabled=e.slicePlaneEnabled;a.commonMaterialParameters.doubleSided=b.doubleSided;a.commonMaterialParameters.cullFace=b.cullFace;a.transparencyHint=null;d?(a.commonMaterialParameters.receiveAmbientOcclusion=
!1,a.transparencyHint=!1):1===e.fullOpacity*f&&"blend"!==b.alphaMode?a.transparencyHint=!1:"blend"===b.alphaMode&&(a.transparencyHint=!0)})};c.prototype._getGeometryParameters=function(a){return{textureCoordinates:a.hasTexture?a.hasRegions?2:1:0,colors:this._hasVertexColors,normals:a.hasNormals&&!this._isIntegratedMesh}};c.prototype._addData=function(a,b,d){var c=this,f=this._addTasks.get(a.index);f?f.attributeInfo=b:(f=I({},r.createResolver(),{attributeInfo:b,meta:null}),this._addTasks.set(a.index,
f),d().then(f.resolve,f.reject).then(function(){return c._addTasks.delete(a.index)}).catch(function(b){c._addTasks.delete(a.index);throw b;}));return f.promise};c.prototype._clearAddTasks=function(){var a=this;this._addTasks.forEach(function(b){k.isSome(b.meta)&&a._deleteComponentObject(b.meta)});this._addTasks.clear()};c.prototype._markParentsAsHole=function(a){if(this._isIntegratedMesh){var b=this._controller;for(a=b.getParentIndex(a);a;a=b.getParentIndex(a))this.updateNodeStatus(a,"hole")}};c.prototype._clippingAreaChanged=
function(){var a=z.create();F.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?this._clippingArea=a:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};c.prototype._filterChange=function(){this._applyFilters(!1)};c.prototype._applyFilters=function(a){var b=this;this._filters=this.getFilters();a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(a){b._applyFiltersToNode(a)&&
(b._addOrUpdateEdgeRendering(a),b.visibleGeometryChanged(a))})};c.prototype.getFilters=function(){var a=this,b=[];this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,c,a._clippingArea)});return b};c.prototype.addSqlFilter=function(a,b,c,e){var d=this;b&&c&&a.push(function(a,f){return d._sqlFilter(a,f,b,c,e)})};c.prototype._sqlFilter=function(a,b,c,e,f){var d={},q=this._createLayerGraphic(d),g=this.layer.objectIdField,k=b.featureIds,m=b.attributeInfo.attributeData;e.every(function(a){return null!=
m[a]||a===g})&&n.filterInPlace(a,k,function(a){d[g]=k[a];for(var b=0;b<e.length;b++){var h=e[b];h!==g&&(d[h]=n.getCachedAttributeValue(m[h],a))}try{return c.testFeature(q)}catch(Ha){return f(Ha),!1}})};c.prototype._boundingboxNodeTest=function(a,b){F.mbsToMbs(a.node.mbs,this._controller.crsIndex,X,this.view.renderSpatialReference);return n.intersectBoundingBoxWithMbs(b,X)};c.prototype._boundingboxFeatureTest=function(a,b,c){return z.intersects(c,this._collection.getComponentAABB(a.objectHandle,b,
Ia))};c.prototype._boundingboxFilter=function(a,b,c){var d=this,f=this._collection,h=this._boundingboxNodeTest(b,c);if(3!==h)if(0===h)a.length=0;else if(f=f.getComponentCount(b.objectHandle),f.invisible+f.visible===b.featureIds.length){var g=this._transformAABB(Ja,c,b.objectHandle);n.filterInPlace(a,b.featureIds,function(a){return d._boundingboxFeatureTest(b,a,g)})}};c.prototype._transformAABB=function(a,b,c){var d=this._collection.getObjectTransform(c);c=d.position;d=d.rotationScale;a[0]=(b[0]-c[0])/
d[0];a[1]=(b[1]-c[1])/d[4];a[2]=(b[2]-c[2])/d[8];a[3]=(b[3]-c[0])/d[0];a[4]=(b[4]-c[1])/d[4];a[5]=(b[5]-c[2])/d[8];return a};c.prototype._addOrUpdateEdgeRendering=function(a,b){void 0===b&&(b=!0);if(!this._edgeView)return r.resolve();var c=a.objectHandle,e=this._edgeView.hasObject(c);a=this._extractObjectEdgeMaterials(a);var f=a.perFeatureEdgeMaterials,h={slicePlaneEnabled:this.slicePlaneEnabled};if(a.hasEdges)return e?(this._edgeView.updateAllComponentMaterials(c,f,h,b),this._edgeView.updateObjectVisibility(c,
!0),r.resolve(!0)):this._collection.addEdges(c,this._edgeView,f,h).then(function(){return!0});e&&this._edgeView.removeObject(c);return r.resolve(!1)};c.prototype._removeEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&this._edgeView.removeObject(a.objectHandle)};c.prototype._applyFiltersToNode=function(a){return this._applyFiltersToNodeComponents(a)?(k.isSome(this._labeler)&&this._labeler.applyFilterChange(a),!0):!1};c.prototype._applyFiltersToNodeComponents=function(a){var b=
this._collection,c=0===b.getComponentCount(a.objectHandle).invisible;b.setAllComponentVisibilities(a.objectHandle,"all");if(0===this._filters.length)return a.filteredIds=null,!c;this._updateCachedFilteredIds(a);if(a.filteredIds===a.featureIds)return!c;c=this._computeFilteredComponentIndices(a);b.setAllComponentVisibilities(a.objectHandle,c);return!0};c.prototype._updateCachedFilteredIds=function(a){if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),
a.appliedFilters=this._filters};c.prototype._computeFilteredIds=function(a){for(var b=a.featureIds.slice(),c=0,e=this._filters;c<e.length&&((0,e[c])(b,a),0!==b.length);c++);return b.length===a.featureIds.length?a.featureIds:b};c.prototype._computeFilteredComponentIndices=function(a){var b=[];a.featureIds.forEach(function(c,e){a.filteredIds[b.length]===c&&b.push(e)});return b};c.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,
e){return b._removeNodeStageData(e,a)})};c.prototype.removeNodeData=function(a,b){for(var c=this.elevationOffset;0<a.length&&!b.done;){var e=a.pop();this._removeNodeStageData(e,c);b.madeProgress()}};c.prototype._removeNodeStageData=function(a,b){var c=this._nodeId2Meta.get(a);if(c){this._collection.setObjectVisibility(c.objectHandle,!1);this.visibleGeometryChanged(c);this._removeEdgeRendering(c);k.isSome(this._labeler)&&this._labeler.removeNodeMeta(c);this._nodeId2Meta.delete(a);this._highlights.objectDeleted(c);
var e=this._controller.indexDepth-c.node.level+1;this._memCache.put(this._getMemCacheKey(a,b),c,c.node.memory,e);this._treeDebugger&&this._treeDebugger.update()}};c.prototype._deleteComponentObject=function(a){this._edgeView&&this._edgeView.removeObject(a.objectHandle);this.memEstimateGeometryRemoved(a.objectHandle);this._collection.destroyObject(a.objectHandle);if(a.textures){var b=0;for(a=a.textures;b<a.length;b++){var c=a[b];this.memEstimateTextureRemoved(c);this._stage.remove(4,c.id)}}};c.prototype.updateNodeStatus=
function(a,b){(a=this._nodeId2Meta.get(a))&&this._collection.updateMaterial(a.objectHandle,function(a){a.polygonOffsetEnabled="hole"===b})};c.prototype._getInvalidRendererVersion=function(){return n.addWraparound(this._rendererVersion,-1)};c.prototype._rendererChange=function(a){return aa(this,void 0,void 0,function(){var b,c,e,f,h,g,k,l,m;return Z(this,function(d){switch(d.label){case 0:this._currentRenderer=a;this.notifyChange("rendererTextureUsage");this._rendererVersion=n.addWraparound(this._rendererVersion,
1);this._opacityVariable=this._colorVariable=this._rendererFields=null;if(!a)return[3,2];b=this;c=n.findFieldsCaseInsensitive;return[4,a.getRequiredFields(this.layer.fields)];case 1:b._rendererFields=c.apply(void 0,[d.sent(),this.layer.fields]),d.label=2;case 2:if(!(!this._arcade&&a&&"arcadeRequired"in a&&a.arcadeRequired))return[3,4];e=this;return[4,qa.loadArcade()];case 3:e._arcade=d.sent(),d.label=4;case 4:if(a&&"visualVariables"in a&&a.visualVariables)for(f=0,h=a.visualVariables;f<h.length;f++)g=
h[f],"color"===g.type?this._colorVariable=g:"opacity"===g.type?this._opacityVariable=g:y.warn("Unsupported visual variable type for 3D Object Scene Services: "+g.type);if(a)for(k=0,l=a.getSymbols();k<l.length;k++)m=l[k],"mesh-3d"!==m.type&&y.error("Symbols of type '"+m.type+"' are not supported for 3D Object Scene Services.");this._controller&&this._controller.requestUpdate();return[2]}})})};c.prototype._getSymbolInfos=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(a);return a.cachedSymbolInfos};c.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return function(b,c){b*=5;na.vec4.set(c.externalColor,a.cachedSymbolColors[b+0]/255,a.cachedSymbolColors[b+1]/255,a.cachedSymbolColors[b+2]/255,a.cachedSymbolColors[b+3]/255);c.externalColorMixMode=a.cachedSymbolColors[b+4]&3;c.castShadows=0!==(a.cachedSymbolColors[b+4]&16)}};c.prototype._updateCachedRendererData=
function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var b={},c=this._currentRenderer,e=a.attributeInfo.attributeData,f=null!=a.featureIds?this.layer.objectIdField:null,h=null!=e?this._rendererFields:null;a.cachedSymbolColors||(a.cachedSymbolColors=new Uint8Array(5*a.featureIds.length));for(var g=0,l=0;l<a.featureIds.length;l++){var w=this._tmpAttributeOnlyGraphic;w.attributes=b;null!=f&&(b[f]=a.featureIds[l]);if(null!=h)for(var m=0,p=h;m<p.length;m++){var x=p[m];e[x]&&
(b[x]=n.getCachedAttributeValue(e[x],l))}p=c&&c.getSymbol(w,{arcade:this._arcade});m=null;p instanceof ra&&(this._symbolInfos.has(p.id)||this._symbolInfos.set(p.id,n.getSymbolInfo(p)),m=this._symbolInfos.get(p.id));a.cachedSymbolInfos[l]=m;var x=p=null,r=!0,v=1;c&&"visualVariables"in c&&(this._colorVariable&&(r=N.getColor(this._colorVariable,w,{color:Ka,arcade:this._arcade}))&&(p=G,p[0]=r.r/255,p[1]=r.g/255,p[2]=r.b/255,this._opacityVariable||null===r.a||(x=r.a)),this._opacityVariable&&(x=N.getOpacity(this._opacityVariable,
w,{arcade:this._arcade})));m&&m.material&&(w=m.material,p=k.isNone(p)||k.isNone(x)?P.overrideColor(p,x,w.color,w.alpha,W,G):P.overrideColor(p,x,null,null,W,G),v=Aa.parseColorMixMode(w.colorMixMode));r=m?m.castShadows:!0;a.cachedSymbolColors[g+0]=k.isSome(p)?Math.round(255*p[0]):255;a.cachedSymbolColors[g+1]=k.isSome(p)?Math.round(255*p[1]):255;a.cachedSymbolColors[g+2]=k.isSome(p)?Math.round(255*p[2]):255;a.cachedSymbolColors[g+3]=k.isSome(p)?Math.round(255*p[3]):255;a.cachedSymbolColors[g+4]=v|+r<<
4;g+=5}}};c.prototype._extractObjectEdgeMaterials=function(a){var b=a.objectHandle,c=a.featureIds?a.featureIds.length:1,e=Array(c),f=Q.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),h={opacity:this.fullOpacity,objectTransparency:2};this._collection.updateMaterial(b,function(a){h.objectTransparency=a.hasVisibleComponents?a.hasTransparency?1:2:0});var g=!1,l=null,n=null,m=this._getSymbolInfos(a);for(a=0;a<c;a++)e[a]=f;this._collection.forEachVisibleComponent(b,function(a){var b=m[a];if(!b)return!0;
n!==b&&(n=b,(l=Q.createMaterialFromEdges(b.edges,h))&&(g=!0));e[a]=k.isSome(l)?l:f;return!0});return{hasEdges:g,perFeatureEdgeMaterials:e}};c.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors){var b=a.objectHandle,c=this._getSymbolColors(a);this._collection.setComponentData(b,c);this._stage.renderView.setNeedsRender();this._updateEdgeRendering(a)}};c.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};
c.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(c){b._collection.updateMaterial(c.objectHandle,function(d){return b._updateMaterialOpacity(d,c.material,a)});b._updateEdgeRendering(c)})};c.prototype._updateMaterial=function(a){var b=this;this._collection.updateMaterial(a.objectHandle,function(c){c.commonMaterialParameters.slicePlaneEnabled=b.slicePlaneEnabled;c.usePBR=b._usePBR(a.material.isSchematic);b._updateMaterialOpacity(c,a.material,b.fullOpacity)})};c.prototype._updateMaterialOpacity=
function(a,b,c){a.objectOpacity=c;this._isIntegratedMesh||"blend"===b.alphaMode||(a.transparencyHint=1===c*a.baseColor[3]?!1:null)};c.prototype._updateEngineObject=function(a){this._setObjectSymbology(a);this._applyFiltersToNode(a);this._addOrUpdateEdgeRendering(a);this.visibleGeometryChanged(a)};c.prototype._slicePlaneEnabledChange=function(a){var b=this;this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=a);k.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=a);this._nodeId2Meta.forEach(function(c){b._collection.updateMaterial(c.objectHandle,
function(b){b.commonMaterialParameters.slicePlaneEnabled=a});b._updateEdgeRendering(c,!1)})};c.prototype._updatePBR=function(){var a=this;this._nodeId2Meta.forEach(function(b){a._collection.updateMaterial(b.objectHandle,function(c){c.usePBR=a._usePBR(b.material.isSchematic)})})};c.prototype._usePBR=function(a){return!this._isIntegratedMesh&&(a?this.view.qualitySettings.physicallyBasedRenderingEnabled:!0)};c.prototype._updateEdgeRendering=function(a,b){void 0===b&&(b=!0);this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&
this._addOrUpdateEdgeRendering(a,b)};c.prototype._forAllFeatures=function(a,b,c){var d=this;void 0===c&&(c=0);J.someMap(this._nodeId2Meta,function(e){if(k.isSome(b))switch(b(e)){case 0:return!0;case 2:return!1}var f=1;switch(c){case 1:f=d._forAllFeaturesOfNode(e,a);break;case 0:f=d._forVisibleFeaturesOfNode(e,a);break;case 2:f=d._forAllFeaturesOfNodeInClippingArea(e,a)}return 0===f})};c.prototype._forAllFeaturesOfNode=function(a,b){for(var c=1,e=a.featureIds,f=0;f<e.length&&(c=b(e[f],f,a),0!==c);f++);
return c};c.prototype._forVisibleFeaturesOfNode=function(a,b){var c=1,e=a.featureIds;this._collection.forEachVisibleComponent(a.objectHandle,function(d){c=b(e[d],d,a);return 1===c});return c};c.prototype._forAllFeaturesOfNodeInClippingArea=function(a,b){if(null==this._clippingArea)return this._forAllFeaturesOfNode(a,b);var c=this._boundingboxNodeTest(a,this._clippingArea);if(0===c)return 1;if(3===c)return this._forAllFeaturesOfNode(a,b);for(var c=a.featureIds,e=n.getClipAABB(this._clippingArea,this._collection.getObjectTransform(a.objectHandle)),
f=0;f<c.length;f++)if(this._boundingboxFeatureTest(a,f,e)){var g=b(c[f],f,a);if(0===g)return g}return 1};c.prototype._createAttributes=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);b=b.attributeInfo.attributeData;if(null!=b)for(var e=0,f=Object.keys(b);e<f.length;e++){var g=f[e];c[g]=n.getCachedAttributeValue(b[g],a)}return c};c.prototype._createGraphic=function(a,b){return this._createLayerGraphic(this._createAttributes(a,b))};c.prototype.highlight=function(a,
b){var c=this;void 0===b&&(b={});var e=this._highlights;"number"===typeof a?a=[a]:a instanceof B?a=[a]:a instanceof ca&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof B){a=a.map(function(a){return D.attributeLookup(a.attributes,c._getObjectIdField())});var f=e.acquireSet(b);b=f.set;f=f.handle;e.setFeatureIds(b,a);return f}if("number"===typeof a[0])return f=e.acquireSet(b),b=f.set,f=f.handle,e.setFeatureIds(b,a),f}return La};c.prototype.visibleGeometryChanged=function(a){var b=
this;this._elevationProvider&&(this._elevationProvider.objectChanged(a.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=ga.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null})))};c.prototype.test=function(){var a=this;return{controller:this._controller,get visibleObjectIds(){var b=[];a._forAllFeatures(function(a){b.push(a);return 1},null,0);b.sort(function(a,b){return a-b});return b},get numNodes(){return a._nodeId2Meta.size}}};
l([g.property()],c.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);l([g.property()],c.prototype,"view",void 0);l([g.property()],c.prototype,"layer",void 0);l([g.property()],c.prototype,"_controller",void 0);l([g.property()],c.prototype,"_labeler",void 0);l([g.property({dependsOn:["updatingMeshView3D"]})],c.prototype,"updating",void 0);l([g.property({dependsOn:["_controller.updating","_visibleGeometryChangedSchedulerHandle","_labeler.updating"]})],c.prototype,"updatingMeshView3D",null);
l([g.property({dependsOn:["_controller.rootNodeVisible"]})],c.prototype,"suspended",void 0);l([g.property(za.updatingProgress)],c.prototype,"updatingProgress",void 0);l([g.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],c.prototype,"updatingProgressValue",void 0);l([g.property({readOnly:!0})],c.prototype,"hasTexturesOrVertexColors",null);l([g.property({readOnly:!0})],c.prototype,"rendererTextureUsage",null);l([g.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],c.prototype,
"elevationOffset",null);l([g.property({type:Boolean})],c.prototype,"slicePlaneEnabled",void 0);l([g.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],c.prototype,"uncompressedTextureDownsamplingEnabled",null);l([g.property({dependsOn:["layer.version"]})],c.prototype,"useCompressedTextures",null);return c=l([g.subclass("esri.views.3d.layers.I3SMeshView3D")],c)}(g.declared(v))};var Ia=z.create(),Ja=z.create(),G=[0,0,0,0],Ka=new ba([0,
0,0,0]),X=[0,0,0,0],La={remove:function(){},pause:function(){},resume:function(){}}});