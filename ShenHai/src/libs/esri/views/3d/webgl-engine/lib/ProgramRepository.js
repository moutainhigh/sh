// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define(["require","exports","../core/shaderTechnique/CommonUniformStore","../../../webgl/programUtils"],function(f,g,d,e){return function(){function c(a,b){void 0===b&&(b="");this._rctx=a;this._shaderPrefix=b;this._programCacheByTemplate=new Map;this._commonUniformStore=new d.CommonUniformStore;this._programRefCount=[]}Object.defineProperty(c.prototype,"context",{get:function(){return this._rctx},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});
this._programRefCount=this._programCacheByTemplate=null;this._commonUniformStore.dispose();this._rctx=null};c.prototype.getProgram=function(a,b){var c=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(b){return e.createProgram(c._rctx,a,b,c._shaderPrefix)});return this.getProgramTemplateInstance(a,b)};c.prototype.addProgramTemplate=function(a,b){this._programCacheByTemplate.set(a,{constructor:b,programs:new Map})};c.prototype.getProgramTemplateInstance=function(a,b){if(a=
this._programCacheByTemplate.get(a)){var c=b?JSON.stringify(b):"default";a.programs.has(c)||(b=a.constructor(b),a.programs.set(c,b));return a.programs.get(c)}return null};c.prototype.getProgramsUsingUniform=function(a){return this._commonUniformStore.getPrograms(a)};c.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:(this._programRefCount[b]=1,this._commonUniformStore.subscribeProgram(a))};c.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?
this._programRefCount[b]--:(this._commonUniformStore.unsubscribeProgram(a),this._programRefCount[b]=0)};return c}()});