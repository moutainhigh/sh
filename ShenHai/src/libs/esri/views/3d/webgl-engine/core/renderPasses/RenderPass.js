// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../core/PooledArray"],function(k,q,r){Object.defineProperty(q,"__esModule",{value:!0});k=function(){function d(g,a){this._rctx=g;this._techniqueRepository=a;this._draws=new r({initialSize:32,allocator:function(a){return a||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}d.prototype.submitDraw=function(g,
a,d,h,m){var e=this._draws.pushNew();e.geometry=a;e.geometryRanges=d;e.material=g;e.bindDrawParams=h;e.depthSquaredHint=m;e.indexType=a.indexed?a.vao.indexBuffer.indexType:0};d.prototype.dispatch=function(d){var a=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();for(var g=null,k={repository:this._techniqueRepository},m=this._draws.length,e=0;e<m;e++){var b=this._draws.data[e],l=b.geometry,c=b.material.getTechnique(k,d,l.parameters);
this._passBoundTechniques.has(c)||(c.bindPass(a,d),this._passBoundTechniques.add(c));a.bindVAO(l.vao);c!==g&&(a.bindProgram(c.program),a.setPipelineState(c.pipeline),g=c);this._previouslyBoundMaterials.get(c)!==b.material&&(c.bindMaterial(a,b.material),this._previouslyBoundMaterials.set(c,b.material));this._previouslyBoundDraw.get(c)!==b.bindDrawParams&&(c.bindDraw(b.bindDrawParams),this._previouslyBoundMaterials.set(c,b.material));if(0!==b.indexType)for(var c=h.get(b.indexType),f=0;f<b.geometryRanges.length;f+=
2){var n=b.geometryRanges[f],p=b.geometryRanges[f+1];a.drawElements(l.primitiveType,p,b.indexType,n*c)}else for(f=0;f<b.geometryRanges.length;f+=2)n=b.geometryRanges[f],p=b.geometryRanges[f+1],a.drawArrays(l.primitiveType,n,p)}};d.prototype.prepareSubmit=function(){this._draws.clear()};d.prototype.finishSubmit=function(){this._draws.sort(function(d,a){return d.depthSquaredHint-a.depthSquaredHint})};Object.defineProperty(d.prototype,"count",{get:function(){return this._draws.length},enumerable:!0,
configurable:!0});return d}();q.RenderPass=k;var h=new Map;h.set(5121,1);h.set(5123,2);h.set(5125,4)});