// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/compilerUtils ../../core/mathUtils ../../core/screenUtils ./InputHandler ./InputManager".split(" "),function(r,l,v,w,x,m,y,z){function t(e){return!!u[e]}function A(e){for(var b=0;b<e.length;b++)if(!t(e[b]))return!1;return!0}Object.defineProperty(l,"__esModule",{value:!0});l.eventTypes="click double-click immediate-click hold drag key-down key-up pointer-down pointer-move pointer-up pointer-drag mouse-wheel pointer-enter pointer-leave gamepad focus blur".split(" ");
var u={};l.eventTypes.forEach(function(e){u[e]=!0});r=function(){function e(b){this.handlers=new Map;this.counter=0;this.handlerCounts=new Map;this.view=b;this.inputManager=null}e.prototype.connect=function(b){var a=this;b&&this.disconnect();this.inputManager=b;this.handlers.forEach(function(c,f){return a.inputManager.installHandlers(f,[c.handler],c.priority)})};e.prototype.disconnect=function(){var b=this;this.inputManager&&this.handlers.forEach(function(a,c){return b.inputManager.uninstallHandlers(c)});
this.inputManager=null};e.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};e.prototype.on=function(b,a,c,f){var g=this,d=Array.isArray(b)?b:b.split(",");if(!A(d))return d.some(t)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;var k;Array.isArray(a)?b=a:(k=a,b=[]);"function"===typeof c?k=c:f=c;f=null!=f?f:z.ViewEventPriorities.DEFAULT;var h=this.createUniqueGroupName();c=new B(this.view,d,b,
k);this.handlers.set(h,{handler:c,priority:f});for(k=0;k<d.length;k++)b=d[k],a=this.handlerCounts.get(b)||0,this.handlerCounts.set(b,a+1);this.inputManager&&this.inputManager.installHandlers(h,[c],f);return{remove:function(){return g.removeHandler(h,d)}}};e.prototype.hasHandler=function(b){return!!this.handlerCounts.get(b)};e.prototype.removeHandler=function(b,a){if(this.handlers.has(b)){this.handlers.delete(b);for(var c=0;c<a.length;c++){var f=a[c],g=this.handlerCounts.get(f);void 0===g?console.error("Trying to remove handler for event that has no handlers registered: ",
f):1===g?this.handlerCounts.delete(f):this.handlerCounts.set(f,g-1)}}this.inputManager&&this.inputManager.uninstallHandlers(b)};e.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return e}();l.ViewEvents=r;var B=function(e){function b(a,c,f,b){var d=e.call(this,!0)||this;d.view=a;for(a=0;a<c.length;a++){var g=c[a];switch(g){case "click":d.registerIncoming("click",f,function(a){return b(d.wrapClick(a))});break;case "double-click":d.registerIncoming("double-click",
f,function(a){return b(d.wrapDoubleClick(a))});break;case "immediate-click":d.registerIncoming("immediate-click",f,function(a){return b(d.wrapImmediateClick(a))});break;case "hold":d.registerIncoming("hold",f,function(a){return b(d.wrapHold(a))});break;case "drag":d.registerIncoming("drag",f,function(a){(a=d.wrapDrag(a))&&b(a)});break;case "key-down":d.registerIncoming("key-down",f,function(a){return b(d.wrapKeyDown(a))});break;case "key-up":d.registerIncoming("key-up",f,function(a){return b(d.wrapKeyUp(a))});
break;case "pointer-down":d.registerIncoming("pointer-down",f,function(a){return b(d.wrapPointer(a,"pointer-down"))});break;case "pointer-move":d.registerIncoming("pointer-move",f,function(a){return b(d.wrapPointer(a,"pointer-move"))});break;case "pointer-up":d.registerIncoming("pointer-up",f,function(a){return b(d.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":d.registerIncoming("pointer-drag",f,function(a){return b(d.wrapPointerDrag(a))});break;case "mouse-wheel":d.registerIncoming("mouse-wheel",
f,function(a){return b(d.wrapMouseWheel(a))});break;case "pointer-enter":d.registerIncoming("pointer-enter",f,function(a){return b(d.wrapPointer(a,"pointer-enter"))});break;case "pointer-leave":d.registerIncoming("pointer-leave",f,function(a){return b(d.wrapPointer(a,"pointer-leave"))});break;case "gamepad":d.registerIncoming("gamepad",f,function(a){b(d.wrapGamepad(a))});break;case "focus":d.registerIncoming("focus",f,function(a){b(d.wrapFocus(a))});break;case "blur":d.registerIncoming("blur",f,function(a){b(d.wrapBlur(a))});
break;default:w.neverReached(g)}}return d}v(b,e);b.prototype.wrapFocus=function(a){return{type:"focus",timestamp:a.timestamp,native:a.data.native,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapBlur=function(a){return{type:"blur",timestamp:a.timestamp,native:a.data.native,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};
b.prototype.wrapClick=function(a){var c=a.data,b=c.pointerType,g=c.button,d=c.buttons,e=c.x,h=c.y,l=c.native,c=c.eventId,C=a.cancelable,p=a.timestamp,n=m.createScreenPoint(e,h),q=this.view.toMap(n);return{type:"click",pointerType:b,button:g,buttons:d,x:e,y:h,native:l,timestamp:p,screenPoint:n,mapPoint:q,eventId:c,cancelable:C,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapDoubleClick=function(a){var c=a.data,b=c.x,g=c.y,
d=c.eventId,e=a.cancelable;return{type:"double-click",pointerType:c.pointerType,button:c.button,buttons:c.buttons,x:b,y:g,native:c.native,timestamp:a.timestamp,mapPoint:this.view.toMap(m.createScreenPoint(b,g)),eventId:d,cancelable:e,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapImmediateClick=function(a){var c=a.data,b=c.x,g=c.y,d=c.native,e=c.eventId,h=a.cancelable;return{type:"immediate-click",pointerId:d.pointerId,
pointerType:c.pointerType,button:c.button,buttons:c.buttons,x:b,y:g,native:d,timestamp:a.timestamp,mapPoint:this.view.toMap(m.createScreenPoint(b,g)),eventId:e,cancelable:h,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapHold=function(a){var c=a.data,b=c.x,e=c.y,d=a.cancelable;return{type:"hold",pointerType:c.pointerType,button:c.button,buttons:c.buttons,x:b,y:e,native:c.native,timestamp:a.timestamp,mapPoint:this.view.toMap(m.createScreenPoint(b,
e)),cancelable:d,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapDrag=function(a){var c=a.data,b=c.center,e=b.x,b=b.y,d=c.action,k=c.pointerType,h=c.button;"start"===d&&(this.latestDragStart=c);if(this.latestDragStart){var l=c.pointer.native,m=c.buttons,p=a.cancelable,n=a.timestamp,q={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};"end"===d&&(this.latestDragStart=void 0);return{type:"drag",action:d,x:e,
y:b,origin:q,pointerType:k,button:h,buttons:m,radius:c.radius,angle:x.rad2deg(c.angle),native:l,timestamp:n,cancelable:p,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}}};b.prototype.wrapKeyDown=function(a){var c=a.data;return{type:"key-down",key:c.key,repeat:c.repeat,native:c.native,timestamp:a.timestamp,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};
b.prototype.wrapKeyUp=function(a){var c=a.data;return{type:"key-up",key:c.key,native:c.native,timestamp:a.timestamp,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapPointer=function(a,c){var b=a.data,e=b.native;return{type:c,x:b.x,y:b.y,pointerId:e.pointerId,pointerType:e.pointerType,button:b.button,buttons:b.buttons,native:e,timestamp:a.timestamp,eventId:b.eventId,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},
preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapPointerDrag=function(a){var c=a.data.currentEvent;return{type:"pointer-drag",x:c.x,y:c.y,pointerId:a.data.startEvent.native.pointerId,pointerType:a.data.startEvent.native.pointerType,button:a.data.startEvent.button,buttons:c.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},native:c.native,timestamp:a.timestamp,eventId:c.eventId,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},
preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapMouseWheel=function(a){var c=a.data;return{type:"mouse-wheel",x:c.x,y:c.y,deltaY:c.deltaY,native:c.native,timestamp:a.timestamp,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};b.prototype.wrapGamepad=function(a){var c=a.data,b=c.state;return{type:"gamepad",device:c.device,timestamp:a.timestamp,action:c.action,buttons:b.buttons,axes:b.axes,cancelable:a.cancelable,
stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};return b}(y.InputHandler)});