// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry/support/aaBoundingRect ../featureConversionUtils ../OptimizedGeometry ./QueryEngine ./utils".split(" "),function(I,p,J,K,L,z,a,F,x,A){function B(b,c,r,C,u,l){b.lengths.length&&(b.lengths.length=0);b.coords.length&&(b.coords.length=0);if(!c||!c.coords.length)return null;var k=c.coords;c=c.lengths;if(!c.length)return b.coords[0]=a.quantizeX(l,k[0]),
b.coords[1]=a.quantizeY(l,k[1]),b.coords.length=r,b;for(var e,g,f,n,m=0,h,d=0,y=0;y<c.length;y++){var D=c[y];if(!(D<C)){h=d;f=e=a.quantizeX(l,k[m]);n=g=a.quantizeY(l,k[m+1]);b.coords[h]=f;b.coords[h+1]=n;m+=r;f=a.quantizeX(l,k[m]);n=a.quantizeY(l,k[m+1]);var v=f-e,q=n-g,w=q/v;h+=2;b.coords[h]=v;b.coords[h+1]=q;e=f;g=n;for(var m=m+r,p=2;p<D;p++){f=a.quantizeX(l,k[m]);n=a.quantizeY(l,k[m+1]);if(f!==e||n!==g){e=f-e;g=n-g;var t=g/e;w!==t&&(isFinite(w)||isFinite(t))||!(u||(isFinite(t)?0<=w&&0<=t||0>=w&&
0>=t:0<=q&&0<=g||0>=q&&0>=g))?(v=e,q=g,h+=2):(v+=e,q+=g);b.coords[h]=v;b.coords[h+1]=q;w=t;e=f;g=n}m+=r}f=(h+2-d)/2;f>=C&&(b.lengths.push(f),d=h+2)}}b.coords.length>d&&(b.coords.length=d);return b.coords.length?b:null}Object.defineProperty(p,"__esModule",{value:!0});var E=new F.default,G={esriGeometryPoint:a.convertToPoint,esriGeometryPolyline:a.convertToPolyline,esriGeometryPolygon:a.convertToPolygon,esriGeometryMultipoint:a.convertToMultipoint};p.executeTileQueryForIds=function(b,c,r){c=z.pad(c.bounds,
r.pixelBuffer*c.resolution,z.create());var a=[];b.featureStore.forEachInBounds(c,function(c){return a.push(b.featureAdapter.getObjectId(c))});return a};p.createTileFeatures=function(b,c,a,p,u,l,k,e,g){var f=G[a.geometryType],n=H[a.geometryType],m="esriGeometryPolygon"===a.geometryType&&!e,h=a.hasZ?a.hasM?4:3:a.hasM?3:2;k&&!l?p.forEachInBounds(u,function(d){if(!c.has(d.objectId)){var f=A.getCentroid(a,d,g),h=d.attributes;f&&(c.add(d.objectId),b.push(new x.Feature(h,d.localId,null,f)))}}):l&&!k?p.forEachInBounds(u,
function(a){if(!c.has(a.objectId)){var d=a.attributes,e=f(B(E,a.geometry,h,n,m,g),!1,!1);e&&(c.add(a.objectId),b.push(new x.Feature(d,a.localId,e,null)))}}):p.forEachInBounds(u,function(d){if(!c.has(d.objectId)){var e=A.getCentroid(a,d,g),l=d.attributes,k=f(B(E,d.geometry,h,n,m,g),!1,!1);k&&e&&(c.add(d.objectId),b.push(new x.Feature(l,d.localId,k,e)))}})};var H={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0}});