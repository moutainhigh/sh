// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISImageService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../geometry ../../Graphic ../../rasterRenderers ../../request ../../core/Error ../../core/jsonMap ../../core/lang ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../support/commonProperties ../support/DimensionalDefinition ../support/ExportImageServiceParameters ../support/Field ../support/FieldsIndex ../support/imageryRendererUtils ../support/MosaicRule ../support/PixelBlock ../support/RasterFunction ../support/RasterInfo ../support/RasterJobHandler ../support/rasterFormats/RasterCodec ../../renderers/support/RasterSymbolizer ../../tasks/ImageServiceIdentifyTask ../../tasks/QueryTask ../../tasks/support/FeatureSet ../../tasks/support/ImageServiceIdentifyParameters ../../tasks/support/Query".split(" "),
function(y,m,u,f,k,r,d,a,c,p,e,b,l,h,g,t,v,n,q,E,A,F,C,z,x,w,B,H,G,D,L,J,P,I,M,X,N,V){function O(a){return a?JSON.stringify(a).match(/"rasterFunction":"(.*?")/gi).map(function(a){return a.replace('"rasterFunction":"',"").replace('"',"")}).join("/"):null}Object.defineProperty(m,"__esModule",{value:!0});var oa=g.getLogger("esri.layers.mixins.ArcGISImageService"),za=l.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),ka=
l.strict()({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"}),W=l.strict()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"});m.ArcGISImageService=function(g){return function(g){function l(){var a=null!==g&&g.apply(this,arguments)||this;a._functionRasterInfos={};a._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};a._symbolizer=null;a._defaultServiceMosaicRule=null;a.rasterAttributeTableFieldPrefix=
"Raster.";a.adjustAspectRatio=null;a.bandCount=null;a.bandIds=void 0;a.capabilities=null;a.compressionQuality=void 0;a.compressionTolerance=.01;a.copyright=null;a.definitionExpression=null;a.exportImageServiceParameters=null;a.rasterInfo=null;a.fields=null;a.fullExtent=null;a.hasMultidimensions=!1;a.imageMaxHeight=4100;a.imageMaxWidth=4100;a.interpolation=void 0;a.multidimensionalInfo=null;a.noData=null;a.noDataInterpretation=void 0;a.objectIdField=null;a.pixelSizeX=null;a.pixelSizeY=null;a.pixelFilter=
null;a.raster=void 0;a.viewId=void 0;a.renderer=null;a.rasterAttributeTable=null;a.rasterFunctionInfos=null;a.serviceDataType=null;a.spatialReference=null;a.pixelType=null;a.serviceRasterInfo=null;a.sourceJSON=null;a.url=null;a.version=null;return a}f(l,g);l.prototype.initialize=function(){this._set("exportImageServiceParameters",new C.ExportImageServiceParameters({layer:this}))};l.prototype.readDefaultServiceMosaicRule=function(a,b){return B.fromJSON(b)};Object.defineProperty(l.prototype,"rasterFunctionNamesIndex",
{get:function(){var a=new Map;if(!this.rasterFunctionInfos||1>this.rasterFunctionInfos.length)return a;this.rasterFunctionInfos.forEach(function(b){a.set(b.name.toLowerCase().replace(/ /gi,"_"),b.name)});return a},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"queryTask",{get:function(){return new M({url:this.url})},enumerable:!0,configurable:!0});l.prototype.readCapabilities=function(a){return a&&a.split(",").map(function(a){return a.trim()})};l.prototype.writeCompressionQuality=
function(a,b,g){null!=a&&"lerc"!==this.format&&(b[g]=a)};l.prototype.writeCompressionTolerance=function(a,b,g){"lerc"===this.format&&null!=a&&(b[g]=a)};Object.defineProperty(l.prototype,"fieldsIndex",{get:function(){return this.fields?new x(this.fields):null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"format",{get:function(){return this._get("format")||(null!=this.pixelFilter?"lerc":"jpgpng")},set:function(a){a&&-1<"png png8 png24 png32 jpg bmp jpgpng lerc tiff".split(" ").indexOf(a.toLowerCase())&&
this._set("format",a.toLowerCase())},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"mosaicRule",{set:function(a){a&&a.mosaicMethod&&(a=B.fromJSON(u({},a.toJSON(),{mosaicMethod:a.mosaicMethod,mosaicOperation:a.mosaicOperation})));this._set("mosaicRule",a)},enumerable:!0,configurable:!0});l.prototype.readMosaicRule=function(a,b){return B.fromJSON(a||b.mosaicRule||b)};l.prototype.writeMosaicRule=function(a,b,g){a=this.mosaicRule;var e=this.definitionExpression;a?e&&e!==a.where&&(a=
a.clone(),a.where=e):e&&(a=new B({where:e}));this._isValidCustomizedMosaicRule(a)&&(b[g]=a.toJSON())};l.prototype.writeNoData=function(a,b,g){null!=a&&"number"===typeof a&&(b[g]=a)};l.prototype.readObjectIdField=function(a,b){a||(a=(a=b.fields.filter(function(a){return"esriFieldTypeOID"===a.type||"oid"===a.type}))&&a[0]&&a[0].name);return a};Object.defineProperty(l.prototype,"parsedUrl",{get:function(){return this.url?n.urlToObject(this.url):null},enumerable:!0,configurable:!0});l.prototype.readRenderer=
function(a,b,g){a=p.read(b&&b.layerDefinition&&b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.renderer,g)||void 0;if(null!=a)return w.isSupportedRendererType(a)||oa.warn("ArcGISImageService","Imagery layer doesn't support given renderer type."),a};Object.defineProperty(l.prototype,"rasterFields",{get:function(){var a=this.rasterAttributeTableFieldPrefix||"Raster.",b=new z({name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"string"}),g=new z({name:"Raster.ServicePixelValue",
alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),e=new z({name:"Raster.ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),c=this.fields?h.clone(this.fields):[];c.push(g);this.capabilities&&this.capabilities.some(function(a){return"catalog"===a.toLowerCase()})&&this.fields&&0<this.fields.length&&c.push(b);10.4<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.some(function(a){return"none"===a.name.toLowerCase()})&&
c.push(e);this.rasterFunctionInfos&&this.rasterFunctionInfos.filter(function(a){return"none"!==a.name.toLowerCase()}).forEach(function(a){c.push(new z({name:"Raster.ServicePixelValue."+a.name,alias:a.name,domain:null,editable:!1,length:50,type:"string"}))});null==this.pixelFilter||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(c.push(new z({name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"double"})),
c.push(new z({name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"double"})));(b=this.rasterInfo.attributeTable&&this.rasterInfo.attributeTable.fields||null)&&0<b.length&&(b=b.filter(function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}).map(function(b){var g=h.clone(b);g.name=a+b.name;return g}),c=c.concat(b));return c},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=G.fromJSON(u({},
a.toJSON(),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));this._set("renderingRule",a)},enumerable:!0,configurable:!0});l.prototype.readRenderingRule=function(a,b){a=b.rasterFunctionInfos;return b.renderingRule||a&&a.length&&"None"!==a[0].name?G.fromJSON(b.renderingRule||{rasterFunctionInfos:b.rasterFunctionInfos}):null};l.prototype.writeRenderingRule=function(a,b,g){this._isRFTJson(a)||(b[g]=a.toJSON())};l.prototype.readSpatialReference=function(b,g){return(b=
b||g.extent.spatialReference)?a.SpatialReference.fromJSON(b):null};l.prototype.readPixelType=function(a){return W.fromJSON(a)||a};l.prototype.writePixelType=function(a,b,g){if(t.isNone(this.serviceRasterInfo)||this.pixelType!==this.serviceRasterInfo.pixelType)b[g]=W.toJSON(a)};l.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("fields")||b.hasOwnProperty("timeInfo")?10:9.3);return a};l.prototype.applyFilter=function(a){var b=a;this.pixelFilter&&(b=this._clonePixelData(a),
this.pixelFilter(b));return b};l.prototype.applyRenderer=function(a,b){return d(this,void 0,void 0,function(){var g,e,c,n;return r(this,function(h){switch(h.label){case 0:g=a;if(this._isPicture()||!this.renderer||!this._symbolizer||this.pixelFilter)return[3,5];e=JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer.toJSON());c=this._rasterJobHandler.instance;if(!c)return[3,4];if(!e)return[3,2];this._cachedRendererJson=this.renderer.toJSON();this._symbolizer.bind();return[4,c.updateSymbolizer(this._symbolizer,
b)];case 1:h.sent(),h.label=2;case 2:return[4,c.symbolize(a.pixelBlock,b)];case 3:return n=h.sent(),g={extent:a.extent,pixelBlock:n},[3,5];case 4:g={extent:a.extent,pixelBlock:this._symbolizer.symbolize(a.pixelBlock)},h.label=5;case 5:return[2,g]}})})};l.prototype.destroy=function(){this._shutdownJobHandler()};l.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++};l.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--;0>=this._rasterJobHandler.refCount&&
this._shutdownJobHandler()};l.prototype.fetchImage=function(a,g,e,c){var n=this;void 0===c&&(c={});if(null==a||null==g||null==e)return v.reject(new b("imagery-layer:fetch-image","Insufficient parameters for requesting an image. A valid extent, width and height values are required."));var h=this.renderer||this._symbolizer?this.generateRasterInfo(this.renderingRule,{signal:c.signal}):null;return v.when(h).then(function(b){b&&(n.rasterInfo=b);b={imageServiceParameters:n.getExportImageServiceParameters(a,
g,e,c.timeExtent),imageProps:{extent:a,width:g,height:e,format:n.format},requestAsImageElement:c.requestAsImageElement&&!n.pixelFilter||!1,signal:c.signal};return n._requestArrayBuffer(b)})};l.prototype.fetchKeyProperties=function(a){a=a&&a.renderingRule&&a.renderingRule.toJSON();return e(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):null})}).then(function(a){return a.data})};l.prototype.fetchRasterAttributeTable=function(a){a=
a&&a.renderingRule&&a.renderingRule.toJSON();return 10.1>this.version?v.reject(new b("#fetchRasterAttributeTable()","Failed to get rasterAttributeTable")):e(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):null})}).then(function(a){return X.fromJSON(a.data)})};l.prototype.getCatalogItemRasterInfo=function(b,g){return d(this,void 0,void 0,function(){var c,n,h,p,l;return r(this,function(d){switch(d.label){case 0:return c=
e(this.parsedUrl.path+"/"+b+"/info",u({query:this._getQueryParams(),responseType:"json"},g)).then(function(a){return a.data}),n=e(this.parsedUrl.path+"/"+b+"/info/keyProperties",u({query:this._getQueryParams(),responseType:"json"},g)).then(function(a){return a.data}).catch(function(){}),[4,v.all([c,n])];case 1:h=d.sent();if(!h[0])return[2,void 0];p=a.Extent.fromJSON(h[0].extent);l=h[0].statistics?h[0].statistics.map(function(a){return{min:a[0],max:a[1],avg:a[2],stddev:a[3]}}):null;return[2,new D({bandCount:h[0].bandCount,
extent:p,spatialReference:p.sr,pixelSize:new a.Point({x:h[0].pixelSizeX,y:h[0].pixelSizeY,spatialReference:p.sr}),pixelType:h[0].pixelType.toLowerCase(),statistics:l,histograms:h[0].histograms,keyProperties:h[1]})]}})})};l.prototype.getCatalogItemICSInfo=function(b,g){return d(this,void 0,void 0,function(){var c,h,n,p,l,d,t,q,f,k,E,A,w,B,z,F,C,x,H,m,D,pa,G,L,ca,y,W,R,K;return r(this,function(r){switch(r.label){case 0:return[4,e(this.parsedUrl.path+"/"+b+"/info/ics",u({query:this._getQueryParams(),
responseType:"json"},g))];case 1:h=(c=r.sent().data)&&c.ics;if(!h)return[2,void 0];n=10.7<=this.version?e(this.parsedUrl.path+"/"+b+"/info/icstopixel",u({query:this._getQueryParams(),responseType:"json"},g)).then(function(a){return a.data}).catch(function(){return{}}):{};p=h.extent.spatialReference;if(!p)for(l in h.geodataXform)h.geodataXform[l].spatialReference&&(p=h.geodataXform[l].spatialReference);d={geometries:JSON.stringify({geometryType:"esriGeometryEnvelope",geometries:[h.extent]}),inSR:p.wkid||
p,outSR:"0:"+b};t=e(this.parsedUrl.path+"/project",u({query:this._getQueryParams(d),responseType:"json"},g)).then(function(a){return a.data});q=5;f=(h.extent.xmin+h.extent.xmax)/2;k=(h.extent.ymax-h.extent.ymin)/(q+1);E=h.extent.ymin+k;A=[];for(w=0;w<q;w++)A.push({x:f,y:E+k*w});B={geometries:JSON.stringify({geometryType:"esriGeometryPoint",geometries:A}),inSR:p.wkid||p,outSR:"0:"+b};z=e(this.parsedUrl.path+"/project",u({query:this._getQueryParams(B),responseType:"json"},g)).then(function(a){return a.data});
return[4,v.all([n,t,z])];case 2:F=r.sent();C=F[0].ipxf;null==C&&(x=h.geodataXform&&h.geodataXform.xf_0)&&"topup"===x.name.toLowerCase()&&(C={affine:{name:"ics [sensor: Frame] to pixel (column, row) transformation",coefficients:x.coefficients,cellsizeRatio:0,type:"GeometricXform"}});if(H=a.Extent.fromJSON(F[1]&&F[1].geometries&&F[1].geometries[0]))H.spatialReference=new a.SpatialReference({wkid:0,imageCoordinateSystem:h});m=F[2].geometries.filter(function(a){return null!=a});D=m.length;for(w=ca=L=
G=pa=0;w<D;w++)pa+=m[w].x,G+=m[w].y,L+=m[w].x*m[w].x,ca+=m[w].x*m[w].y;y=(D*ca-pa*G)/(D*L-pa*pa);W=0;R=m[q-1].x>m[0].x;K=m[q-1].y>m[0].y;Infinity===y?W=K?90:270:0===y?W=R?0:180:0<y?W=R?180*Math.atan(y)/Math.PI:180*Math.atan(y)/Math.PI+180:0>y&&(W=K?180+180*Math.atan(y)/Math.PI:360+180*Math.atan(y)/Math.PI);return[2,{ics:h,icsToPixelTransform:C,icsExtent:H,northDirection:W}]}})})};l.prototype.generateRasterInfo=function(a,b){return d(this,void 0,void 0,function(){var g,e;return r(this,function(c){switch(c.label){case 0:if((!a||
"none"===a.functionName.toLowerCase())&&t.isSome(this.serviceRasterInfo))return[2,this.serviceRasterInfo];g=O(a);if(this._functionRasterInfos[g])return[2,this._functionRasterInfos[g]];e=this._generateRasterInfo(a,b);this._functionRasterInfos[g]=e;c.label=1;case 1:return c.trys.push([1,3,,4]),[4,e];case 2:return[2,c.sent()];case 3:return c.sent(),this._functionRasterInfos[g]=null,[2,null];case 4:return[2]}})})};l.prototype.getExportImageServiceParameters=function(a,b,g,e){a=a.clone().shiftCentralMeridian();
var c=a.spatialReference;if(c.imageCoordinateSystem)var h=c.imageCoordinateSystem,n=h.id,h=h.referenceServiceName,c=null!=n?h?-1<this.parsedUrl.path.toLowerCase().indexOf("/"+h.toLowerCase()+"/")?"0:"+n:JSON.stringify({icsid:n,icsns:h}):"0:"+n:JSON.stringify({ics:c.imageCoordinateSystem});else c=c.wkid||JSON.stringify(c.toJSON());t.isSome(this.serviceRasterInfo)&&this.pixelType!==this.serviceRasterInfo.pixelType&&(this.exportImageServiceParameters.pixelType=this.pixelType);var n=this.exportImageServiceParameters.toJSON(),
h=n.bandIds,p=n.noData,l=n.mosaicRule,d=n.renderingRule;h instanceof Array&&0<h.length&&(n.bandIds=h.join(","));p instanceof Array&&0<p.length&&(n.noData=p.join(","));var v=this.timeInfo;l&&l.multidimensionalDefinition&&e&&v&&v.startField&&(l.multidimensionalDefinition=l.multidimensionalDefinition.filter(function(a){return a.dimensionName!==v.startField}));n.mosaicRule=l&&JSON.stringify(l);n.renderingRule=d&&JSON.stringify(d);h={};if(e)if(p=e.toJSON(),e=p.start,p=p.end,e&&p&&e===p)h.time=""+e;else if(null!=
e||null!=p)h.time=(null==e?"null":e)+","+(null==p?"null":p);return u({bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,bboxSR:c,imageSR:c,size:b+","+g},n,h)};l.prototype.queryRasters=function(a){return this.queryTask.execute(a)};l.prototype.queryVisibleRasters=function(g,e){var c=this;if(!g)return v.reject(new b("imagery-layer: query-visible-rasters","missing query parameter"));var h=e||{pixelSize:null,returnDomainValues:!1,returnTopmostRaster:!1,showNoDataRecords:!1};e=h.pixelSize;var n=h.returnDomainValues,
p=h.returnTopmostRaster,l=h.showNoDataRecords,d=!1,t=h=null,q=this.rasterFunctionNamesIndex;if(g.outFields&&10.4<=this.version){var f=g.outFields.filter(function(a){return-1<a.toLowerCase().indexOf("raster.servicepixelvalue")&&24<a.length}).map(function(a){a=a.slice(25);return[c._updateRenderingRulesFunctionName(a,q),a]}),h=f.map(function(a){return new G({functionName:a[0]})}),t=f.map(function(a){return a[1]}),d=g.outFields.some(function(a){return-1===a.toLowerCase().indexOf("raster.servicepixelvalue")});
0===h.length&&(h=null)}var k=!g.outSpatialReference||g.outSpatialReference.equals(this.spatialReference);e=this._getQueryParams({geometry:g.geometry,timeExtent:g.timeExtent,mosaicRule:this.exportImageServiceParameters.mosaicRule,renderingRule:this.renderingRule,renderingRules:h,pixelSize:e,returnCatalogItems:d,returnGeometry:k,maxItemCount:p?1:null});delete e.f;var E=new N(e),A=new I({url:this.url}),w=this.generateRasterInfo(this.renderingRule);return v.create(function(e){w.then(function(){A.execute(E).then(function(h){var p=
g.outFields;if(d&&!k&&h.catalogItems&&h.catalogItems.features&&0<h.catalogItems.features.length){var v=c.objectIdField||"ObjectId",q=h.catalogItems.features,f=q.map(function(a){return a.attributes&&a.attributes[v]}),f=new V({objectIds:f,returnGeometry:!0,outSpatialReference:g.outSpatialReference,outFields:[v]});return c.queryRasters(f).then(function(b){b&&b.features&&0<b.features.length&&b.features.forEach(function(b){q.forEach(function(e){e.attributes[v]===b.attributes[v]&&(e.geometry=new a.Polygon(b.geometry),
e.geometry.spatialReference=g.outSpatialReference)})});e(c._processVisibleRastersResponse(h,{returnDomainValues:n,templateRRFunctionNames:t,showNoDataRecords:l,templateFields:p}))}).catch(function(){throw new b("imagery-layer:query-visible-rasters","encountered error when querying visible rasters geometry");})}e(c._processVisibleRastersResponse(h,{returnDomainValues:n,templateRRFunctionNames:t,showNoDataRecords:l,templateFields:p}))}).catch(function(){throw new b("imagery-layer:query-visible-rasters",
"encountered error when querying visible rasters");})})})};l.prototype._fetchService=function(a){return d(this,void 0,void 0,function(){var b,g,c,h,n,p,l=this;return r(this,function(d){switch(d.label){case 0:return(b=this.sourceJSON)?[3,2]:[4,e(this.parsedUrl.path,{query:this._getQueryParams(),responseType:"json",signal:a})];case 1:g=d.sent(),c=g.data,h=g.ssl,this.sourceJSON=b=c,h&&(this.url=this.url.replace(/^http:/i,"https:")),d.label=2;case 2:return this.read(b,{origin:"service",url:this.parsedUrl}),
t.isSome(this.serviceRasterInfo)&&!this.rasterInfo&&(this.rasterInfo=this.serviceRasterInfo),n=t.isSome(this.serviceRasterInfo)?v.resolve(this.serviceRasterInfo):this._fetchAuxiliaryRasterInfo({serviceInfo:b,signal:a}).then(function(a){l._set("serviceRasterInfo",a);return a}),p=this.renderingRule&&"none"!==this.renderingRule.functionName.toLowerCase()?this.generateRasterInfo(this.renderingRule,{signal:a}):null,[2,v.all([n,p]).then(function(a){a[1]?l._set("rasterInfo",a[1]):l._set("rasterInfo",a[0]);
l._configDefaultRenderer();l.watch("renderer",function(){return l._configDefaultRenderer()});l.watch("renderingRule",function(a){(l.renderer||l._symbolizer||l.popupEnabled&&l.popupTemplate)&&l.generateRasterInfo(a).then(function(a){a&&(l.rasterInfo=a)})});(a=t.isSome(l.serviceRasterInfo)&&l.serviceRasterInfo.multidimensionalInfo)&&l._updateMultidimensionalDefinition(a)})]}})})};l.prototype._initJobHandler=function(){return d(this,void 0,void 0,function(){var a,b=this;return r(this,function(g){switch(g.label){case 0:if(null!=
this._rasterJobHandler.connectionPromise)return[2,this._rasterJobHandler.connectionPromise];a=new L;this._rasterJobHandler.connectionPromise=a.initialize().then(function(){b._rasterJobHandler.instance=a},function(){return null});return[4,this._rasterJobHandler.connectionPromise];case 1:return g.sent(),[2]}})})};l.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();this._rasterJobHandler.instance=null;this._rasterJobHandler.connectionPromise=
null;this._rasterJobHandler.refCount=0};l.prototype._isPicture=function(){return!this.format||-1<this.format.indexOf("jpg")||-1<this.format.indexOf("png")};l.prototype._configDefaultRenderer=function(){if(!this._isPicture()&&!this.pixelFilter){if(!this.bandIds&&3<=this.rasterInfo.bandCount){var a=w.getDefaultBandCombination(this.rasterInfo);!a||3===this.rasterInfo.bandCount&&0===a[0]&&1===a[1]&&2===a[2]||(this.bandIds=a)}this.renderer||(this.renderer=w.createDefaultRenderer(this.rasterInfo,this.bandIds));
this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=this.rasterInfo):this._symbolizer=new P({renderer:this.renderer,rasterInfo:this.rasterInfo});this._symbolizer.bind()||(this._symbolizer=null)}};l.prototype._clonePixelData=function(a){return null==a?a:{extent:a.extent&&a.extent.clone(),pixelBlock:a.pixelBlock&&a.pixelBlock.clone()}};l.prototype._getQueryParams=function(a){return u({raster:this.raster,viewId:this.viewId,f:"json"},a)};l.prototype._decodePixelBlock=
function(a,b,g){return this._rasterJobHandler.instance?this._rasterJobHandler.instance.decode({data:a,options:b}):J.decode(a,b,g)};l.prototype._fetchAuxiliaryRasterInfo=function(g){var c=g&&g.serviceInfo;if(!c)return v.reject(new b("imagery-layer:fetch-metadata","valid serviceInfo is required"));var h=g.renderingRule?JSON.stringify(g.renderingRule.toJSON()):null,n=g.signal;g=c.hasRasterAttributeTable&&10.1<=this.version?e(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.1<=
this.version?h:null}),signal:n}).then(function(a){return X.fromJSON(a.data)}).catch(function(){return null}):!1;var p=c.hasColormap&&10.1<=this.version?e(this.parsedUrl.path+"/colormap",{query:this._getQueryParams({renderingRule:10.6<=this.version?h:null}),signal:n}).then(function(a){return a.data&&a.data.colormap}):!1,l=c.hasHistograms&&10.1<=this.version?e(this.parsedUrl.path+"/histograms",{query:this._getQueryParams({renderingRule:10.1<=this.version?h:null}),signal:n}).then(function(a){return a.data&&
a.data.histograms}):!1,h=10.3<=this.version?e(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:h}),signal:n}).then(function(a){return a.data}).catch(function(){}):!1,n=c.hasMultidimensions&&10.3<=this.version?e(this.parsedUrl.path+"/multidimensionalInfo",{query:this._getQueryParams(),signal:n}).then(function(a){return a.data&&a.data.multidimensionalInfo}):!1;return v.all([g,p,l,h,n]).then(function(b){var g=null;if(c.minValues&&c.minValues.length===c.bandCount)for(var g=
[],e=0;e<c.minValues.length;e++)g.push({min:c.minValues[e],max:c.maxValues[e],avg:c.meanValues[e],stddev:c.stdvValues[e]});e=a.SpatialReference.fromJSON(c.spatialReference||c.extent.spatialReference);return new D({bandCount:c.bandCount,extent:a.Extent.fromJSON(c.extent),spatialReference:e,pixelSize:new a.Point({x:c.pixelSizeX,y:c.pixelSizeY,spatialReference:e}),pixelType:c.pixelType.toLowerCase(),statistics:g,attributeTable:b[0]||null,colormap:b[1]||null,histograms:b[2]||null,keyProperties:b[3]||
null,multidimensionalInfo:b[4]||null})})};l.prototype._requestArrayBuffer=function(a){var g=this,c=a.imageProps,h=a.signal;if(a.requestAsImageElement&&!this.pixelFilter&&c.format&&-1<c.format.indexOf("png"))return e(this.parsedUrl.path+"/exportImage",{responseType:"image",query:this._getQueryParams(u({f:"image"},a.imageServiceParameters)),signal:h}).then(function(a){return{imageElement:a.data,params:c}});var n=this._initJobHandler();a=e(this.parsedUrl.path+"/exportImage",{responseType:"array-buffer",
query:this._getQueryParams(u({f:"image"},a.imageServiceParameters)),signal:h});return v.all([a,n]).then(function(a){a=a[0].data;var e=c.format||"jpgpng",n=e;"bsq"!==n&&"bip"!==n&&(n=J.getFormat(a));if(!n)throw new b("imagery-layer:fetch-image","unsupported format signature "+String.fromCharCode.apply(null,new Uint8Array(a)));var n=-1<e.indexOf("png")&&("png"===n||"jpg"===n),p={signal:h};return n?J.decode(a,u({useCanvas:!0},c),p).then(function(a){return{pixelData:{pixelBlock:a,extent:c.extent},params:c}}):
g._decodePixelBlock(a,{width:c.width,height:c.height,planes:null,pixelType:null,noDataValue:null,format:e},p).then(function(a){return{pixelData:{pixelBlock:a,extent:c.extent},params:c}})})};l.prototype._generateRasterInfo=function(a,b){return d(this,void 0,void 0,function(){var g,c;return r(this,function(h){switch(h.label){case 0:return[4,e(this.parsedUrl.path,u({query:this._getQueryParams({renderingRule:a}),responseType:"json"},b))];case 1:return g=h.sent().data,[4,this._fetchAuxiliaryRasterInfo(u({serviceInfo:g,
renderingRule:a},b))];case 2:return c=h.sent(),[2,c]}})})};l.prototype._isValidCustomizedMosaicRule=function(a){return a&&JSON.stringify(a.toJSON())!==JSON.stringify(this._defaultServiceMosaicRule&&this._defaultServiceMosaicRule.toJSON())};l.prototype._updateMultidimensionalDefinition=function(a){if(!this._isValidCustomizedMosaicRule(this.mosaicRule)){var b=a.variables[0].dimensions;a=[];for(var g in b)if(b.hasOwnProperty(g)){var e=b[g],c=e.extent,h=!0,n=[c[0]];e.hasRanges&&!0===e.hasRanges?(h=!1,
n=[e.values[0]]):"stdz"===e.name.toLowerCase()&&Math.abs(c[1])<=Math.abs(c[0])&&(n=[c[1]]);a.push(new F({variableName:"",dimensionName:b[g].name,isSlice:h,values:n}))}0<a.length&&(this.mosaicRule=this.mosaicRule||new B,g=this.mosaicRule.multidimensionalDefinition,!g||g&&0>=g.length)&&(this.mosaicRule.multidimensionalDefinition=a)}};l.prototype._processVisibleRastersResponse=function(a,b){b=b||{};var g=a.value,e=b.templateRRFunctionNames,h=b.showNoDataRecords,n=b.returnDomainValues,p=b.templateFields;
b=a.processedValues;var l=a.catalogItems&&a.catalogItems.features,d=a.properties&&a.properties.Values&&a.properties.Values.map(function(a){return a.replace(/ /gi,", ")})||[],v=this.objectIdField||"ObjectId";a=-1<g.toLowerCase().indexOf("nodata");var t=[];!g||l||a||(l={},l[v]=0,l=new c(this.fullExtent,null,l),d=[g],l=[l]);if(!l)return[];this._updateResponseFieldNames(l,p);for(var q,v=0;v<l.length;v++){p=l[v];if(null!=g&&!a){q=d[v];if("nodata"===q.toLowerCase()&&!h)continue;p.attributes["Raster.ItemPixelValue"]=
q;p.attributes["Raster.ServicePixelValue"]=g;this._updateFeatureWithMagDirValues(p,q);this._updateFeatureWithRasterAttributeTableValues(p,this.renderingRule?g:q)}p.sourceLayer=this;n&&this._updateFeatureWithDomainValues(p);if(e&&b&&e.length===b.length)for(q=0;q<e.length;q++)p.attributes["Raster.ServicePixelValue."+e[q]]=b[q];t.push(l[v])}return t};l.prototype._updateFeatureWithRasterAttributeTableValues=function(a,b){var g=this,e=this.rasterInfo&&this.rasterInfo.attributeTable,c=e&&e.features;if(c){var e=
e.fields,h=e.map(function(a){return a.name}).filter(function(a){return"value"===a.toLowerCase()}),n=h&&h[0];if(n){var p=c.filter(function(a){return a.attributes[n]===(null!=b?parseInt(b,10):null)});p&&p[0]&&e.forEach(function(b){a.attributes[g.rasterAttributeTableFieldPrefix+b.name]=p[0].attributes[b.name]})}}};l.prototype._updateFeatureWithMagDirValues=function(b,g){if(this.pixelFilter&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)){var e=
g.replace(" ",",").split(",").map(function(a){return parseFloat(a)});g=e.map(function(a){return[a]});e=e.map(function(a){return{minValue:a,maxValue:a,noDataValue:null}});g=new H({height:1,width:1,pixelType:"f32",pixels:g,statistics:e});this.pixelFilter({pixelBlock:g,extent:new a.Extent(0,0,0,0,this.spatialReference)});b.attributes["Raster.Magnitude"]=g.pixels[0][0];b.attributes["Raster.Direction"]=g.pixels[1][0]}};l.prototype._updateFeatureWithDomainValues=function(a){var b=this.fields&&this.fields.filter(function(a){return a.domain&&
"coded-value"===a.domain.type});null!=b&&b.forEach(function(b){var g=a.attributes[b.name];if(null!=g){var e=b.domain.codedValues.filter(function(a){return a.code===g})[0];e&&(a.attributes[b.name]=e.name)}})};l.prototype._updateResponseFieldNames=function(a,b){if(b&&!(1>b.length)){var g=this.fieldsIndex;g&&a.forEach(function(a){if(a&&a.attributes)for(var e=0;e<b.length;e++){var c=b[e];if(g.has(c)){var h=g.get(c).name;h!==c&&(a.attributes[c]=a.attributes[h],delete a.attributes[h])}}})}};l.prototype._updateRenderingRulesFunctionName=
function(a,b){if(a&&!(1>a.length)){if("Raw"===a)return a.replace("Raw","None");var g=a.toLowerCase().replace(/ /gi,"_");return b.has(g)?b.get(g):a}};l.prototype._isRFTJson=function(a){return a.name&&a.arguments&&a.function&&a.hasOwnProperty("functionType")};k([q.property()],l.prototype,"_functionRasterInfos",void 0);k([q.property()],l.prototype,"_rasterJobHandler",void 0);k([q.property()],l.prototype,"_symbolizer",void 0);k([q.property()],l.prototype,"_defaultServiceMosaicRule",void 0);k([q.reader("_defaultServiceMosaicRule",
["defaultMosaicMethod"])],l.prototype,"readDefaultServiceMosaicRule",null);k([q.property()],l.prototype,"_cachedRendererJson",void 0);k([q.property()],l.prototype,"rasterAttributeTableFieldPrefix",void 0);k([q.property({readOnly:!0,dependsOn:["rasterFunctionInfos"]})],l.prototype,"rasterFunctionNamesIndex",null);k([q.property({readOnly:!0,dependsOn:["url"]})],l.prototype,"queryTask",null);k([q.property()],l.prototype,"adjustAspectRatio",void 0);k([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.bandCount")],
l.prototype,"bandCount",void 0);k([q.property({type:[E.Integer],json:{write:!0}})],l.prototype,"bandIds",void 0);k([q.property({readOnly:!0})],l.prototype,"capabilities",void 0);k([q.reader("capabilities")],l.prototype,"readCapabilities",null);k([q.property({type:Number})],l.prototype,"compressionQuality",void 0);k([q.writer("compressionQuality")],l.prototype,"writeCompressionQuality",null);k([q.property({type:Number})],l.prototype,"compressionTolerance",void 0);k([q.writer("compressionTolerance")],
l.prototype,"writeCompressionTolerance",null);k([q.property({json:{read:{source:"copyrightText"}}})],l.prototype,"copyright",void 0);k([q.property({type:String,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],l.prototype,"definitionExpression",void 0);k([q.property({readOnly:!0,constructOnly:!0})],l.prototype,"exportImageServiceParameters",void 0);k([q.property()],l.prototype,"rasterInfo",void 0);k([q.property({readOnly:!0,type:[z]})],
l.prototype,"fields",void 0);k([q.property({readOnly:!0,dependsOn:["fields"]})],l.prototype,"fieldsIndex",null);k([q.property({type:String,json:{write:!0}})],l.prototype,"format",null);k([q.property({type:a.Extent})],l.prototype,"fullExtent",void 0);k([q.property({readOnly:!0})],l.prototype,"hasMultidimensions",void 0);k([q.property({json:{read:{source:"maxImageHeight"}}})],l.prototype,"imageMaxHeight",void 0);k([q.property({json:{read:{source:"maxImageWidth"}}})],l.prototype,"imageMaxWidth",void 0);
k([q.property({type:String,json:{read:{reader:za.read},write:{writer:za.write}}})],l.prototype,"interpolation",void 0);k([q.property({type:B})],l.prototype,"mosaicRule",null);k([q.reader("mosaicRule",["mosaicRule","defaultMosaicMethod"])],l.prototype,"readMosaicRule",null);k([q.writer("mosaicRule")],l.prototype,"writeMosaicRule",null);k([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.multidimensionalInfo")],l.prototype,"multidimensionalInfo",void 0);k([q.property()],l.prototype,"noData",void 0);
k([q.writer("noData")],l.prototype,"writeNoData",null);k([q.property({type:String,json:{read:{reader:ka.read},write:{writer:ka.write}}})],l.prototype,"noDataInterpretation",void 0);k([q.property({type:String,readOnly:!0,json:{read:{source:["fields"]}}})],l.prototype,"objectIdField",void 0);k([q.reader("objectIdField")],l.prototype,"readObjectIdField",null);k([q.property({readOnly:!0,dependsOn:["url"]})],l.prototype,"parsedUrl",null);k([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.pixelSize.x")],
l.prototype,"pixelSizeX",void 0);k([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.pixelSize.y")],l.prototype,"pixelSizeY",void 0);k([q.property({type:Function})],l.prototype,"pixelFilter",void 0);k([q.property()],l.prototype,"raster",void 0);k([q.property()],l.prototype,"viewId",void 0);k([q.property({types:p.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],l.prototype,"renderer",void 0);k([q.reader("renderer")],
l.prototype,"readRenderer",null);k([q.property(A.opacityDrawingInfo)],l.prototype,"opacity",void 0);k([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.attributeTable")],l.prototype,"rasterAttributeTable",void 0);k([q.property({readOnly:!0,dependsOn:["fields","rasterInfo"]})],l.prototype,"rasterFields",null);k([q.property({readOnly:!0})],l.prototype,"rasterFunctionInfos",void 0);k([q.property({type:G})],l.prototype,"renderingRule",null);k([q.reader("renderingRule",["renderingRule","rasterFunctionInfos"])],
l.prototype,"readRenderingRule",null);k([q.writer("renderingRule")],l.prototype,"writeRenderingRule",null);k([q.property()],l.prototype,"serviceDataType",void 0);k([q.property({readOnly:!0,type:a.SpatialReference})],l.prototype,"spatialReference",void 0);k([q.reader("spatialReference",["spatialReference","extent"])],l.prototype,"readSpatialReference",null);k([q.property()],l.prototype,"pixelType",void 0);k([q.reader("pixelType")],l.prototype,"readPixelType",null);k([q.writer("pixelType")],l.prototype,
"writePixelType",null);k([q.property({constructOnly:!0,type:D})],l.prototype,"serviceRasterInfo",void 0);k([q.property()],l.prototype,"sourceJSON",void 0);k([q.property(A.url)],l.prototype,"url",void 0);k([q.property({readOnly:!0})],l.prototype,"version",void 0);k([q.reader("version",["currentVersion","fields","timeInfo"])],l.prototype,"readVersion",null);return l=k([q.subclass("esri.layers.mixins.ArcGISImageService")],l)}(q.declared(g))}})},"esri/rasterRenderers":function(){define("require exports ./core/Warning ./renderers/ClassBreaksRenderer ./renderers/RasterColormapRenderer ./renderers/RasterStretchRenderer ./renderers/UniqueValueRenderer".split(" "),
function(y,m,u,f,k,r,d){function a(a,e){if(!a)return null;var b;b=a?c[a.type]||null:null;if(b)return b=new b,b.read(a,e),b;e&&e.messages&&a&&e.messages.push(new u("renderer:unsupported","Renderers of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:e}));return null}Object.defineProperty(m,"__esModule",{value:!0});m.ClassBreaksRenderer=f;m.RasterColormapRenderer=k;m.RasterStretchRenderer=r;m.UniqueValueRenderer=d;m.rasterRendererTypes={key:"type",base:null,typeMap:{"unique-value":m.UniqueValueRenderer,
"class-breaks":m.ClassBreaksRenderer,"raster-colormap":m.RasterColormapRenderer,"raster-stretch":m.RasterStretchRenderer}};var c={uniqueValue:m.UniqueValueRenderer,classBreaks:m.ClassBreaksRenderer,rasterStretch:m.RasterStretchRenderer,rasterColormap:m.RasterColormapRenderer};m.read=a;m.fromJSON=function(c,e){return a(c,e)}})},"esri/renderers/RasterColormapRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/accessorSupport/decorators ./support/ColormapInfo ./support/colorRampUtils".split(" "),
function(y,m,u,f,k,r,d,a,c){return function(p){function e(a){a=p.call(this,a)||this;a.type="raster-colormap";return a}u(e,p);b=e;e.createFromColormap=function(e){if(!e)return null;var c=5===e[0].length;e=e.sort(function(a){return a[0]-a[1]});c=c?e.map(function(b){return a.fromJSON({value:b[0],color:b.slice(1,5),label:String(b[0])})}):e.map(function(b){return a.fromJSON({value:b[0],color:b.slice(1,4).concat([255]),label:String(b[0])})});return new b({colormapInfos:c})};e.createFromColorramp=function(a){a=
c.convertColorRampToColormap(a,256);return b.createFromColormap(a)};e.prototype.clone=function(){return new b({colormapInfos:this.colormapInfos.map(function(a){return a.toJSON()})})};e.prototype.extractColormap=function(){return this.colormapInfos.map(function(a){return[a.value,a.color.r,a.color.g,a.color.b,1<a.color.a?a.color.a:255*a.color.a&255]}).sort(function(a,b){return a[0]-b[0]})};var b;f([d.property({type:[a],json:{write:!0}})],e.prototype,"colormapInfos",void 0);f([d.enumeration.serializable()({rasterColormap:"raster-colormap"})],
e.prototype,"type",void 0);return e=b=f([d.subclass("esri.renderers.RasterColormapRenderer")],e)}(d.declared(r.JSONSupport))})},"esri/renderers/support/ColormapInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(y,m,u,f,k,r,d,a){return function(c){function p(){var a=null!==c&&c.apply(this,arguments)||this;
a.value=null;a.label=null;a.color=null;return a}u(p,c);f([a.property({type:Number,json:{write:!0}})],p.prototype,"value",void 0);f([a.property({type:String,json:{write:!0}})],p.prototype,"label",void 0);f([a.property({type:r,json:{write:!0}})],p.prototype,"color",void 0);return p=f([a.subclass("esri.renderers.support.ColormapInfo")],p)}(a.declared(d.JSONSupport))})},"esri/renderers/support/colorRampUtils":function(){define(["require","exports","../../Color","../../core/colorUtils"],function(y,m,u,
f){function k(a,c){if(!a||!c||a.length!==c.length)return!1;for(var p=0;p<a.length;p++)if(a[p]>c[p]+2||a[p]<c[p]-2)return!1;return!0}function r(a,c,p){a=f.toLAB(a);c=f.toLAB(c);return f.toRGB({l:a.l*(1-p)+p*c.l,a:a.a*(1-p)+p*c.a,b:a.b*(1-p)+p*c.b})}function d(a,c){if(a){c=c?c:m.PREDEFINED_JSON_COLOR_RAMPS;var p=null,e;"algorithmic"===a.type?c.some(function(b){if(k(a.fromColor.toRgb(),b.fromColor)&&k(a.toColor.toRgb(),b.toColor))return p=b.id,!0}):"multipart"===a.type&&c.some(function(b){if(a.colorRamps&&
b.colorRamps&&a.colorRamps.length===b.colorRamps.length&&(e=a.colorRamps,!b.colorRamps.some(function(a,b){if(!k(e[b].fromColor.toRgb(),(new u(a.fromColor)).toRgb())||!k(e[b].toColor.toRgb(),(new u(a.toColor)).toRgb()))return!0}))){if(p)return!0;p=b.id}});return p}}Object.defineProperty(m,"__esModule",{value:!0});m.PREDEFINED_JSON_COLOR_RAMPS=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,
181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,
100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,
70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",
colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,
186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,
181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],
toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,
38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,
30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,
143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,
14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",
fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,
245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",
type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,
255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,
255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,
224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}];m.PREDEFINED_COLOR_RAMP_NAME_MAP={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",
blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",
distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",
partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",
purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",
slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};
m.getColorRampId=d;m.getColorRampName=function(a){return(a=d(a))?m.PREDEFINED_COLOR_RAMP_NAME_MAP[a]:null};m.convertColorRampToColormap=function(a,c){if(a&&c){for(var p="multipart"===a.type?a.colorRamps.length:1,e=[],b=[],l,h,g,d,v,n=0,q=0;q<p;q++)e[q]={start:null,end:null},e[q].start=n,e[q].end=n+1/p,n=e[q].end;p=function(n){d=n/c;e.forEach(function(e,p){d>=e.start&&d<e.end&&(v=(d-e.start)/(e.end-e.start),"multipart"===a.type?(l=new u(a.colorRamps[p].fromColor),h=new u(a.colorRamps[p].toColor)):
(l=new u(a.fromColor),h=new u(a.toColor)),g=r(l,h,v),0===n?b.push([n,l.r,l.g,l.b]):n===c-1?b.push([n,h.r,h.g,h.b]):(g=r(l,h,v),b.push([n,g.r,g.g,g.b])))})};for(q=0;q<c;q++)p(q);return b}}})},"esri/core/colorUtils":function(){define(["require","exports"],function(y,m){function u(a,b){var e=[],c,g;if(a[0].length!==b.length)throw"dimensions do not match";var p=a.length,d=a[0].length,n=0;for(c=0;c<p;c++){for(g=n=0;g<d;g++)n+=a[c][g]*b[g];e.push(n)}return e}function f(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=
a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=u(c,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function k(a){a=u(p,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function r(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-
a[2])}}function d(a){var b=a.l;a=[(b+16)/116+a.a/500,(b+16)/116,(b+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function a(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var b=a.c,c=a.h;return k(d({l:a.l,a:b*Math.cos(c),b:b*Math.sin(c)}))}if("l"in a&&"a"in a&&"b"in a)return k(d(a));if("x"in a&&"y"in a&&"z"in a)return k(a);if("h"in a&&"s"in a&&"v"in a){c=(a.h+360)%360/60;b=a.v/100*
255;a=a.s/100*b;var e=a*(1-Math.abs(c%2-1));switch(Math.floor(c)){case 0:c={r:a,g:e,b:0};break;case 1:c={r:e,g:a,b:0};break;case 2:c={r:0,g:a,b:e};break;case 3:c={r:0,g:e,b:a};break;case 4:c={r:e,g:0,b:a};break;case 5:case 6:c={r:a,g:0,b:e};break;default:c={r:0,g:0,b:0}}c.r=Math.round(c.r+b-a);c.g=Math.round(c.g+b-a);c.b=Math.round(c.b+b-a);return c}}Object.defineProperty(m,"__esModule",{value:!0});var c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],p=[[3.2406,-1.5372,-.4986],[-.9689,
1.8758,.0415],[.0557,-.204,1.057]];m.toRGB=a;m.toHSV=function(c){if("h"in c&&"s"in c&&"v"in c)return c;var b=a(c);c=b.r;var e=b.g,b=b.b,h=Math.max(c,e,b),g=h-Math.min(c,e,b),p;0===g?p=0:h===c?p=(e-b)/g%6:h===e?p=(b-c)/g+2:h===b&&(p=(c-e)/g+4);0>p&&(p+=6);return{h:60*p,s:100*(0===g?0:g/h),v:100/255*h}};m.toLAB=function(c){return"l"in c&&"a"in c&&"b"in c?c:r(f(a(c)))};m.toLCH=function(c){if(!("l"in c&&"c"in c&&"h"in c)){var b=r(f(a(c)));c=b.l;var e=b.a,h=b.b,b=Math.sqrt(e*e+h*h),e=Math.atan2(h,e),e=
0<e?e:e+2*Math.PI;c={l:c,c:b,h:e}}return c};m.toXYZ=function(c){return"x"in c&&"y"in c&&"z"in c?c:f(a(c))}})},"esri/renderers/RasterStretchRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/stretchRendererUtils ../tasks/support/colorRamps".split(" "),function(y,m,u,f,k,r,d,a,c,p){return function(e){function b(a){a=e.call(this,
a)||this;a.colorRamp=null;a.computeGamma=!1;a.dynamicRangeAdjustment=!0;a.gamma=[];a.maxPercent=null;a.minPercent=null;a.numberOfStandardDeviations=null;a.outputMax=null;a.outputMin=null;a.sigmoidStrengthLevel=null;a.statistics=[];a.histograms=null;a.useGamma=!1;a.stretchType="none";a.type="raster-stretch";return a}u(b,e);l=b;b.prototype.readColorRamp=function(a){if(a)return p.fromJSON(a)};b.prototype.writeStatistics=function(a,b,c){null==a||0===a.length?a=null:a[0]instanceof Array||(a=a.map(function(a){return[a.min,
a.max,a.avg,a.stddev]}));b[c]=a};b.prototype.clone=function(){return new l({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:d.clone(this.statistics),gamma:d.clone(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,colorRamp:d.clone(this.colorRamp),histograms:d.clone(this.histograms),
dynamicRangeAdjustment:this.dynamicRangeAdjustment})};var l;f([a.property({types:p.types,json:{write:!0}})],b.prototype,"colorRamp",void 0);f([a.reader("colorRamp")],b.prototype,"readColorRamp",null);f([a.property({type:Boolean,json:{write:!0}})],b.prototype,"computeGamma",void 0);f([a.property({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],b.prototype,"dynamicRangeAdjustment",void 0);f([a.property({type:[Number],json:{write:{allowNull:!0}}})],b.prototype,"gamma",void 0);f([a.property({type:Number,
json:{write:{allowNull:!0}}})],b.prototype,"maxPercent",void 0);f([a.property({type:Number,json:{write:{allowNull:!0}}})],b.prototype,"minPercent",void 0);f([a.property({type:Number,json:{write:{allowNull:!0}}})],b.prototype,"numberOfStandardDeviations",void 0);f([a.property({type:Number,json:{read:{source:"max"},write:{target:"max",allowNull:!0}}})],b.prototype,"outputMax",void 0);f([a.property({type:Number,json:{read:{source:"min"},write:{target:"min",allowNull:!0}}})],b.prototype,"outputMin",void 0);
f([a.property({type:Number,json:{write:{allowNull:!0}}})],b.prototype,"sigmoidStrengthLevel",void 0);f([a.property({json:{write:{allowNull:!0}}})],b.prototype,"statistics",void 0);f([a.property()],b.prototype,"histograms",void 0);f([a.writer("statistics")],b.prototype,"writeStatistics",null);f([a.property({type:Boolean,json:{write:!0}})],b.prototype,"useGamma",void 0);f([a.property({type:c.stretchTypeJSONDict.apiValues,json:{type:c.stretchTypeJSONDict.jsonValues,read:c.stretchTypeJSONDict.read,write:c.stretchTypeJSONDict.write}})],
b.prototype,"stretchType",void 0);f([a.enumeration.serializable()({rasterStretch:"raster-stretch"})],b.prototype,"type",void 0);return b=l=f([a.subclass("esri.renderers.RasterStretchRenderer")],b)}(a.declared(r.JSONSupport))})},"esri/renderers/support/stretchRendererUtils":function(){define(["require","exports","../../core/jsonMap"],function(y,m,u){Object.defineProperty(m,"__esModule",{value:!0});m.stretchTypeJSONDict=new u.default({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",
minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"})})},"esri/layers/support/DimensionalDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(y,m,u,f,k,r,d,a){return function(c){function p(a){a=c.call(this,a)||this;a.variableName=null;a.dimensionName=null;a.values=[];a.isSlice=!1;return a}
u(p,c);e=p;p.prototype.clone=function(){return new e({variableName:this.variableName,dimensionName:this.dimensionName,values:r.clone(this.values),isSlice:this.isSlice})};var e;f([d.property({type:String,json:{write:!0}})],p.prototype,"variableName",void 0);f([d.property({type:String,json:{write:!0}})],p.prototype,"dimensionName",void 0);f([d.property({type:a.types.array(a.types.oneOf([a.types.native(Number),a.types.array(a.types.native(Number))])),json:{write:!0}})],p.prototype,"values",void 0);f([d.property({type:Boolean,
json:{write:!0}})],p.prototype,"isSlice",void 0);return p=e=f([d.subclass("esri.layers.support.DimensionalDefinition")],p)}(d.declared(k.JSONSupport))})},"esri/layers/support/ExportImageServiceParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators ./imageryRendererUtils ./MosaicRule".split(" "),function(y,m,u,f,k,r,
d,a,c,p){Object.defineProperty(m,"__esModule",{value:!0});var e=new r.default({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),b=new r.default({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"});y=function(d){function h(){var a=null!==d&&d.apply(this,arguments)||this;a.layer=null;a.adjustAspectRatio=void 0;a.bandIds=void 0;a.compression=void 0;a.compressionQuality=void 0;a.compressionTolerance=.01;a.format=null;a.interpolation=
null;a.noData=null;a.noDataInterpretation=void 0;a.pixelType=void 0;a.lercVersion=2;return a}f(h,d);h.prototype.writeAdjustAspectRatio=function(a,b,c){10.3>this.layer.version||(b[c]=a)};h.prototype.writeCompressionQuality=function(a,b,c){this.format&&-1<this.format.toLowerCase().indexOf("jpg")&&null!=a&&(b[c]=a)};h.prototype.writeCompressionTolerance=function(a,b,c){"lerc"===this.format&&null!=a&&(b[c]=a)};h.prototype.writeLercVersion=function(a,b,c){"lerc"===this.format&&10.5<=this.layer.version&&
(b[c]=a)};Object.defineProperty(h.prototype,"version",{get:function(){var a=this.layer;a.bandIds;a.format;a.compressionQuality;a.compressionTolerance;a.interpolation;a.noData;a.noDataInterpretation;a.mosaicRule;a.renderingRule;a.adjustAspectRatio;a.pixelFilter;a.renderer;a.definitionExpression;return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mosaicRule",{get:function(){var a=this.layer,b=a.mosaicRule,a=a.definitionExpression;
b?a&&a!==b.where&&(b=b.clone(),b.where=a):a&&(b=new p({where:a}));return b},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderingRule",{get:function(){var a=this.layer,b=a.renderingRule,c=a.pixelFilter;(!a.format||-1<a.format.indexOf("jpg")||-1<a.format.indexOf("png"))&&!c&&(b=this.combineRendererWithRenderingRule());return b},enumerable:!0,configurable:!0});h.prototype.combineRendererWithRenderingRule=function(){var a=this.layer,b=a.rasterInfo,e=a.renderingRule,n=a.renderer;
return n&&c.isSupportedRendererType(n)?c.combineRenderingRules(c.convertRendererToRenderingRule(n,{rasterAttributeTable:b.attributeTable,pixelType:b.pixelType,convertColorRampToColormap:10.6>a.version}),e):e};k([a.property()],h.prototype,"layer",void 0);k([a.property({json:{write:!0}})],h.prototype,"adjustAspectRatio",void 0);k([a.writer("adjustAspectRatio")],h.prototype,"writeAdjustAspectRatio",null);k([a.property({json:{write:!0}}),a.aliasOf("layer.bandIds")],h.prototype,"bandIds",void 0);k([a.property({json:{write:!0}})],
h.prototype,"compression",void 0);k([a.property({json:{write:!0}}),a.aliasOf("layer.compressionQuality")],h.prototype,"compressionQuality",void 0);k([a.writer("compressionQuality")],h.prototype,"writeCompressionQuality",null);k([a.property({json:{write:!0}}),a.aliasOf("layer.compressionTolerance")],h.prototype,"compressionTolerance",void 0);k([a.writer("compressionTolerance")],h.prototype,"writeCompressionTolerance",null);k([a.property({json:{write:!0}}),a.aliasOf("layer.format")],h.prototype,"format",
void 0);k([a.property({type:String,json:{read:{reader:e.read},write:{writer:e.write}}}),a.aliasOf("layer.interpolation")],h.prototype,"interpolation",void 0);k([a.property({json:{write:!0}}),a.aliasOf("layer.noData")],h.prototype,"noData",void 0);k([a.property({type:String,json:{read:{reader:b.read},write:{writer:b.write}}}),a.aliasOf("layer.noDataInterpretation")],h.prototype,"noDataInterpretation",void 0);k([a.property({json:{write:!0}})],h.prototype,"pixelType",void 0);k([a.property({json:{write:!0}})],
h.prototype,"lercVersion",void 0);k([a.writer("lercVersion")],h.prototype,"writeLercVersion",null);k([a.property({type:Number,dependsOn:"layer.adjustAspectRatio layer.bandIds layer.format layer.compressionQuality layer.compressionTolerance layer.definitionExpression layer.interpolation layer.noData layer.noDataInterpretation layer.mosaicRule layer.renderingRule layer.pixelFilter layer.renderer lercVersion pixelType".split(" ")})],h.prototype,"version",null);k([a.property({dependsOn:["layer.mosaicRule",
"layer.definitionExpression"],json:{write:!0}})],h.prototype,"mosaicRule",null);k([a.property({dependsOn:["layer.renderingRule","layer.renderer","layer.rasterInfo","layer.format"],json:{write:!0}})],h.prototype,"renderingRule",null);return h=k([a.subclass("esri.layers.mixins.ExportImageServiceParameters")],h)}(a.declared(d.JSONSupport));m.ExportImageServiceParameters=y})},"esri/layers/support/imageryRendererUtils":function(){define("require exports ../../rasterRenderers ../../core/arrayUtils ../../core/lang ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils".split(" "),
function(y,m,u,f,k,r,d,a){function c(a){var b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?c(b.functionArguments):a}function p(a,c){var g=[],n=[],h=[],p=[],d=c.pixelType,l=(c=c.rasterAttributeTable)&&c.features,v=b(c);if(l&&Array.isArray(l)&&a.classBreakInfos)return a.classBreakInfos.forEach(function(b,c){var g=b.symbol.color,e;g.a&&l.forEach(function(n){e=n.attributes[a.field];(e>=b.minValue&&e<b.maxValue||c===a.classBreakInfos.length-1&&e>=b.minValue)&&p.push([n.attributes[v],
g.r,g.g,g.b])})}),d=d?e(p,d):p,c=new r,c.functionName="Colormap",c.functionArguments={},c.functionArguments.Colormap=d,c.variableName="Raster",c;a.classBreakInfos.forEach(function(a,b){var c=a.symbol&&a.symbol.color;c.a?(0===b?g.push(a.minValue,a.maxValue+1E-6):g.push(a.minValue+1E-6,a.maxValue+1E-6),n.push(b),p.push([b,c.r,c.g,c.b])):h.push(a.minValue,a.maxValue)});d=d?e(p,d):p;c=new r;c.functionName="Remap";c.functionArguments={InputRanges:g,OutputValues:n,NoDataRanges:h};c.variableName="Raster";
var f=new r;f.functionName="Colormap";f.functionArguments={Colormap:d,Raster:c};return f}function e(a,b){(b=h[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function b(a){if(a)return(a=(a=a.fields)&&f.find(a,function(a){return a&&a.name&&"value"===a.name.toLowerCase()}))&&a.name}function l(a,c){var g=[],h=c.pixelType,p=(c=c.rasterAttributeTable)&&c.features,n=b(c),d=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(b){var c=b.symbol.color;
c.a&&(a.field!==n&&p?p&&p.forEach(function(e){String(e.attributes[a.field])===String(b.value)&&g.push([e.attributes[n],c.r,c.g,c.b])}):isNaN(b.value)?d=!0:g.push([b.value,c.r,c.g,c.b]))});if(d)return null;h=h&&0<g.length?e(g,h):g;c=new r;c.functionName="Colormap";c.functionArguments={};c.functionArguments.Colormap=h;c.variableName="Raster";return c}Object.defineProperty(m,"__esModule",{value:!0});var h={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},g={type:"multipart",
colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]};m.isSupportedRendererType=function(a){a=a.type;return"raster-stretch"===a||"unique-value"===a||"class-breaks"===a};m.combineRenderingRules=function(a,b){if(!a||!b)return k.clone(a||b);a=k.clone(a);"none"!==b.functionName.toLowerCase()&&(c(a.functionArguments).Raster=b);return a};m.convertRendererToRenderingRule=function(b,c){c=c||{};switch(b.type){case "raster-stretch":var g=
new r;g.functionName="Stretch";var h=t[a.stretchTypeJSONDict.toJSON(b.stretchType)],n={StretchType:h,Statistics:b.statistics,DRA:b.dynamicRangeAdjustment,UseGamma:b.useGamma,Gamma:b.gamma,ComputeGamma:b.computeGamma};null!=b.outputMin&&(n.Min=b.outputMin);null!=b.outputMax&&(n.Max=b.outputMax);h===t.standardDeviation?(n.NumberOfStandardDeviations=b.numberOfStandardDeviations,g.outputPixelType="u8"):h===t.percentClip?(n.MinPercent=b.minPercent,n.MaxPercent=b.maxPercent,g.outputPixelType="u8"):h===
t.minMax?g.outputPixelType="u8":h===t.sigmoid&&(n.SigmoidStrengthLevel=b.sigmoidStrengthLevel);g.functionArguments=n;g.variableName="Raster";if(b.colorRamp){var h=b.colorRamp,n=new r,f=d.getColorRampName(h);n.functionArguments=f?{colorRamp:f}:!c.convertColorRampToColormap||"algorithmic"!==h.type&&"multipart"!==h.type?{colorRamp:b.colorRamp.toJSON()}:{Colormap:d.convertColorRampToColormap(h,256)};n.variableName="Raster";n.functionName="Colormap";n.functionArguments.Raster=g;b=n}else b=g;return b;case "class-breaks":return p(b,
c);case "unique-value":return l(b,c);case "raster-colormap":return(b=b.extractColormap())&&0!==b.length?(b=(c=c.pixelType)?e(b,c):b,c=new r,c.functionName="Colormap",c.functionArguments={},c.functionArguments.Colormap=b,b=c):b=void 0,b}};m.createDefaultRenderer=function(a,b){if(a){var c=a.attributeTable,e=a.dataType,h=a.bandCount,p=a.pixelType,n=a.colormap,d=a.statistics,l=a.histograms;b&&0<b.length&&(d=d?b.map(function(a){return d[a]}):null,l=l?b.map(function(a){return l[a]}):null);var f;if(1===
h&&n&&0<n.length)f=u.RasterColormapRenderer.createFromColormap(n);else if(1===h&&c){var t=c.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0],v=c.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0],k=c.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0],e=c.fields.filter(function(a){return"value"===a.name})[0],r=c.fields.filter(function(a){return"classname"===a.name.toLowerCase()})[0];r||(r=c.fields.filter(function(a){return"string"===a.type})[0])||(r=
e);t&&v&&k&&r&&(f=u.UniqueValueRenderer.fromJSON({field1:r.name,uniqueValueInfos:c.features.map(function(a){return{value:a.attributes[r.name],label:a.attributes[r.name],symbol:{color:[a.attributes[t.name],a.attributes[v.name],a.attributes[k.name],255],type:"esriSFS",style:"esriSFSSolid"}}})}))}else c=void 0,f=!1,h=b=a=void 0,"u8"===p&&"processed"===e?(c="min-max",d=d||[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===p||"elevation"===e?(c="min-max",f=d?!1:!0):"scientific"===e?(c="min-max",
f=d?!1:!0,a=g):l&&0<l.length?(c="percent-clip",h=b=.25):d?c="min-max":(c="percent-clip",f=!0),f=u.RasterStretchRenderer.fromJSON({stretchType:c,dra:f,colorRamp:a,min:0,max:255,statistics:f?null:d,histograms:f?null:l,maxPercent:b,minPercent:h});return f}};m.getDefaultBandCombination=function(a){var b,c,g,e,h,p,d=a.keyProperties&&a.keyProperties.BandProperties;if(3<=a.bandCount){if(d&&d.length===a.bandCount){for(b=0;b<d.length;b++)d[b].BandName&&"red"===d[b].BandName.toLowerCase()&&(g=b),d[b].BandName&&
"green"===d[b].BandName.toLowerCase()&&(e=b),d[b].BandName&&"blue"===d[b].BandName.toLowerCase()&&(h=b),d[b].BandName&&"nearinfrared"===d[b].BandName.toLowerCase()&&(p=b);void 0!==g&&void 0!==e&&void 0!==h?c=[g,e,h]:void 0!==g&&void 0!==e&&void 0!==p&&(c=[p,g,e])}!c&&3<a.bandCount&&(c=[0,1,2])}return c};var t={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9}})},"esri/layers/support/RasterFunction":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/iteratorUtils ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators".split(" "),
function(y,m,u,f,k,r,d,a){var c=k.createSetFromValues(["Raster","Raster2","DEM","FillRaster"]),p=k.createSetFromValues(["Rasters"]),e=function(a){return a&&a.rasterFunction?h.fromJSON(a):a},b=function(a){return a&&a instanceof h?a.toJSON():a},l;(function(a){a[a.MOSAIC=0]="MOSAIC";a[a.GROUP=1]="GROUP";a[a.ITEM=2]="ITEM"})(l||(l={}));var h=function(g){function h(a){a=g.call(this,a)||this;a.functionArguments=null;a.functionName=null;a.outputPixelType="unknown";a.variableName=null;a.description=null;
a.functionDefinition=null;a.thumbnail=null;return a}u(h,g);v=h;h.prototype.readFunctionArguments=function(a,b){a=b.arguments||b.rasterFunctionArguments;if(null==a)a=null;else{b={};for(var g=0,h=Object.keys(a);g<h.length;g++){var d=h[g];c.has(d)?b[d]=e(a[d]):p.has(d)&&Array.isArray(a[d])?b[d]=a[d].map(e):b[d]=a[d]}a=b}return a};h.prototype.writeFunctionArguments=function(a,g,e){for(var h={},d=0,n=Object.keys(a);d<n.length;d++){var l=n[d];c.has(l)?h[l]=b(a[l]):p.has(l)&&Array.isArray(a[l])?h[l]=a[l].map(b):
h[l]=b(a[l])}this.functionDefinition?g.arguments=h:g[e]=h};h.prototype.readFunctionName=function(a,b){a=b.rasterFunctionInfos;var c=b.name;return c?c:a&&a.length&&"None"!==a[0].name?a[0].name:b.rasterFunction};h.prototype.writeFunctionName=function(a,b,c){this.functionDefinition?b.name=a:b[c]=a};h.prototype.readFunctionType=function(a){return l[a]};h.prototype.writeFunctionType=function(a,b,c){b[c]=l[a]};h.prototype.clone=function(){return new v({functionName:this.functionName,functionArguments:d.clone(this.functionArguments),
outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})};var v;f([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],h.prototype,"functionArguments",void 0);f([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],h.prototype,"readFunctionArguments",null);f([a.writer("functionArguments")],h.prototype,
"writeFunctionArguments",null);f([a.property({json:{type:String,write:{target:"rasterFunction"}}})],h.prototype,"functionName",void 0);f([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],h.prototype,"readFunctionName",null);f([a.writer("functionName")],h.prototype,"writeFunctionName",null);f([a.enumeration.serializable()({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),
a.property({json:{default:"unknown"}})],h.prototype,"outputPixelType",void 0);f([a.property({type:String,json:{read:!0,write:!0}})],h.prototype,"variableName",void 0);f([a.property({type:String,json:{read:!0,write:!0}})],h.prototype,"description",void 0);f([a.property()],h.prototype,"functionType",void 0);f([a.reader("functionType")],h.prototype,"readFunctionType",null);f([a.writer("functionType")],h.prototype,"writeFunctionType",null);f([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"}}})],
h.prototype,"functionDefinition",void 0);f([a.property({type:String,json:{read:!0,write:!0}})],h.prototype,"thumbnail",void 0);return h=v=f([a.subclass("esri.layers.support.RasterFunction")],h)}(a.declared(r.JSONSupport));return h})},"esri/layers/support/MosaicRule":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../geometry/Point ./DimensionalDefinition ./RasterFunction".split(" "),
function(y,m,u,f,k,r,d,a,c,p,e){var b=k.strict()({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),l=k.strict()({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"});return function(h){function g(a){a=h.call(this,a)||this;a.ascending=!0;a.itemRenderingRule=null;a.lockRasterIds=
null;a.method=null;a.multidimensionalDefinition=null;a.objectIds=null;a.operation=null;a.sortField=null;a.sortValue=null;a.viewpoint=null;a.where=null;return a}u(g,h);t=g;g.prototype.readAscending=function(a,b){return null!=b.ascending?b.ascending:null!=b.sortAscending?b.sortAscending:!0};g.prototype.readMethod=function(a,b){a=b.mosaicMethod||b.defaultMosaicMethod;switch(a?a.toLowerCase().replace("esrimosaic",""):""){case "byattribute":case "attribute":a="esriMosaicAttribute";break;case "lockraster":a=
"esriMosaicLockRaster";break;case "center":a="esriMosaicCenter";break;case "northwest":a="esriMosaicNorthwest";break;case "nadir":a="esriMosaicNadir";break;case "viewpoint":a="esriMosaicViewpoint";break;case "seamline":a="esriMosaicSeamline";break;case "none":a="esriMosaicNone";break;default:a="esriMosaicNone"}return l.fromJSON(a)};g.prototype.readOperation=function(a,c){a=c.mosaicOperation;c=c.mosaicOperator&&c.mosaicOperator.toLowerCase();c=a||(c?b.toJSON(c):null);return b.fromJSON(c)||"first"};
g.prototype.castSortValue=function(a){return null==a||"string"===typeof a||"number"===typeof a?a:""+a};g.prototype.clone=function(){return new t({ascending:this.ascending,itemRenderingRule:d.clone(this.itemRenderingRule),lockRasterIds:d.clone(this.lockRasterIds),method:this.method,multidimensionalDefinition:d.clone(this.multidimensionalDefinition),objectIds:d.clone(this.objectIds),operation:this.operation,sortField:this.sortField,sortValue:this.sortValue,viewpoint:d.clone(this.viewpoint),where:this.where})};
var t;f([a.property({type:Boolean,json:{write:!0}})],g.prototype,"ascending",void 0);f([a.reader("ascending",["ascending","sortAscending"])],g.prototype,"readAscending",null);f([a.property({type:e,json:{write:!0}})],g.prototype,"itemRenderingRule",void 0);f([a.property({type:[Number],json:{write:{overridePolicy:function(){return{enabled:"lock-raster"===this.method}}}}})],g.prototype,"lockRasterIds",void 0);f([a.property({type:String,json:{type:l.jsonValues,write:{target:"mosaicMethod",writer:l.write}}})],
g.prototype,"method",void 0);f([a.reader("method",["mosaicMethod","defaultMosaicMethod"])],g.prototype,"readMethod",null);f([a.property({type:[p],json:{write:!0}})],g.prototype,"multidimensionalDefinition",void 0);f([a.property({type:[Number],json:{read:{source:"fids"},write:{target:"fids"}}})],g.prototype,"objectIds",void 0);f([a.property({json:{type:b.jsonValues,read:{reader:b.read},write:{target:"mosaicOperation",writer:b.write}}})],g.prototype,"operation",void 0);f([a.reader("operation",["mosaicOperation",
"mosaicOperator"])],g.prototype,"readOperation",null);f([a.property({type:String,json:{write:{overridePolicy:function(){return{enabled:"attribute"===this.method}}}}})],g.prototype,"sortField",void 0);f([a.property({type:[String,Number],json:{write:{allowNull:!0,overridePolicy:function(){return{enabled:"attribute"===this.method,allowNull:!0}}}}})],g.prototype,"sortValue",void 0);f([a.cast("sortValue")],g.prototype,"castSortValue",null);f([a.property({type:c,json:{write:!0}})],g.prototype,"viewpoint",
void 0);f([a.property({type:String,json:{write:!0}})],g.prototype,"where",void 0);return g=t=f([a.subclass("esri.layers.support.MosaicRule")],g)}(a.declared(r.JSONSupport))})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(y,m,u,f,k,r,d,a,c){var p=a.getLogger("esri.layers.support.PixelBlock");
return function(a){function b(b){b=a.call(this,b)||this;b.width=null;b.height=null;b.pixelType="f32";b.validPixelCount=null;b.mask=null;b.maskIsAlpha=!1;b.pixels=null;b.statistics=null;return b}u(b,a);e=b;b.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");return a};b.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};b.prototype.addData=
function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new k("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};b.prototype.getAsRGBA=function(){var a=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);
break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};b.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};b.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(b){return a._calculateBandStatistics(b,a.mask)});var b=this.mask,c=0;if(b)for(var e=0;e<b.length;e++)b[e]&&c++;else c=this.width*this.height;this.validPixelCount=c};b.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==
a){var b;switch(a){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var c=b[0];b=b[1];for(var e=this.pixels,h=this.width*this.height,p=e.length,d,l,f,k=[],r=0;r<p;r++){f=this._createEmptyBand(a,h);d=e[r];for(var x=0;x<h;x++)l=d[x],f[x]=l>b?b:l<c?c:l;k.push(f)}this.pixels=k;this.pixelType=a}};b.prototype.clone=function(){var a=
new e({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(a.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var b,c=this.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){a.pixels=[];var p=this.pixels[0].slice;for(b=0;b<this.pixels.length;b++)a.pixels[b]=p?this.pixels[b].slice(0,this.pixels[b].length):new c(this.pixels[b])}if(this.statistics)for(a.statistics=
[],b=0;b<this.statistics.length;b++)a.statistics[b]=d.clone(this.statistics[b]);return a};b.prototype.getPixelArrayConstructor=function(a){switch(a){case "u8":a=Uint8Array;break;case "u16":a=Uint16Array;break;case "u32":a=Uint32Array;break;case "s8":a=Int8Array;break;case "s16":a=Int16Array;break;case "s32":a=Int32Array;break;case "u32":a=Uint32Array;break;case "f32":a=Float32Array;break;case "f64":a=Float64Array;break;default:a=Float32Array}return a};b.prototype._createEmptyBand=function(a,b){return new (this.getPixelArrayConstructor(a))(b)};
b.prototype._fillFrom8Bit=function(a){var b=this.mask,c=this.maskIsAlpha,e=this.pixels;if(a&&e&&e.length){var h,d,l;h=d=l=e[0];3<=e.length?(d=e[1],l=e[2]):2===e.length&&(d=e[1]);a=new Uint32Array(a);e=this.width*this.height;if(h.length!==e)p.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(b&&b.length===e)if(c)for(c=0;c<e;c++)b[c]&&(a[c]=b[c]<<24|l[c]<<16|d[c]<<8|h[c]);else for(c=0;c<e;c++)b[c]&&(a[c]=-16777216|l[c]<<16|d[c]<<8|h[c]);else for(c=0;c<e;c++)a[c]=-16777216|
l[c]<<16|d[c]<<8|h[c]}else p.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};b.prototype._fillFromNon8Bit=function(a){var b=this.pixels,c=this.mask,e=this.statistics;if(a&&b&&b.length){var d=this.pixelType,h=1,l=0,h=1;e&&0<e.length?(l=e.map(function(a){return a.minValue}).reduce(function(a,b){return Math.min(a,b)}),h=e.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),h=255/h):(h=255,"s8"===d?(l=-128,h=127):"u16"===d?h=65535:
"s16"===d?(l=-32768,h=32767):"u32"===d?h=4294967295:"s32"===d?(l=-2147483648,h=2147483647):"f32"===d?(l=-3.4*1E39,h=3.4*1E39):"f64"===d&&(l=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-l));a=new Uint32Array(a);var d=this.width*this.height,f,k,e=f=k=b[0];if(e.length!==d)return p.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=b.length)if(f=b[1],3<=b.length&&(k=b[2]),c&&c.length===d)for(b=0;b<d;b++)c[b]&&(a[b]=-16777216|(k[b]-l)*h<<16|(f[b]-l)*h<<8|(e[b]-l)*h);else for(b=
0;b<d;b++)a[b]=-16777216|(k[b]-l)*h<<16|(f[b]-l)*h<<8|(e[b]-l)*h;else if(c&&c.length===d)for(b=0;b<d;b++)f=(e[b]-l)*h,c[b]&&(a[b]=-16777216|f<<16|f<<8|f);else for(b=0;b<d;b++)f=(e[b]-l)*h,a[b]=-16777216|f<<16|f<<8|f}else p.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};b.prototype._fillFrom32Bit=function(a){var b=this.pixels,c=this.mask;if(!a||!b||!b.length)return p.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var e,d,h;
e=d=h=b[0];3<=b.length?(d=b[1],h=b[2]):2===b.length&&(d=b[1]);var l=this.width*this.height;if(e.length!==l)return p.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var f=0;if(c&&c.length===l)for(b=0;b<l;b++)a[f++]=e[b],a[f++]=d[b],a[f++]=h[b],a[f++]=c[b]&1;else for(b=0;b<l;b++)a[f++]=e[b],a[f++]=d[b],a[f++]=h[b],a[f++]=1};b.prototype._calculateBandStatistics=function(a,b){var c=Infinity,e=-Infinity,g=a.length,d,p=0;if(b)for(d=0;d<g;d++)b[d]&&(p=a[d],c=p<c?p:c,e=p>
e?p:e);else for(d=0;d<g;d++)p=a[d],c=p<c?p:c,e=p>e?p:e;return{minValue:c,maxValue:e}};var e;f([c.property({json:{write:!0}})],b.prototype,"width",void 0);f([c.property({json:{write:!0}})],b.prototype,"height",void 0);f([c.property({json:{write:!0}})],b.prototype,"pixelType",void 0);f([c.cast("pixelType")],b.prototype,"castPixelType",null);f([c.property({json:{write:!0}})],b.prototype,"validPixelCount",void 0);f([c.property({json:{write:!0}})],b.prototype,"mask",void 0);f([c.property({json:{write:!0}})],
b.prototype,"maskIsAlpha",void 0);f([c.property({json:{write:!0}})],b.prototype,"pixels",void 0);f([c.property({json:{write:!0}})],b.prototype,"statistics",void 0);return b=e=f([c.subclass("esri.layers.support.PixelBlock")],b)}(c.declared(r.JSONSupport))})},"esri/layers/support/RasterInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ../../tasks/support/FeatureSet".split(" "),
function(y,m,u,f,k,r,d,a,c){return function(p){function e(a){a=p.call(this,a)||this;a.attributeTable=null;a.bandCount=null;a.colormap=null;a.extent=null;a.format=void 0;a.histograms=null;a.keyProperties=null;a.multidimensionalInfo=null;a.pixelSize=null;a.pixelType=null;a.spatialReference=null;a.statistics=null;return a}f(e,p);Object.defineProperty(e.prototype,"dataType",{get:function(){var a=this.keyProperties&&this.keyProperties.DataType;return a?a.toLowerCase():"generic"},enumerable:!0,configurable:!0});
k([d.property({type:c,json:{write:!0}})],e.prototype,"attributeTable",void 0);k([d.property({json:{write:!0}})],e.prototype,"bandCount",void 0);k([d.property({json:{write:!0}})],e.prototype,"colormap",void 0);k([d.property({type:String,readOnly:!0})],e.prototype,"dataType",null);k([d.property({type:a,json:{write:!0}})],e.prototype,"extent",void 0);k([d.property({json:{write:!0}})],e.prototype,"format",void 0);k([d.property({json:{write:!0}})],e.prototype,"histograms",void 0);k([d.property({json:{write:!0}})],
e.prototype,"keyProperties",void 0);k([d.property({json:{write:!0}})],e.prototype,"multidimensionalInfo",void 0);k([d.property({json:{write:!0}})],e.prototype,"pixelSize",void 0);k([d.property({json:{write:!0}})],e.prototype,"pixelType",void 0);k([d.property({json:{write:!0}})],e.prototype,"spatialReference",void 0);k([d.property({json:{write:!0}})],e.prototype,"statistics",void 0);return e=k([d.subclass("esri.layers.support.RasterInfo")],e)}(d.declared(r.JSONSupport))})},"esri/layers/support/RasterJobHandler":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/promiseUtils ../../core/requireUtils ../../core/workers ./PixelBlock module".split(" "),
function(y,m,u,f,k,r,d,a,c,p){return function(){function e(){this._workerThread=null;this._destroyed=!1}e.prototype.initialize=function(){return f(this,void 0,void 0,function(){var b;return u(this,function(c){switch(c.label){case 0:return[4,a.open(d.getAbsMid("./RasterWorker",y,p))];case 1:return b=c.sent(),this._destroyed?b.close():this._workerThread=b,[2]}})})};e.prototype.destroy=function(){this._destroyed=!0;this._workerThread&&(this._workerThread.close(),this._workerThread=null)};e.prototype.decode=
function(a,e){return f(this,void 0,void 0,function(){var b;return u(this,function(g){switch(g.label){case 0:if(!this._workerThread)throw new k("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",a,e)];case 1:return b=g.sent(),[2,b?new c(b):null]}})})};e.prototype.symbolize=function(a,e){return f(this,void 0,void 0,function(){var b;return u(this,function(g){switch(g.label){case 0:if(!this._workerThread)throw new k("raster-jobhandler:no-connection",
"no available worker connection");return[4,this._workerThread.invoke("symbolize",a.toJSON(),e)];case 1:return b=g.sent(),[2,b?new c(b):null]}})})};e.prototype.updateSymbolizer=function(a,c){return f(this,void 0,void 0,function(){var b;return u(this,function(e){switch(e.label){case 0:if(!this._workerThread)throw new k("raster-jobhandler:no-connection","no available worker connection");b=a&&a.renderer&&"raster-stretch"===a.renderer.type&&a.renderer.histograms;return[4,r.all(this._workerThread.broadcast("updateSymbolizer",
{symbolizerJSON:a.toJSON(),histograms:b},c))];case 1:return e.sent(),[2]}})})};return e}()})},"esri/layers/support/rasterFormats/RasterCodec":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc2Codec ./LercCodec ./Png ./Raw ./TiffDecoder".split(" "),function(y,m,u,f,k,r,d,a,c,p,e,b,l,h){function g(a,b){if(!x)throw new r("rasterCoded:decode",
"lerc decoder is not supported on big endian platform");var c=b.width,g=b.height,p=b.pixelType,h=z(p),l=h.pixelTypeCtor;b=null==b.noDataValue?h.noDataValue:b.noDataValue;for(var h=0,f,n=0,k,q=a.byteLength-10;n<q;){var t=e.decode(a,{inputOffset:n,encodedMaskData:f,returnMask:0===h?!0:!1,returnEncodedMask:0===h?!0:!1,returnFileInfo:!0,pixelType:l,noDataValue:b});if(c&&g&&(t.width!==c||t.height!==g))throw new r("rasterCoded:decode","lerc decoded result has width or height different from specified in options");
n=t.fileInfo.eofOffset;0===h&&(f=t.encodedMaskData,k=new d({width:t.width,height:t.height,pixels:[],pixelType:p,mask:t.maskData,statistics:[]}));h++;k.addData({pixels:t.pixelData,statistics:{minValue:t.minValue,maxValue:t.maxValue,noDataValue:t.noDataValue}})}return k}function t(a,b){if(!x)throw new r("rasterCoded:decode","lerc decoder is not supported on big endian platform");for(var c=0,e=0,g=0,h,l,f=a.byteLength-10,n=[],k=b.width,t=b.height;e<f;){b=p.decode(a,{inputOffset:e,maskData:h,returnFileInfo:!0});
if(k&&t&&(b.width!==k||b.height!==t))throw new r("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");e=b.fileInfo.eofOffset;0===c&&(g=b.fileInfo.numValidPixel,h=b.maskData,l=new d({width:b.width,height:b.height,pixels:[],pixelType:b.fileInfo.pixelType,mask:b.maskData,statistics:[]}));b.fileInfo.mask&&0<b.fileInfo.mask.numBytes&&n.push(b.maskData);c++;l.addData({pixels:b.pixelData,statistics:{minValue:b.minValue,maxValue:b.maxValue}})}e=c=a=0;
if(1<n.length){e=l.width*l.height;h=new Uint8Array(e);h.set(n[0]);for(a=1;a<n.length;a++)for(g=n[a],c=0;c<e;c++)h[c]&=g[c];for(c=g=0;c<e;c++)g+=h[c];l.mask=h}l.validPixelCount=g;return l}function v(a){a=h.decode(a);a=new d({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.maskData,statistics:null});a.updateStatistics();return a}function n(a,b,c){var e=z(b.pixelType).pixelTypeCtor;a=("bsq"===c?l.decodeBSQ:l.decodeBIP)(a,{bandCount:b.planes,width:b.width,height:b.height,
pixelType:e});b=new d({width:b.width,height:b.height,pixels:a.pixels,pixelType:b.pixelType,mask:a.mask,statistics:null});b.updateStatistics();return b}function q(a){a=c.decode(a);a=new d({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});a.updateStatistics();return a}function E(a,c){a=new Uint8Array(a);var e=new b(a);a=c.width;var g=c.height;c=a*g;for(var e=e.decode(),p=0,h=0,h=new Uint8Array(c),p=0;p<c;p++)h[p]=e[4*p+3];g=new d({width:a,height:g,pixels:[],
pixelType:"U8",mask:h,statistics:[]});for(p=0;3>p;p++){a=new Uint8Array(c);for(h=0;h<c;h++)a[h]=e[4*h+p];g.addData({pixels:a})}g.updateStatistics();return g}function A(b,c,e){return f(this,void 0,void 0,function(){var g,p,h,l;return u(this,function(f){switch(f.label){case 0:return g=new a,p=k({applyJpegMask:!1},c),[4,g.decode(b,p,e)];case 1:return h=f.sent(),l=new d(h),l.updateStatistics(),[2,l]}})})}function F(a){if(null==a)throw new r("rasterCodec:decode","parameter encodeddata is required.");a=
new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="png":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="lerc":76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5]?b="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]?b="tiff":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="error");return b}function C(a){var b=
null;switch(a){case "lerc":b=g;break;case "lerc2":b=t;break;case "jpg":b=q;break;case "png":b=E;break;case "bsq":b=function(a,b){return n(a,b,"bsq")};break;case "bip":b=function(a,b){return n(a,b,"bip")};break;case "tiff":b=v;break;case "error":b=function(){throw new r("rasterCodec:decode","input data contains error");};break;default:b=function(){throw new r("rasterCodec:decode","unsupported raster format");}}return b}function z(a){var b=null,c=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":c=
Math.pow(2,8)-1;b=Uint8Array;break;case "u16":c=c||Math.pow(2,16)-1;b=Uint16Array;break;case "u32":c=c||Math.pow(2,32)-1;b=Uint32Array;break;case "s8":c=c||0-Math.pow(2,7);b=Int8Array;break;case "s16":c=c||0-Math.pow(2,15);b=Int16Array;break;case "s32":c=c||0-Math.pow(2,31);b=Int32Array;break;default:b=Float32Array}return{pixelTypeCtor:b,noDataValue:c}}var x=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}();return function(){function a(){}a.getFormat=
function(a){a=F(a);"lerc2"===a?a="lerc":"error"===a&&(a="");return a};a.decode=function(a,b,c){return f(this,void 0,void 0,function(){var e,g,p;return u(this,function(d){switch(d.label){case 0:if(null==a)throw new r("rasterCodec:decode","missing encodeddata parameter.");if(null==b||null==b.width||null==b.height)throw new r("rasterCodec:decode","requires width and height in options parameter.");e=b.format&&b.format.toLowerCase();if(!e||"bsq"!==e&&"bip"!==e)e=F(a);return!b.useCanvas||"jpg"!==e&&"png"!==
e?[3,2]:[4,A(a,b,c)];case 1:return p=d.sent(),[3,3];case 2:g=C(e);b.isPoint&&(b=k({},b),b.width++,b.height++);p=g(a,b);if(b.isPoint){var h=p,l=void 0;void 0===l&&(l=1);if(h){var f=h.pixels,n=h.width,t=h.mask;if(f&&0!==f.length){var q=f.length,v=n-1,E=h.height-1,z=[],w,x,m,u,B,H,D=h.getPixelArrayConstructor(h.pixelType);if(0===l){for(l=0;l<q;l++){u=f[l];B=new D(v*E);for(w=0;w<E;w++)for(m=w*n,x=0;x<v;x++)B[w*v+x]=u[m+x];z.push(B)}if(t)for(H=new Uint8Array(v*E),w=0;w<E;w++)for(m=w*n,x=0;x<v;x++)H[w*
v+x]=t[m+x]}else{for(l=0;l<q;l++){u=f[l];B=new D(v*E);for(w=0;w<E;w++)for(m=w*n,x=0;x<v;x++)B[w*v+x]=(u[m+x]+u[m+x+1]+u[m+n+x]+u[m+n+x+1])/4;z.push(B)}if(t)for(H=new Uint8Array(v*E),w=0;w<E;w++)for(m=w*n,x=0;x<v;x++)H[w*v+x]=Math.min.apply(null,[t[m+x],t[m+x+1],t[m+n+x],t[m+n+x+1]])}h.width=v;h.height=E;h.mask=H;h.pixels=z}}}d.label=3;case 3:return[2,p]}})})};return a}()})},"esri/layers/support/rasterFormats/ImageCanvasDecoder":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/promiseUtils ./Zlib".split(" "),
function(y,m,u,f,k,r){return function(){function d(a){a&&(this.canvas=a.canvas,this.ctx=a.ctx||a.canvas&&a.canvas.getContext("2d"))}d.getFormat=function(a){if(!a||10>a.byteLength)return"";a=new Uint8Array(a,0,10);var c="";255===a[0]&&216===a[1]?c="jpeg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&(c="png");return c};d.prototype.decode=function(a,c,p){var e=this;if(!a||10>a.byteLength)throw new u("imagecanvasdecoder: decode","required a valid encoded data as input.");var b=d.getFormat(a);if(""===
b)throw new u("imagecanvasdecoder: decode","encoded data format is not a supported format (jpeg or png).");var l=c.width,h=c.height,g=c.applyJpegMask;if(g&&(!l||!h))throw new u("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return f.create(function(t,v){var n=null;"jpeg"===b&&g&&(n=d.getMask(a,c));var q=new Blob([new Uint8Array(a)],{type:"image/"+b}),r=URL.createObjectURL(q),A=new Image,F;A.src=r;A.onload=function(){URL.revokeObjectURL(r);if(f.isAborted(p))v(k.createAbortError());
else{l=A.width;h=A.height;if(e.canvas){if(e.canvas.width!==l||e.canvas.height!==h)e.canvas.width=l,e.canvas.height=h;e.ctx.clearRect(0,0,l,h)}else e.canvas=document.createElement("canvas"),e.canvas.width=l,e.canvas.height=h,e.ctx=e.canvas.getContext("2d");e.ctx.drawImage(A,0,0);var a=e.ctx.getImageData(0,0,l,h);F=a.data;var b;if(c.renderOnCanvas){if(n)for(b=0;b<n.length;b++)F[4*b+3]=n[b]?255:0;e.ctx.putImageData(a,0,0);t(null)}else{var a=l*h,g=new Uint8Array(a),d=new Uint8Array(a),q=new Uint8Array(a);
if(n)for(b=0;b<a;b++)g[b]=F[4*b],d[b]=F[4*b+1],q[b]=F[4*b+2];else for(n=new Uint8Array(a),b=0;b<a;b++)g[b]=F[4*b],d[b]=F[4*b+1],q[b]=F[4*b+2],n[b]=F[4*b+3];t({width:l,height:h,pixels:[g,d,q],mask:n,pixelType:"u8"})}}};A.onerror=function(){URL.revokeObjectURL(r);v("cannot load image")}})};d.getMask=function(a,c){var p=null;try{var e=new Uint8Array(a);a=0;var b=e.length-2;for(a=Math.ceil(e.length/2);a<b&&(255!==e[a]||217!==e[a+1]);a++);a+=2;if(a<e.length-1)for(var d=(new r(e.subarray(a))).getBytes(),
p=new Uint8Array(c.width*c.height),e=c=0;e<d.length;e++)for(b=7;0<=b;b--)p[c++]=d[e]>>b&1}catch(h){}return p};return d}()})},"esri/layers/support/rasterFormats/Zlib":function(){define([],function(){var y=function(){function m(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}m.prototype={ensureBuffer:function(m){var f=this.buffer,k=f?f.byteLength:0;if(m<k)return f;for(var r=512;r<m;)r<<=1;m=new Uint8Array(r);for(r=0;r<k;++r)m[r]=f[r];return this.buffer=m},getByte:function(){for(var m=this.pos;this.bufferLength<=
m;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(m){var f=this.pos;if(m){this.ensureBuffer(f+m);for(m=f+m;!this.eof&&this.bufferLength<m;)this.readBlock();var k=this.bufferLength;m>k&&(m=k)}else{for(;!this.eof;)this.readBlock();m=this.bufferLength}this.pos=m;return this.buffer.subarray(f,m)},lookChar:function(){for(var m=this.pos;this.bufferLength<=m;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var m=
this.pos;this.bufferLength<=m;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(m,f,k){for(var r=m+f;this.bufferLength<=r&&!this.eof;)this.readBlock();return new Stream(this.buffer,m,f,k)},skip:function(m){m||(m=1);this.pos+=m},reset:function(){this.pos=0}};return m}();return function(){function m(a){throw Error(a);}function u(a){var c=0,e=a[c++],b=a[c++];-1!=e&&-1!=b||m("Invalid header in flate stream");8!=(e&15)&&m("Unknown compression method in flate stream");
0!=((e<<8)+b)%31&&m("Bad FCHECK in flate stream");b&32&&m("FDICT bit set in flate stream");this.bytes=a;this.bytesPos=c;this.codeBuf=this.codeSize=0;y.call(this)}if(!self||!self.Uint32Array)return null;var f=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,
131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),d=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,
524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,
524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,
524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,
524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,
524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,
524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,
524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];u.prototype=Object.create(y.prototype);
u.prototype.getBits=function(a){for(var c=this.codeSize,e=this.codeBuf,b=this.bytes,d=this.bytesPos,h;c<a;)"undefined"==typeof(h=b[d++])&&m("Bad encoding in flate stream"),e|=h<<c,c+=8;this.codeBuf=e>>a;this.codeSize=c-=a;this.bytesPos=d;return e&(1<<a)-1};u.prototype.getCode=function(a){var c=a[0],e=a[1];a=this.codeSize;for(var b=this.codeBuf,d=this.bytes,h=this.bytesPos;a<e;){var g;"undefined"==typeof(g=d[h++])&&m("Bad encoding in flate stream");b|=g<<a;a+=8}e=c[b&(1<<e)-1];c=e>>16;e&=65535;(0==
a||a<c||0==c)&&m("Bad encoding in flate stream");this.codeBuf=b>>c;this.codeSize=a-c;this.bytesPos=h;return e};u.prototype.generateHuffmanTable=function(a){for(var c=a.length,e=0,b=0;b<c;++b)a[b]>e&&(e=a[b]);for(var d=1<<e,h=new Uint32Array(d),g=1,f=0,k=2;g<=e;++g,f<<=1,k<<=1)for(var n=0;n<c;++n)if(a[n]==g){for(var q=0,r=f,b=0;b<g;++b)q=q<<1|r&1,r>>=1;for(b=q;b<d;b+=k)h[b]=g<<16|n;++f}return[h,e]};u.prototype.readBlock=function(){function c(a,b,c,e,g){for(a=a.getBits(c)+e;0<a--;)b[t++]=g}var p=this.getBits(3);
p&1&&(this.eof=!0);p>>=1;if(0==p){var e=this.bytes,b=this.bytesPos,l;"undefined"==typeof(l=e[b++])&&m("Bad block header in flate stream");var h=l;"undefined"==typeof(l=e[b++])&&m("Bad block header in flate stream");h|=l<<8;"undefined"==typeof(l=e[b++])&&m("Bad block header in flate stream");p=l;"undefined"==typeof(l=e[b++])&&m("Bad block header in flate stream");(p|l<<8)!=(~h&65535)&&m("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;l=this.bufferLength;p=this.ensureBuffer(l+
h);this.bufferLength=h=l+h;for(var g=l;g<h;++g){if("undefined"==typeof(l=e[b++])){this.eof=!0;break}p[g]=l}this.bytesPos=b}else{if(1==p)b=d,l=a;else if(2==p){p=this.getBits(5)+257;l=this.getBits(5)+1;for(var e=this.getBits(4)+4,b=Array(f.length),t=0;t<e;)b[f[t++]]=this.getBits(3);b=this.generateHuffmanTable(b);t=e=0;l=p+l;for(h=Array(l);t<l;)g=this.getCode(b),16==g?c(this,h,2,3,e):17==g?c(this,h,3,3,e=0):18==g?c(this,h,7,11,e=0):h[t++]=e=g;b=this.generateHuffmanTable(h.slice(0,p));l=this.generateHuffmanTable(h.slice(p,
l))}else m("Unknown block type in flate stream");h=(p=this.buffer)?p.length:0;for(g=this.bufferLength;;){var v=this.getCode(b);if(256>v)g+1>=h&&(p=this.ensureBuffer(g+1),h=p.length),p[g++]=v;else{if(256==v){this.bufferLength=g;break}var v=v-257,v=k[v],n=v>>16;0<n&&(n=this.getBits(n));e=(v&65535)+n;v=this.getCode(l);v=r[v];n=v>>16;0<n&&(n=this.getBits(n));v=(v&65535)+n;g+e>=h&&(p=this.ensureBuffer(g+e),h=p.length);for(n=0;n<e;++n,++g)p[g]=p[g-v]}}}};return u}()})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["require",
"exports","./Jpg","./Zlib"],function(y,m,u,f){return function(){function k(){}k.decode=function(k){var d=new Uint8Array(k),a=new u;a.parse(d);k=a.width;var c=a.height,p=a.numComponents,e=a.eof,a=a.getData(k,c,!0),b,l=k*c,h=0,g=0,t=0;if(e<d.length-1)for(d=(new f(d.subarray(e))).getBytes(),b=new Uint8Array(l),h=e=0;h<d.length;h++)for(t=7;0<=t;t--)b[e++]=d[h]>>t&1;d=null;if(1===p)d=[a,a,a];else{d=[];for(h=0;3>h;h++)p=new Uint8Array(l),d.push(p);for(g=t=0;g<l;g++)for(h=0;3>h;h++)d[h][g]=a[t++]}return{width:k,
height:c,pixels:d,mask:b}};return k}()})},"esri/layers/support/rasterFormats/Jpg":function(){define([],function(){var y=function(){function m(m){this.message="JPEG error: "+m}m.prototype=Error();m.prototype.name="JpegError";return m.constructor=m}();return function(){function m(){this.decodeTransform=null;this.colorTransform=-1}function u(a,c){for(var d=0,e=[],b,l,h=16;0<h&&!a[h-1];)h--;e.push({children:[],index:0});var g=e[0],f;for(b=0;b<h;b++){for(l=0;l<a[b];l++){g=e.pop();for(g.children[g.index]=
c[d];0<g.index;)g=e.pop();g.index++;for(e.push(g);e.length<=b;)e.push(f={children:[],index:0}),g.children[g.index]=f.children,g=f;d++}b+1<h&&(e.push(f={children:[],index:0}),g.children[g.index]=f.children,g=f)}return e[0].children}function f(a,c,p,e,b,l,h,g,f){function k(){if(0<G)return G--,u>>G&1;u=a[c++];if(255===u){var b=a[c++];if(b)throw new y("unexpected marker "+(u<<8|b).toString(16));}G=7;return u>>>7}function n(a){for(;;){a=a[k()];if("number"===typeof a)return a;if("object"!==typeof a)throw new y("invalid huffman sequence");
}}function q(a){for(var b=0;0<a;)b=b<<1|k(),a--;return b}function t(a){if(1===a)return 1===k()?1:-1;var b=q(a);return b>=1<<a-1?b:b+(-1<<a)+1}function A(a,b){var c=n(a.huffmanTableDC),c=0===c?0:t(c);a.blockData[b]=a.pred+=c;for(c=1;64>c;){var e=n(a.huffmanTableAC),g=e&15,e=e>>4;if(0===g){if(15>e)break;c+=16}else c+=e,a.blockData[b+d[c]]=t(g),c++}}function m(a,b){var c=n(a.huffmanTableDC),c=0===c?0:t(c)<<f;a.blockData[b]=a.pred+=c}function C(a,b){a.blockData[b]|=k()<<f}function z(a,b){if(0<D)D--;else for(var c=
l;c<=h;){var e=n(a.huffmanTableAC),g=e&15,e=e>>4;if(0===g){if(15>e){D=q(e)+(1<<e)-1;break}c+=16}else c+=e,a.blockData[b+d[c]]=t(g)*(1<<f),c++}}function x(a,b){for(var c=l,e=0,g;c<=h;){g=d[c];switch(L){case 0:e=n(a.huffmanTableAC);g=e&15;e>>=4;if(0===g)15>e?(D=q(e)+(1<<e),L=4):(e=16,L=1);else{if(1!==g)throw new y("invalid ACn encoding");J=t(g);L=e?2:3}continue;case 1:case 2:a.blockData[b+g]?a.blockData[b+g]+=k()<<f:(e--,0===e&&(L=2===L?3:0));break;case 3:a.blockData[b+g]?a.blockData[b+g]+=k()<<f:(a.blockData[b+
g]=J<<f,L=0);break;case 4:a.blockData[b+g]&&(a.blockData[b+g]+=k()<<f)}c++}4===L&&(D--,0===D&&(L=0))}var w=p.mcusPerLine,B=c,u=0,G=0,D=0,L=0,J,P=e.length,I,M,X,N,V;g=p.progressive?0===l?0===g?m:C:0===g?z:x:A;var O=0;p=1===P?e[0].blocksPerLine*e[0].blocksPerColumn:w*p.mcusPerColumn;for(var oa,za;O<p;){var ka=b?Math.min(p-O,b):p;for(M=0;M<P;M++)e[M].pred=0;D=0;if(1===P)for(I=e[0],V=0;V<ka;V++)g(I,64*((I.blocksPerLine+1)*(O/I.blocksPerLine|0)+O%I.blocksPerLine)),O++;else for(V=0;V<ka;V++){for(M=0;M<
P;M++)for(I=e[M],oa=I.h,za=I.v,X=0;X<za;X++)for(N=0;N<oa;N++)g(I,64*((I.blocksPerLine+1)*((O/w|0)*I.v+X)+(O%w*I.h+N)));O++}G=0;(I=r(a,c))&&I.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+I.invalid),c=I.offset);I=I&&I.marker;if(!I||65280>=I)throw new y("marker was not found");if(65488<=I&&65495>=I)c+=2;else break}(I=r(a,c))&&I.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+I.invalid),c=I.offset);return c-B}function k(a,c){a=c.blocksPerLine;
for(var d=c.blocksPerColumn,e=new Int16Array(64),b=0;b<d;b++)for(var l=0;l<a;l++){var h=64*((c.blocksPerLine+1)*b+l),g=e,f=c.quantizationTable,k=c.blockData,n=void 0,q=void 0,r=void 0,A=void 0,m=void 0,C=void 0,z=void 0,x=void 0,w=void 0,B=x=void 0,u=z=q=C=void 0,G=void 0,w=void 0;if(!f)throw new y("missing required Quantization Table.");for(var D=0;64>D;D+=8)w=k[h+D],x=k[h+D+1],B=k[h+D+2],C=k[h+D+3],q=k[h+D+4],z=k[h+D+5],u=k[h+D+6],G=k[h+D+7],w*=f[D],0===(x|B|C|q|z|u|G)?(w=5793*w+512>>10,g[D]=w,
g[D+1]=w,g[D+2]=w,g[D+3]=w,g[D+4]=w,g[D+5]=w,g[D+6]=w,g[D+7]=w):(x*=f[D+1],B*=f[D+2],C*=f[D+3],q*=f[D+4],z*=f[D+5],u*=f[D+6],G*=f[D+7],n=5793*w+128>>8,q=5793*q+128>>8,r=B,A=u,m=2896*(x-G)+128>>8,x=2896*(x+G)+128>>8,C<<=4,z<<=4,n=n+q+1>>1,q=n-q,w=3784*r+1567*A+128>>8,r=1567*r-3784*A+128>>8,A=w,m=m+z+1>>1,z=m-z,x=x+C+1>>1,C=x-C,n=n+A+1>>1,A=n-A,q=q+r+1>>1,r=q-r,w=2276*m+3406*x+2048>>12,m=3406*m-2276*x+2048>>12,x=w,w=799*C+4017*z+2048>>12,C=4017*C-799*z+2048>>12,z=w,g[D]=n+x,g[D+7]=n-x,g[D+1]=q+z,g[D+
6]=q-z,g[D+2]=r+C,g[D+5]=r-C,g[D+3]=A+m,g[D+4]=A-m);for(f=0;8>f;++f)w=g[f],x=g[f+8],B=g[f+16],C=g[f+24],q=g[f+32],z=g[f+40],u=g[f+48],G=g[f+56],0===(x|B|C|q|z|u|G)?(w=5793*w+8192>>14,w=-2040>w?0:2024<=w?255:w+2056>>4,k[h+f]=w,k[h+f+8]=w,k[h+f+16]=w,k[h+f+24]=w,k[h+f+32]=w,k[h+f+40]=w,k[h+f+48]=w,k[h+f+56]=w):(n=5793*w+2048>>12,q=5793*q+2048>>12,r=B,A=u,m=2896*(x-G)+2048>>12,x=2896*(x+G)+2048>>12,n=(n+q+1>>1)+4112,q=n-q,w=3784*r+1567*A+2048>>12,r=1567*r-3784*A+2048>>12,A=w,m=m+z+1>>1,z=m-z,x=x+C+1>>
1,C=x-C,n=n+A+1>>1,A=n-A,q=q+r+1>>1,r=q-r,w=2276*m+3406*x+2048>>12,m=3406*m-2276*x+2048>>12,x=w,w=799*C+4017*z+2048>>12,C=4017*C-799*z+2048>>12,z=w,w=n+x,G=n-x,x=q+z,u=q-z,B=r+C,z=r-C,C=A+m,q=A-m,w=16>w?0:4080<=w?255:w>>4,x=16>x?0:4080<=x?255:x>>4,B=16>B?0:4080<=B?255:B>>4,C=16>C?0:4080<=C?255:C>>4,q=16>q?0:4080<=q?255:q>>4,z=16>z?0:4080<=z?255:z>>4,u=16>u?0:4080<=u?255:u>>4,G=16>G?0:4080<=G?255:G>>4,k[h+f]=w,k[h+f+8]=x,k[h+f+16]=B,k[h+f+24]=C,k[h+f+32]=q,k[h+f+40]=z,k[h+f+48]=u,k[h+f+56]=G)}return c.blockData}
function r(a,c,d){var e=a.length-1;d=d<c?d:c;if(c>=e)return null;var b=a[c]<<8|a[c+1];if(65472<=b&&65534>=b)return{invalid:null,marker:b,offset:c};for(c=a[d]<<8|a[d+1];!(65472<=c&&65534>=c);){if(++d>=e)return null;c=a[d]<<8|a[d+1]}return{invalid:b.toString(16),marker:c,offset:d}}if(!self||!self.Uint8ClampedArray)return null;var d=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,
46,53,60,61,54,47,55,62,63]);m.prototype={parse:function(a){function c(){var c=a[b]<<8|a[b+1];b+=2;return c}function p(){var e=c(),e=b+e-2,g=r(a,e,b);g&&g.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+g.invalid),e=g.offset);e=a.subarray(b,e);b+=e.length;return e}function e(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),e=0;e<a.components.length;e++){B=a.components[e];var g=Math.ceil(Math.ceil(a.samplesPerLine/8)*B.h/a.maxH),d=Math.ceil(Math.ceil(a.scanLines/
8)*B.v/a.maxV);B.blockData=new Int16Array(64*c*B.v*(b*B.h+1));B.blocksPerLine=g;B.blocksPerColumn=d}a.mcusPerLine=b;a.mcusPerColumn=c}var b=0,l=null,h=null,g,t,v=[],n=[],q=[],E=c();if(65496!==E)throw new y("SOI not found");for(E=c();65497!==E;){var m,F;switch(E){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:m=p();65504===E&&74===m[0]&&70===m[1]&&73===m[2]&&70===
m[3]&&0===m[4]&&(l={version:{major:m[5],minor:m[6]},densityUnits:m[7],xDensity:m[8]<<8|m[9],yDensity:m[10]<<8|m[11],thumbWidth:m[12],thumbHeight:m[13],thumbData:m.subarray(14,14+3*m[12]*m[13])});65518===E&&65===m[0]&&100===m[1]&&111===m[2]&&98===m[3]&&101===m[4]&&(h={version:m[5]<<8|m[6],flags0:m[7]<<8|m[8],flags1:m[9]<<8|m[10],transformCode:m[11]});break;case 65499:for(var E=c()+b-2,C;b<E;){var z=a[b++],x=new Uint16Array(64);if(0===z>>4)for(m=0;64>m;m++)C=d[m],x[C]=a[b++];else if(1===z>>4)for(m=
0;64>m;m++)C=d[m],x[C]=c();else throw new y("DQT - invalid table spec");v[z&15]=x}break;case 65472:case 65473:case 65474:if(g)throw new y("Only single frame JPEGs supported");c();g={};g.extended=65473===E;g.progressive=65474===E;g.precision=a[b++];g.scanLines=c();g.samplesPerLine=c();g.components=[];g.componentIds={};m=a[b++];for(E=x=z=0;E<m;E++){C=a[b];F=a[b+1]>>4;var w=a[b+1]&15;z<F&&(z=F);x<w&&(x=w);F=g.components.push({h:F,v:w,quantizationId:a[b+2],quantizationTable:null});g.componentIds[C]=F-
1;b+=3}g.maxH=z;g.maxV=x;e(g);break;case 65476:C=c();for(E=2;E<C;){z=a[b++];x=new Uint8Array(16);for(m=F=0;16>m;m++,b++)F+=x[m]=a[b];w=new Uint8Array(F);for(m=0;m<F;m++,b++)w[m]=a[b];E+=17+F;(0===z>>4?q:n)[z&15]=u(x,w)}break;case 65501:c();t=c();break;case 65498:c();C=a[b++];m=[];for(var B,E=0;E<C;E++)z=g.componentIds[a[b++]],B=g.components[z],z=a[b++],B.huffmanTableDC=q[z>>4],B.huffmanTableAC=n[z&15],m.push(B);E=a[b++];C=a[b++];z=a[b++];E=f(a,b,g,m,t,E,C,z>>4,z&15);b+=E;break;case 65535:255!==a[b]&&
b--;break;default:if(255===a[b-3]&&192<=a[b-2]&&254>=a[b-2])b-=3;else throw new y("unknown marker "+E.toString(16));}E=c()}this.width=g.samplesPerLine;this.height=g.scanLines;this.jfif=l;this.eof=b;this.adobe=h;this.components=[];for(E=0;E<g.components.length;E++){B=g.components[E];if(l=v[B.quantizationId])B.quantizationTable=l;this.components.push({output:k(g,B),scaleX:B.h/g.maxH,scaleY:B.v/g.maxV,blocksPerLine:B.blocksPerLine,blocksPerColumn:B.blocksPerColumn})}this.numComponents=this.components.length},
_getLinearizedBlockData:function(a,c){var d=this.width/a,e=this.height/c,b,f,h,g,k,v,n=0,q,r=this.components.length,m=a*c*r,F=new Uint8ClampedArray(m),u=new Uint32Array(a);for(v=0;v<r;v++){b=this.components[v];f=b.scaleX*d;h=b.scaleY*e;n=v;q=b.output;g=b.blocksPerLine+1<<3;for(k=0;k<a;k++)b=0|k*f,u[k]=(b&4294967288)<<3|b&7;for(f=0;f<c;f++)for(b=0|f*h,b=g*(b&4294967288)|(b&7)<<3,k=0;k<a;k++)F[n]=q[b+u[k]],n+=r}if(c=this.decodeTransform)for(v=0;v<m;)for(a=b=0;b<r;b++,v++,a+=2)F[v]=(F[v]*c[a]>>8)+c[a+
1];return F},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,d,e,b=0,f=a.length;b<f;b+=3)c=a[b],d=a[b+1],e=a[b+2],a[b]=c-179.456+1.402*e,a[b+1]=c+135.459-.344*d-.714*e,a[b+2]=c-226.816+1.772*d;return a},_convertYcckToRgb:function(a){for(var c,d,e,b,f=0,h=0,g=a.length;h<g;h+=4)c=a[h],d=a[h+1],e=a[h+2],b=a[h+3],a[f++]=-122.67195406894+d*(-6.60635669420364E-5*
d+4.37130475926232E-4*e-5.4080610064599E-5*c+4.8449797120281E-4*b-.154362151871126)+e*(-9.57964378445773E-4*e+8.17076911346625E-4*c-.00477271405408747*b+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*b+.48357088451265)+b*(-3.36197177618394E-4*b+.484791561490776),a[f++]=107.268039397724+d*(2.19927104525741E-5*d-6.40992018297945E-4*e+6.59397001245577E-4*c+4.26105652938837E-4*b-.176491792462875)+e*(-7.78269941513683E-4*e+.00130872261408275*c+7.70482631801132E-4*b-.151051492775562)+c*(.00126935368114843*
c-.00265090189010898*b+.25802910206845)+b*(-3.18913117588328E-4*b-.213742400323665),a[f++]=-20.810012546947+d*(-5.70115196973677E-4*d-2.63409051004589E-5*e+.0020741088115012*c-.00288260236853442*b+.814272968359295)+e*(-1.53496057440975E-5*e-1.32689043961446E-4*c+5.60833691242812E-4*b-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*b+.116935020465145)+b*(-3.43531996510555E-4*b+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,d,e,b=0,f=a.length;b<f;b+=4)c=a[b],d=a[b+
1],e=a[b+2],a[b]=434.456-c-1.402*e,a[b+1]=119.541-c+.344*d+.714*e,a[b+2]=481.816-c-1.772*d;return a},_convertCmykToRgb:function(a){for(var c,d,e,b,f=0,h=1/255,g=0,k=a.length;g<k;g+=4)c=a[g]*h,d=a[g+1]*h,e=a[g+2]*h,b=a[g+3]*h,a[f++]=255+c*(-4.387332384609988*c+54.48615194189176*d+18.82290502165302*e+212.25662451639585*b-285.2331026137004)+d*(1.7149763477362134*d-5.6096736904047315*e-17.873870861415444*b-5.497006427196366)+e*(-2.5217340131683033*e-21.248923337353073*b+17.5119270841813)-b*(21.86122147463605*
b+189.48180835922747),a[f++]=255+c*(8.841041422036149*c+60.118027045597366*d+6.871425592049007*e+31.159100130055922*b-79.2970844816548)+d*(-15.310361306967817*d+17.575251261109482*e+131.35250912493976*b-190.9453302588951)+e*(4.444339102852739*e+9.8632861493405*b-24.86741582555878)-b*(20.737325471181034*b+187.80453709719578),a[f++]=255+c*(.8842522430003296*c+8.078677503112928*d+30.89978309703729*e-.23883238689178934*b-14.183576799673286)+d*(10.49593273432072*d+63.02378494754052*e+50.606957656360734*
b-112.23884253719248)+e*(.03296041114873217*e+115.60384449646641*b-193.58209356861505)-b*(22.33816807309886*b+180.12613974708367);return a},getData:function(a,c,d){if(4<this.numComponents)throw new y("Unsupported color mode");a=this._getLinearizedBlockData(a,c);if(1===this.numComponents&&d){d=a.length;c=new Uint8ClampedArray(3*d);for(var e=0,b=0;b<d;b++){var f=a[b];c[e++]=f;c[e++]=f;c[e++]=f}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===
this.numComponents){if(this._isColorConversionNeeded())return d?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(d)return this._convertCmykToRgb(a)}return a}};return m}()})},"esri/layers/support/rasterFormats/Lerc2Codec":function(){define([],function(){var y={unstuff:function(f,k,r,d,a,c,p,e){var b=(1<<r)-1,l=0,h,g=0,t,v;f[f.length-1]<<=8*(4*f.length-Math.ceil(r*d/8));if(a)for(h=0;h<d;h++)0===g&&(v=f[l++],g=32),g>=r?(t=v>>>g-r&b,g-=r):(g=r-g,t=(v&b)<<g&b,v=f[l++],g=32-g,t+=v>>>g),k[h]=a[t];
else for(a=Math.ceil((e-c)/p),h=0;h<d;h++)0===g&&(v=f[l++],g=32),g>=r?(t=v>>>g-r&b,g-=r):(g=r-g,t=(v&b)<<g&b,v=f[l++],g=32-g,t+=v>>>g),k[h]=t<a?c+t*p:e},unstuffLUT:function(f,k,r,d,a,c){var p=(1<<k)-1,e=0,b=0,l=0,h=l=0,g,t=[];f[f.length-1]<<=8*(4*f.length-Math.ceil(k*r/8));for(var v=Math.ceil((c-d)/a),b=0;b<r;b++)0===l&&(g=f[e++],l=32),l>=k?(h=g>>>l-k&p,l-=k):(l=k-l,h=(g&p)<<l&p,g=f[e++],l=32-l,h+=g>>>l),t[b]=h<v?d+h*a:c;t.unshift(d);return t},unstuff2:function(f,k,r,d,a,c,p,e){var b=(1<<r)-1,l=0,
h,g=0,t=0,v,n,q;if(a)for(h=0;h<d;h++)0===g&&(n=f[l++],g=32,t=0),g>=r?(v=n>>>t&b,g-=r,t+=r):(q=r-g,v=n>>>t&b,n=f[l++],g=32-q,v|=(n&(1<<q)-1)<<r-q,t=q),k[h]=a[v];else for(a=Math.ceil((e-c)/p),h=0;h<d;h++)0===g&&(n=f[l++],g=32,t=0),g>=r?(v=n>>>t&b,g-=r,t+=r):(q=r-g,v=n>>>t&b,n=f[l++],g=32-q,v|=(n&(1<<q)-1)<<r-q,t=q),k[h]=v<a?c+v*p:e;return k},unstuffLUT2:function(f,k,r,d,a,c){for(var p=(1<<k)-1,e=0,b=0,l=0,h=0,g=0,t=0,v,n=[],q=Math.ceil((c-d)/a),b=0;b<r;b++)0===h&&(v=f[e++],h=32,t=0),h>=k?(g=v>>>t&p,
h-=k,t+=k):(l=k-h,g=v>>>t&p,v=f[e++],h=32-l,g|=(v&(1<<l)-1)<<k-l,t=l),n[b]=g<q?d+g*a:c;n.unshift(d);return n},originalUnstuff:function(f,k,r,d){var a=(1<<r)-1,c=0,p,e=0,b,l;f[f.length-1]<<=8*(4*f.length-Math.ceil(r*d/8));for(p=0;p<d;p++)0===e&&(l=f[c++],e=32),e>=r?(b=l>>>e-r&a,e-=r):(e=r-e,b=(l&a)<<e&a,l=f[c++],e=32-e,b+=l>>>e),k[p]=b;return k},originalUnstuff2:function(f,k,r,d){var a=(1<<r)-1,c=0,p,e=0,b=0,l,h,g;for(p=0;p<d;p++)0===e&&(h=f[c++],e=32,b=0),e>=r?(l=h>>>b&a,e-=r,b+=r):(g=r-e,l=h>>>b&
a,h=f[c++],e=32-g,l|=(h&(1<<g)-1)<<r-g,b=g),k[p]=l;return k}},m={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(f){for(var k=65535,r=65535,d=f.length,a=Math.floor(d/2),c=0;a;){var p=359<=a?359:a,a=a-p;do k+=f[c++]<<8,r+=k+=f[c++];while(--p);k=(k&65535)+(k>>>16);r=(r&65535)+(r>>>16)}d&1&&(r+=k+=f[c]<<8);return((r&65535)+(r>>>16)<<16|(k&65535)+(k>>>16))>>>0},readHeaderInfo:function(f,k){var r=k.ptr,d=new Uint8Array(f,r,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,d);if(0!==
a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;var r=r+6,d=new DataView(f,r,8),c=d.getInt32(0,!0);a.fileVersion=c;r+=4;3<=c&&(a.checksum=d.getUint32(4,!0),r+=4);d=new DataView(f,r,12);a.height=d.getUint32(0,!0);a.width=d.getUint32(4,!0);r+=8;4<=c?(a.numDims=d.getUint32(8,!0),r+=4):a.numDims=1;d=new DataView(f,r,40);a.numValidPixel=d.getUint32(0,!0);a.microBlockSize=d.getInt32(4,!0);a.blobSize=d.getInt32(8,!0);a.imageType=
d.getInt32(12,!0);a.maxZError=d.getFloat64(16,!0);a.zMin=d.getFloat64(24,!0);a.zMax=d.getFloat64(32,!0);r+=40;k.headerInfo=a;k.ptr=r;if(3<=c&&(f=this.computeChecksumFletcher32(new Uint8Array(f,r-(4<=c?52:48),a.blobSize-14)),f!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(f,k){var r=k.headerInfo,d=this.getDataTypeArray(r.imageType),a=r.numDims*this.getDataTypeSize(r.imageType),c=this.readSubArray(f,k.ptr,d,a);f=this.readSubArray(f,k.ptr+a,d,a);k.ptr+=2*a;a=!0;for(k=0;k<
r.numDims;k++)if(c[k]!==f[k]){a=!1;break}r.minValues=c;r.maxValues=f;return a},readSubArray:function(f,k,r,d){if(r===Uint8Array)f=new Uint8Array(f,k,d);else{var a=new ArrayBuffer(d);(new Uint8Array(a)).set(new Uint8Array(f,k,d));f=new r(a)}return f},readMask:function(f,k){var r=k.ptr,d=k.headerInfo,a=d.width*d.height,c=d.numValidPixel,p=new DataView(f,r,4),d={};d.numBytes=p.getUint32(0,!0);r+=4;if((0===c||a===c)&&0!==d.numBytes)throw"invalid mask";if(0===c)c=new Uint8Array(Math.ceil(a/8)),d.bitset=
c,p=new Uint8Array(a),k.pixels.resultMask=p,r+=d.numBytes;else if(0<d.numBytes){c=new Uint8Array(Math.ceil(a/8));p=new DataView(f,r,d.numBytes);f=p.getInt16(0,!0);var e=2,b=0,l=0;do{if(0<f)for(;f--;)c[b++]=p.getUint8(e++);else for(l=p.getUint8(e++),f=-f;f--;)c[b++]=l;f=p.getInt16(e,!0);e+=2}while(e<d.numBytes);if(-32768!==f||b<c.length)throw"Unexpected end of mask RLE encoding";p=new Uint8Array(a);for(e=e=f=0;e<a;e++)e&7?(f=c[e>>3],f<<=e&7):f=c[e>>3],f&128&&(p[e]=1);k.pixels.resultMask=p;d.bitset=
c;r+=d.numBytes}k.ptr=r;k.mask=d;return!0},readDataOneSweep:function(f,k,r){var d=k.ptr,a=k.headerInfo,c=a.numDims,p=a.width*a.height,a=a.numValidPixel*m.getDataTypeSize(a.imageType)*c,e=k.pixels.resultMask;if(r===Uint8Array)f=new Uint8Array(f,d,a);else{var b=new ArrayBuffer(a);(new Uint8Array(b)).set(new Uint8Array(f,d,a));f=new r(b)}if(f.length===p*c)k.pixels.resultPixels=f;else{k.pixels.resultPixels=new r(p*c);var l=b=r=0,h=0;if(1<c)for(l=0;l<c;l++)for(h=l*p,b=0;b<p;b++)e[b]&&(k.pixels.resultPixels[h+
b]=f[r++]);else for(b=0;b<p;b++)e[b]&&(k.pixels.resultPixels[b]=f[r++])}k.ptr=d+a;return!0},readHuffmanTree:function(f,k){var r=this.HUFFMAN_LUT_BITS_MAX,d=new DataView(f,k.ptr,16);k.ptr+=16;if(2>d.getInt32(0,!0))throw"unsupported Huffman version";var a=d.getInt32(4,!0),c=d.getInt32(8,!0),d=d.getInt32(12,!0);if(c>=d)return!1;var p=new Uint32Array(d-c);m.decodeBits(f,k,p);var e=[],b,l,h;for(b=c;b<d;b++)l=b-(b<a?0:a),e[l]={first:p[b-c],second:null};b=f.byteLength-k.ptr;p=new ArrayBuffer(4*Math.ceil(b/
4));(new Uint8Array(p)).set(new Uint8Array(f,k.ptr,b));f=new Uint32Array(p);k=0;var g,p=0;g=f[0];for(b=c;b<d;b++)l=b-(b<a?0:a),h=e[l].first,0<h&&(e[l].second=g<<k>>>32-h,32-k>=h?(k+=h,32===k&&(k=0,p++,g=f[p])):(k+=h-32,p++,g=f[p],e[l].second|=g>>>32-k));var t=g=0,v=new u;for(b=0;b<e.length;b++)void 0!==e[b]&&(g=Math.max(g,e[b].first));var t=g>=r?r:g,r=[],n,q;for(b=c;b<d;b++)if(l=b-(b<a?0:a),h=e[l].first,0<h)if(c=[h,l],h<=t)for(l=e[l].second<<t-h,n=1<<t-h,h=0;h<n;h++)r[l|h]=c;else for(l=e[l].second,
n=v,--h;0<=h;h--)(q=l>>>h&1)?(n.right||(n.right=new u),n=n.right):(n.left||(n.left=new u),n=n.left),0!==h||n.val||(n.val=c[1]);return{decodeLut:r,numBitsLUTQick:t,numBitsLUT:g,tree:v,stuffedData:f,srcPtr:p,bitPos:k}},readHuffman:function(f,k,r){var d=k.headerInfo,a=d.numDims,c=k.headerInfo.height,p=k.headerInfo.width,e=p*c,b=this.readHuffmanTree(f,k);f=b.decodeLut;var l=b.tree,h=b.stuffedData,g=b.srcPtr,t=b.bitPos,v=b.numBitsLUTQick,b=b.numBitsLUT,n=0===k.headerInfo.imageType?128:0,q,m,A=k.pixels.resultMask,
F,u,z,x,w,B,y=0;0<t&&(g++,t=0);var G=h[g],D=1===k.encodeMode,L=new r(e*a),J=L,P;for(P=0;P<d.numDims;P++){1<a&&(J=new r(L.buffer,e*P,e),y=0);if(k.headerInfo.numValidPixel===p*c)for(z=w=0;z<c;z++)for(x=0;x<p;x++,w++){m=0;q=F=G<<t>>>32-v;32-t<v&&(q=F|=h[g+1]>>>64-t-v);if(f[q])m=f[q][1],t+=f[q][0];else for(q=F=G<<t>>>32-b,32-t<b&&(q=F|=h[g+1]>>>64-t-b),q=l,B=0;B<b;B++)if(q=(u=F>>>b-B-1&1)?q.right:q.left,!q.left&&!q.right){m=q.val;t=t+B+1;break}32<=t&&(t-=32,g++,G=h[g]);m-=n;D?(m=0<x?m+y:0<z?m+J[w-p]:
m+y,m&=255,y=J[w]=m):J[w]=m}else for(z=w=0;z<c;z++)for(x=0;x<p;x++,w++)if(A[w]){m=0;q=F=G<<t>>>32-v;32-t<v&&(q=F|=h[g+1]>>>64-t-v);if(f[q])m=f[q][1],t+=f[q][0];else for(q=F=G<<t>>>32-b,32-t<b&&(q=F|=h[g+1]>>>64-t-b),q=l,B=0;B<b;B++)if(q=(u=F>>>b-B-1&1)?q.right:q.left,!q.left&&!q.right){m=q.val;t=t+B+1;break}32<=t&&(t-=32,g++,G=h[g]);m-=n;D?(m=0<x&&A[w-1]?m+y:0<z&&A[w-p]?m+J[w-p]:m+y,m&=255,y=J[w]=m):J[w]=m}k.ptr=k.ptr+4*(g+1)+(0<t?4:0)}k.pixels.resultPixels=L},decodeBits:function(f,k,m,d,a){var c=
k.headerInfo,p=c.fileVersion,e=0,b=new DataView(f,k.ptr,5<=f.byteLength-k.ptr?5:f.byteLength-k.ptr),l=b.getUint8(0);e++;var h=l>>6,g=0===h?4:3-h,t=0<(l&32)?!0:!1,h=l&31,l=0;if(1===g)l=b.getUint8(e),e++;else if(2===g)l=b.getUint16(e,!0),e+=2;else if(4===g)l=b.getUint32(e,!0),e+=4;else throw"Invalid valid pixel count type";var g=2*c.maxZError,v,n;a=1<c.numDims?c.maxValues[a]:c.zMax;if(t){k.counter.lut++;t=b.getUint8(e);e++;c=Math.ceil((t-1)*h/8);v=Math.ceil(c/4);v=new ArrayBuffer(4*v);n=new Uint8Array(v);
k.ptr+=e;n.set(new Uint8Array(f,k.ptr,c));e=new Uint32Array(v);k.ptr+=c;for(b=0;t-1>>>b;)b++;c=Math.ceil(l*b/8);v=Math.ceil(c/4);v=new ArrayBuffer(4*v);n=new Uint8Array(v);n.set(new Uint8Array(f,k.ptr,c));f=new Uint32Array(v);k.ptr+=c;k=3<=p?y.unstuffLUT2(e,h,t-1,d,g,a):y.unstuffLUT(e,h,t-1,d,g,a);3<=p?y.unstuff2(f,m,b,l,k):y.unstuff(f,m,b,l,k)}else k.counter.bitstuffer++,b=h,k.ptr+=e,0<b&&(c=Math.ceil(l*b/8),v=Math.ceil(c/4),v=new ArrayBuffer(4*v),n=new Uint8Array(v),n.set(new Uint8Array(f,k.ptr,
c)),f=new Uint32Array(v),k.ptr+=c,3<=p?null==d?y.originalUnstuff2(f,m,b,l):y.unstuff2(f,m,b,l,!1,d,g,a):null==d?y.originalUnstuff(f,m,b,l):y.unstuff(f,m,b,l,!1,d,g,a))},readTiles:function(f,k,r){var d=k.headerInfo,a=d.width,c=d.height,p=d.microBlockSize,e=d.imageType,b=m.getDataTypeSize(e),l=Math.ceil(a/p),h=Math.ceil(c/p);k.pixels.numBlocksY=h;k.pixels.numBlocksX=l;for(var g=k.pixels.ptr=0,t=0,v=0,n=0,q=0,E=0,A=0,F=0,u=0,z=0,x=0,w=0,B=0,A=B=A=0,y,G=new r(p*p),D=c%p||p,L=a%p||p,J=d.numDims,P,I=k.pixels.resultMask,
M=k.pixels.resultPixels,X=5<=d.fileVersion?14:15,N=d.zMax,v=0;v<h;v++)for(q=v!==h-1?p:D,n=0;n<l;n++)for(E=n!==l-1?p:L,x=v*a*p+n*p,w=a-E,P=0;P<J;P++){1<J?(B=M,x=v*a*p+n*p,M=new r(k.pixels.resultPixels.buffer,a*c*P*b,a*c),N=d.maxValues[P]):B=null;A=f.byteLength-k.ptr;g=new DataView(f,k.ptr,Math.min(10,A));t={};A=0;F=g.getUint8(0);A++;y=5<=d.fileVersion?F&4:0;u=F>>6&255;z=F>>2&X;if(z!==(n*p>>3&X))throw"integrity issue";if(y&&0===P)throw"integrity issue";F&=3;if(3<F)throw k.ptr+=A,"Invalid block encoding ("+
F+")";if(2===F){if(y)if(I)for(g=0;g<q;g++)for(t=0;t<E;t++)I[x]&&(M[x]=B[x]),x++;else for(g=0;g<q;g++)for(t=0;t<E;t++)M[x]=B[x],x++;k.counter.constant++;k.ptr+=A}else if(0===F){if(y)throw"integrity issue";k.counter.uncompressed++;k.ptr+=A;B=q*E*b;A=f.byteLength-k.ptr;B=B<A?B:A;A=new ArrayBuffer(0===B%b?B:B+b-B%b);y=new Uint8Array(A);y.set(new Uint8Array(f,k.ptr,B));A=new r(A);B=0;if(I)for(g=0;g<q;g++){for(t=0;t<E;t++)I[x]&&(M[x]=A[B++]),x++;x+=w}else for(g=0;g<q;g++){for(t=0;t<E;t++)M[x++]=A[B++];
x+=w}k.ptr+=B*b}else if(u=m.getDataTypeUsed(y&&6>e?5:e,u),z=m.getOnePixel(t,A,u,g),A+=m.getDataTypeSize(u),3===F)if(k.ptr+=A,k.counter.constantoffset++,I)for(g=0;g<q;g++){for(t=0;t<E;t++)I[x]&&(M[x]=y?Math.min(N,B[x]+z):z),x++;x+=w}else for(g=0;g<q;g++){for(t=0;t<E;t++)M[x]=y?Math.min(N,B[x]+z):z,x++;x+=w}else if(k.ptr+=A,m.decodeBits(f,k,G,z,P),A=0,y)if(I)for(g=0;g<q;g++){for(t=0;t<E;t++)I[x]&&(M[x]=G[A++]+B[x]),x++;x+=w}else for(g=0;g<q;g++){for(t=0;t<E;t++)M[x]=G[A++]+B[x],x++;x+=w}else if(I)for(g=
0;g<q;g++){for(t=0;t<E;t++)I[x]&&(M[x]=G[A++]),x++;x+=w}else for(g=0;g<q;g++){for(t=0;t<E;t++)M[x++]=G[A++];x+=w}}},formatFileInfo:function(f){return{fileIdentifierString:f.headerInfo.fileIdentifierString,fileVersion:f.headerInfo.fileVersion,imageType:f.headerInfo.imageType,height:f.headerInfo.height,width:f.headerInfo.width,numValidPixel:f.headerInfo.numValidPixel,microBlockSize:f.headerInfo.microBlockSize,blobSize:f.headerInfo.blobSize,maxZError:f.headerInfo.maxZError,pixelType:m.getPixelType(f.headerInfo.imageType),
eofOffset:f.eofOffset,mask:f.mask?{numBytes:f.mask.numBytes}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,maxValue:f.headerInfo.zMax,minValue:f.headerInfo.zMin,noDataValue:f.noDataValue}}},constructConstantSurface:function(f){var k=f.headerInfo.zMax,m=f.headerInfo.numDims,d=f.headerInfo.height*f.headerInfo.width,a=0,c=0,p=0,e=f.pixels.resultMask,b=f.pixels.resultPixels;if(e)if(1<m)for(a=0;a<m;a++)for(p=a*d,k=f.headerInfo.maxValues[a],c=0;c<d;c++)e[c]&&(b[p+c]=k);else for(c=
0;c<d;c++)e[c]&&(b[c]=k);else if(1<m)for(a=0;a<m;a++)for(p=a*d,k=f.headerInfo.maxValues[a],c=0;c<d;c++)b[p+c]=k;else for(c=0;c<d;c++)b[c]=k},getDataTypeArray:function(f){switch(f){case 0:f=Int8Array;break;case 1:f=Uint8Array;break;case 2:f=Int16Array;break;case 3:f=Uint16Array;break;case 4:f=Int32Array;break;case 5:f=Uint32Array;break;case 6:f=Float32Array;break;case 7:f=Float64Array;break;default:f=Float32Array}return f},getPixelType:function(f){switch(f){case 0:f="S8";break;case 1:f="U8";break;
case 2:f="S16";break;case 3:f="U16";break;case 4:f="S32";break;case 5:f="U32";break;case 6:f="F32";break;case 7:f="F64";break;default:f="F32"}return f},isValidPixelValue:function(f,k){if(null==k)return!1;switch(f){case 0:f=-128<=k&&127>=k;break;case 1:f=0<=k&&255>=k;break;case 2:f=-32768<=k&&32767>=k;break;case 3:f=0<=k&&65536>=k;break;case 4:f=-2147483648<=k&&2147483647>=k;break;case 5:f=0<=k&&4294967296>=k;break;case 6:f=-3.4027999387901484E38<=k&&3.4027999387901484E38>=k;break;case 7:f=4.9E-324<=
k&&1.7976931348623157E308>=k;break;default:f=!1}return f},getDataTypeSize:function(f){var k=0;switch(f){case 0:case 1:k=1;break;case 2:case 3:k=2;break;case 4:case 5:case 6:k=4;break;case 7:k=8;break;default:k=f}return k},getDataTypeUsed:function(f,k){var m=f;switch(f){case 2:case 4:m=f-k;break;case 3:case 5:m=f-2*k;break;case 6:m=0===k?f:1===k?2:1;break;case 7:m=0===k?f:f-2*k+1;break;default:m=f}return m},getOnePixel:function(f,k,m,d){f=0;switch(m){case 0:f=d.getInt8(k);break;case 1:f=d.getUint8(k);
break;case 2:f=d.getInt16(k,!0);break;case 3:f=d.getUint16(k,!0);break;case 4:f=d.getInt32(k,!0);break;case 5:f=d.getUInt32(k,!0);break;case 6:f=d.getFloat32(k,!0);break;case 7:f=d.getFloat64(k,!0);break;default:throw"the decoder does not understand this pixel type";}return f}},u=function(f,k,m){this.val=f;this.left=k;this.right=m};return{decode:function(f,k){k=k||{};var r=k.noDataValue,d=0,a={};a.ptr=k.inputOffset||0;a.pixels={};if(m.readHeaderInfo(f,a)){var d=a.headerInfo,c=d.fileVersion,p=m.getDataTypeArray(d.imageType);
if(5<c)throw"unsupported lerc version 2."+c;m.readMask(f,a);d.numValidPixel===d.width*d.height||a.pixels.resultMask||(a.pixels.resultMask=k.maskData);var e=d.width*d.height;a.pixels.resultPixels=new p(e*d.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==d.numValidPixel)if(d.zMax===d.zMin)m.constructConstantSurface(a);else if(4<=c&&m.checkMinMaxRanges(f,a))m.constructConstantSurface(a);else{var b=new DataView(f,a.ptr,2),l=b.getUint8(0);a.ptr++;if(l)m.readDataOneSweep(f,
a,p);else if(1<c&&1>=d.imageType&&1E-5>Math.abs(d.maxZError-.5)){b=b.getUint8(1);a.ptr++;a.encodeMode=b;if(2<b||4>c&&1<b)throw"Invalid Huffman flag "+b;b?m.readHuffman(f,a,p):m.readTiles(f,a,p)}else m.readTiles(f,a,p)}a.eofOffset=a.ptr;k.inputOffset?(f=a.headerInfo.blobSize+k.inputOffset-a.ptr,1<=Math.abs(f)&&(a.eofOffset=k.inputOffset+a.headerInfo.blobSize)):(f=a.headerInfo.blobSize-a.ptr,1<=Math.abs(f)&&(a.eofOffset=a.headerInfo.blobSize));f={width:d.width,height:d.height,pixelData:a.pixels.resultPixels,
minValue:d.zMin,maxValue:d.zMax,validPixelCount:d.numValidPixel,dimCount:d.numDims,dimStats:{minValues:d.minValues,maxValues:d.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&m.isValidPixelValue(d.imageType,r)){c=a.pixels.resultMask;for(d=0;d<e;d++)c[d]||(f.pixelData[d]=r);f.noDataValue=r}a.noDataValue=r;k.returnFileInfo&&(f.fileInfo=m.formatFileInfo(a));return f}},getBandCount:function(f){for(var k=0,r=0,d={ptr:0,pixels:{}};r<f.byteLength-58;)m.readHeaderInfo(f,d),r+=d.headerInfo.blobSize,
k++,d.ptr=r;return k}}})},"esri/layers/support/rasterFormats/LercCodec":function(){define(["../../../core/mathUtils"],function(y){var m={};m.defaultNoDataValue=y.clampFloat32(-Infinity);m.decode=function(f,k){var r;k=k||{};var d=k.inputOffset||0,a=k.encodedMaskData||null===k.encodedMaskData,c={},p=new Uint8Array(f,d,10);c.fileIdentifierString=String.fromCharCode.apply(null,p);if("CntZImage"!=c.fileIdentifierString.trim())throw"Unexpected file identifier string: "+c.fileIdentifierString;d+=10;p=new DataView(f,
d,24);c.fileVersion=p.getInt32(0,!0);c.imageType=p.getInt32(4,!0);c.height=p.getUint32(8,!0);c.width=p.getUint32(12,!0);c.maxZError=p.getFloat64(16,!0);d+=24;if(!a)if(p=new DataView(f,d,16),c.mask={},c.mask.numBlocksY=p.getUint32(0,!0),c.mask.numBlocksX=p.getUint32(4,!0),c.mask.numBytes=p.getUint32(8,!0),c.mask.maxValue=p.getFloat32(12,!0),d+=16,0<c.mask.numBytes){var a=new Uint8Array(Math.ceil(c.width*c.height/8)),p=new DataView(f,d,c.mask.numBytes),e=p.getInt16(0,!0),b=2,l=0;do{if(0<e)for(;e--;)a[l++]=
p.getUint8(b++);else for(var h=p.getUint8(b++),e=-e;e--;)a[l++]=h;e=p.getInt16(b,!0);b+=2}while(b<c.mask.numBytes);if(-32768!==e||l<a.length)throw"Unexpected end of mask RLE encoding";c.mask.bitset=a;d+=c.mask.numBytes}else 0===(c.mask.numBytes|c.mask.numBlocksY|c.mask.maxValue)&&(a=new Uint8Array(Math.ceil(c.width*c.height/8)),c.mask.bitset=a);p=new DataView(f,d,16);c.pixels={};c.pixels.numBlocksY=p.getUint32(0,!0);c.pixels.numBlocksX=p.getUint32(4,!0);c.pixels.numBytes=p.getUint32(8,!0);c.pixels.maxValue=
p.getFloat32(12,!0);d+=16;a=c.pixels.numBlocksX;p=c.pixels.numBlocksY;a+=0<c.width%a?1:0;e=p+(0<c.height%p?1:0);c.pixels.blocks=Array(a*e);b=1E9;for(h=l=0;h<e;h++)for(var g=0;g<a;g++){var t=0,p=new DataView(f,d,Math.min(10,f.byteLength-d)),v={};c.pixels.blocks[l++]=v;var n=p.getUint8(0);t++;v.encoding=n&63;if(3<v.encoding)throw"Invalid block encoding ("+v.encoding+")";if(2===v.encoding)d++,b=Math.min(b,0);else{if(0!==n&&2!==n){n>>=6;v.offsetType=n;if(2===n)v.offset=p.getInt8(1),t++;else if(1===n)v.offset=
p.getInt16(1,!0),t+=2;else if(0===n)v.offset=p.getFloat32(1,!0),t+=4;else throw"Invalid block offset type";b=Math.min(v.offset,b);if(1===v.encoding)if(n=p.getUint8(t),t++,v.bitsPerPixel=n&63,n>>=6,v.numValidPixelsType=n,2===n)v.numValidPixels=p.getUint8(t),t++;else if(1===n)v.numValidPixels=p.getUint16(t,!0),t+=2;else if(0===n)v.numValidPixels=p.getUint32(t,!0),t+=4;else throw"Invalid valid pixel count type";}d+=t;if(3!=v.encoding)if(0===v.encoding){p=(c.pixels.numBytes-1)/4;if(p!==Math.floor(p))throw"uncompressed block has invalid length";
t=new ArrayBuffer(4*p);n=new Uint8Array(t);n.set(new Uint8Array(f,d,4*p));t=new Float32Array(t);for(n=0;n<t.length;n++)b=Math.min(b,t[n]);v.rawData=t;d+=4*p}else 1===v.encoding&&(p=Math.ceil(v.numValidPixels*v.bitsPerPixel/8),t=new ArrayBuffer(4*Math.ceil(p/4)),n=new Uint8Array(t),n.set(new Uint8Array(f,d,p)),v.stuffedData=new Uint32Array(t),d+=p)}}c.pixels.minValue=b;c.eofOffset=d;f=null!=k.noDataValue?y.clampFloat32(k.noDataValue):m.defaultNoDataValue;var a=k.encodedMaskData,v=k.returnMask,p=0,
e=c.pixels.numBlocksX,b=c.pixels.numBlocksY,l=Math.floor(c.width/e),h=Math.floor(c.height/b),g=2*c.maxZError,a=a||(c.mask?c.mask.bitset:null),q,d=new (k.pixelType||Float32Array)(c.width*c.height);v&&a&&(q=new Uint8Array(c.width*c.height));for(var v=new Float32Array(l*h),E,A,t=0;t<=b;t++)if(n=t!==b?h:c.height%b,0!==n)for(var F=0;F<=e;F++){var C=F!==e?l:c.width%e;if(0!==C){var z=t*c.width*h+F*l,x=c.width-C,w=c.pixels.blocks[p],B,H;if(2>w.encoding){if(0===w.encoding)B=w.rawData;else{B=w.stuffedData;
H=w.bitsPerPixel;E=w.numValidPixels;A=w.offset;var G=g,D=v,L=c.pixels.maxValue,J=(1<<H)-1,P=0,I=void 0,M=0,X=void 0,N=void 0,V=Math.ceil((L-A)/G);B[B.length-1]<<=8*(4*B.length-Math.ceil(H*E/8));for(I=0;I<E;I++)0===M&&(N=B[P++],M=32),M>=H?(X=N>>>M-H&J,M-=H):(M=H-M,X=(N&J)<<M&J,N=B[P++],M=32-M,X+=N>>>M),D[I]=X<V?A+X*G:L;B=v}H=0}else r=2===w.encoding?0:w.offset;var O;if(a)for(A=0;A<n;A++){z&7&&(O=a[z>>3],O<<=z&7);for(E=0;E<C;E++)z&7||(O=a[z>>3]),O&128?(q&&(q[z]=1),d[z++]=2>w.encoding?B[H++]:r):(q&&(q[z]=
0),d[z++]=f),O<<=1;z+=x}else if(2>w.encoding)for(A=0;A<n;A++){for(E=0;E<C;E++)d[z++]=B[H++];z+=x}else for(A=0;A<n;A++)if(d.fill)d.fill(r,z,z+C),z+=C+x;else{for(E=0;E<C;E++)d[z++]=r;z+=x}if(1===w.encoding&&H!==w.numValidPixels)throw"Block and Mask do not match";p++}}r=q;q={width:c.width,height:c.height,pixelData:d,minValue:c.pixels.minValue,maxValue:c.pixels.maxValue,noDataValue:f};r&&(q.maskData=r);k.returnEncodedMask&&c.mask&&(q.encodedMaskData=c.mask.bitset?c.mask.bitset:null);if(k.returnFileInfo&&
(q.fileInfo=u(c),k.computeUsedBitDepths)){k=q.fileInfo;r=c.pixels.numBlocksX*c.pixels.numBlocksY;O={};for(B=0;B<r;B++)H=c.pixels.blocks[B],0===H.encoding?O.float32=!0:1===H.encoding?O[H.bitsPerPixel]=!0:O[0]=!0;c=Object.keys(O);k.bitDepths=c}return q};var u=function(f){return{fileIdentifierString:f.fileIdentifierString,fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,
numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,minValue:f.pixels.minValue,noDataValue:this.noDataValue}}};return m})},"esri/layers/support/rasterFormats/Png":function(){define(["./Zlib"],function(y){return function(m){function u(d){var a,c,f,e;this.data=d;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(f=null;;){a=
this.readUInt32();e=d=void 0;e=[];for(d=0;4>d;++d)e.push(String.fromCharCode(this.data[this.pos++]));d=e.join("");switch(d){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};
break;case "PLTE":this.palette=this.read(a);break;case "fcTL":f&&this.animation.frames.push(f);this.pos+=4;f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};d=this.readUInt16();a=this.readUInt16()||100;f.delay=1E3*d/a;f.disposeOp=this.data[this.pos++];f.blendOp=this.data[this.pos++];f.data=[];break;case "IDAT":case "fdAT":"fdAT"===d&&(this.pos+=4,a-=4);d=(null!=f?f.data:void 0)||this.imgData;for(e=0;0<=a?e<a:e>a;0<=a?++e:--e)d.push(this.data[this.pos++]);
break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(a);a=255-this.transparency.indexed.length;if(0<a)for(d=0;0<=a?d<a:d>a;0<=a?++d:--d)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case "tEXt":e=this.read(a);a=e.indexOf(0);d=String.fromCharCode.apply(String,e.slice(0,a));this.text[d]=String.fromCharCode.apply(String,e.slice(a+1));break;case "IEND":f&&
this.animation.frames.push(f);a:{switch(this.colorType){case 0:case 3:case 4:f=1;break a;case 2:case 6:f=3;break a}f=void 0}this.colors=f;this.hasAlphaChannel=4===(c=this.colorType)||6===c;c=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*c;a:{switch(this.colors){case 1:c="DeviceGray";break a;case 3:c="DeviceRGB";break a}c=void 0}this.colorSpace=c;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=a}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");
}}var f,k,r;u.load=function(d,a,c){var f;"function"===typeof a&&(c=a);f=new XMLHttpRequest;f.open("GET",d,!0);f.responseType="arraybuffer";f.onload=function(){var e;e=new Uint8Array(f.response||f.mozResponseArrayBuffer);e=new u(e);"function"===typeof(null!=a?a.getContext:void 0)&&e.render(a);return"function"===typeof c?c(e):void 0};return f.send(null)};u.prototype.read=function(d){var a,c;c=[];for(a=0;0<=d?a<d:a>d;0<=d?++a:--a)c.push(this.data[this.pos++]);return c};u.prototype.readUInt32=function(){var d,
a,c,f;d=this.data[this.pos++]<<24;a=this.data[this.pos++]<<16;c=this.data[this.pos++]<<8;f=this.data[this.pos++];return d|a|c|f};u.prototype.readUInt16=function(){var d,a;d=this.data[this.pos++]<<8;a=this.data[this.pos++];return d|a};u.prototype.decodePixels=function(d){var a,c,f,e,b,l,h,g,k,m,n,q,r,A,u;null==d&&(d=this.imgData);if(0===d.length)return new Uint8Array(0);d=new y(d);d=d.getBytes();g=this.pixelBitlength/8;q=g*this.width;k=new Uint8Array(q*this.height);l=d.length;for(c=m=n=0;m<l;){switch(d[m++]){case 0:for(e=
a=0;a<q;e=a+=1)k[c++]=d[m++];break;case 1:for(e=r=0;r<q;e=r+=1)a=d[m++],b=e<g?0:k[c-g],k[c++]=(a+b)%256;break;case 2:for(e=b=0;b<q;e=b+=1)a=d[m++],f=(e-e%g)/g,r=n&&k[(n-1)*q+f*g+e%g],k[c++]=(r+a)%256;break;case 3:for(e=u=0;u<q;e=u+=1)a=d[m++],f=(e-e%g)/g,b=e<g?0:k[c-g],r=n&&k[(n-1)*q+f*g+e%g],k[c++]=(a+Math.floor((b+r)/2))%256;break;case 4:for(e=u=0;u<q;e=u+=1)a=d[m++],f=(e-e%g)/g,b=e<g?0:k[c-g],0===n?r=A=0:(r=k[(n-1)*q+f*g+e%g],A=f&&k[(n-1)*q+(f-1)*g+e%g]),h=b+r-A,e=Math.abs(h-b),f=Math.abs(h-r),
h=Math.abs(h-A),b=e<=f&&e<=h?b:f<=h?r:A,k[c++]=(a+b)%256;break;default:throw Error("Invalid filter algorithm: "+d[m-1]);}n++}return k};u.prototype.decodePalette=function(){var d,a,c,f,e,b,l,h,g;c=this.palette;b=this.transparency.indexed||[];e=new Uint8Array((b.length||0)+c.length);a=l=d=f=0;for(h=c.length;l<h;a=l+=3)e[f++]=c[a],e[f++]=c[a+1],e[f++]=c[a+2],e[f++]=null!=(g=b[d++])?g:255;return e};u.prototype.copyToImageData=function(d,a){var c,f,e,b,l,h,g;f=this.colors;g=null;c=this.hasAlphaChannel;
this.palette.length&&(g=null!=(e=this._decodedPalette)?e:this._decodedPalette=this.decodePalette(),f=4,c=!0);d=d.data||d;h=d.length;b=g||a;e=l=0;if(1===f)for(;e<h;)f=g?4*a[e/4]:l,l=b[f++],d[e++]=l,d[e++]=l,d[e++]=l,d[e++]=c?b[f++]:this.transparency.grayscale&&this.transparency.grayscale===l?0:255,l=f;else for(;e<h;)f=g?4*a[e/4]:l,d[e++]=b[f++],d[e++]=b[f++],d[e++]=b[f++],d[e++]=c?b[f++]:this.transparency.rgb&&this.transparency.rgb[1]===b[f-3]&&this.transparency.rgb[3]===b[f-2]&&this.transparency.rgb[5]===
b[f-1]?0:255,l=f};u.prototype.decode=function(){var d;d=new Uint8Array(this.width*this.height*4);this.copyToImageData(d,this.decodePixels());return d};r=(k=m.document&&m.document.createElement("canvas"))&&k.getContext("2d");f=function(d){r.width=d.width;r.height=d.height;r.clearRect(0,0,d.width,d.height);r.putImageData(d,0,0);d=new Image;d.src=k.toDataURL();return d};u.prototype.decodeFrames=function(d){var a,c,p,e,b,l,h;if(this.animation){l=this.animation.frames;h=[];a=e=0;for(b=l.length;e<b;a=++e)a=
l[a],c=d.createImageData(a.width,a.height),p=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(c,p),a.imageData=c,h.push(a.image=f(c));return h}};u.prototype.renderFrame=function(d,a){var c,f;f=this.animation.frames;c=f[a];f=f[a-1];0===a&&d.clearRect(0,0,this.width,this.height);1===(null!=f?f.disposeOp:void 0)?d.clearRect(f.xOffset,f.yOffset,f.width,f.height):2===(null!=f?f.disposeOp:void 0)&&d.putImageData(f.imageData,f.xOffset,f.yOffset);0===c.blendOp&&d.clearRect(c.xOffset,c.yOffset,
c.width,c.height);return d.drawImage(c.image,c.xOffset,c.yOffset)};u.prototype.animate=function(d){var a,c,f,e,b,l,h=this;c=0;l=this.animation;e=l.numFrames;f=l.frames;b=l.numPlays;return(a=function(){var g,l;g=c++%e;l=f[g];h.renderFrame(d,g);if(1<e&&c/e<b)return h.animation._timeout=setTimeout(a,l.delay)})()};u.prototype.stopAnimation=function(){var d;return clearTimeout(null!=(d=this.animation)?d._timeout:void 0)};u.prototype.render=function(d){var a;d._png&&d._png.stopAnimation();d._png=this;d.width=
this.width;d.height=this.height;d=d.getContext("2d");if(this.animation)return this.decodeFrames(d),this.animate(d);a=d.createImageData(this.width,this.height);this.copyToImageData(a,this.decodePixels());return d.putImageData(a,0,0)};return u}(this)})},"esri/layers/support/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(y,m){var u=m.pixelType,f=m.bandCount,k=[],r=m.width*m.height,d=this.getBandCount(y,m),f=f||d,a=y.byteLength-y.byteLength%(r*this._getPixelLength(u)),c=
new u(y,0,r*d),p,e,b,l;for(p=0;p<f;p++){l=new u(r);for(e=0;e<r;e++)l[e]=c[e*d+p];k.push(l)}a<y.byteLength-1&&(b=this._decodeMask(y.slice(a),m));return{pixels:k,mask:b}},decodeBSQ:function(y,m){var u=m.pixelType,f=m.bandCount;if(void 0===f||null===f)f=this.getBandCount(y,m);for(var k=[],r=m.width*m.height,d=r*f,a=y.byteLength-y.byteLength%(r*this._getPixelLength(u)),u=new u(y,0,d),c,d=0;d<f;d++)k.push(u.subarray(d*r,(d+1)*r));a<y.byteLength-1&&(c=this._decodeMask(y.slice(a),m));return{pixels:k,mask:c}},
getBandCount:function(y,m){return Math.floor(y.byteLength/(m.width*m.height*this._getPixelLength(m.pixelType)))},_getPixelLength:function(y){var m=1;switch(y){case Uint8Array:case Int8Array:case Uint8ClampedArray:m=1;break;case Uint16Array:case Int16Array:m=2;break;case Uint32Array:case Int32Array:case Float32Array:m=4;break;case Float64Array:m=8}return m},_decodeMask:function(y,m){var u=m.width*m.height;if(8*y.byteLength<u)return null;y=new Uint8Array(y,0,Math.ceil(u/8));m=new Uint8Array(m.width*
m.height);for(var f=0,k=0,r=0,d=0,r=0;r<y.length-1;r++)for(k=y[r],d=7;0<=d;d--)m[f++]=k>>d&1;for(d=7;f<u-1;)k=y[y.length-1],m[f++]=k>>d&1,d--;return m}}})},"esri/layers/support/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(y,m){var u=function(){var d=new ArrayBuffer(4),a=new Uint8Array(d),d=new Uint32Array(d);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===d[0]},f=function(){var d=[];d[254]="NEWSUBFILETYPE";d[255]="SUBFILETYPE";d[256]="IMAGEWIDTH";d[257]="IMAGELENGTH";d[258]=
"BITSPERSAMPLE";d[259]="COMPRESSION";d[262]="PHOTOMETRICINTERPRETATION";d[263]="THRESHHOLDING";d[264]="CELLWIDTH";d[265]="CELLLENGTH";d[266]="FILLORDER";d[269]="DOCUMENTNAME";d[270]="IMAGEDESCRIPTION";d[271]="MAKE";d[272]="MODEL";d[273]="STRIPOFFSETS";d[274]="ORIENTATION";d[277]="SAMPLESPERPIXEL";d[278]="ROWSPERSTRIP";d[279]="STRIPBYTECOUNTS";d[280]="MINSAMPLEVALUE";d[281]="MAXSAMPLEVALUE";d[282]="XRESOLUTION";d[283]="YRESOLUTION";d[284]="PLANARCONFIGURATION";d[285]="PAGENAME";d[286]="XPOSITION";
d[287]="YPOSITION";d[288]="FREEOFFSETS";d[289]="FREEBYTECOUNTS";d[290]="GRAYRESPONSEUNIT";d[291]="GRAYRESPONSECURVE";d[292]="T4OPTIONS";d[293]="T6OPTIONS";d[296]="RESOLUTIONUNIT";d[297]="PAGENUMBER";d[300]="COLORRESPONSEUNIT";d[301]="TRANSFERFUNCTION";d[305]="SOFTWARE";d[306]="DATETIME";d[315]="ARTIST";d[316]="HOSTCOMPUTER";d[317]="PREDICTOR";d[318]="WHITEPOINT";d[319]="PRIMARYCHROMATICITIES";d[320]="COLORMAP";d[321]="HALFTONEHINTS";d[322]="TILEWIDTH";d[323]="TILELENGTH";d[324]="TILEOFFSETS";d[325]=
"TILEBYTECOUNTS";d[326]="BADFAXLINES";d[327]="CLEANFAXDATA";d[328]="CONSECUTIVEBADFAXLINES";d[330]="SUBIFD";d[332]="INKSET";d[333]="INKNAMES";d[334]="NUMBEROFINKS";d[336]="DOTRANGE";d[337]="TARGETPRINTER";d[338]="EXTRASAMPLES";d[339]="SAMPLEFORMAT";d[340]="SMINSAMPLEVALUE";d[341]="SMAXSAMPLEVALUE";d[342]="TRANSFERRANGE";d[347]="JPEGTABLES";d[512]="JPEGPROC";d[513]="JPEGIFOFFSET";d[514]="JPEGIFBYTECOUNT";d[515]="JPEGRESTARTINTERVAL";d[517]="JPEGLOSSLESSPREDICTORS";d[518]="JPEGPOINTTRANSFORM";d[519]=
"JPEGQTABLES";d[520]="JPEGDCTABLES";d[521]="JPEGACTABLES";d[529]="YCBCRCOEFFICIENTS";d[530]="YCBCRSUBSAMPLING";d[531]="YCBCRPOSITIONING";d[532]="REFERENCEBLACKWHITE";d[33550]="GEOPIXELSCALE";d[33922]="GEOTIEPOINTS";d[33432]="COPYRIGHT";d[42112]="GDAL_METADATA";d[42113]="GDAL_NODATA";d[50844]="RPCCOEFFICIENT";d[34735]="GEOKEYDIRECTORY";d[34736]="GEODOUBLEPARAMS";d[34737]="GEOASCIIPARAMS";return d}(),k=[0,1,1,2,4,8,1,1,2,4,8,4,8],r=function(d,a){var c="UNKNOWN";3===d?c="F32":1===d?8>=a?c="U8":16>=a?
c="U16":32>=a&&(c="U32"):2===d&&(8>=a?c="S8":16>=a?c="S16":32>=a&&(c="S32"));return c};return{decode:function(d){var a,c=new DataView(d,0,8),p=c.getUint16(0,!1),e;if(18761===p)e=!0;else if(19789===p)e=!1;else throw"unexpected endianess byte";if(42!==c.getUint16(2,e))throw"unexpected tiff identifier";var b=c.getUint32(4,e);a=e;var l,h,g,t,v,n,q,E,A,F,C;l=b;for(var z=[];l;){h=(new DataView(d,l,2)).getUint16(0,a);g=l+2;l=(new DataView(d,g+12*h,4)).getUint32(0,a);F={};for(t=0;t<h;t++)if(v=new DataView(d,
g,12),n=v.getUint16(0,a),q=v.getUint16(2,a),E=v.getUint32(4,a),A=v.getUint32(8,a),g+=12,!(7===q||12<q)){var x=C={fieldTag:n,fieldType:q,fieldValueCount:E,fieldValueOffset:A},w=d,B=a,H=[],G=C.fieldType,D=C.fieldValueCount,L=C.fieldValueOffset,J=L,P=k[G],I=8*P,M=D*P,X=D*k[G]*8,N=void 0,V=void 0;if(32>=X)if(B||(L>>>=32-X),1===D)H=[L];else for(V=0;V<D;V++)H.push(L<<I*V>>>32-I);else for(J=L;J<L+M;J+=P){switch(G){case 1:N=(new DataView(w,J,1)).getUint8(0);break;case 2:N=(new DataView(w,J,1)).getUint8(0);
break;case 3:N=(new DataView(w,J,2)).getUint16(0,B);break;case 4:N=(new DataView(w,J,4)).getUint32(0,B);break;case 5:N=(new DataView(w,J,4)).getUint32(0,B)/(new DataView(w,J+4,4)).getUint32(0,B);break;case 6:N=(new DataView(w,J,1)).getInt8(0);break;case 8:N=(new DataView(w,J,2)).getInt16(0,B);break;case 9:N=(new DataView(w,J,4)).getInt32(0,B);break;case 10:N=(new DataView(w,J,4)).getInt32(0,B)/(new DataView(w,J+4,4)).getInt32(0,B);break;case 11:N=(new DataView(w,J,4)).getFloat32(0,B);break;case 12:N=
(new DataView(w,J,8)).getFloat64(0,B);break;case 7:N=null;break;default:N=null}H.push(N)}if(2===G){for(var O="",oa=H,H=[],V=0;V<oa.length;V++)0===oa[V]&&""!==O?(H.push(O),O=""):O+=String.fromCharCode(oa[V]);""===O&&0!==H.length||H.push(O)}x.fieldValues=H;var za=F,ka=f[n];void 0===ka&&(ka="unknown"+n);za[ka]={type:q,values:C.fieldValues}}z.push(F)}if(0===z.length)throw"no valid image file directory";var W,R,K=z[0],Aa=void 0===K.GDAL_NODATA||null===K.GDAL_NODATA?null:parseFloat(K.GDAL_NODATA.values[0]);
if(K.TILEOFFSETS){var pa,ca,la,kb=u()===a,qa=K.TILEOFFSETS?K.TILEOFFSETS.values:void 0;if(void 0===qa)R=void 0;else{var ra=K.TILEBYTECOUNTS.values,sa=K.TILEWIDTH.values[0],Ba=K.TILELENGTH.values[0],Ca=K.IMAGEWIDTH.values[0],Va=K.IMAGELENGTH.values[0],ma=Ca*Va,da=K.BITSPERSAMPLE.values[0],Y=K.SAMPLESPERPIXEL.values[0],Da=K.SAMPLEFORMAT?K.SAMPLEFORMAT.values[0]:1,La=r(Da,da);if(1!==(K.PLANARCONFIGURATION?K.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),
"can only handle PLANARCONFIGURATION\x3d1";var ga=K.COMPRESSION?K.COMPRESSION.values[0]:1;if(1!==ga&&6!==ga&&8!==ga&&32946!==ga)throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";if(3<Da)R=void 0;else{3===Da?(ca=new Float32Array(ma*Y),la=Float32Array):1===Da?8>=da?(ca=new Uint8Array(ma*Y),la=Uint8Array):16>=da?(ca=new Uint16Array(ma*Y),la=Uint16Array):32>=da&&(ca=new Uint32Array(ma*Y),la=Uint32Array):2===Da&&(8>=da?(ca=new Int8Array(ma*
Y),la=Int8Array):16>=da?(ca=new Int16Array(ma*Y),la=Int16Array):32>=da&&(ca=new Int32Array(ma*Y),la=Int32Array));var S,Ea,Z,Fa,Wa,Xa,Ya,Za,Ma,Na,db,eb,ha,T,ta,$a,Oa,ab,fb=Math.ceil(Ca/sa);if(0===da%8)for(S=0;S<qa.length;S++){Xa=Math.floor(S/fb)*Ba;Ya=S%fb*sa;Za=(Xa*Ca+Ya)*Y;if("U8"===La||"S8"===La||kb)if(8===ga||32946===ga)T=new Uint8Array(d,qa[S],ra[S]),Oa=new m(T),ab=Oa.getBytes(),ha=new ArrayBuffer(ab.length),T=new Uint8Array(ha),T.set(ab),T.length!==sa*Ba*Y*da/8&&console.log("tile byte counts is different than expected");
else if(6===ga){T=new Uint8Array(d,qa[S],ra[S]);var Pa=new y;Pa.parse(T);var gb=Pa.getData(Pa.width,Pa.height);ha=new ArrayBuffer(gb.length);T=new Uint8Array(ha);T.set(gb)}else 1===ga&&(ra[S]!==sa*Ba*Y*da/8&&console.log("tile byte counts is different than expected"),ha=d.slice(qa[S],qa[S]+ra[S]));else switch(8===ga||32946===ga?(T=new Uint8Array(d,qa[S],ra[S]),Oa=new m(T),T=Oa.getBytes(),ha=new ArrayBuffer(T.length),ta=new Uint8Array(ha),T.length!==sa*Ba*Y*da/8&&console.log("tile byte counts is different than expected")):
1===ga&&(ra[S]!==sa*Ba*Y*da/8&&console.log("tile byte counts is different than expected"),ha=new ArrayBuffer(ra[S]),T=new Uint8Array(d,qa[S],ra[S]),ta=new Uint8Array(ha)),La){case "U16":case "S16":for(Z=0;Z<T.length;Z+=2)ta[Z]=T[Z+1],ta[Z+1]=T[Z];break;case "U32":case "S32":case "F32":for(Z=0;Z<T.length;Z+=4)ta[Z]=T[Z+3],ta[Z+1]=T[Z+2],ta[Z+2]=T[Z+1],ta[Z+3]=T[Z]}pa=new la(ha);Na=0;Ma=Za;eb=Math.min(sa,Ca-Ya);db=Math.min(Ba,Va-Xa);for(Fa=0;Fa<db;Fa++)for(Ma=Za+Fa*Ca*Y,Na=Fa*sa*Y,Wa=0;Wa<eb*Y;Wa++,
Ma++,Na++)ca[Ma]=pa[Na]}var Qa={width:Ca,height:Va,pixelType:La};if(1===Y)Qa.pixels=[ca];else for(Qa.pixels=[],S=0;S<Y;S++){$a=new la(ma);for(Ea=0;Ea<ma;Ea++)$a[Ea]=ca[Ea*Y+S];Qa.pixels.push($a)}R=Qa}}}else if(K.STRIPOFFSETS){var hb,ia,na,lb=u()===a,ua=K.STRIPOFFSETS?K.STRIPOFFSETS.values:void 0;if(void 0===ua)R=void 0;else{var va=K.STRIPBYTECOUNTS.values,Ga=K.ROWSPERSTRIP.values,wa=K.IMAGEWIDTH.values[0],Ha=K.IMAGELENGTH.values[0],xa=wa*Ha,ea=K.BITSPERSAMPLE.values[0],ba=K.SAMPLESPERPIXEL.values[0],
Ia=K.SAMPLEFORMAT?K.SAMPLEFORMAT.values[0]:1,Ra=r(Ia,ea);if(1!==(K.PLANARCONFIGURATION?K.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var fa=K.COMPRESSION?K.COMPRESSION.values[0]:1;if(1!==fa&&6!==fa&&8!==fa&&32946!==fa)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ia)R=void 0;else{3===Ia?(ia=new Float32Array(xa*ba),na=Float32Array):
1===Ia?8>=ea?(ia=new Uint8Array(xa*ba),na=Uint8Array):16>=ea?(ia=new Uint16Array(xa*ba),na=Uint16Array):32>=ea&&(ia=new Uint32Array(xa*ba),na=Uint32Array):2===Ia&&(8>=ea?(ia=new Int8Array(xa*ba),na=Int8Array):16>=ea?(ia=new Int16Array(xa*ba),na=Int16Array):32>=ea&&(ia=new Int32Array(wa*Ha*ba),na=Int32Array));var Q,Ja,aa,ib,ja,U,ya,bb,Sa,cb,Ka=Ga;if(0===ea%8)for(Q=0;Q<ua.length;Q++){ib=Q*Ga*wa*ba;Ka=(Q+1)*Ga>Ha?Ha-Q*Ga:Ga;if("U8"===Ra||"S8"===Ra||lb)if(8===fa||32946===fa)U=new Uint8Array(d,ua[Q],va[Q]),
Sa=new m(U),cb=Sa.getBytes(),ja=new ArrayBuffer(cb.length),U=new Uint8Array(ja),U.set(cb),U.length!==Ka*wa*ba*ea/8&&console.log("strip byte counts is different than expected");else if(6===fa){U=new Uint8Array(d,ua[Q],va[Q]);var Ta=new y;Ta.parse(U);var jb=Ta.getData(Ta.width,Ta.height);ja=new ArrayBuffer(jb.length);U=new Uint8Array(ja);U.set(jb)}else 1===fa&&(va[Q]!==Ka*wa*ba*ea/8&&console.log("strip byte counts is different than expected"),ja=d.slice(ua[Q],ua[Q]+va[Q]));else switch(6===fa||8===fa||
32946===fa?(U=new Uint8Array(d,ua[Q],va[Q]),Sa=new m(U),U=Sa.getBytes(),ja=new ArrayBuffer(U.length),ya=new Uint8Array(ja),U.length!==Ka*wa*ba*ea/8&&console.log("strip byte counts is different than expected")):1===fa&&(va[Q]!==Ka*wa*ba*ea/8&&console.log("strip byte counts is different than expected"),ja=new ArrayBuffer(va[Q]),U=new Uint8Array(d,ua[Q],va[Q]),ya=new Uint8Array(ja)),Ra){case "U16":case "S16":for(aa=0;aa<U.length;aa+=2)ya[aa]=U[aa+1],ya[aa+1]=U[aa];break;case "U32":case "S32":case "F32":for(aa=
0;aa<U.length;aa+=4)ya[aa]=U[aa+3],ya[aa+1]=U[aa+2],ya[aa+2]=U[aa+1],ya[aa+3]=U[aa]}hb=new na(ja);ia.set(hb,ib)}var Ua={width:wa,height:Ha,pixelType:Ra};if(1===ba)Ua.pixels=[ia];else for(Ua.pixels=[],Q=0;Q<ba;Q++){bb=new na(xa);for(Ja=0;Ja<xa;Ja++)bb[Ja]=ia[Ja*ba+Q];Ua.pixels.push(bb)}R=Ua}}}if(null!==Aa){R.maskData=new Uint8Array(R.width*R.height);if(1E24<Math.abs(Aa))for(W=0;W<R.width*R.height;W++)R.maskData[W]=1E-6>Math.abs((R.pixels[0][W]-Aa)/Aa)?0:1;else for(W=0;W<R.width*R.height;W++)R.maskData[W]=
R.pixels[0][W]===Aa?0:1;R.noDataValue=Aa}return R}}})},"esri/renderers/support/RasterSymbolizer":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../rasterRenderers ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../layers/support/RasterInfo ../../layers/support/rasterFunctions/pixelUtils ../support/colorRampUtils".split(" "),
function(y,m,u,f,k,r,d,a,c,p,e,b,l,h){var g=p.getLogger("esri.renderers.support.RasterSymbolizer");return function(c){function d(a){return c.call(this,a)||this}f(d,c);d.prototype.readRenderer=function(b,c,e){return a.read(b,e)};d.prototype.bind=function(){this.lookup={};if(!this.renderer)return!1;var a;switch(this.renderer.type){case "unique-value":a=this._updateUVRenderer(this.renderer);break;case "raster-colormap":a=this._updateColormapRenderer(this.renderer);break;case "raster-stretch":a=this._updateStretchRenderer(this.renderer);
break;case "class-breaks":a=this._updateClassBreaksRenderer(this.renderer)}return a};d.prototype.symbolize=function(a){if(!(a&&a.pixels&&0<a.pixels.length&&0!==a.validPixelCount))return a;try{3<a.pixels.length&&(a=l.extractBands(a,[0,1,2]));var b=void 0;switch(this.renderer.type){case "unique-value":case "raster-colormap":b=this._symbolize_colormap(a);break;case "class-breaks":b=this._symbolize_classBreaks(a);break;case "raster-stretch":b=this._symbolize_stretch(a)}return b}catch(E){return g.error("symbolize",
E.message),a}};d.prototype._isLUTChanged=function(a){if(!this.lookup)return!0;if("raster-stretch"===this.renderer.type){var b=this.renderer.colorRamp;if(a)return JSON.stringify(b.toJSON())!==JSON.stringify(this.lookup.rendererJson.colorRamp);a=u({},this.renderer.toJSON());b=u({},this.lookup.rendererJson);a.colorRamp=null;b.colorRamp=null}return JSON.stringify(this.renderer.toJSON())!==JSON.stringify(this.lookup.rendererJson)};d.prototype._symbolize_colormap=function(a){return this._isLUTChanged()&&
!this.bind()?a:l.colorize(a,this.lookup.lut)};d.prototype._symbolize_classBreaks=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType);return this._isLUTChanged()&&!this.bind()?a:b?l.colorize(a,this.lookup.lut):l.remapColor(a,this.lookup.lut)};d.prototype._symbolize_stretch=function(a){var b=this.rasterInfo.pixelType,c=this.renderer,e=-1<["u8","u16","s8","s16"].indexOf(b),d=c.gamma,g=c.useGamma;if(e){if(c.dynamicRangeAdjustment)e=this.getStretchCutoff(c,a),b=l.createStretchLUT(u({pixelType:b},
e,{gamma:g?d:null}));else{if(this._isLUTChanged()&&(d=this.bind(),!d))return a;b=this.lookup?this.lookup.lut:null}if(!b)return a;b=l.lookupPixels(a,b)}else e=this.getStretchCutoff(c,a),b=l.stretch(a,u({},e,{gamma:g?d:null}));if(c.colorRamp){if(this._isLUTChanged(!0)&&(d=this.bind(),!d))return a;b=l.colorize(b,this.lookup.colorRampLut)}return b};d.prototype._updateUVRenderer=function(a){var b=this.rasterInfo,c=b.bandCount,e=b.attributeTable,d=b.statistics,b=-1<["u8","s8"].indexOf(b.pixelType)&&d&&
null!=d[0].min&&null!=d[0].max;if(1!==c||!e&&!b)return!1;var g=a.field;if(!g)return!1;var f=[];if(e){var h=e.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];if(!h)return!1;e.features.forEach(function(b){var c=a.uniqueValueInfos.filter(function(a){return String(a.value)===String(b.attributes[g])})[0];(c=c&&c.symbol&&c.symbol.color)&&f.push([b.attributes[h.name],c.r,c.g,c.b,1<c.a?c.a:Math.round(255*c.a)])})}else{if("Value"!==g.toLowerCase())return!1;a.uniqueValueInfos.forEach(function(a){var b=
a&&a.symbol&&a.symbol.color;b&&f.push([parseInt(a.value,10),b.r,b.g,b.b,1<b.a?b.a:Math.round(255*b.a)])})}if(0===f.length)return!1;c=l.createColormapLUT({colormap:f});this.lookup={rendererJson:a.toJSON(),lut:c};return!0};d.prototype._updateColormapRenderer=function(a){var b=a.extractColormap();if(!b||0===b.length)return!1;b=l.createColormapLUT({colormap:b});this.lookup={rendererJson:a.toJSON(),lut:b};return!0};d.prototype._updateClassBreaksRenderer=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType),
c=a.classBreakInfos;if(!c||0===c.length)return!1;var e=c.sort(function(a,b){return a.minValue-b.minValue}),c=e[e.length-1];if(!b)return b=e.map(function(a){return{value:a.minValue,mappedColor:[a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)]}}),b.push({value:c.maxValue,mappedColor:[c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]}),this.lookup={rendererJson:a.toJSON(),lut:b},
!0;var d=[],g,f=0;e.forEach(function(a){g=Math.ceil(a.minValue);f=Math.floor(a.maxValue);for(var b=g;b<f;b++)d.push([b,a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)])});d.push([c.maxValue,c.symbol.color.r,c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]);b=l.createColormapLUT({colormap:d,fillUnspecified:!1});this.lookup={rendererJson:a.toJSON(),lut:b};return!0};d.prototype._updateStretchRenderer=
function(a){if(!(a.statistics||this.rasterInfo.statistics||a.dynamicRangeAdjustment))return!1;var b=a.histograms||this.rasterInfo.histograms;if(!a.dynamicRangeAdjustment&&"percent-clip"===a.stretchType&&!b)return!1;var c=a.gamma,e=a.useGamma,b=a.colorRamp,d=this.rasterInfo.pixelType;if(!a.dynamicRangeAdjustment&&-1<["u8","u16","s8","s16"].indexOf(d)){var g=this.getStretchCutoff(a),c=l.createStretchLUT(u({pixelType:d},g,{gamma:e?c:null}));this.lookup={rendererJson:a.toJSON(),lut:c}}b&&(b=h.convertColorRampToColormap(b,
256),this.lookup.colorRampLut=l.createColormapLUT({colormap:b}),this.lookup.rendererJson=a.toJSON());return!0};d.prototype.getStretchCutoff=function(a,b){var c,e,d=a.stretchType;a.dynamicRangeAdjustment?"min-max"===d&&b.statistics?c=b.statistics.map(function(a){return[a.minValue,a.maxValue,0,0]}):(e=l.estimateStatisticsHistograms(b),c=e.statistics,e=e.histograms):(c=a.statistics,e=a.histograms||this.rasterInfo.histograms);b=c||e?(c||e).length:this.rasterInfo.bandCount;var g=[],f=[],h,k,p,n,m,q;c[0]instanceof
Array||(c=c.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));switch(d){case "min-max":for(d=0;d<b;d++)g[d]=c[d][0],f[d]=c[d][1];break;case "standard-deviation":for(d=0;d<b;d++)g[d]=c[d][2]-a.numberOfStandardDeviations*c[d][3],f[d]=c[d][2]+a.numberOfStandardDeviations*c[d][3],g[d]<c[d][0]&&(g[d]=c[d][0]),f[d]>c[d][1]&&(f[d]=c[d][1]);break;case "percent-clip":for(d=0;d<b;d++){c=e[d];n=new Uint32Array(c.size);p=c.counts;k=0;h=(c.max-c.min)/c.size;m=-.5===c.min&&1===h?.5:0;for(q=0;q<c.size;q++)k+=
p[q],n[q]=k;p=a.minPercent*k/100;for(q=0;q<c.size;q++)if(n[q]>p){g[d]=c.min+h*(q+m);break}p=(1-a.maxPercent/100)*k;for(q=c.size-2;0<=q;q--)if(n[q]<p){f[d]=c.min+h*(q+2-m);break}}break;default:for(d=0;d<b;d++)g[d]=c[d][0],f[d]=c[d][1]}return{minCutOff:g,maxCutOff:f,outMax:a.outputMax||255,outMin:a.outputMin||0}};k([e.property({types:a.rasterRendererTypes,json:{write:!0}})],d.prototype,"renderer",void 0);k([e.reader("renderer")],d.prototype,"readRenderer",null);k([e.property({type:b,json:{write:!0}})],
d.prototype,"rasterInfo",void 0);k([e.property({json:{write:!0}})],d.prototype,"lookup",void 0);return d=k([e.subclass("esri.renderers.support.RasterSymbolizer")],d)}(e.declared(c.JSONSupport))})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(y,m,u){function f(a,c){a=Math.min(Math.max(a,-100),100);c=Math.min(Math.max(c,-100),100);var d,e,b=new Uint8Array(256);for(d=0;256>d;d++)0<a&&100>a?e=(200*d-25500+510*c)/(2*(100-a))+128:0>=a&&
-100<a?e=(200*d-25500+510*c)*(100+a)/2E4+128:100===a?(e=200*d-25500+256*(100-a)+510*c,e=0<e?255:0):-100===a&&(e=128),b[d]=255<e?255:0>e?0:e;return b}function k(a,c,d,e,b,f,h,g){return{xmin:b<=d*a?0:b<d*a+a?b-d*a:a,ymin:f<=e*c?0:f<e*c+c?f-e*c:c,xmax:b+h<=d*a?0:b+h<d*a+a?b+h-d*a:a,ymax:f+g<=e*c?0:f+g<e*c+c?f+g-e*c:c}}var r=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length},d={createColormapLUT:function(a){if(a){var c=a.colormap;if(c&&0!==c.length){var c=
c.sort(function(a,b){return a[0]-b[0]}),d=0;0>c[0][0]&&(d=c[0][0]);var e=Math.max(256,c[c.length-1][0]-d+1),b=new Uint8Array(4*e),f=[],h=0,g=0,k=5===c[0].length;if(65536<e)return c.forEach(function(a){f[a[0]-d]=k?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:f,offset:d,alphaSpecified:k};if(a.fillUnspecified)for(a=c[g],h=a[0]-d;h<e;h++)b[4*h]=a[1],b[4*h+1]=a[2],b[4*h+2]=a[3],b[4*h+3]=k?a[4]:255,h===a[0]-d&&(a=g===c.length-1?a:c[++g]);else for(h=0;h<c.length;h++)a=c[h],g=4*(a[0]-d),b[g]=
a[1],b[g+1]=a[2],b[g+2]=a[3],b[g+3]=k?a[4]:255;return{indexedColormap:b,offset:d,alphaSpecified:k}}}},createContrastBrightnessLUT:f,createStretchLUT:function(a){var c=a.minCutOff,d=a.maxCutOff,e=a.gamma,b=a.pixelType,l=a.outMin||0,h=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(b))return null;var g=c.length,k,m=0;"s8"===b?m=-127:"s16"===b&&(m=-32767);var n=256;-1<["u16","s16"].indexOf(b)&&(n=65536);for(var q=[],r=h-l,b=0;b<g;b++)q[b]=d[b]-c[b];k=e&&e.length>=g;var u=[];if(k)for(b=0;b<g;b++)u[b]=
1<e[b]?2<e[b]?6.5+Math.pow(e[b]-2,2.5):6.5+100*Math.pow(2-e[b],4):1;var y,C=[],z,x,w;if(k)for(b=0;b<g;b++){w=[];for(k=0;k<n;k++)z=k+m,y=(z-c[b])/q[b],x=1,1<e[b]&&(x-=Math.pow(1/r,y*u[b])),w[k]=z<d[b]&&z>c[b]?Math.floor(x*r*Math.pow(y,1/e[b]))+l:z>=d[b]?h:l;C[b]=w}else for(b=0;b<g;b++){w=[];for(k=0;k<n;k++)z=k+m,w[k]=z<=c[b]?l:z>=d[b]?h:Math.floor((z-c[b])/q[b]*r)+l;C[b]=w}if(null!=a.contrastOffset)for(a=f(a.contrastOffset,a.brightnessOffset),b=0;b<g;b++)for(w=C[b],k=0;k<n;k++)w[k]=a[w[k]];return{lut:C,
offset:m}},colorize:function(a,c){if(!r(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;var d=a.clone(),e=d.pixels,b=d.mask,f=d.width*d.height;if(1!==e.length)return a;var h=c.indexedColormap;a=c.indexed2DColormap;var g=c.offset;c=c.alphaSpecified;var k=h.length-1,m=0,e=e[0],n=new Uint8Array(e.length),q=new Uint8Array(e.length),u=new Uint8Array(e.length),A=0;if(h)if(b)for(m=0;m<f;m++)b[m]&&(A=4*(e[m]-g),A<g||A>k?b[m]=0:(n[m]=h[A],q[m]=h[A+1],u[m]=h[A+2],b[m]=h[A+3]));else{b=new Uint8Array(f);
for(m=0;m<f;m++)A=4*(e[m]-g),A<g||A>k?b[m]=0:(n[m]=h[A],q[m]=h[A+1],u[m]=h[A+2],b[m]=h[A+3]);d.mask=b}else if(b)for(m=0;m<f;m++)b[m]&&(h=a[e[m]],n[m]=h[0],q[m]=h[1],u[m]=h[2],b[m]=h[3]);else{b=new Uint8Array(f);for(m=0;m<f;m++)h=a[e[m]],n[m]=h[0],q[m]=h[1],u[m]=h[2],b[m]=h[3];d.mask=b}d.pixels=[n,q,u];d.statistics=null;d.pixelType="u8";d.maskIsAlpha=c;return d},estimateStatisticsHistograms:function(a){if(!r(a))return null;var c=a.pixels,d=a.mask,e=a.pixelType,b=a.statistics;a=a.width*a.height;var f=
c.length,h,g,k,m,n,q=[],u=[],A,y,C;for(m=0;m<f;m++){A=new Uint32Array(256);C=c[m];if("u8"===e)if(h=-.5,g=255.5,d)for(n=0;n<a;n++)d[n]&&A[C[n]]++;else for(n=0;n<a;n++)A[C[n]]++;else{h=b[m].minValue;g=b[m].maxValue;k=(g-h)/256;y=new Uint32Array(257);if(d)for(n=0;n<a;n++)d[n]&&y[Math.floor((C[n]-h)/k)]++;else for(n=0;n<a;n++)y[Math.floor((C[n]-h)/k)]++;for(n=0;255>n;n++)A[n]=y[n];A[255]=y[255]+y[256]}q.push({min:h,max:g,size:256,counts:A});for(n=C=y=k=0;256>n;n++)k+=A[n],y+=n*A[n];y/=k;for(n=0;256>n;n++)C+=
A[n]*Math.pow(n-y,2);A=Math.sqrt(C/(k-1));k=(g-h)/256;n=(y+.5)*k+h;A*=k;u.push({min:h,max:g,avg:n,stddev:A})}return{statistics:u,histograms:q}},extractBands:function(a,c){return!c||!r(a)||c&&c.some(function(c){return c>a.pixels.length})?a:new u({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:c.map(function(c){return a.pixels[c]}),statistics:a.statistics&&c.map(function(c){return a.statistics[c]})})},stretch:function(a,
c){if(!r(a))return null;a=a.clone();var d=a.pixels,e=a.mask,b=c.minCutOff,f=c.maxCutOff,h=c.gamma,g=c.outMin||0;c=c.outMax||255;var k=a.width*a.height,m=d.length,n,q,u,A,y,C=c-g,z=[];for(n=0;n<m;n++)z[n]=f[n]-b[n];q=h&&h.length>=m;var x=[];if(q)for(n=0;n<m;n++)x[n]=1<h[n]?2<h[n]?6.5+Math.pow(h[n]-2,2.5):6.5+100*Math.pow(2-h[n],4):1;if(q)if(null!=e)for(q=0;q<k;q++){if(e[q])for(n=0;n<m;n++)u=d[n][q],y=(u-b[n])/z[n],A=1,1<h[n]&&(A-=Math.pow(1/C,y*x[n])),d[n][q]=u<f[n]&&u>b[n]?Math.floor(A*C*Math.pow(y,
1/h[n]))+g:u>=f[n]?c:g}else for(q=0;q<k;q++)for(n=0;n<m;n++)u=d[n][q],y=(u-b[n])/z[n],A=1,1<h[n]&&(A-=Math.pow(1/C,y*x[n])),d[n][q]=u<f[n]&&u>b[n]?Math.floor(A*C*Math.pow(y,1/h[n]))+g:u>=f[n]?c:g;else if(null!=e)for(q=0;q<k;q++){if(e[q])for(n=0;n<m;n++)u=d[n][q],d[n][q]=u<f[n]&&u>b[n]?Math.floor((u-b[n])/z[n]*C)+g:u>=f[n]?c:g}else for(q=0;q<k;q++)for(n=0;n<m;n++)u=d[n][q],d[n][q]=u<f[n]&&u>b[n]?Math.floor((u-b[n])/z[n]*C)+g:u>=f[n]?c:g;a.pixelType="u8";a.updateStatistics();return a},lookupPixels:function(a,
c){if(!r(a))return null;var d=a.pixels,e=a.mask,b=a.width*a.height,f=d.length,h=c.lut;c=c.offset;var g,k;h&&1===h[0].length&&(h=d.map(function(){return h}));var m=[],n,q,y;if(c)if(null==e)for(g=0;g<f;g++){n=d[g];q=h[g];y=new Uint8Array(b);for(k=0;k<b;k++)y[k]=q[n[k]-c];m.push(y)}else for(g=0;g<f;g++){n=d[g];q=h[g];y=new Uint8Array(b);for(k=0;k<b;k++)e[k]&&(y[k]=q[n[k]-c]);m.push(y)}else if(null==e)for(g=0;g<f;g++){n=d[g];q=h[g];y=new Uint8Array(b);for(k=0;k<b;k++)y[k]=q[n[k]];m.push(y)}else for(g=
0;g<f;g++){n=d[g];q=h[g];y=new Uint8Array(b);for(k=0;k<b;k++)e[k]&&(y[k]=q[n[k]]);m.push(y)}a=new u({width:a.width,height:a.height,pixels:m,mask:e,pixelType:"u8"});a.updateStatistics();return a},remapColor:function(a,c){if(!r(a))return null;a=a.clone();var d=a.width*a.height,e=c.length,b=Math.floor(e/2),f=c[Math.floor(b)],h=a.pixels[0],g,k,m,n,q,u,y=!1,F=new Uint8Array(d),C=new Uint8Array(d),z=new Uint8Array(d),x=a.mask,w=4===c[0].mappedColor.length;x||(x=new Uint8Array(d),x.fill(w?255:1),a.mask=
x);for(q=0;q<d;q++)if(x[q]){g=h[q];y=!1;u=b;k=f;m=0;for(n=e-1;1<n-m;){if(g===k.value){y=!0;break}g>k.value?m=u:n=u;u=Math.floor((m+n)/2);k=c[Math.floor(u)]}y||(g===c[m].value?(k=c[m],y=!0):g===c[n].value?(k=c[n],y=!0):g<c[m].value?(y=!1,k=null):g>c[m].value&&(g<c[n].value?(k=c[m],y=!0):n===e-1?(y=!1,k=null):(k=c[n],y=!0)));y?(F[q]=k.mappedColor[0],C[q]=k.mappedColor[1],z[q]=k.mappedColor[2],x[q]=k.mappedColor[3]):F[q]=C[q]=z[q]=x[q]=0}a.pixels=[F,C,z];a.mask=x;a.pixelType="u8";a.maskIsAlpha=w;return a},
mosaic:function(a,c,d,e){var b=a.filter(function(a){return r(a)})[0];if(null==b)return null;var f=e?e.width:c.width;e=e?e.height:c.height;var h=b.width,g=b.height,p=c.width/h;c=c.height/g;var m=d?d.x:0;d=d?d.y:0;var n=b.pixelType,q=b.getPixelArrayConstructor(n),y=b.pixels.length,b=[],A,F,C,z,x,w,B,H,G,D;for(x=0;x<y;x++){F=new q(f*e);for(w=0;w<c;w++)for(B=0;B<p;B++)if(C=a[w*p+B])for(A=C.pixels[x],D=k(h,g,B,w,m,d,f,e),H=D.ymin;H<D.ymax;H++)for(C=(w*g+H-d)*f+(B*h-m),z=H*h,G=D.xmin;G<D.xmax;G++)F[C+G]=
A[z+G];b.push(F)}var L;if(a.some(function(a){return a&&a.mask&&0<a.mask.length}))for(L=new Uint8Array(f*e),w=0;w<c;w++)for(B=0;B<p;B++)if(q=(C=a[w*p+B])?C.mask:null,D=k(h,g,B,w,m,d,f,e),q)for(H=D.ymin;H<D.ymax;H++)for(C=(w*g+H-d)*f+(B*h-m),z=H*h,G=D.xmin;G<D.xmax;G++)L[C+G]=q[z+G];else if(C)for(H=D.ymin;H<D.ymax;H++)for(C=(w*g+H-d)*f+(B*h-m),z=H*h,G=D.xmin;G<D.xmax;G++)L[C+G]=1;else for(H=D.ymin;H<D.ymax;H++)for(C=(w*g+H-d)*f+(B*h-m),z=H*h,G=D.xmin;G<D.xmax;G++)L[C+G]=0;a=new u({width:f,height:e,
pixels:b,pixelType:n,mask:L});a.updateStatistics();return a},mosaicPixelData:function(a,c){if(!a||0===a.length)return null;var f=a.filter(function(a){return a.pixelBlock})[0];if(!f)return null;var e=(f.extent.xmax-f.extent.xmin)/f.pixelBlock.width,b=(f.extent.ymax-f.extent.ymin)/f.pixelBlock.height,k=.01*Math.min(e,b),h=a.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>k?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>k?a.extent.xmin-b.extent.xmin:0}),g=Math.min.apply(null,
h.map(function(a){return a.extent.xmin})),m=Math.min.apply(null,h.map(function(a){return a.extent.ymin})),r=Math.max.apply(null,h.map(function(a){return a.extent.xmax})),n=Math.max.apply(null,h.map(function(a){return a.extent.ymax}));a={x:Math.round((c.xmin-g)/e),y:Math.round((n-c.ymax)/b)};g={width:Math.round((r-g)/e),height:Math.round((n-m)/b)};e={width:Math.round((c.xmax-c.xmin)/e),height:Math.round((c.ymax-c.ymin)/b)};if(Math.round(g.width/f.pixelBlock.width)*Math.round(g.height/f.pixelBlock.height)!==
h.length||0>a.x||0>a.y||g.width<e.width||g.height<e.height)return null;f=h.map(function(a){return a.pixelBlock});f=d.mosaic(f,g,a,e);return{extent:c,pixelBlock:f}}};return d})},"esri/tasks/ImageServiceIdentifyTask":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/maybe ../core/accessorSupport/decorators ../geometry/support/normalizeUtils ./Task ./support/ImageServiceIdentifyResult".split(" "),
function(y,m,u,f,k,r,d,a,c,p,e){return function(b){function l(){return null!==b&&b.apply(this,arguments)||this}u(l,b);l.prototype.execute=function(a,b){var f=this;return c.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(c){var e=a.toJSON();c=c&&c[0];d.isSome(c)&&(e.geometry=JSON.stringify(c.toJSON()));e=f._encode(k({f:"json"},f.parsedUrl.query,e));e=k({query:e},f.requestOptions,b);return r(f.parsedUrl.path+"/identify",e)}).then(function(a){return e.fromJSON(a.data)})};return l=
f([a.subclass("esri.tasks.ImageServiceIdentifyTask")],l)}(a.declared(p))})},"esri/tasks/support/ImageServiceIdentifyResult":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ./FeatureSet".split(" "),function(y,m,u,f,k,r,d,a){return function(c){function k(){var a=null!==c&&c.apply(this,arguments)||this;a.catalogItemVisibilities=null;a.catalogItems=null;a.location=
null;a.name=null;a.objectId=null;a.processedValues=null;a.properties=null;a.value=null;return a}u(k,c);f([r.property({json:{write:!0}})],k.prototype,"catalogItemVisibilities",void 0);f([r.property({type:a,json:{write:!0}})],k.prototype,"catalogItems",void 0);f([r.property({type:d,json:{write:!0}})],k.prototype,"location",void 0);f([r.property({json:{write:!0}})],k.prototype,"name",void 0);f([r.property({json:{write:!0}})],k.prototype,"objectId",void 0);f([r.property({json:{write:!0}})],k.prototype,
"processedValues",void 0);f([r.property({json:{write:!0}})],k.prototype,"properties",void 0);f([r.property({json:{write:!0}})],k.prototype,"value",void 0);return k=f([r.subclass("esri.tasks.support.ImageServiceIdentifyResult")],k)}(r.declared(k.JSONSupport))})},"esri/tasks/support/ImageServiceIdentifyParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/jsonUtils ../../layers/support/MosaicRule ../../layers/support/RasterFunction".split(" "),
function(y,m,u,f,k,r,d,a,c,p,e,b){return function(d){function h(){var a=null!==d&&d.apply(this,arguments)||this;a.geometry=null;a.renderingRules=null;a.pixelSize=null;a.returnGeometry=!0;a.returnCatalogItems=!0;a.returnPixelValues=!0;a.maxItemCount=null;a.timeExtent=null;a.raster=void 0;a.viewId=void 0;return a}u(h,d);h.prototype.writeGeometry=function(a,b,c){null!=a&&(b.geometryType=p.getJsonType(a),b[c]=JSON.stringify(a.toJSON()))};Object.defineProperty(h.prototype,"mosaicRule",{set:function(a){a&&
a.mosaicMethod&&(a=e.fromJSON(k({},a.toJSON(),{mosaicMethod:a.mosaicMethod,mosaicOperation:a.mosaicOperation})));this._set("mosaicRule",a)},enumerable:!0,configurable:!0});h.prototype.writeMosaicRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};Object.defineProperty(h.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=b.fromJSON(k({},a.toJSON(),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));this._set("renderingRule",a)},enumerable:!0,
configurable:!0});h.prototype.writeRenderingRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};h.prototype.writeRenderingRules=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.map(function(a){return a.toJSON()})))};h.prototype.writePixelSize=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};h.prototype.writeTimeExtent=function(a,b,c){if(null!=a){var d=a.start?a.start.getTime():null;a=a.end?a.end.getTime():null;b[c]=null!=d?null!=a?d+","+a:""+d:null}};f([a.property({json:{write:!0}})],
h.prototype,"geometry",void 0);f([a.writer("geometry")],h.prototype,"writeGeometry",null);f([a.property({type:e,json:{write:!0}})],h.prototype,"mosaicRule",null);f([a.writer("mosaicRule")],h.prototype,"writeMosaicRule",null);f([a.property({type:b,json:{write:!0}})],h.prototype,"renderingRule",null);f([a.writer("renderingRule")],h.prototype,"writeRenderingRule",null);f([a.property({type:[b],json:{write:!0}})],h.prototype,"renderingRules",void 0);f([a.writer("renderingRules")],h.prototype,"writeRenderingRules",
null);f([a.property({type:c,json:{write:!0}})],h.prototype,"pixelSize",void 0);f([a.writer("pixelSize")],h.prototype,"writePixelSize",null);f([a.property({type:Boolean,json:{write:!0}})],h.prototype,"returnGeometry",void 0);f([a.property({type:Boolean,json:{write:!0}})],h.prototype,"returnCatalogItems",void 0);f([a.property({type:Boolean,json:{write:!0}})],h.prototype,"returnPixelValues",void 0);f([a.property({type:Number,json:{write:!0}})],h.prototype,"maxItemCount",void 0);f([a.property({type:r,
json:{write:{target:"time"}}})],h.prototype,"timeExtent",void 0);f([a.writer("timeExtent")],h.prototype,"writeTimeExtent",null);f([a.property({json:{write:!0}})],h.prototype,"raster",void 0);f([a.property({json:{write:!0}})],h.prototype,"viewId",void 0);return h=f([a.subclass("esri.tasks.support.ImageServiceIdentifyParameters")],h)}(a.declared(d.JSONSupport))})},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../PopupTemplate ../core/maybe ../core/MultiOriginJSONSupport ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISImageService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ../support/popupUtils".split(" "),function(y,
m,u,f,k,r,d,a,c,p,e,b,l,h,g,t,v,n,q,E,A){return function(b){function d(a,c){a=b.call(this,a)||this;a.legendEnabled=!0;a.isReference=null;a.operationalLayerType="ArcGISImageServiceLayer";a.popupEnabled=!0;a.popupTemplate=null;a.type="imagery";return a}u(d,b);d.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};d.prototype.load=function(a){var b=this,d=c.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},a).then(function(){return b._fetchService(d)},
function(){return b._fetchService(d)}));return this.when()};Object.defineProperty(d.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});d.prototype.createPopupTemplate=function(a){var b=this.rasterFields,c=this.title,d=new Set,e=!1,f=!1;this.capabilities&&(f=(e=this.capabilities&&this.capabilities.some(function(a){return"catalog"===a.toLowerCase()})||this.fields&&0<this.fields.length)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||
"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType));var g=new Set;e&&(g.add("raster.itempixelvalue"),f&&g.add("raster.magnitude").add("raster.direction"));for(e=0;e<b.length;e++){var f=b[e],h=f.name.toLowerCase();g.has(h)||-1<h.indexOf("raster.servicepixelvalue.")||d.add(f.name)}return A.createPopupTemplate({fields:b,title:c,visibleFieldNames:d},a)};d.prototype.redraw=function(){this.emit("redraw")};f([e.property(E.legendEnabled)],d.prototype,"legendEnabled",void 0);f([e.property({type:["show",
"hide"]})],d.prototype,"listMode",void 0);f([e.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],d.prototype,"isReference",void 0);f([e.property({type:["ArcGISImageServiceLayer"]})],d.prototype,"operationalLayerType",void 0);f([e.property(E.popupEnabled)],d.prototype,"popupEnabled",void 0);f([e.property({type:a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],d.prototype,"popupTemplate",void 0);f([e.property({readOnly:!0,dependsOn:["fields",
"title"]})],d.prototype,"defaultPopupTemplate",null);f([e.property({readOnly:!0,json:{read:!1}})],d.prototype,"type",void 0);return d=f([e.subclass("esri.layers.ImageryLayer")],d)}(e.declared(q.TemporalLayer(v.RefreshableLayer(n.ScaleRangeLayer(g.OperationalLayer(t.PortalLayer(l.ArcGISImageService(h.ArcGISService(p.MultiOriginJSONMixin(b))))))))))});