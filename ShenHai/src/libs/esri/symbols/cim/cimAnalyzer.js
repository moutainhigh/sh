// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../Color ../../core/Logger ../../core/promiseUtils ../../core/string ../../support/arcadeOnDemand ./CIMSymbolHelper ./enums ./SDFHelper ../../views/2d/arcade/utils".split(" "),function(Ba,R,x,y,ga,ha,ia,ja,D,U,E,B,da,V){function F(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/255}:{r:0,g:0,b:0,a:0}}function M(a){switch(a){case "Butt":return B.CapType.BUTT;case "Square":return B.CapType.SQUARE;
default:return B.CapType.ROUND}}function N(a){switch(a){case "Bevel":return B.JoinType.BEVEL;case "Miter":return B.JoinType.MITER;default:return B.JoinType.ROUND}}function ka(a){switch(a){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"justify"}}function la(a){switch(a){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}}function ma(a){var b="normal",e="normal";a&&(a=a.toLowerCase(),-1!==
a.indexOf("italic")?b="italic":-1!==a.indexOf("oblique")&&(b="oblique"),-1!==a.indexOf("bold")?e="bold":-1!==a.indexOf("light")&&(e="lighter"));return{style:b,weight:e}}function na(a,b,e,m,l,h){return y(this,void 0,void 0,function(){var d,k,n,f,g,c,w;return x(this,function(u){switch(u.label){case 0:if(!a)return[2];d=a.symbolLayers;if(!d)return[2];n=E.CIMSymbolHelper.getSize(a);"CIMPointSymbol"===a.type&&"Map"===a.angleAlignment&&(k=B.Alignment.MAP);f=d.length;u.label=1;case 1:if(!f--)return[3,23];
g=d[f];if(!g||!1===g.enable)return[3,1];c=[];E.OverrideHelper.findApplicableOverrides(g,b,c);w=g.type;switch(w){case "CIMSolidFill":return[3,2];case "CIMPictureFill":return[3,4];case "CIMHatchFill":return[3,6];case "CIMGradientFill":return[3,8];case "CIMSolidStroke":return[3,10];case "CIMPictureStroke":return[3,12];case "CIMGradientStroke":return[3,14];case "CIMCharacterMarker":return[3,16];case "CIMPictureMarker":return[3,17];case "CIMVectorMarker":return[3,19]}return[3,21];case 2:return[4,oa(g,
c,m,l)];case 3:return u.sent(),[3,22];case 4:return[4,pa(g,c,m,l)];case 5:return u.sent(),[3,22];case 6:return[4,qa(g,c,m,l)];case 7:return u.sent(),[3,22];case 8:return[4,ra(g,c,m,l)];case 9:return u.sent(),[3,22];case 10:return[4,sa(g,c,m,l,"CIMPolygonSymbol"===a.type,n)];case 11:return u.sent(),[3,22];case 12:return[4,ta(g,c,m,l,"CIMPolygonSymbol"===a.type,n)];case 13:return u.sent(),[3,22];case 14:return[4,ua(g,c,m,l,"CIMPolygonSymbol"===a.type,n)];case 15:return u.sent(),[3,22];case 16:return[3,
22];case 17:return[4,va(g,c,m,l,k,n)];case 18:return u.sent(),[3,22];case 19:return[4,wa(g,c,e,m,l,k,n,h)];case 20:return u.sent(),[3,22];case 21:xa.error("Cannot analyze CIM layer",g.type),u.label=22;case 22:return[3,1];case 23:return[2]}})})}function oa(a,b,e,m){return y(this,void 0,void 0,function(){var l,h,d,k,n,f;return x(this,function(g){switch(g.label){case 0:return l=a.primitiveName,h=F(a.color),d=D.numericHash(JSON.stringify(a)).toString(),n=(k=m).push,f={type:"fill",templateHash:d,materialHash:0===
b.length?d:function(){return d},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,q(l,"Color",b,e,h,G)];case 1:return n.apply(k,[(f.color=g.sent(),f.height=0,f.angle=0,f.offsetX=0,f.offsetY=0,f.scaleX=1,f)]),[2]}})})}function pa(a,b,e,m){return y(this,void 0,void 0,function(){var l,h,d,k,n,f,g;return x(this,function(c){switch(c.label){case 0:return l=a.primitiveName,h=F(a.tintColor),d=D.numericHash(JSON.stringify(a)).toString(),k=D.numericHash(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),
f=(n=m).push,g={type:"fill",templateHash:d,materialHash:0===b.length?k:function(){return k},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,q(l,"TintColor",b,e,h,G)];case 1:return g.color=c.sent(),[4,q(l,"Height",b,e,a.height)];case 2:return g.height=c.sent(),[4,q(l,"ScaleX",b,e,a.scaleX)];case 3:return g.scaleX=c.sent(),[4,q(l,"Rotation",b,e,a.rotation)];case 4:return g.angle=c.sent(),[4,q(l,"OffsetX",b,e,a.offsetX)];case 5:return g.offsetX=c.sent(),[4,q(l,"OffsetY",b,e,a.offsetY)];case 6:return f.apply(n,
[(g.offsetY=c.sent(),g)]),[2]}})})}function qa(a,b,e,m){return y(this,void 0,void 0,function(){var l,h,d,k,n,f,g,c;return x(this,function(w){switch(w.label){case 0:l=["Rotation","OffsetX","OffsetY"];h=b.filter(function(b){return b.primitiveName!==a.primitiveName&&-1===l.indexOf(b.propertyName)});d=a.primitiveName;k=D.numericHash(JSON.stringify(a)).toString();f=(n=m).push;g={type:"fill",templateHash:k};if(0!==b.length)return[3,1];c=k;return[3,3];case 1:return[4,O(k,h,e)];case 2:c=w.sent(),w.label=
3;case 3:return g.materialHash=c,g.cim=a,g.materialOverrides=h,g.colorLocked=a.colorLocked,g.color={r:128,g:128,b:128,a:1},g.height=0,g.scaleX=1,[4,q(d,"Rotation",b,e,a.rotation)];case 4:return g.angle=w.sent(),[4,q(d,"OffsetX",b,e,a.offsetX)];case 5:return g.offsetX=w.sent(),[4,q(d,"OffsetY",b,e,a.offsetY)];case 6:return f.apply(n,[(g.offsetY=w.sent(),g)]),[2]}})})}function ra(a,b,e,m){return y(this,void 0,void 0,function(){var l,h,d,k,n;return x(this,function(f){switch(f.label){case 0:l=D.numericHash(JSON.stringify(a)).toString();
d=(h=m).push;k={type:"fill",templateHash:l};if(0!==b.length)return[3,1];n=l;return[3,3];case 1:return[4,O(l,b,e)];case 2:n=f.sent(),f.label=3;case 3:return d.apply(h,[(k.materialHash=n,k.cim=a,k.materialOverrides=null,k.colorLocked=a.colorLocked,k.color={r:128,g:128,b:128,a:1},k.height=0,k.angle=0,k.offsetX=0,k.offsetY=0,k.scaleX=1,k)]),[2]}})})}function sa(a,b,e,m,l,h){return y(this,void 0,void 0,function(){var d,k,n,f,g,c,w,u,r,v;return x(this,function(p){switch(p.label){case 0:return d=D.numericHash(JSON.stringify(a)).toString(),
k=a.primitiveName,n=F(a.color),f=void 0!==a.width?a.width:4,g=M(a.capStyle),c=N(a.joinStyle),w=a.miterLimit,r=(u=m).push,v={type:"line",templateHash:d,materialHash:0===b.length?d:function(){return d},cim:a,materialOverrides:null,isOutline:l,colorLocked:a.colorLocked},[4,q(k,"Color",b,e,n,G)];case 1:return v.color=p.sent(),[4,q(k,"Width",b,e,f)];case 2:return v.width=p.sent(),[4,q(k,"CapStyle",b,e,g)];case 3:return v.cap=p.sent(),[4,q(k,"JoinStyle",b,e,c)];case 4:return v.join=p.sent(),[4,q(k,"MiterLimit",
b,e,w)];case 5:return r.apply(u,[(v.miterLimit=p.sent(),v.referenceWidth=h,v.zOrder=P(a.name),v.isDashed=!1,v)]),[2]}})})}function ta(a,b,e,m,l,h){return y(this,void 0,void 0,function(){var d,k,n,f,g,c,w,u,r,v,p;return x(this,function(A){switch(A.label){case 0:return d=D.numericHash(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),k=a.primitiveName,n=F(a.tintColor),f=void 0!==a.width?a.width:4,g=M(a.capStyle),c=N(a.joinStyle),w=a.miterLimit,u=D.numericHash(JSON.stringify(a)).toString(),v=
(r=m).push,p={type:"line",templateHash:u,materialHash:0===b.length?d:function(){return d},cim:a,materialOverrides:null,isOutline:l,colorLocked:a.colorLocked},[4,q(k,"TintColor",b,e,n,G)];case 1:return p.color=A.sent(),[4,q(k,"Width",b,e,f)];case 2:return p.width=A.sent(),[4,q(k,"CapStyle",b,e,g)];case 3:return p.cap=A.sent(),[4,q(k,"JoinStyle",b,e,c)];case 4:return p.join=A.sent(),[4,q(k,"MiterLimit",b,e,w)];case 5:return v.apply(r,[(p.miterLimit=A.sent(),p.referenceWidth=h,p.zOrder=P(a.name),p.isDashed=
!1,p)]),[2]}})})}function ua(a,b,e,m,l,h){return y(this,void 0,void 0,function(){var d,k,n,f,g,c,w,u,r,v;return x(this,function(p){switch(p.label){case 0:d=a.primitiveName;k=void 0!==a.width?a.width:4;n=M(a.capStyle);f=N(a.joinStyle);g=a.miterLimit;c=D.numericHash(JSON.stringify(a)).toString();u=(w=m).push;r={type:"line",templateHash:c};if(0!==b.length)return[3,1];v=c;return[3,3];case 1:return[4,O(c,b,e)];case 2:v=p.sent(),p.label=3;case 3:return r.materialHash=v,r.cim=a,r.materialOverrides=null,
r.isOutline=l,r.colorLocked=a.colorLocked,r.color={r:128,g:128,b:128,a:1},[4,q(d,"Width",b,e,k)];case 4:return r.width=p.sent(),[4,q(d,"CapStyle",b,e,n)];case 5:return r.cap=p.sent(),[4,q(d,"JoinStyle",b,e,f)];case 6:return r.join=p.sent(),[4,q(d,"MiterLimit",b,e,g)];case 7:return u.apply(w,[(r.miterLimit=p.sent(),r.referenceWidth=h,r.zOrder=P(a.name),r.isDashed=!1,r)]),[2]}})})}function va(a,b,e,m,l,h){return y(this,void 0,void 0,function(){var d,k,n,f,g,c,w,u,r,v,p,A,H,y,E,z;return x(this,function(t){switch(t.label){case 0:d=
a.primitiveName;k=a.size;n=a.scaleX;f=a.rotation;g=a.offsetX;c=a.offsetY;w=F(a.tintColor);u=D.numericHash(""+a.url+JSON.stringify(a.colorSubstitutions)).toString();r=!1;v="";p=0;for(A=b;p<A.length;p++)H=A[p],H.primitiveName===d&&(void 0!==H.value?v+="|"+H.primitiveName+"|"+H.propertyName+"|"+JSON.stringify(H.value):H.valueExpressionInfo&&(r=!0));E=(y=m).push;z={type:"marker",templateHash:D.numericHash(JSON.stringify(a)+v).toString(),materialHash:r?function(){return u}:u,cim:a,materialOverrides:null,
colorLocked:a.colorLocked,scaleSymbolsProportionally:!1,alignment:l,anchorPoint:a.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits};return[4,q(d,"Size",b,e,k)];case 1:return z.size=t.sent(),[4,q(d,"ScaleX",b,e,n)];case 2:return z.scaleX=t.sent(),[4,q(d,"Rotation",b,e,f)];case 3:return z.rotation=t.sent(),[4,q(d,"OffsetX",b,e,g)];case 4:return z.offsetX=t.sent(),[4,q(d,"OffsetY",b,e,c)];case 5:return z.offsetY=t.sent(),[4,q(d,"TintColor",b,e,w,G)];case 6:return E.apply(y,[(z.color=
t.sent(),z.outlineColor={r:0,g:0,b:0,a:0},z.outlineWidth=0,z.frameHeight=0,z.rotateClockwise=a.rotateClockwise,z.referenceSize=h,z.sizeRatio=1,z)]),[2]}})})}function wa(a,b,e,m,l,h,d,k){return y(this,void 0,void 0,function(){var n,f,g,c,w,u,r,q;return x(this,function(p){switch(p.label){case 0:n=a.markerGraphics;if(!n)return[2];f=0;a.scaleSymbolsProportionally&&(g=a.frame)&&(f=g.ymax-g.ymin);c=[];w=0;for(u=n;w<u.length;w++)if(r=u[w])if(q=r.symbol)switch(q.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":c.push(ya(a,
r,b,m,l,h,d,f,k));break;case "CIMTextSymbol":c.push(za(a,r,b,e,m,l,h,d,f))}return[4,ja.all(c)];case 1:return p.sent(),[2]}})})}function za(a,b,e,m,l,h,d,k,n){return y(this,void 0,void 0,function(){var f,g,c,w,u,r,v,p,A,H,y,ea,z,t,S,K,Q,B,G,T,J,W,X,C;return x(this,function(x){switch(x.label){case 0:f=[];E.OverrideHelper.findApplicableOverrides(b,e,f);g=b.geometry;if(!("x"in g&&"y"in g))return[2];c=b.symbol;w=c.underline?"underline":c.strikethrough?"line-through":"none";u=ma(c.fontStyleName);c.font=
ga({family:c.fontFamilyName,decoration:w},u);r=a.frame;v=g.x-.5*(r.xmin+r.xmax);p=g.y-.5*(r.ymin+r.ymax);A=a.size/n;H=a.primitiveName;y=(c.height||0)*A;ea=c.angle||0;z=((c.offsetX||0)+v)*A;t=((c.offsetY||0)+p)*A;S=F(E.CIMSymbolHelper.getFillColor(c));K=F(E.CIMSymbolHelper.getStrokeColor(c));Q=E.CIMSymbolHelper.getStrokeWidth(c);Q||(K=F(E.CIMSymbolHelper.getFillColor(c.haloSymbol)),Q=c.haloSize*A);B="";G=0;for(T=e;G<T.length;G++)J=T[G],J.primitiveName===H&&void 0!==J.value&&(B+="|"+J.primitiveName+
"|"+J.propertyName+"|"+JSON.stringify(J.value));X=(W=h).push;C={type:"text",templateHash:D.numericHash(JSON.stringify(b)+B).toString(),materialHash:function(){return D.numericHash(JSON.stringify(c.font)).toString()},cim:c,materialOverrides:null,colorLocked:a.colorLocked,alignment:d,anchorPoint:{x:a.anchorPoint?a.anchorPoint.x:0,y:a.anchorPoint?a.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits,fontName:c.fontFamilyName,decoration:"none",weight:"normal",style:"normal"};return[4,
q(H,"Height",e,l,y)];case 1:return C.size=x.sent(),[4,q(H,"Rotation",e,l,ea)];case 2:return C.angle=x.sent(),[4,q(H,"OffsetX",e,l,z)];case 3:return C.offsetX=x.sent(),[4,q(H,"OffsetY",e,l,t)];case 4:return X.apply(W,[(C.offsetY=x.sent(),C.horizontalAlignment=ka(c.horizontalAlignment),C.verticalAlignment=la(c.verticalAlignment),C.text=Aa(m,b.textString,c.textCase),C.color=S,C.outlineColor=K,C.outlineSize=Q,C.referenceSize=k,C.sizeRatio=1,C)]),[2]}})})}function ya(a,b,e,m,l,h,d,k,n){return y(this,void 0,
void 0,function(){var f,g,c,w,u,r;return x(this,function(v){switch(v.label){case 0:f=b.symbol;g=b.geometry;if(!g)return[2];c=da.getExtent(g);if("CIMTextSymbol"===f.type)return[2];w=f.symbolLayers;if(!w)return[2];u=w.length;r=function(){var f,r,v,y,B,z,t,S,K,Q,O,R,T,J,W,X,C,M,N,Z,P,L,aa,U,V,Y,I,ba,ca;return x(this,function(p){switch(p.label){case 0:return(f=w[u])&&!1!==f.enable?n?[4,fa(a,b,e,m,l,h,d,k)]:[3,2]:[2,"continue"];case 1:return p.sent(),[2,"continue"];case 2:r=f.type;switch(r){case "CIMSolidFill":return[3,
3];case "CIMSolidStroke":return[3,3]}return[3,15];case 3:v=da.getSDFMetrics(c,a.frame,a.size,a.anchorPoint,"Relative"!==a.anchorPointUnits);y=v[0];B=v[1];z=v[2];t="CIMSolidFill"===f.type;S={type:"sdf",geom:g,asFill:t};K=a.primitiveName;Q=a.size;O=a.rotation;R=a.offsetX;T=a.offsetY;J=f.primitiveName;W=t?F(E.CIMSymbolHelper.getFillColor(f)):F(E.CIMSymbolHelper.getStrokeColor(f));X=t?{r:0,g:0,b:0,a:0}:F(E.CIMSymbolHelper.getStrokeColor(f));C=E.CIMSymbolHelper.getStrokeWidth(f);if(!t&&!C)return[3,16];
M=!1;N="";Z=0;for(P=e;Z<P.length;Z++)if(L=P[Z],L.primitiveName===J||L.primitiveName===K)void 0!==L.value?N+="|"+L.primitiveName+"|"+L.propertyName+"|"+JSON.stringify(L.value):L.valueExpressionInfo&&(M=!0);aa=D.numericHash(JSON.stringify(S)).toString();U=D.numericHash(JSON.stringify(f)+JSON.stringify(b)+N).toString();Y=(V=l).push;I={type:"marker",templateHash:U,materialHash:M?function(){return aa}:aa,cim:S,materialOverrides:null,colorLocked:a.colorLocked,scaleSymbolsProportionally:a.scaleSymbolsProportionally,
alignment:h,anchorPoint:{x:B,y:z},isAbsoluteAnchorPoint:!1};return[4,q(K,"Size",e,m,Q)];case 4:return I.size=p.sent(),I.scaleX=1,[4,q(K,"Rotation",e,m,O)];case 5:return I.rotation=p.sent(),[4,q(K,"OffsetX",e,m,R)];case 6:return I.offsetX=p.sent(),[4,q(K,"OffsetY",e,m,T)];case 7:return I.offsetY=p.sent(),[4,q(J,"Color",e,m,W,G)];case 8:I.color=p.sent();if(!t)return[3,9];ba={r:0,g:0,b:0,a:0};return[3,11];case 9:return[4,q(J,"Color",e,m,X,G)];case 10:ba=p.sent(),p.label=11;case 11:I.outlineColor=ba;
if(!t)return[3,12];ca=0;return[3,14];case 12:return[4,q(J,"Width",e,m,C)];case 13:ca=p.sent(),p.label=14;case 14:return Y.apply(V,[(I.outlineWidth=ca,I.frameHeight=k,I.rotateClockwise=a.rotateClockwise,I.referenceSize=d,I.sizeRatio=y,I)]),[3,16];case 15:return fa(a,b,e,m,l,h,d,k),[3,16];case 16:return[2]}})};v.label=1;case 1:return u--?[5,r()]:[3,3];case 2:return v.sent(),[3,1];case 3:return[2]}})})}function fa(a,b,e,m,l,h,d,k){return y(this,void 0,void 0,function(){var n,f,g,c,w,u,r,v,p,A,y,B,G,
z,t,F;return x(this,function(x){switch(x.label){case 0:n={type:a.type,enable:!0,name:a.name,colorLocked:a.colorLocked,primitiveName:a.primitiveName,anchorPoint:a.anchorPoint,anchorPointUnits:a.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:a.rotateClockwise,rotation:0,size:a.size,billboardMode3D:a.billboardMode3D,depth3D:a.depth3D,frame:a.frame,markerGraphics:[b],scaleSymbolsProportionally:a.scaleSymbolsProportionally,respectFrame:a.respectFrame,clippingPath:a.clippingPath};f=[];g=["Rotation",
"OffsetX","OffsetY"];f=e.filter(function(b){return b.primitiveName!==a.primitiveName||-1===g.indexOf(b.propertyName)});c=E.CIMSymbolHelper.getTextureAnchor(n);w=c[0];u=c[1];r=JSON.stringify(n);v=a.primitiveName;p=a.rotation;A=a.offsetX;y=a.offsetY;B=D.numericHash(JSON.stringify(n)).toString();z=(G=l).push;t={type:"marker",templateHash:B};if(0!==f.length)return[3,1];F=B;return[3,3];case 1:return[4,O(r,f,m)];case 2:F=x.sent(),x.label=3;case 3:return t.materialHash=F,t.cim=n,t.materialOverrides=f,t.colorLocked=
a.colorLocked,t.scaleSymbolsProportionally=a.scaleSymbolsProportionally,t.alignment=h,t.anchorPoint={x:w,y:u},t.isAbsoluteAnchorPoint=!1,t.size=a.size,t.scaleX=1,[4,q(v,"Rotation",e,m,p)];case 4:return t.rotation=x.sent(),[4,q(v,"OffsetX",e,m,A)];case 5:return t.offsetX=x.sent(),[4,q(v,"OffsetY",e,m,y)];case 6:return z.apply(G,[(t.offsetY=x.sent(),t.color={r:0,g:0,b:0,a:0},t.outlineColor={r:0,g:0,b:0,a:0},t.outlineWidth=0,t.frameHeight=k,t.rotateClockwise=a.rotateClockwise,t.referenceSize=d,t.sizeRatio=
1,t)]),[2]}})})}function P(a){return a&&0===a.indexOf("Level_")?parseInt(a.substr(6),10):0}function G(a){if(!a||0===a.length)return null;a=(new ha(a)).toRgba();return{r:a[0],g:a[1],b:a[2],a:a[3]}}function q(a,b,e,m,l,h){return y(this,void 0,void 0,function(){var d,k,n,f,g;return x(this,function(c){switch(c.label){case 0:if(!a)return[3,4];d=function(c){var f,g,e;return x(this,function(d){switch(d.label){case 0:if(c.primitiveName!==a||c.propertyName!==b)return[3,2];if(void 0!==c.value)return[2,{value:h?
h(c.value):c.value}];f=c.valueExpressionInfo;if(!f)return[3,2];g=f.expression;return[4,U.createRendererExpression(g,m.spatialReference,m.fields)];case 1:return e=d.sent(),[2,{value:function(a,b,c){a=V.callWithFeature(e,a,{$view:c},m.geometryType,b);null!==a&&h&&(a=h(a));return null!==a?a:l}}];case 2:return[2]}})};k=0;n=e;c.label=1;case 1:if(!(k<n.length))return[3,4];f=n[k];return[5,d(f)];case 2:g=c.sent();if("object"===typeof g)return[2,g.value];c.label=3;case 3:return k++,[3,1];case 4:return[2,l]}})})}
function Y(a,b){switch(b){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}function Aa(a,b,e){if(!a||-1===b.indexOf("["))return Y(b,e);var m=function(a){for(var b=a.length;b--;)if(-1===" /-,\n".indexOf(a.charAt(b)))return!1;return!0},l=[],h=0,d=-1;do d=b.indexOf("[",h),d>=h&&(d>h&&(h=b.substr(h,d-h),l.push([h,null,m(h)])),h=d+1,d=b.indexOf("]",h),d>=h&&(d>h&&(h=b.substr(h,d-h),(h=a[h])&&l.push([null,h,!1])),h=d+1));while(-1!==d);h<b.length-1&&(h=b.substr(h),
l.push([h,null,m(h)]));return function(a){for(var b="",f=null,g=0;g<l.length;g++){var c=l[g],d=c[0],h=c[1],c=c[2];if(d)c?f=d:(f&&(b+=f,f=null),b+=d);else if(d=a.attributes[h])f&&(b+=f,f=null),b+=d}return Y(b,e)}}function O(a,b,e){return y(this,void 0,void 0,function(){var m,l,h,d;return x(this,function(k){switch(k.label){case 0:m=function(a){var b,d,c;return x(this,function(f){switch(f.label){case 0:b=a.valueExpressionInfo;if(!b)return[3,2];d=b.expression;return[4,U.createRendererExpression(d,e.spatialReference,
e.fields)];case 1:c=f.sent(),a.fn=function(a,b,d){return V.callWithFeature(c,a,{$view:d},e.geometryType,b)},f.label=2;case 2:return[2]}})},l=0,h=b,k.label=1;case 1:if(!(l<h.length))return[3,4];d=h[l];return[5,m(d)];case 2:k.sent(),k.label=3;case 3:return l++,[3,1];case 4:return[2,function(d,f,e){for(var c=0;c<b.length;c++){var g=b[c];g.fn&&(g.value=g.fn(d,f,e))}return D.numericHash(a+E.OverrideHelper.buildOverrideKey(b)).toString()}]}})})}Object.defineProperty(R,"__esModule",{value:!0});var xa=ia.getLogger("esri.symbols.cim.cimAnalyzer");
R.analyzeCIMSymbol=function(a,b,e,m,l){return y(this,void 0,void 0,function(){var h,d,k,n;return x(this,function(f){switch(f.label){case 0:h=m?m:[];if(!a)return[2,h];"CIMSymbolReference"===a.type?(d=a.symbol,k=a.primitiveOverrides):(d=a,k=null);n=d.type;switch(n){case "CIMPointSymbol":return[3,1];case "CIMLineSymbol":return[3,1];case "CIMPolygonSymbol":return[3,1];case "CIMTextSymbol":return[3,3]}return[3,4];case 1:return[4,na(d,k,b,e,h,l)];case 2:return f.sent(),[3,4];case 3:return[3,4];case 4:return[2,
h]}})})};R.analyzeCIMResource=function(a,b){if(!b||0===b.length)return a;a=JSON.parse(JSON.stringify(a));E.OverrideHelper.applyOverrides(a,b);return a}});