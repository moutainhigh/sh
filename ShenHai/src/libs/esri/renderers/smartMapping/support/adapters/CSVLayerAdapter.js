// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/accessorSupport/decorators ../../statistics/support/utils ../utils ./FeatureLayerAdapter ./support/utils ../../../../tasks/support/generateRendererUtils".split(" "),function(C,D,v,w,x,y,n,p,z,A,B,g,q){function r(b){return"esri.tasks.support.ClassBreaksDefinition"===
b.declaredClass}function t(b){return"esri.tasks.support.UniqueValueDefinition"===b.declaredClass}return function(b){function a(d){return b.call(this,d)||this}v(a,b);a.prototype._createGenerateRendererResult=function(d,k,c,u,m){return y(this,void 0,void 0,function(){var e,b,h,f,a;return x(this,function(l){switch(l.label){case 0:b=(e=d&&d.features)&&e.length;if(!b)throw new n("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");h=null;return"percent-of-total"!==
u?[3,2]:[4,g.calculateStatsFromMemory({field:k},e)];case 1:f=l.sent();h=f.sum;if(null==h)throw new n("csv-layer-adapter:invalid","invalid normalizationTotal");l.label=2;case 2:return r(m)?[4,g.getDataValues({field:k,normalizationType:u,normalizationField:c,normalizationTotal:h},e)]:[3,4];case 3:return a=l.sent().filter(function(c){return null!=c&&g.isValidNumber(c)}),[2,q.createGenerateRendererClassBreaks({definition:m,values:a,normalizationTotal:h})];case 4:return t(m)?[4,g.getDataValues({field:k},
e)]:[3,6];case 5:return a=l.sent().filter(function(c){return null!=c&&"string"===typeof c&&""!==c.trim()}),[2,q.createGenerateRendererUniqueValues(a)];case 6:return[2,void 0]}})})};a.prototype.generateRenderer=function(a){var k=this,c=a.classificationDefinition,b=null,d=null,e=null;r(c)?(b=c.classificationField,d=c.normalizationField,e=c.normalizationType):t(c)&&(b=c.attributeField);var g=this.layer;return A.getFieldsList({field:b,normalizationField:d}).then(function(h){var f=g.createQuery();f.returnGeometry=
!1;f.outFields=h;f.where=z.mergeWhereClauses(f.where,a.where);return g.queryFeatures(f).then(function(a){return k._createGenerateRendererResult(a,b,d,e,c)})})};a.prototype.load=function(a){var b=this;a=this.layer.load(a).then(function(a){b.geometryType=a.geometryType;b.objectIdField=a.objectIdField;b.supportsSQLExpression=!0;b._hasLocalSource=!1;b.hasQueryEngine=!0});this.addResolvingPromise(a);return this.when()};return a=w([p.subclass("esri.renderers.smartMapping.support.adapters.CSVLayerAdapter")],
a)}(p.declared(B))});